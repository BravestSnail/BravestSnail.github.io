<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Compose的动画 | BravestSnail's Blog</title><meta name="author" content="BravestSnail"><meta name="copyright" content="BravestSnail"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="乍一看Jetpack Compose中的动画Api，尼玛是真的多呀，我C了，简直令人眼花缭乱、云里雾里、天马行空、小兔乱撞、手脚慌乱、头冒虚汗、四肢抓狂、不知所措呀 。。。😭 但是我们可以对其进行分一下类，如果按照使用的方便程度划分，大概可以分为两大类：高级动画API和低级动画API（这里类比高级开发语言的分类，并不是指效果多高级）。 其中高级动画API使用比较简单方便，封装度高，更加适用于日">
<meta property="og:type" content="article">
<meta property="og:title" content="Compose的动画">
<meta property="og:url" content="https://bravestsnail.github.io/2025/05/29/note/Android/compose/Compose%E7%9A%84%E5%8A%A8%E7%94%BB/index.html">
<meta property="og:site_name" content="BravestSnail&#39;s Blog">
<meta property="og:description" content="乍一看Jetpack Compose中的动画Api，尼玛是真的多呀，我C了，简直令人眼花缭乱、云里雾里、天马行空、小兔乱撞、手脚慌乱、头冒虚汗、四肢抓狂、不知所措呀 。。。😭 但是我们可以对其进行分一下类，如果按照使用的方便程度划分，大概可以分为两大类：高级动画API和低级动画API（这里类比高级开发语言的分类，并不是指效果多高级）。 其中高级动画API使用比较简单方便，封装度高，更加适用于日">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://bravestsnail.github.io/images/avatar.png">
<meta property="article:published_time" content="2025-05-29T16:00:00.000Z">
<meta property="article:modified_time" content="2025-06-04T12:46:35.125Z">
<meta property="article:author" content="BravestSnail">
<meta property="article:tag" content="Android">
<meta property="article:tag" content="Compose">
<meta property="article:tag" content="动画">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://bravestsnail.github.io/images/avatar.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Compose的动画",
  "url": "https://bravestsnail.github.io/2025/05/29/note/Android/compose/Compose%E7%9A%84%E5%8A%A8%E7%94%BB/",
  "image": "https://bravestsnail.github.io/images/avatar.png",
  "datePublished": "2025-05-29T16:00:00.000Z",
  "dateModified": "2025-06-04T12:46:35.125Z",
  "author": [
    {
      "@type": "Person",
      "name": "BravestSnail",
      "url": "https://bravestsnail.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/images/favicon.ico"><link rel="canonical" href="https://bravestsnail.github.io/2025/05/29/note/Android/compose/Compose%E7%9A%84%E5%8A%A8%E7%94%BB/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Compose的动画',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>if(window.mermaid){mermaid.initialize({startOnLoad:true});}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/images/favicon.ico" alt="Logo"><span class="site-name">BravestSnail's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">Compose的动画</span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">Compose的动画</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-05-29T16:00:00.000Z" title="发表于 2025-05-30 00:00:00">2025-05-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-06-04T12:46:35.125Z" title="更新于 2025-06-04 20:46:35">2025-06-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/note/">note</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><!-- filepath: /Users/lijiapei/Project/Blog/source/_posts/note/compose/Compose的动画.md -->
<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/8b6babf1ad8edf0de8acca471ee37105.png%23pic_center" alt="在这里插入图片描述"><br>乍一看Jetpack Compose中的动画Api，尼玛是真的多呀，我C了，简直令人眼花缭乱、云里雾里、天马行空、小兔乱撞、手脚慌乱、头冒虚汗、四肢抓狂、不知所措呀 。。。😭</p>
<p>但是我们可以对其进行分一下类，如果按照使用的方便程度划分，大概可以分为两大类：高级动画API和低级动画API（这里类比高级开发语言的分类，并不是指效果多高级）。</p>
<p>其中高级动画API使用比较简单方便，封装度高，更加适用于日常业务开发，而低级动画API则使用起来较为麻烦，因为其配置项或流程较多，但是却更加灵活，能对动画效果做出更加精细的控制，适合自定义要求度较高的业务场景。</p>
<p>我们还可以按照功能类型进行一个大概的分类，也就是上图中的划分，这里再用表格归类一下：</p>
<table>
<thead>
<tr>
<th>功能需求点</th>
<th>可能符合的API类型</th>
</tr>
</thead>
<tbody><tr>
<td>单个组件的显示隐藏转场动画  <br>每个子组件需要不同的入场&#x2F;出场效果</td>
<td>AnimatedVisibility</td>
</tr>
<tr>
<td>根据组件内容状态变化的动画(数据、尺寸等)  <br>不同组件间的切换动画</td>
<td>AnimatedContent  <br>Modifier.animateContentSize</td>
</tr>
<tr>
<td>单纯的淡入淡出动画</td>
<td>Crossfade</td>
</tr>
<tr>
<td>根据数据估值状态自动执行连续动画  <br>基于单个数据值的状态变化执行动画  <br>基于自定义数据类型进行估值动画  <br>指定每一帧&#x2F;每一时刻的动画状态  <br>替代传统属性动画的方案</td>
<td>animateXXXAsState</td>
</tr>
<tr>
<td>根据不同状态同时管理和运行多个动画  <br>进入界面时自动执行一次动画  <br>监听动画状态  <br>替代传统View动画中的AnimationSet的方案。</td>
<td>updateTransition  <br>MutableTransitionState</td>
</tr>
<tr>
<td>永不停止、无限循环的动画</td>
<td>rememberInfiniteTransition</td>
</tr>
<tr>
<td>更加底层的低级动画API  <br>可高度自由定制的估值属性动画  <br>需要在协程中执行的动画  <br>需要控制一些动画并行执行</td>
<td>Animatable</td>
</tr>
<tr>
<td>更加底层的低级动画API  <br>需要手动精确控制动画的时间  <br>手势动画，fling衰减动画</td>
<td>TargetBasedAnimation  <br>DecayAnimation</td>
</tr>
</tbody></table>
<h2 id="高级动画API"><a href="#高级动画API" class="headerlink" title="高级动画API"></a>高级动画API</h2><h3 id="AnimatedVisibility"><a href="#AnimatedVisibility" class="headerlink" title="AnimatedVisibility"></a>AnimatedVisibility</h3><p><strong>AnimatedVisibility</strong>主要用于页面显示状态的动画，即显示&#x2F;隐藏的过渡动画，或者入场&#x2F;离场动画。<br>可以使用 <strong>+</strong> 运算符组合多个 <strong>EnterTransition</strong> 或 <strong>ExitTransition</strong> 对象，并且每个对象都接受可选参数以自定义其行为。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatedVisibilityExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> visible <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">true</span>) &#125;</span><br><span class="line">    <span class="keyword">val</span> density = LocalDensity.current</span><br><span class="line">    Box(Modifier.fillMaxWidth(), contentAlignment = Alignment.TopCenter) &#123;</span><br><span class="line">        AnimatedVisibility(</span><br><span class="line">            visible = visible,</span><br><span class="line">            enter = slideInVertically &#123; with(density) &#123; -<span class="number">40.</span>dp.roundToPx() &#125; &#125; <span class="comment">// 从顶部 40dp 的地方开始滑入</span></span><br><span class="line">                    + expandVertically(expandFrom = Alignment.Top)  <span class="comment">// 从顶部开始展开</span></span><br><span class="line">                    + fadeIn(initialAlpha = <span class="number">0.3f</span>), <span class="comment">// 从初始透明度 0.3f 开始淡入</span></span><br><span class="line">            exit = slideOutVertically() + shrinkVertically() + fadeOut()</span><br><span class="line">        ) &#123;</span><br><span class="line">            Text(<span class="string">&quot;Hello&quot;</span>,</span><br><span class="line">                Modifier.background(Color.Green).fillMaxWidth().height(<span class="number">200.</span>dp)</span><br><span class="line">                    .wrapContentWidth(Alignment.CenterHorizontally),</span><br><span class="line">                fontSize = <span class="number">20.</span>sp</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">        Button(</span><br><span class="line">            onClick = &#123; visible = !visible &#125;,</span><br><span class="line">            modifier = Modifier.padding(top = <span class="number">200.</span>dp)</span><br><span class="line">        ) &#123;</span><br><span class="line">            Text(text = <span class="keyword">if</span>(visible) <span class="string">&quot;隐藏&quot;</span> <span class="keyword">else</span> <span class="string">&quot;显示&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行效果：<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/3e22b4715acd83d62846ddb060aa4a79.gif"></p>
<p>默认情况下 <strong>EnterTransition</strong> 是 <strong>fadeIn() + expandIn()</strong> 的效果，而 <strong>ExitTransition</strong> 是 <strong>shrinkOut() + fadeOut()</strong> 的效果， Compose额外提供了<strong>RowScope.AnimatedVisibility</strong>和<strong>ColumnScope.AnimatedVisibility</strong>两个扩展方法， 当我们在<strong>Row</strong>或<strong>Column</strong>中调用时，该组件的默认动画效果会根据父容器的布局特征进行调整，比如在<strong>Row</strong>中<strong>EnterTransition</strong>默认是<strong>fadeIn + expandHorizontally</strong>组合，而在<strong>Column</strong>中<strong>EnterTransition</strong>默认是<strong>fadeIn + expandVertically</strong>组合方案。</p>
<p><strong>EnterTransition</strong> 和 <strong>ExitTransition</strong> 动画分类效果示例：</p>
<table>
<thead>
<tr>
<th>EnterTransition</th>
<th>ExitTransition</th>
</tr>
</thead>
<tbody><tr>
<td>FadeIn<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/67d0860deeec8a99ea7f2cce7d6098f9.gif%23pic_center"></td>
<td>FadeOut<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/ef1ca6d769ae298e376e713c798f3bf8.gif%23pic_center"></td>
</tr>
<tr>
<td>slideIn<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/1dff32012ca8f26ba7c7f08a42d6c833.gif%23pic_center"></td>
<td>slideOut<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/6133f5399ec5c1f4fdede031a168bdbe.gif%23pic_center"></td>
</tr>
<tr>
<td>slideInHorizontally<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/cbfd3accac9e76aafd7e25f17eb8a57d.gif%23pic_center"></td>
<td>slideOutHorizontally<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/313364af392b206d901220e8779adb46.gif%23pic_center"></td>
</tr>
<tr>
<td>slideInVertically<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/f66fad6f439ecee50d8577521ded3e74.gif%23pic_center"></td>
<td>slideOutVertically<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/56adb93b11b0b1968253c8d7b604de01.gif%23pic_center"></td>
</tr>
<tr>
<td>scaleIn<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/05dcc7896ee6f719437b2d233d639286.gif%23pic_center"></td>
<td>scaleOut<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/201109df2aadf656953a12d8889cdb40.gif%23pic_center"></td>
</tr>
<tr>
<td>expandIn<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/8a6b470f6789653b6b5b3e309b4b41f3.gif%23pic_center"></td>
<td>shrinkOut<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/a0a5c0892fb90b84f6f8dcfc13bae429.gif%23pic_center"></td>
</tr>
<tr>
<td>expandHorizontally<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/66e0e708d3f676467b4236bbb8fd3625.gif%23pic_center"></td>
<td>shrinkHorizontally<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/d46b61381d6ff493359596f5ad4af9f7.gif%23pic_center"></td>
</tr>
<tr>
<td>expandVertically<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/4ff8c840f478b2ddcdd6a5badc598b0d.gif%23pic_center"></td>
<td>shrinkVertically<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/93bd8b421695eaedd09f6fa503b19c1e.gif%23pic_center"></td>
</tr>
</tbody></table>
<h4 id="为子项添加进入和退出动画效果"><a href="#为子项添加进入和退出动画效果" class="headerlink" title="为子项添加进入和退出动画效果"></a>为子项添加进入和退出动画效果</h4><p><strong>AnimatedVisibility</strong> 中的内容（直接或间接子项）可以使用 <strong>Modifier.animateEnterExit</strong> 修饰符为每个子项指定不同的动画行为。</p>
<p>其中每个子项的视觉效果均由 AnimatedVisibility 可组合项中指定的动画与子项自己的进入和退出动画构成。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalAnimationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatedVisibilityExample3</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> visible <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">true</span>) &#125;</span><br><span class="line">    Box(Modifier.fillMaxWidth(), contentAlignment = Alignment.TopCenter) &#123;</span><br><span class="line">        AnimatedVisibility(visible = visible, enter = fadeIn(), exit = fadeOut()) &#123;</span><br><span class="line">            <span class="comment">// 外层Box组件淡入淡出进出屏幕</span></span><br><span class="line">            Box(Modifier.fillMaxSize().background(Color.DarkGray)) &#123;</span><br><span class="line">                Box(Modifier.align(Alignment.Center)</span><br><span class="line">                    .sizeIn(minWidth = <span class="number">256.</span>dp, minHeight = <span class="number">64.</span>dp).background(Color.Green)</span><br><span class="line">                    .animateEnterExit(enter = slideInVertically(), exit = slideOutVertically())</span><br><span class="line">                ) &#123;</span><br><span class="line">                    Text(text = <span class="string">&quot;内层Box组件滑动进出屏幕&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">                &#125;</span><br><span class="line">                Box(Modifier.padding(top = <span class="number">150.</span>dp).align(Alignment.Center)</span><br><span class="line">                    .sizeIn(minWidth = <span class="number">256.</span>dp, minHeight = <span class="number">64.</span>dp).background(Color.Cyan)</span><br><span class="line">                    .animateEnterExit(enter = scaleIn(), exit = scaleOut())</span><br><span class="line">                ) &#123;</span><br><span class="line">                    Text(text = <span class="string">&quot;内层层Box组件缩放进出屏幕&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Button(</span><br><span class="line">            onClick = &#123; visible = !visible &#125;,</span><br><span class="line">            modifier = Modifier.padding(top = <span class="number">50.</span>dp)</span><br><span class="line">        ) &#123;</span><br><span class="line">            Text(text = <span class="keyword">if</span>(visible) <span class="string">&quot;隐藏&quot;</span> <span class="keyword">else</span> <span class="string">&quot;显示&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行效果：<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/655aa60d412587d6854b90d14bf041cc.gif"></p>
<p>有时我们希望 <strong>AnimatedVisibility</strong> 内的<strong>每个子组件有不同的过渡动画</strong>，此时请在 <strong>AnimatedVisibility</strong> 可组合项中指定 <strong>EnterTransition.None</strong> 和 <strong>ExitTransition.None</strong>，即完全不应用任何动画，这样子项就可以通过 <strong>Modifier.animateEnterExit</strong> 拥有各自的不同动画了。</p>
<h4 id="自定义Enter-Exit动画"><a href="#自定义Enter-Exit动画" class="headerlink" title="自定义Enter&#x2F;Exit动画"></a>自定义Enter&#x2F;Exit动画</h4><p>如果想在内置进入和退出动画之外添加自定义动画效果，请在 <strong>AnimatedVisibilityScope</strong> 内设置 <strong>transition</strong>， 添加到 <strong>Transition</strong> 实例的所有动画状态都将与 <strong>AnimatedVisibility</strong> 的进入和退出动画同时运行。</p>
<p><strong>AnimatedVisibility</strong> 会等到 <strong>Transition</strong> 中的所有动画都完成后再移除其内容。对于独立于 <strong>Transition</strong>（例如使用 <strong>animate*AsState</strong>）创建的退出动画，<strong>AnimatedVisibility</strong> 将无法解释这些动画，因此可能会在完成之前移除内容可组合项。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalAnimationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatedVisibilityExample4</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> visible <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">true</span>) &#125;</span><br><span class="line">    Box(Modifier.fillMaxWidth(), contentAlignment = Alignment.TopCenter) &#123;</span><br><span class="line">        AnimatedVisibility(visible = visible, enter = scaleIn(), exit = scaleOut()) &#123;</span><br><span class="line">            <span class="comment">// 使用 AnimatedVisibilityScope#transition 添加自定义的动画与AnimatedVisibility同时执行</span></span><br><span class="line">            <span class="keyword">val</span> background <span class="keyword">by</span> transition.animateColor(label = <span class="string">&quot;backgroundTransition&quot;</span>) &#123; state -&gt;</span><br><span class="line">                <span class="keyword">if</span> (state == EnterExitState.Visible) Color.Blue <span class="keyword">else</span> Color.Green</span><br><span class="line">            &#125;</span><br><span class="line">            Box(modifier = Modifier.size(<span class="number">100.</span>dp).background(background))</span><br><span class="line">        &#125;</span><br><span class="line">        Button(</span><br><span class="line">            onClick = &#123; visible = !visible &#125;,</span><br><span class="line">            modifier = Modifier.padding(top = <span class="number">120.</span>dp)</span><br><span class="line">        ) &#123;</span><br><span class="line">            Text(text = <span class="keyword">if</span>(visible) <span class="string">&quot;隐藏&quot;</span> <span class="keyword">else</span> <span class="string">&quot;显示&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行效果：<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/0c9632dc2cede9bb46eb7cff055c3220.gif"></p>
<h3 id="AnimatedContent"><a href="#AnimatedContent" class="headerlink" title="AnimatedContent"></a>AnimatedContent</h3><p><strong>AnimatedContent</strong> 可组合项会在内容根据目标状态发生变化时，为内容添加动画效果。<br>与 AnimatedVisibility 的区别是: <strong>AnimatedVisibility用来添加组件自身的入场&#x2F;离场动画，而AnimatedContent是实现不同组件间的切换动画</strong></p>
<p>AnimatedContent接收一个<strong>targetState</strong>和一个<strong>content</strong>，<strong>content</strong> 是基于 <strong>targetState</strong> 创建的<strong>Composable</strong>，当<strong>targetState</strong>变化时，<strong>content</strong>的内容也会随之变化。<strong>AnimatedContent</strong>内部维护着<strong>targetState</strong>到<strong>content</strong>的映射表，查找 <strong>targetState</strong>新旧值对应的<strong>content</strong>后，在<strong>content</strong>发生重组时附加动画效果。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalAnimationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatedContentExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column &#123;</span><br><span class="line">        <span class="keyword">var</span> count <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">0</span>) &#125;</span><br><span class="line">        Button(onClick = &#123; count++ &#125;) &#123; Text(<span class="string">&quot;Add&quot;</span>) &#125;</span><br><span class="line">        AnimatedContent(targetState = count) &#123; targetCount -&gt;</span><br><span class="line">            <span class="comment">// 这里要使用lambda的参数 `targetCount`, 而不是 `count`，否则将没有意义（API 会将此值用作键，以标识当前显示的内容）</span></span><br><span class="line">            Text(text = <span class="string">&quot;Count: <span class="variable">$targetCount</span>&quot;</span>, Modifier.background(Color.Green), fontSize = <span class="number">25.</span>sp)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行效果：<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/5147c0b86727d15fab581f2057883976.gif"></p>
<h4 id="ContentTransform"><a href="#ContentTransform" class="headerlink" title="ContentTransform"></a>ContentTransform</h4><p><strong>AnimatedContent</strong>默认是淡入淡出效果，可以为 <strong>transitionSpec</strong> 参数指定 <strong>ContentTransform</strong> 对象，以自定义此动画行为。</p>
<p>可以使用 <strong>with infix</strong> 函数来组合 <strong>EnterTransition</strong> 与 <strong>ExitTransition</strong>，以创建 <strong>ContentTransform</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExperimentalAnimationApi</span></span><br><span class="line"><span class="keyword">infix</span> <span class="function"><span class="keyword">fun</span> EnterTransition.<span class="title">with</span><span class="params">(exit: <span class="type">ExitTransition</span>)</span></span> = ContentTransform(<span class="keyword">this</span>, exit)</span><br></pre></td></tr></table></figure>

<p><strong>ContentTransform</strong>本质上就是<strong>currentContent(initial)</strong> 的 <strong>ExitTransition</strong>与<strong>targetContent</strong>的<strong>EnterTransition</strong>组合， <strong>EnterTransition</strong> 定义了目标内容应如何显示，<strong>ExitTransition</strong> 则定义了初始内容应如何消失。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalAnimationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatedContentExample2</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column &#123;</span><br><span class="line">        <span class="keyword">var</span> count <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">0</span>) &#125;</span><br><span class="line">        Button(onClick = &#123; count++ &#125;) &#123; Text(<span class="string">&quot;Add&quot;</span>) &#125;</span><br><span class="line">        AnimatedContent(</span><br><span class="line">            targetState = count,</span><br><span class="line">            transitionSpec = &#123;</span><br><span class="line">                <span class="comment">// 从右往左切换，并伴随淡入淡出效果（initialOffsetX = width, targetOffsetX = -width）</span></span><br><span class="line">                slideInHorizontally&#123;width -&gt; width&#125; + fadeIn() with</span><br><span class="line">                        slideOutHorizontally&#123;width -&gt; -width&#125; + fadeOut()</span><br><span class="line">            &#125;</span><br><span class="line">        ) &#123; targetCount -&gt;</span><br><span class="line">            Text(text = <span class="string">&quot;Count: <span class="variable">$targetCount</span>&quot;</span>, Modifier.background(Color.Green), fontSize = <span class="number">25.</span>sp)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行效果：<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/aba6dc7663519fa182818bf7180edd4a.gif"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalAnimationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatedContentExample3</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column(horizontalAlignment = Alignment.CenterHorizontally) &#123;</span><br><span class="line">        <span class="keyword">var</span> count <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">0</span>) &#125;</span><br><span class="line">        Button(onClick = &#123; count++ &#125;) &#123; Text(<span class="string">&quot;Add&quot;</span>) &#125;</span><br><span class="line">        <span class="keyword">val</span> animationSpec = tween&lt;IntOffset&gt;(<span class="number">200</span>)</span><br><span class="line">        <span class="keyword">val</span> animationSpec2 = tween&lt;<span class="built_in">Float</span>&gt;(<span class="number">200</span>)</span><br><span class="line">        AnimatedContent(</span><br><span class="line">            targetState = count,</span><br><span class="line">            transitionSpec = &#123;</span><br><span class="line">                slideInVertically(animationSpec)&#123; height -&gt; height&#125; + fadeIn(animationSpec2) with</span><br><span class="line">                    slideOutVertically(animationSpec) &#123;height -&gt; height&#125; + fadeOut(animationSpec2)</span><br><span class="line">            &#125;</span><br><span class="line">        ) &#123; targetCount -&gt;</span><br><span class="line">            Text(text = <span class="string">&quot;<span class="variable">$targetCount</span>&quot;</span>, fontSize = <span class="number">40.</span>sp)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行效果：<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/32ad157d2be46e78cb9ac4e4a2d44769.gif"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalAnimationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatedContentExample4</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column &#123;</span><br><span class="line">        <span class="keyword">var</span> count <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">0</span>) &#125;</span><br><span class="line">        Row(horizontalArrangement = Arrangement.SpaceAround) &#123;</span><br><span class="line">            Button(onClick = &#123; count-- &#125;) &#123; Text(<span class="string">&quot;Minus&quot;</span>) &#125;</span><br><span class="line">            Spacer(Modifier.size(<span class="number">60.</span>dp))</span><br><span class="line">            Button(onClick = &#123; count++ &#125;) &#123; Text(<span class="string">&quot;Plus &quot;</span>) &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Spacer(Modifier.size(<span class="number">20.</span>dp))</span><br><span class="line">        AnimatedContent(</span><br><span class="line">            targetState = count,</span><br><span class="line">            transitionSpec = &#123;</span><br><span class="line">                <span class="keyword">if</span> (targetState &gt; initialState) &#123;</span><br><span class="line">                    <span class="comment">// 如果targetState更大，则从下往上切换并伴随淡入淡出效果</span></span><br><span class="line">                    slideInVertically &#123; height -&gt; height &#125; + fadeIn() with</span><br><span class="line">                            slideOutVertically &#123; height -&gt; -height &#125; + fadeOut()</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 如果targetState更小，则从上往下切换并伴随淡入淡出效果</span></span><br><span class="line">                    slideInVertically &#123; height -&gt; -height &#125; + fadeIn() with</span><br><span class="line">                            slideOutVertically &#123; height -&gt; height &#125; + fadeOut()</span><br><span class="line">                &#125;.using(</span><br><span class="line">                    <span class="comment">// Disable clipping since the faded slide-in/out should be displayed out of bounds.</span></span><br><span class="line">                    SizeTransform(clip = <span class="literal">false</span>)</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        ) &#123; targetCount -&gt;</span><br><span class="line">            Text(text = <span class="string">&quot;Count: <span class="variable">$targetCount</span>&quot;</span>, Modifier.background(Color.Green), fontSize = <span class="number">25.</span>sp)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行效果：<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/683d7ad96c09b4aaeca92185386e0760.gif"></p>
<h4 id="slideIntoContainer-和-slideOutOfContainer"><a href="#slideIntoContainer-和-slideOutOfContainer" class="headerlink" title="slideIntoContainer 和 slideOutOfContainer"></a><strong>slideIntoContainer</strong> 和 <strong>slideOutOfContainer</strong></h4><p>除了可用于 AnimatedVisibility 的所有 EnterTransition 和 ExitTransition 函数之外，AnimatedContent 还提供了 <strong>slideIntoContainer</strong> 和 <strong>slideOutOfContainer</strong>。这些是 <strong>slideInHorizontally&#x2F;Vertically</strong> 和 <strong>slideOutHorizontally&#x2F;Vertically</strong> 的便捷替代方案，它们可根据初始内容的大小和 <strong>AnimatedContent</strong> 内容的目标内容来计算滑动距离。(官方例子可见：<a target="_blank" rel="noopener" href="https://developer.android.com/reference/kotlin/androidx/compose/animation/AnimatedContentScope#slideIntoContainer%28androidx.compose.animation.AnimatedContentScope.SlideDirection,androidx.compose.animation.core.FiniteAnimationSpec,kotlin.Function1">slideIntoContainer</a>)</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalAnimationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">SlideIntoContainerSample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> transitionSpec: AnimatedContentScope&lt;<span class="built_in">Int</span>&gt;.() -&gt; ContentTransform = &#123;</span><br><span class="line">        <span class="keyword">if</span> (initialState &lt; targetState) &#123;</span><br><span class="line">            slideIntoContainer(towards = AnimatedContentScope.SlideDirection.Up) + fadeIn() with</span><br><span class="line">                    slideOutOfContainer(towards = AnimatedContentScope.SlideDirection.Up) + fadeOut()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            slideIntoContainer(towards = AnimatedContentScope.SlideDirection.Down) + fadeIn()  with</span><br><span class="line">                    slideOutOfContainer(towards = AnimatedContentScope.SlideDirection.Down) + fadeOut()</span><br><span class="line">        &#125;.apply &#123;</span><br><span class="line">            <span class="comment">// 这里可指定目标内容的 zIndex ，值越大越上层，值越小越下层</span></span><br><span class="line"><span class="comment">//            targetContentZIndex = when (targetState) &#123;</span></span><br><span class="line"><span class="comment">//                NestedMenuState.Level1 -&gt; 1f</span></span><br><span class="line"><span class="comment">//                NestedMenuState.Level2 -&gt; 2f</span></span><br><span class="line"><span class="comment">//                NestedMenuState.Level3 -&gt; 3f</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line">        &#125;.using(SizeTransform(clip = <span class="literal">false</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    Column &#123;</span><br><span class="line">        <span class="keyword">var</span> count <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">0</span>) &#125;</span><br><span class="line">        Row(horizontalArrangement = Arrangement.SpaceAround) &#123;</span><br><span class="line">            Button(onClick = &#123; count-- &#125;) &#123; Text(<span class="string">&quot;Minus&quot;</span>) &#125;</span><br><span class="line">            Spacer(Modifier.size(<span class="number">60.</span>dp))</span><br><span class="line">            Button(onClick = &#123; count++ &#125;) &#123; Text(<span class="string">&quot;Plus &quot;</span>) &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Spacer(Modifier.size(<span class="number">20.</span>dp))</span><br><span class="line">        AnimatedContent(</span><br><span class="line">            targetState = count,</span><br><span class="line">            transitionSpec = transitionSpec,</span><br><span class="line">        ) &#123; targetCount -&gt;</span><br><span class="line">            Text(text = <span class="string">&quot;Count: <span class="variable">$targetCount</span>&quot;</span>, Modifier.background(Color.Green), fontSize = <span class="number">25.</span>sp)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行效果：同上一个例子一样</p>
<h4 id="SizeTransform"><a href="#SizeTransform" class="headerlink" title="SizeTransform"></a>SizeTransform</h4><p><strong>SizeTransform</strong> 定义了大小应如何在初始内容与目标内容之间添加动画效果。在创建动画时，您可以访问初始大小和目标大小。 SizeTransform 还可控制在动画播放期间是否应将内容裁剪为组件大小。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalAnimationApi::class, ExperimentalMaterialApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">SizeTransformAnimatedContentSample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> expanded <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">false</span>) &#125;</span><br><span class="line">    Surface(</span><br><span class="line">        color = MaterialTheme.colors.primary,</span><br><span class="line">        onClick = &#123; expanded = !expanded &#125;,</span><br><span class="line">        modifier = Modifier.padding(<span class="number">10.</span>dp).onSizeChanged &#123;  &#125;</span><br><span class="line">    ) &#123;</span><br><span class="line">        AnimatedContent(</span><br><span class="line">            targetState = expanded,</span><br><span class="line">            transitionSpec = &#123;</span><br><span class="line">                fadeIn(animationSpec = tween(<span class="number">150</span>, <span class="number">150</span>)) with</span><br><span class="line">                    fadeOut(animationSpec = tween(<span class="number">150</span>)) using</span><br><span class="line">                        SizeTransform &#123; initialSize, targetSize -&gt;</span><br><span class="line">                            <span class="keyword">if</span> (targetState) &#123;</span><br><span class="line">                                keyframes &#123;</span><br><span class="line">                                    <span class="comment">// 展开时，先水平方向展开</span></span><br><span class="line">                                    <span class="comment">// 150ms之前：宽度从initialSize.width增大到targetSize.width，高度保持initialSize.height不变</span></span><br><span class="line">                                    <span class="comment">// 150ms之后：宽度保持targetSize.width不变，高度从initialSize.height开始增大到targetSize.height</span></span><br><span class="line">                                    IntSize(targetSize.width, initialSize.height) at <span class="number">150</span></span><br><span class="line">                                    durationMillis = <span class="number">300</span></span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                keyframes &#123;</span><br><span class="line">                                    <span class="comment">// 收缩时，先垂直方向收起</span></span><br><span class="line">                                    <span class="comment">// 150ms之前：宽度保持initialSize.width不变，高度从initialSize.height减小到targetSize.height</span></span><br><span class="line">                                    <span class="comment">// 150ms之后：宽度从initialSize.width减小到targetSize.width，高度保持targetSize.height不变</span></span><br><span class="line">                                    IntSize(initialSize.width, targetSize.height) at <span class="number">150</span></span><br><span class="line">                                    durationMillis = <span class="number">300</span></span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ) &#123; targetExpanded -&gt;</span><br><span class="line">            <span class="keyword">if</span> (targetExpanded) Expanded() <span class="keyword">else</span> ContentIcon()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ContentIcon</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Icon(Icons.Default.ArrowDropDown, <span class="string">&quot;&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">Expanded</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Text(text = <span class="string">&quot;SizeTransform 定义了大小应如何在初始内容与目标内容之间添加动画效果。在创建动画时，您可以访问初始大小和目标大小。SizeTransform 还可控制在动画播放期间是否应将内容裁剪为组件大小。SizeTransform 定义了大小应如何在初始内容与目标内容之间添加动画效果。在创建动画时，您可以访问初始大小和目标大小。SizeTransform 还可控制在动画播放期间是否应将内容裁剪为组件大小。&quot;</span>,</span><br><span class="line">        modifier = Modifier.padding(<span class="number">10.</span>dp))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行效果：<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/dc1d2e7764174d0693093f1f3a000544.gif"></p>
<p>与<strong>AnimatedVisibility</strong>一样，<strong>AnimatedContent</strong> 内的子组件也可以通过 <strong>Modifier.animateEnterExit()</strong> 单独指定动画。</p>
<h4 id="Modifier-animateContentSize"><a href="#Modifier-animateContentSize" class="headerlink" title="Modifier.animateContentSize"></a>Modifier.animateContentSize</h4><p><strong>Modifier.animateContentSize：</strong> 当容器尺寸大小发生变化时添加动画效果</p>
<blockquote>
<p>注意：<strong>animateContentSize</strong> 在修饰符链中的位置顺序很重要。为了确保流畅的动画，<strong>请务必将其放置在任何大小修饰符（如 size 或 defaultMinSize）前面</strong>，以确保 <strong>animateContentSize</strong> 会将带动画效果的值的变化报告给布局。</p>
</blockquote>
<p>下面代码使用<strong>expand</strong>来控制<strong>Text</strong>的<strong>maxLines</strong>属性，当最大行数发生变化时，<strong>animateContentSize()</strong> 会使用过渡动画：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimateContentSizeExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> expand <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">true</span>) &#125;</span><br><span class="line">    Column(Modifier.padding(<span class="number">16.</span>dp)) &#123;</span><br><span class="line">        Button(onClick = &#123; expand = !expand &#125;) &#123;</span><br><span class="line">            Text(text = <span class="keyword">if</span> (expand) <span class="string">&quot;收起&quot;</span> <span class="keyword">else</span> <span class="string">&quot;展开&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        Spacer(Modifier.height(<span class="number">16.</span>dp))</span><br><span class="line">        Box(</span><br><span class="line">            modifier = Modifier.background(Color.Green, RoundedCornerShape(<span class="number">15.</span>dp))</span><br><span class="line">                .padding(<span class="number">16.</span>dp).wrapContentSize()</span><br><span class="line">                .animateContentSize()</span><br><span class="line">        ) &#123;</span><br><span class="line">            Text(</span><br><span class="line">                text = <span class="string">&quot;Modifier.animateContentSize() animates its own size when its child modifier (or the child composable if it is already at the tail of the chain) changes size. This allows the parent modifier to observe a smooth size change, resulting in an overall continuous visual change.\n\n&quot;</span></span><br><span class="line">                        +<span class="string">&quot;A FiniteAnimationSpec can be optionally specified for the size change animation. By default, spring will be used.\n\n&quot;</span></span><br><span class="line">                        +<span class="string">&quot;An optional finishedListener can be supplied to get notified when the size change animation is finished. Since the content size change can be dynamic in many cases, both initial value and target value (i.e. final size) will be passed to the finishedListener. Note: if the animation is interrupted, the initial value will be the size at the point of interruption. This is intended to help determine the direction of the size change (i.e. expand or collapse in x and y dimensions).&quot;</span>,</span><br><span class="line">                fontSize = <span class="number">16.</span>sp,</span><br><span class="line">                textAlign = TextAlign.Justify,</span><br><span class="line">                maxLines = <span class="keyword">if</span> (expand) <span class="built_in">Int</span>.MAX_VALUE <span class="keyword">else</span> <span class="number">2</span></span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行效果：<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/9107199e4f2e019b3e599e92afa42214.gif"></p>
<h3 id="Crossfade"><a href="#Crossfade" class="headerlink" title="Crossfade"></a>Crossfade</h3><p><strong>Crossfade</strong> 可使用淡入淡出动画在两个布局之间添加动画效果。 通过切换传递给 <strong>current</strong> 参数的值，可以使用淡入淡出动画来切换内容。如果只是淡入淡出的需求，可以使用<strong>Crossfade</strong>替代<strong>AnimatedContent</strong>。</p>
<p><strong>AnimatedContent</strong>是<strong>Crossfade</strong>的一种<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%B3%9B%E5%8C%96&spm=1001.2101.3001.7020">泛化</a>，<strong>AnimatedContent</strong>是后来为了增强<strong>Crossfade</strong>而增加的。</p>
<p>需要注意的是：Crossfade无法实现 SizeTransform 那样尺寸大小变化的动画效果（如果有这种需求，请使用<strong>AnimatedContent + SizeTransform</strong> 或者使用 <strong>Crossfade + Modifier.animateContentSize</strong>）</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">CrossfadeExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column &#123;</span><br><span class="line">        <span class="keyword">var</span> currentPage <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="string">&quot;A&quot;</span>) &#125;</span><br><span class="line">        Button(onClick = &#123; currentPage = <span class="keyword">if</span>(currentPage == <span class="string">&quot;A&quot;</span>) <span class="string">&quot;B&quot;</span> <span class="keyword">else</span> <span class="string">&quot;A&quot;</span> &#125;) &#123;</span><br><span class="line">            Text(<span class="string">&quot;Change&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        Spacer(Modifier.size(<span class="number">20.</span>dp))</span><br><span class="line">        Crossfade(targetState = currentPage) &#123; screen -&gt;</span><br><span class="line">            <span class="keyword">when</span> (screen) &#123;</span><br><span class="line">                <span class="string">&quot;A&quot;</span> -&gt; Text(<span class="string">&quot;Page A&quot;</span>, Modifier.background(Color.Green), fontSize = <span class="number">25.</span>sp)</span><br><span class="line">                <span class="string">&quot;B&quot;</span> -&gt; Text(<span class="string">&quot;Page B&quot;</span>, Modifier.background(Color.Red), fontSize = <span class="number">25.</span>sp)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行效果：<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/7df0d654fbbf2d72f825972e6af82322.gif"></p>
<h3 id="animateXXXAsState"><a href="#animateXXXAsState" class="headerlink" title="animateXXXAsState"></a>animateXXXAsState</h3><p><strong>animate*AsState</strong> 函数是 Compose 中最简单的动画 API，用于为单个值添加动画效果。类似于传统动画中的属性动画。</p>
<p>您只需提供结束值（或目标值），该 API 就会自动完成从当前值到目标值过渡的估值计算。<br>例如以下代码：透明度在1和0.2之前切换</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimateXXXAsStateExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> enabled <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">true</span>) &#125;</span><br><span class="line">    <span class="keyword">val</span> alpha: <span class="built_in">Float</span> <span class="keyword">by</span> animateFloatAsState(<span class="keyword">if</span> (enabled) <span class="number">1f</span> <span class="keyword">else</span> <span class="number">0.2f</span>)</span><br><span class="line">    Box(</span><br><span class="line">        Modifier</span><br><span class="line">            .size(<span class="number">200.</span>dp)</span><br><span class="line">            .graphicsLayer(alpha = alpha)</span><br><span class="line">            .background(Color.Red)</span><br><span class="line">            .clickable &#123; enabled = !enabled &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行效果：<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/137db17457e2aa2591f58d1858d3c135.gif"></p>
<p>以下代码实现红心按钮动画效果：</p>
<ul>
<li>点击按钮时，buttonSize从24dp开始向32dp过渡，</li>
<li>当buttonSize达到32dp时，changeSize被置为false，buttonSize又会从32dp开始向24dp过渡，</li>
<li>同时每点击一次按钮，按钮颜色在红色和灰色之间过渡切换</li>
<li>size: 小 -&gt; 大 -&gt; 小 color: 灰色 -&gt; 红色</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimateXXXAsStateExample2</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> changeSize <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">false</span>) &#125;</span><br><span class="line">    <span class="keyword">var</span> changeColor <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">false</span>) &#125;</span><br><span class="line">    <span class="keyword">val</span> buttonSize <span class="keyword">by</span> animateDpAsState(<span class="keyword">if</span>(changeSize) <span class="number">32.</span>dp <span class="keyword">else</span> <span class="number">24.</span>dp)</span><br><span class="line">    <span class="keyword">val</span> buttonColor <span class="keyword">by</span> animateColorAsState(</span><br><span class="line">        targetValue = <span class="keyword">if</span>(changeColor) Color.Red <span class="keyword">else</span> Color.Gray,</span><br><span class="line">        animationSpec = spring(Spring.DampingRatioNoBouncy)</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">if</span> (buttonSize == <span class="number">32.</span>dp) &#123;</span><br><span class="line">        changeSize = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    Box(Modifier.fillMaxSize(),contentAlignment = Alignment.Center) &#123;</span><br><span class="line">        IconButton(</span><br><span class="line">            onClick = &#123;</span><br><span class="line">                changeSize = <span class="literal">true</span></span><br><span class="line">                changeColor = !changeColor</span><br><span class="line">            &#125;</span><br><span class="line">        ) &#123;</span><br><span class="line">            Icon(Icons.Rounded.Favorite, <span class="literal">null</span>, Modifier.size(buttonSize), tint = buttonColor)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行效果：<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/c1e29b2a2f3f0e700a40d653949a0bff.gif"></p>
<p>请注意，您无需创建任何动画类的实例，也不必处理中断。在后台，系统会在调用点创建并记录一个动画对象（即 <strong>Animatable</strong> 实例），并将第一个目标值设为初始值。此后，只要您为此可组合项提供不同的目标值，系统就会自动向该值播放动画。</p>
<p>如果已有动画在播放，系统将从其当前值（和速度）开始向目标值播放动画。 在播放动画期间，这个可组合项会重组，并且每帧都会返回一个已更新的动画值。</p>
<p>Compose 为 <strong>Float、Color、Dp、Size、Offset、Rect、Int、IntOffset</strong> 和 <strong>IntSize</strong> 提供开箱即用的 <strong>animate*AsState</strong> 函数。 对于无法直接估值计算的数据类型，可以使用通用类型的 <strong>animateValueAsState</strong>，并实现 <strong>TwoWayConverter</strong> 估值计算器。</p>
<h4 id="AnimationVector-TwoWayConverter"><a href="#AnimationVector-TwoWayConverter" class="headerlink" title="AnimationVector &amp; TwoWayConverter"></a>AnimationVector &amp; TwoWayConverter</h4><p><strong>Float、Color、Dp</strong>等都是通过<strong>Animatable</strong>转换成可动画类型，而<strong>Animatable</strong>是借助 <strong>TwoWayConverter</strong> 实现的：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animatable</span>&lt;<span class="type">T, V : AnimationVector</span>&gt;(</span><br><span class="line">    initialValue: T, <span class="comment">// T类型的动画初始值</span></span><br><span class="line">    <span class="keyword">val</span> typeConverter: TwoWayConverter&lt;T, V&gt;, <span class="comment">// 将T类型的数值与V类型的数组进行转换</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> visibilityThreshold: T? = <span class="literal">null</span>, <span class="comment">// 动画消失时的阈值，默认为null</span></span><br><span class="line">    <span class="keyword">val</span> label: String = <span class="string">&quot;Animatable&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TwoWayConverter</span>&lt;<span class="type">T, V : AnimationVector</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> convertToVector: (T) -&gt; V   <span class="comment">// 将T类型的数值转换为V类型</span></span><br><span class="line">    <span class="keyword">val</span> convertFromVector: (V) -&gt; T <span class="comment">// 将V类型的数值转换为T类型</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不同类型的数值可以根据需求与不同的<strong>AnimationVectorXD</strong>进行转换，这里<strong>X</strong>代表了信息的维度，例如一个<strong>Int</strong>可以与<strong>AnimationVector1D</strong>进行转换，<strong>AnimationVector1D</strong>只包含一个浮点型数值。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> IntToVector: TwoWayConverter&lt;<span class="built_in">Int</span>, AnimationVector1D&gt; =</span><br><span class="line">       TwoWayConverter( &#123; AnimationVector1D(it.toFloat()) &#125;, &#123; it.value.toInt() &#125;)</span><br></pre></td></tr></table></figure>

<p>同样地，<strong>Size</strong>包含<strong>width</strong>和<strong>height</strong>两个维度，可以与<strong>AnimationVector2D</strong>进行转换，<br><strong>Color</strong> 包含 <strong>red、green、blue</strong> 和 <strong>alpha</strong> 这 <strong>4</strong> 个维度，可以与 <strong>AnimationVector4D</strong> 进行转换。</p>
<p>通过这种方式，动画中使用的每种数据类型都可以根据其维度转换为 <strong>AnimationVector1D、AnimationVector2D、AnimationVector3D</strong> 或 <strong>AnimationVector4D</strong>。</p>
<p>这样可为对象的不同组件单独添加动画效果，且每个组件都有自己的速度跟踪。对于常见的数据类型，Compose都提供了<strong>内置转换器</strong>，可以直接使用如<strong>Color.VectorConverter、Dp.VectorConverter、Float.VectorConverter、Rect.VectorConverter</strong> 等等。可以在对应类型的<strong>伴生对象</strong>中找到其实现。</p>
<h4 id="自定义TwoWayConverter"><a href="#自定义TwoWayConverter" class="headerlink" title="自定义TwoWayConverter"></a>自定义TwoWayConverter</h4><p>首先要明确一点的是，只有没有找到Compose提供的内置转换器的数据类型时才需要进行自定义，通常我们不需要这样做。</p>
<p>例如，您可以结合使用 <strong>animateValueAsState</strong> 为自定义数据类型添加动画效果，如下所示：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimateValueExample</span><span class="params">(targetSize: <span class="type">MySize</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> animSize: MySize <span class="keyword">by</span> animateValueAsState(</span><br><span class="line">        targetValue = targetSize,</span><br><span class="line">        typeConverter = TwoWayConverter(</span><br><span class="line">            convertToVector = &#123; size: MySize -&gt;</span><br><span class="line">                <span class="comment">// Extract a float value from each of the `Dp` fields.</span></span><br><span class="line">                AnimationVector2D(size.width.value, size.height.value)</span><br><span class="line">            &#125;,</span><br><span class="line">            convertFromVector = &#123; vector: AnimationVector2D -&gt;</span><br><span class="line">                MySize(vector.v1.dp, vector.v2.dp)</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">MySize</span>(<span class="keyword">val</span> width: Dp, <span class="keyword">val</span> height: Dp)</span><br></pre></td></tr></table></figure>

<h3 id="Transition"><a href="#Transition" class="headerlink" title="Transition"></a>Transition</h3><p><strong>Transition</strong> 可管理一个或多个动画作为其子项，并在多个状态之间同时运行这些动画。类似传统动画中的<strong>AnimationSet</strong>。</p>
<p>这里的状态可以是任何数据类型。在很多情况下，您可以使用自定义 <strong>enum</strong> 类型来确保类型安全，如下例所示：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="keyword">class</span> <span class="title class_">BoxState</span> &#123;</span><br><span class="line">    Collapsed,</span><br><span class="line">    Expanded</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="updateTransition"><a href="#updateTransition" class="headerlink" title="updateTransition"></a>updateTransition</h4><p><strong>updateTransition</strong> 可创建并记住 <strong>Transition</strong> 的实例，当其观察的状态改变时，Transition会自动更新其状态。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> currentState <span class="keyword">by</span> remember &#123; mutableStateOf(BoxState.Collapsed) &#125;</span><br><span class="line"><span class="keyword">val</span> transition = updateTransition(currentState, label = <span class="string">&quot;BoxTransition&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>然后，您可以使用某一个 <strong>transition.animatexxx 扩展函数</strong> 来定义此过渡效果中的子动画。为每个状态指定目标值。</p>
<p>这些 <strong>transition.animatexxx 扩展函数</strong> 会返回一个动画值，在动画播放过程中，当使用 <strong>updateTransition</strong> 更新过渡状态时，该值将逐帧更新。</p>
<p>您也可以传递 <strong>transitionSpec</strong> 参数，为过渡状态变化的每个组合指定不同的 <strong>AnimationSpec</strong>。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">TransitionAnimationExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> boxState <span class="keyword">by</span> remember &#123; mutableStateOf(BoxState.Collapsed) &#125;</span><br><span class="line">    <span class="keyword">val</span> transition = updateTransition(boxState, label = <span class="string">&quot;BoxTransition&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> size <span class="keyword">by</span> transition.animateFloat(</span><br><span class="line">        transitionSpec = &#123; tween(<span class="number">500</span>) &#125;, label = <span class="string">&quot;size&quot;</span></span><br><span class="line">    ) &#123; state -&gt;</span><br><span class="line">        state.valueOf(collapsed = <span class="number">100f</span>, expanded = <span class="number">200f</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> borderWidth <span class="keyword">by</span> transition.animateDp(</span><br><span class="line">        transitionSpec = &#123; tween(<span class="number">500</span>) &#125;, label = <span class="string">&quot;borderWidth&quot;</span></span><br><span class="line">    ) &#123; state -&gt;</span><br><span class="line">        state.valueOf(collapsed = <span class="number">1.</span>dp, expanded = <span class="number">2.</span>dp)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> bgColor <span class="keyword">by</span> transition.animateColor(</span><br><span class="line">        transitionSpec = &#123;</span><br><span class="line">            <span class="keyword">when</span> &#123;</span><br><span class="line">                BoxState.Expanded isTransitioningTo BoxState.Collapsed -&gt; spring(stiffness = <span class="number">50f</span>)</span><br><span class="line">                <span class="keyword">else</span> -&gt; tween(<span class="number">500</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, label = <span class="string">&quot;bgColor&quot;</span></span><br><span class="line">    ) &#123; state -&gt;</span><br><span class="line">        state.valueOf(collapsed = Color.Green, expanded = Color.Cyan)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> borderColor <span class="keyword">by</span> transition.animateColor(label = <span class="string">&quot;borderColor&quot;</span>) &#123; state -&gt;</span><br><span class="line">        state.valueOf(collapsed = Color.Red, expanded = Color.Blue)</span><br><span class="line">    &#125;</span><br><span class="line">    Box(</span><br><span class="line">        modifier = Modifier</span><br><span class="line">            .clickable &#123;</span><br><span class="line">                boxState = boxState.swapState()</span><br><span class="line">            &#125;</span><br><span class="line">            .padding(<span class="number">5.</span>dp)</span><br><span class="line">            .size(size.dp)</span><br><span class="line">            .background(bgColor)</span><br><span class="line">            .border(BorderStroke(borderWidth, borderColor)),</span><br><span class="line">        contentAlignment = Alignment.Center</span><br><span class="line">    ) &#123;</span><br><span class="line">        Text(text = boxState.valueOf(<span class="string">&quot;Collapsed&quot;</span>, <span class="string">&quot;Expanded&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> BoxState.<span class="title">valueOf</span><span class="params">(collapsed: <span class="type">T</span>, expanded: <span class="type">T</span>)</span></span> : T &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">when</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        BoxState.Collapsed -&gt; collapsed</span><br><span class="line">        BoxState.Expanded -&gt; expanded</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> BoxState.<span class="title">swapState</span><span class="params">()</span></span> : BoxState = valueOf(BoxState.Expanded, BoxState.Collapsed)</span><br></pre></td></tr></table></figure>

<p>运行效果：<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/78d97855f77e9304ab8e01adc7ae5b78.gif"></p>
<p>当过渡动画到目标状态后，<strong>Transition.currentState</strong> 将与 <strong>Transition.targetState</strong> 相同，这一点可以用作判断是否已完成过渡动画的条件。</p>
<h4 id="MutableTransitionState"><a href="#MutableTransitionState" class="headerlink" title="MutableTransitionState"></a>MutableTransitionState</h4><h5 id="MutableTransitionState：为其设置不同的目标值可立即触发动画"><a href="#MutableTransitionState：为其设置不同的目标值可立即触发动画" class="headerlink" title="MutableTransitionState：为其设置不同的目标值可立即触发动画"></a>MutableTransitionState：为其设置不同的目标值可立即触发动画</h5><p>有时，我们会希望<strong>初始状态与第一个目标状态不同</strong>，我们可以通过结合使用 <strong>updateTransition</strong> 和 <strong>MutableTransitionState</strong> 来实现这一点。</p>
<p><strong>MutableTransitionState</strong>的构造函数接受一个<strong>initialState</strong>参数，只需要修改它的<strong>targetState</strong>值与<strong>initialState</strong>不同的值，就会立即触发动画。</p>
<p>例如，它允许我们在代码进入组合阶段后立即开始播放动画。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MutableTransitionStateExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> boxState = remember &#123;</span><br><span class="line">        MutableTransitionState(BoxState.Collapsed).apply &#123;</span><br><span class="line">            targetState = BoxState.Expanded <span class="comment">// 修改targetState与initialState不同立即执行动画</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> transition = updateTransition(boxState, label = <span class="string">&quot;BoxTransition&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> size <span class="keyword">by</span> transition.animateFloat(</span><br><span class="line">        transitionSpec = &#123; tween(<span class="number">500</span>) &#125;, label = <span class="string">&quot;sizeTransition&quot;</span></span><br><span class="line">    ) &#123; state -&gt;</span><br><span class="line">        state.valueOf(collapsed = <span class="number">100f</span>, expanded = <span class="number">200f</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> bgColor <span class="keyword">by</span> transition.animateColor(</span><br><span class="line">        transitionSpec = &#123; tween(<span class="number">500</span>) &#125;, label = <span class="string">&quot;bgColorTransition&quot;</span></span><br><span class="line">    ) &#123; state -&gt;</span><br><span class="line">        state.valueOf(collapsed = Color.Green, expanded = Color.Cyan)</span><br><span class="line">    &#125;</span><br><span class="line">    Box(</span><br><span class="line">        modifier = Modifier</span><br><span class="line">            .clickable &#123;</span><br><span class="line">                boxState.targetState = boxState.targetState.swapState() <span class="comment">// 修改状态时要修改状态的targetState </span></span><br><span class="line">            &#125;</span><br><span class="line">            .padding(<span class="number">5.</span>dp)</span><br><span class="line">            .size(size.dp)</span><br><span class="line">            .background(bgColor) ,</span><br><span class="line">        contentAlignment = Alignment.Center</span><br><span class="line">    ) &#123;</span><br><span class="line">        Text(text = boxState.valueOf(<span class="string">&quot;Collapsed&quot;</span>, <span class="string">&quot;Expanded&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> MutableTransitionState<span class="type">&lt;BoxState&gt;</span>.<span class="title">valueOf</span><span class="params">(collapsed: <span class="type">T</span>, expanded: <span class="type">T</span>)</span></span> : T &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.targetState.valueOf(collapsed, expanded)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行效果： 与前面的效果一样，但是进入界面就开始自动执行一次动画。</p>
<h5 id="MutableTransitionState-可以用来监听动画状态"><a href="#MutableTransitionState-可以用来监听动画状态" class="headerlink" title="MutableTransitionState 可以用来监听动画状态"></a>MutableTransitionState 可以用来监听动画状态</h5><p>例如，使用 <strong>AnimatedVisibility</strong> 搭配 <strong>MutableTransitionState</strong> 可以实现观察动画的可见状态：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatedVisibilityExample2</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// Create a MutableTransitionState&lt;Boolean&gt; for the AnimatedVisibility.</span></span><br><span class="line">    <span class="keyword">val</span> state = remember &#123;</span><br><span class="line">        <span class="comment">// initialState为false, targetState设置为true, </span></span><br><span class="line">        <span class="comment">// 当AnimatedVisibility上屏时，由于两个状态不同，会立即执行动画</span></span><br><span class="line">        MutableTransitionState(<span class="literal">false</span>).apply &#123; </span><br><span class="line">            targetState = <span class="literal">true</span> <span class="comment">// Start the animation immediately.</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Box(Modifier.fillMaxWidth(), contentAlignment = Alignment.TopCenter) &#123;</span><br><span class="line">        AnimatedVisibility(visibleState = state) &#123;</span><br><span class="line">            Text(text = <span class="string">&quot;Hello, world!&quot;</span>,</span><br><span class="line">                Modifier.background(Color.Green).height(<span class="number">100.</span>dp).fillMaxWidth()</span><br><span class="line">                    .wrapContentWidth(Alignment.CenterHorizontally),</span><br><span class="line">                fontSize = <span class="number">20.</span>sp)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 获取AnimatedVisibility当前所处的动画状态并显示</span></span><br><span class="line">        Text(text = <span class="string">&quot;current Animate State: <span class="subst">$&#123;state.getAnimationState()&#125;</span>&quot;</span>,</span><br><span class="line">            Modifier.padding(top = <span class="number">100.</span>dp).background(Color.Red).fillMaxWidth().padding(<span class="number">15.</span>dp),</span><br><span class="line">            color = Color.White,</span><br><span class="line">            fontSize = <span class="number">20.</span>sp)</span><br><span class="line">        Button(</span><br><span class="line">            onClick = &#123; state.targetState = !state.targetState &#125;,</span><br><span class="line">            Modifier.padding(top = <span class="number">160.</span>dp)</span><br><span class="line">        ) &#123;</span><br><span class="line">            Text(text = <span class="keyword">if</span>(state.targetState) <span class="string">&quot;隐藏&quot;</span> <span class="keyword">else</span> <span class="string">&quot;显示&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">enum</span> <span class="keyword">class</span> <span class="title class_">Animate</span> &#123; VISIBLE, INVISIBLE, APPEARING, DISAPPEARING &#125;</span><br><span class="line"><span class="comment">// 为MutableTransitionState定义一个扩展函数来方便的获取动画状态</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> MutableTransitionState<span class="type">&lt;Boolean&gt;</span>.<span class="title">getAnimationState</span><span class="params">()</span></span>: Animate &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">when</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.isIdle &amp;&amp; <span class="keyword">this</span>.currentState -&gt; Animate.VISIBLE <span class="comment">// 动画已结束，当前处于可见状态</span></span><br><span class="line">        !<span class="keyword">this</span>.isIdle &amp;&amp; <span class="keyword">this</span>.currentState -&gt; Animate.DISAPPEARING <span class="comment">// 动画执行中，且逐渐不可见</span></span><br><span class="line">        <span class="keyword">this</span>.isIdle &amp;&amp; !<span class="keyword">this</span>.currentState -&gt; Animate.INVISIBLE <span class="comment">// 动画已结束，当前处于不可见状态</span></span><br><span class="line">        <span class="keyword">else</span> -&gt; Animate.APPEARING <span class="comment">// 动画执行中，且逐渐可见</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行效果：<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/134bb62428d509ca25cde05c64c98b79.gif"></p>
<h4 id="createChildTransition"><a href="#createChildTransition" class="headerlink" title="createChildTransition"></a>createChildTransition</h4><p>对于涉及多个可组合函数的更复杂的过渡，可使用 createChildTransition 来创建子过渡。</p>
<p>此方法对于在复杂的可组合项中分离多个子组件之间的关注点非常有用。父过渡将会知道子过渡中的所有动画值。createChildTransition更像是一种map。</p>
<p>例如：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="keyword">class</span> <span class="title class_">DialerState</span> &#123; DialerMinimized, NumberPad &#125;</span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">DialerButton</span><span class="params">(isVisibleTransition: <span class="type">Transition</span>&lt;<span class="type">Boolean</span>&gt;)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 不需要知道其他状态，只需关注当前isVisibleTransition是 visible 还是 not visible.</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">NumberPad</span><span class="params">(isVisibleTransition: <span class="type">Transition</span>&lt;<span class="type">Boolean</span>&gt;)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 不需要知道其他状态，只需关注当前isVisibleTransition是 visible 还是 not visible.</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@OptIn(ExperimentalTransitionApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">Dialer</span><span class="params">(dialerState: <span class="type">DialerState</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> transition = updateTransition(dialerState, label = <span class="string">&quot;&quot;</span>)</span><br><span class="line">    Box &#123;</span><br><span class="line">        NumberPad(</span><br><span class="line">            transition.createChildTransition &#123;</span><br><span class="line">                it == DialerState.NumberPad</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">        DialerButton(</span><br><span class="line">            transition.createChildTransition &#123;</span><br><span class="line">                it == DialerState.DialerMinimized</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="将-Transition-与-AnimatedVisibility-和-AnimatedContent-配合使用"><a href="#将-Transition-与-AnimatedVisibility-和-AnimatedContent-配合使用" class="headerlink" title="将 Transition 与 AnimatedVisibility 和 AnimatedContent 配合使用"></a>将 Transition 与 AnimatedVisibility 和 AnimatedContent 配合使用</h4><p><strong>Transition</strong>中有分别针对<strong>AnimatedVisibility</strong> 和 <strong>AnimatedContent</strong> 的扩展函数。<br><strong>Transition.AnimatedVisibility</strong> 和 <strong>Transition.AnimatedContent</strong> 的 <strong>targetState</strong> 源自 <strong>Transition</strong>， 会在 <strong>Transition</strong> 的 <strong>targetState</strong> 发生变化时视需要触发进入&#x2F;退出过渡。</p>
<p>这些扩展函数允许将原本位于 <strong>AnimatedVisibility</strong> 或 <strong>AnimatedContent</strong> 内的所有 <strong>enter&#x2F;exit&#x2F;sizeTransform</strong> 动画提升到 <strong>Transition</strong> 中。 借助这些扩展函数，可以从外部观察 <strong>AnimatedVisibility&#x2F;AnimatedContent</strong> 的状态变化。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalAnimationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">TransitionWithAnimatedVisibilityAndAnimatedContent</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> selected <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">false</span>) &#125;</span><br><span class="line">    <span class="comment">// 当 `selected` 变化时触发transition动画</span></span><br><span class="line">    <span class="keyword">val</span> transition = updateTransition(selected, label = <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> borderColor <span class="keyword">by</span> transition.animateColor(label = <span class="string">&quot;&quot;</span>) &#123; isSelected -&gt;</span><br><span class="line">        <span class="keyword">if</span> (isSelected) Color.Magenta <span class="keyword">else</span> Color.White</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> elevation <span class="keyword">by</span> transition.animateDp(label = <span class="string">&quot;&quot;</span>) &#123; isSelected -&gt;</span><br><span class="line">        <span class="keyword">if</span> (isSelected) <span class="number">10.</span>dp <span class="keyword">else</span> <span class="number">2.</span>dp</span><br><span class="line">    &#125;</span><br><span class="line">    Surface(</span><br><span class="line">        modifier = Modifier.clickable &#123; selected = !selected &#125;</span><br><span class="line">            .padding(<span class="number">10.</span>dp),</span><br><span class="line">        shape = RoundedCornerShape(<span class="number">8.</span>dp),</span><br><span class="line">        border = BorderStroke(<span class="number">2.</span>dp, borderColor),</span><br><span class="line">        elevation = elevation</span><br><span class="line">    ) &#123;</span><br><span class="line">        Column(modifier = Modifier</span><br><span class="line">            .fillMaxWidth()</span><br><span class="line">            .padding(<span class="number">16.</span>dp)) &#123;</span><br><span class="line">            Text(text = <span class="string">&quot;Hello, world!&quot;</span>)</span><br><span class="line">            <span class="comment">// AnimatedVisibility 作为过渡动画的一部分</span></span><br><span class="line">            transition.AnimatedVisibility(</span><br><span class="line">                visible = &#123; targetSelected -&gt; targetSelected &#125;,</span><br><span class="line">                enter = expandVertically(),</span><br><span class="line">                exit = shrinkVertically()</span><br><span class="line">            ) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;It is fine today.&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// AnimatedContent 作为过渡动画的一部分</span></span><br><span class="line">            transition.AnimatedContent &#123; targetState -&gt;</span><br><span class="line">                <span class="keyword">if</span> (targetState) &#123;</span><br><span class="line">                    Text(text = <span class="string">&quot;Selected&quot;</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Icon(Icons.Default.Favorite, <span class="string">&quot;&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行效果：<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/f61c1ccbc35e1d1c0e4018685731fb09.gif"></p>
<p>对于<strong>transition.AnimatedContent</strong>, <strong>transition</strong>所包含的状态值会被转换成<strong>targetState</strong>参数传入。<br>对于<strong>transition.AnimatedVisibility</strong>，则需要通过一个 <strong>lambda转换器</strong> 将状态值转换成其所需的 <strong>Boolean</strong> 类型的 <strong>visible</strong> 参数。</p>
<h4 id="封装和复用-Transition"><a href="#封装和复用-Transition" class="headerlink" title="封装和复用 Transition"></a>封装和复用 Transition</h4><p>在处理具有大量动画值的复杂组件时，可能会希望将动画实现与可组合界面分开。<br>为此，您可以创建一个类来保存所有动画值，同时创建一个“update”函数来返回该类的实例。过渡实现可提取到新的独立函数中。</p>
<p>当您需要集中处理动画逻辑或使复杂动画可重复使用时，这种模式很有用。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatingBoxExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> currentState <span class="keyword">by</span> remember &#123; mutableStateOf(BoxState.Collapsed) &#125;</span><br><span class="line">    AnimatingBox(</span><br><span class="line">        boxState = currentState,</span><br><span class="line">        Modifier.clickable &#123; currentState = currentState.swapState() &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatingBox</span><span class="params">(boxState: <span class="type">BoxState</span>, modifier: <span class="type">Modifier</span> = Modifier)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> transitionData = updateTransitionData(boxState)</span><br><span class="line">    Box(modifier.background(transitionData.color).size(transitionData.size))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 保存动画值</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">TransitionData</span>(color: State&lt;Color&gt;, size: State&lt;Dp&gt;) &#123;</span><br><span class="line">    <span class="keyword">val</span> color <span class="keyword">by</span> color</span><br><span class="line">    <span class="keyword">val</span> size <span class="keyword">by</span> size</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个 Transition 并返回其动画值</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">updateTransitionData</span><span class="params">(boxState: <span class="type">BoxState</span>)</span></span>: TransitionData &#123;</span><br><span class="line">    <span class="keyword">val</span> transition = updateTransition(boxState, label = <span class="string">&quot;boxState&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> color = transition.animateColor(label = <span class="string">&quot;color&quot;</span>) &#123; state -&gt;</span><br><span class="line">        state.valueOf(collapsed = Color.Gray, expanded =  Color.Red)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> size = transition.animateDp(label = <span class="string">&quot;size&quot;</span>) &#123; state -&gt;</span><br><span class="line">        state.valueOf(collapsed = <span class="number">64.</span>dp, expanded = <span class="number">128.</span>dp)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> remember(transition) &#123; TransitionData(color, size) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> BoxState.<span class="title">valueOf</span><span class="params">(collapsed: <span class="type">T</span>, expanded: <span class="type">T</span>)</span></span> : T &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">when</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        BoxState.Collapsed -&gt; collapsed</span><br><span class="line">        BoxState.Expanded -&gt; expanded</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> BoxState.<span class="title">swapState</span><span class="params">()</span></span> : BoxState = valueOf(BoxState.Expanded, BoxState.Collapsed)</span><br></pre></td></tr></table></figure>

<p>运行效果：<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/92eb70215e3f49ef32b531d0a4e3fc8d.gif"></p>
<h4 id="rememberInfiniteTransition"><a href="#rememberInfiniteTransition" class="headerlink" title="rememberInfiniteTransition"></a>rememberInfiniteTransition</h4><p><strong>InfiniteTransition</strong> 可以像 <strong>Transition</strong> 一样保存一个或多个子动画， 但是，这些动画一进入组合阶段就开始运行，除非被移除，否则不会停止。即一个<strong>无限循环的Transition动画</strong>。</p>
<p>可以使用 <strong>rememberInfiniteTransition</strong> 创建 <strong>InfiniteTransition</strong> 实例。<br>可以使用 <strong>animateColor</strong>、<strong>animatedFloat</strong> 或 <strong>animatedValue</strong> 添加子动画。<br>还需要指定 <strong>infiniteRepeatable</strong> 以指定动画的重复模式。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">RememberInfiniteTransitionExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> infiniteTransition = rememberInfiniteTransition()</span><br><span class="line">    <span class="keyword">val</span> color <span class="keyword">by</span> infiniteTransition.animateColor(</span><br><span class="line">        initialValue = Color.Red,</span><br><span class="line">        targetValue = Color.Blue,</span><br><span class="line">        animationSpec = infiniteRepeatable(</span><br><span class="line">            animation = tween(<span class="number">1000</span>, easing = LinearEasing),</span><br><span class="line">            repeatMode = RepeatMode.Reverse</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">val</span> roundPercent <span class="keyword">by</span> infiniteTransition.animateFloat(</span><br><span class="line">        initialValue = <span class="number">0f</span>,</span><br><span class="line">        targetValue = <span class="number">100f</span>,</span><br><span class="line">        animationSpec = infiniteRepeatable(</span><br><span class="line">            animation = tween(<span class="number">1000</span>, easing = FastOutLinearInEasing),</span><br><span class="line">            repeatMode = RepeatMode.Reverse</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">val</span> offset <span class="keyword">by</span> infiniteTransition.animateFloat(</span><br><span class="line">        initialValue = <span class="number">0f</span>,</span><br><span class="line">        targetValue = <span class="number">100f</span>,</span><br><span class="line">        animationSpec = infiniteRepeatable(</span><br><span class="line">            animation = tween(<span class="number">1000</span>, easing = FastOutSlowInEasing),</span><br><span class="line">            repeatMode = RepeatMode.Reverse</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">    Box(modifier = Modifier.size(<span class="number">300.</span>dp)) &#123;</span><br><span class="line">        Box(</span><br><span class="line">            Modifier</span><br><span class="line">                .padding(<span class="number">10.</span>dp)</span><br><span class="line">                .size(<span class="number">100.</span>dp)</span><br><span class="line">                .offset(offset.dp, offset.dp)</span><br><span class="line">                .clip(RoundedCornerShape(roundPercent.toInt()))</span><br><span class="line">                .background(color)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行效果：<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/da7af596a0ba19955854d85b9b808826.gif"></p>
<p>在 <strong>infiniteRepeatable</strong> 中的 <strong>repeatMode</strong> 有两种动画的重复模式：</p>
<ul>
<li><strong>Reverse</strong> ： 执行到目标状态后再原路返回初始状态，逆向执行动画效果</li>
<li><strong>Restart</strong>： 执行到目标状态后再重新从初始状态开始执行</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">InfiniteRepeatableDemo</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> infiniteTransition = rememberInfiniteTransition()</span><br><span class="line">    <span class="keyword">val</span> degrees <span class="keyword">by</span> infiniteTransition.animateFloat(</span><br><span class="line">        initialValue = <span class="number">0f</span>,</span><br><span class="line">        targetValue = <span class="number">360f</span>,</span><br><span class="line">        animationSpec = infiniteRepeatable(</span><br><span class="line">            animation = keyframes &#123;</span><br><span class="line">                durationMillis = <span class="number">3000</span></span><br><span class="line">                <span class="number">0F</span> at <span class="number">0</span></span><br><span class="line">                <span class="number">360f</span> at <span class="number">3000</span></span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    Box(</span><br><span class="line">        modifier = Modifier.fillMaxSize(),</span><br><span class="line">        contentAlignment = Alignment.Center</span><br><span class="line">    ) &#123;</span><br><span class="line">        Text(</span><br><span class="line">            text = <span class="string">&quot;infiniteRepeatable&quot;</span>,</span><br><span class="line">            modifier = Modifier.rotate(degrees = degrees),</span><br><span class="line">            color = Color.Red,</span><br><span class="line">            fontSize = <span class="number">22.</span>sp</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行效果：<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/88875c39f6ac2d057593e343327c9acb.gif"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ImageBorderAnimation</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> infiniteTransition = rememberInfiniteTransition()</span><br><span class="line">    <span class="keyword">val</span> degrees <span class="keyword">by</span> infiniteTransition.animateFloat(</span><br><span class="line">        initialValue = <span class="number">0f</span>,</span><br><span class="line">        targetValue = <span class="number">360f</span>,</span><br><span class="line">        animationSpec = infiniteRepeatable(tween(<span class="number">1000</span>, easing = LinearEasing))</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">val</span> strokeWidth = <span class="number">8.</span>dp</span><br><span class="line">    Box(</span><br><span class="line">        modifier = Modifier.fillMaxSize(),</span><br><span class="line">        contentAlignment = Alignment.Center</span><br><span class="line">    ) &#123;</span><br><span class="line">        Image(</span><br><span class="line">            painter = painterResource(id = R.drawable.ic_head3),</span><br><span class="line">            contentDescription = <span class="string">&quot;head&quot;</span>,</span><br><span class="line">            contentScale = ContentScale.Crop,</span><br><span class="line">            modifier = Modifier</span><br><span class="line">                .size(<span class="number">150.</span>dp)</span><br><span class="line">                .drawBehind &#123;</span><br><span class="line">                    rotate(degrees) &#123;</span><br><span class="line">                        drawCircle(</span><br><span class="line">                            brush = Brush.sweepGradient(colors = colors),</span><br><span class="line">                            style = Stroke(strokeWidth.toPx())</span><br><span class="line">                        )</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                .padding(strokeWidth / <span class="number">2</span>)</span><br><span class="line">                .clip(CircleShape)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行效果：<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/e014b20695c7a6cb8d5cdfd070086214.gif"></p>
<h3 id="AnimationSpec"><a href="#AnimationSpec" class="headerlink" title="AnimationSpec"></a>AnimationSpec</h3><p><strong>AnimationSpec</strong>主要是用来对动画进行配置的，前面许多例子中都使用了，目前Compose中大多数动画Api都支持<strong>AnimationSpec</strong>参数来定义动画效果</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> alpha: <span class="built_in">Float</span> <span class="keyword">by</span> animateFloatAsState(</span><br><span class="line">   targetValue = <span class="keyword">if</span> (enabled) <span class="number">1f</span> <span class="keyword">else</span> <span class="number">0.5f</span>,</span><br><span class="line">   <span class="comment">// Configure the animation duration and easing.</span></span><br><span class="line">   animationSpec = tween(durationMillis = <span class="number">300</span>, easing = FastOutSlowInEasing)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>Compose提供了多种AnimationSpec的子类</p>
<h4 id="spring弹簧动画"><a href="#spring弹簧动画" class="headerlink" title="spring弹簧动画"></a><strong>spring弹簧动画</strong></h4><p>使用<strong>spring</strong>会创建一个<strong>SpringSpec</strong>实例，可以用来创建一个基于物理特性的弹跳动画，它的动画估值将在当前值和目标值之间按照弹簧物理运动轨迹进行变化。<strong>spring</strong> 用作很多动画 API（如 <strong>animate*AsState</strong> 和 <strong>updateTransition</strong>）的默认 <strong>AnimationSpec</strong>。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> value <span class="keyword">by</span> animateFloatAsState(</span><br><span class="line">   targetValue = <span class="number">1f</span>,</span><br><span class="line">   animationSpec = spring(</span><br><span class="line">       dampingRatio = Spring.DampingRatioHighBouncy,</span><br><span class="line">       stiffness = Spring.StiffnessMedium</span><br><span class="line">   )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>spring</strong>有三个参数<strong>dampingRatio</strong>、<strong>stiffness</strong>、<strong>visibilityThreshold</strong> 其中前两个参数主要用来控制动画跳动效果的：</p>
<ul>
<li><strong>dampingRatio</strong> 表示弹簧的<strong>阻尼比</strong>，即弹簧的<strong>弹性</strong>，<strong>dampingRatio值越小弹性越大（震动幅度越大），反之弹性越小（dampingRatio&gt;&#x3D;0）</strong><br>  <strong>dampingRatio</strong>默认值是<strong>Spring.DampingRatioNoBouncy</strong>, 即默认没有弹性，系统预定义的<strong>dampingRatio</strong>的各个取值及效果如下：</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> Spring &#123;</span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">val</span> DampingRatioHighBouncy = <span class="number">0.2f</span></span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">val</span> DampingRatioMediumBouncy = <span class="number">0.5f</span></span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">val</span> DampingRatioLowBouncy = <span class="number">0.75f</span></span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">val</span> DampingRatioNoBouncy = <span class="number">1f</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/8f83c91db4e303c1689a4ddf40d7c611.gif%23pic_center" alt="在这里插入图片描述"></p>
<ul>
<li><strong>stiffness</strong>表示弹簧的<strong>刚度</strong>，<strong>值越大表示到静止状态的速度越快，反之越慢</strong>。默认值为 <strong>Spring.StiffnessMedium</strong>。<strong>（stiffness&gt;0）</strong><br>  系统预定义的<strong>stiffness</strong>常量值如下：</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> Spring &#123;</span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">val</span> StiffnessHigh = <span class="number">10_000f</span></span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">val</span> StiffnessMedium = <span class="number">1500f</span></span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">val</span> StiffnessMediumLow = <span class="number">400f</span></span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">val</span> StiffnessLow = <span class="number">200f</span></span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">val</span> StiffnessVeryLow = <span class="number">50f</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>visibilityThreshold</strong>是由开发者指定一个阈值，当动画到达这个阈值时，动画立即停止。其类型和<strong>targetValue</strong>一致。</li>
</ul>
<h4 id="tween补间动画"><a href="#tween补间动画" class="headerlink" title="tween补间动画"></a>tween补间动画</h4><p>使用<strong>tween</strong>可以创建一个<strong>TweenSpec</strong>实例，<strong>TweenSpec</strong>是<strong>DurationBasedAnimationSpec</strong>的子类。<br><strong>TweenSpec必须指定时间参数</strong>， 它必须在规定时间内完成动画。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> value <span class="keyword">by</span> animateFloatAsState(</span><br><span class="line">   targetValue = <span class="number">1f</span>,</span><br><span class="line">   animationSpec = tween(</span><br><span class="line">       durationMillis = <span class="number">300</span>,</span><br><span class="line">       delayMillis = <span class="number">50</span>,</span><br><span class="line">       easing = LinearOutSlowInEasing</span><br><span class="line">   )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>tween</strong>可以通过<strong>easing</strong>参数来控制动画变化速率</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 先加速后减速</span></span><br><span class="line"> <span class="keyword">val</span> FastOutSlowInEasing: Easing = CubicBezierEasing(<span class="number">0.4f</span>, <span class="number">0.0f</span>, <span class="number">0.2f</span>, <span class="number">1.0f</span>)</span><br><span class="line"> <span class="comment">// 先匀速后减速</span></span><br><span class="line"> <span class="keyword">val</span> LinearOutSlowInEasing: Easing = CubicBezierEasing(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.2f</span>, <span class="number">1.0f</span>)</span><br><span class="line"> <span class="comment">// 先加速后匀速</span></span><br><span class="line"> <span class="keyword">val</span> FastOutLinearInEasing: Easing = CubicBezierEasing(<span class="number">0.4f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>)</span><br><span class="line"> <span class="comment">// 一直匀速</span></span><br><span class="line"> <span class="keyword">val</span> LinearEasing: Easing = Easing &#123; fraction -&gt; fraction &#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>Easing</th>
<th>效果</th>
</tr>
</thead>
<tbody><tr>
<td>FastOutSlowInEasing</td>
<td><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/ee03d83f714e3ab9e0276027a27d8e5f.gif%23pic_center" alt="FastOutSlowInEasing"></td>
</tr>
<tr>
<td>LinearOutSlowInEasing</td>
<td><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/d4dc663bf349864688e9b9799fd14424.gif%23pic_center" alt="LinearOutSlowInEasing"></td>
</tr>
<tr>
<td>FastOutLinearInEasing</td>
<td><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/2ec458b00490e541ff49c687a1a42976.gif%23pic_center" alt="FastOutLinearInEasing"></td>
</tr>
</tbody></table>
<p>以上预定义的<strong>Easing</strong>都是通过<strong>CubicBezierEasing</strong>三阶贝塞尔曲线实现的，也可以自定义<strong>CubicBezierEasing</strong>。如需自定义<strong>CubicBezierEasing</strong>可以参考网站 <a target="_blank" rel="noopener" href="https://cubic-bezier.com/#.4,0,.2,1">cubic-bezier</a> 来调试自己的参数， 其中，起始点(0,0), 终点(1, 1), 所以只需要提供两个控制点的坐标即可，也就是<strong>CubicBezierEasing</strong>的四个参数的含义。</p>
<h4 id="keyframes关键帧动画"><a href="#keyframes关键帧动画" class="headerlink" title="keyframes关键帧动画"></a>keyframes关键帧动画</h4><p><strong>keyframes</strong> 可以更精细的控制动画，它允许在开始和结束之间插入关键帧节点，节点与节点之间的动画过渡可以应用不同效果。</p>
<p>对于其中每个关键帧，您都可以指定 <strong>Easing</strong> 来确定插值曲线。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> value <span class="keyword">by</span> animateFloatAsState(</span><br><span class="line">   targetValue = <span class="number">1f</span>,</span><br><span class="line">   animationSpec = keyframes &#123;</span><br><span class="line">       durationMillis = <span class="number">375</span></span><br><span class="line">       <span class="number">0.0f</span> at <span class="number">0</span> with LinearOutSlowInEasing <span class="comment">// 0ms初始值为0f, 开始使用LinearOutSlowInEasing</span></span><br><span class="line">       <span class="number">0.2f</span> at <span class="number">15</span> with FastOutLinearInEasing <span class="comment">// 15ms达到0.2f, 从15ms开始使用FastOutLinearInEasing</span></span><br><span class="line">       <span class="number">0.4f</span> at <span class="number">75</span> <span class="comment">// 75ms达到0.4f</span></span><br><span class="line">       <span class="number">0.4f</span> at <span class="number">225</span> <span class="comment">// 225ms达到0.4f</span></span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>keyframes</strong>返回一个<strong>KeyFrameSpec</strong>实例，它也是<strong>DurationBasedAnimationSpec</strong>的子类，需要在规定时间内完成动画。</p>
<p>关键帧节点的定义由时间戳、动画数值、动画效果组成。</p>
<h4 id="repeatable循环动画"><a href="#repeatable循环动画" class="headerlink" title="repeatable循环动画"></a>repeatable循环动画</h4><p>使用<strong>repeatable</strong>可以创建一个<strong>RepeatableSpec</strong>实例。<strong>repeatable</strong> 反复运行基于时长的动画（例如 <strong>tween</strong> 或 <strong>keyframes</strong>），直至达到指定的迭代计数。您可以传递 <strong>repeatMode</strong> 参数来指定动画是从头开始 (<strong>RepeatMode.Restart</strong>) 还是从结尾开始 (<strong>RepeatMode.Reverse</strong>) 重复播放。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> value <span class="keyword">by</span> animateFloatAsState(</span><br><span class="line">   targetValue = <span class="number">1f</span>,</span><br><span class="line">   animationSpec = repeatable(</span><br><span class="line">       iterations = <span class="number">3</span>, <span class="comment">// 重复播放的次数</span></span><br><span class="line">       animation = tween(durationMillis = <span class="number">300</span>),</span><br><span class="line">       repeatMode = RepeatMode.Reverse</span><br><span class="line">   )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>RepeatMode.Reverse: 往返执行，达到目标值后再原路返回初始值</li>
<li>RepeatMode.Restart: 从头执行，达到目标值后，再重新从初始值开始执行</li>
</ul>
<h4 id="infiniteRepeatable无限循环动画"><a href="#infiniteRepeatable无限循环动画" class="headerlink" title="infiniteRepeatable无限循环动画"></a>infiniteRepeatable无限循环动画</h4><p><strong>infiniteRepeatable</strong> 与 <strong>repeatable</strong> 类似，但它会重复无限次的迭代。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> value <span class="keyword">by</span> animateFloatAsState(</span><br><span class="line">   targetValue = <span class="number">1f</span>,</span><br><span class="line">   animationSpec = infiniteRepeatable(</span><br><span class="line">       animation = tween(durationMillis = <span class="number">300</span>),</span><br><span class="line">       repeatMode = RepeatMode.Reverse</span><br><span class="line">   )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="snap快闪动画"><a href="#snap快闪动画" class="headerlink" title="snap快闪动画"></a>snap快闪动画</h4><p><strong>snap</strong>创建一个<strong>SnapSpec</strong>实例，<strong>snap</strong> 是一种特殊的 <strong>AnimationSpec</strong>，它会立即将值切换到目标值。没有中间过渡，动画瞬间完成。</p>
<p>可以指定 <strong>delayMillis</strong> 来设置延迟动画的开始时间。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> value <span class="keyword">by</span> animateFloatAsState(</span><br><span class="line">   targetValue = <span class="number">1f</span>,</span><br><span class="line">   animationSpec = snap(delayMillis = <span class="number">50</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="动画形式的矢量资源"><a href="#动画形式的矢量资源" class="headerlink" title="动画形式的矢量资源"></a>动画形式的矢量资源</h3><p>如需使用 <strong>AnimatedVectorDrawable</strong> 资源，请使用 <strong>animatedVectorResource</strong> 加载可绘制对象文件，并传入 <strong>boolean</strong> 以在可绘制对象的开始和结束状态之间切换。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatedVectorDrawable</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> image = AnimatedImageVector.animatedVectorResource(R.drawable.ic_hourglass_animated)</span><br><span class="line">    <span class="keyword">var</span> atEnd <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">false</span>) &#125;</span><br><span class="line">    Image(</span><br><span class="line">        painter = rememberAnimatedVectorPainter(image, atEnd),</span><br><span class="line">        contentDescription = <span class="string">&quot;Timer&quot;</span>,</span><br><span class="line">        modifier = Modifier.clickable &#123;</span><br><span class="line">            atEnd = !atEnd</span><br><span class="line">        &#125;,</span><br><span class="line">        contentScale = ContentScale.Crop</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="低级动画API"><a href="#低级动画API" class="headerlink" title="低级动画API"></a>低级动画API</h2><p>前面提及的所有高级别动画 API 都是在低级别动画 API 的基础上构建而成的。</p>
<p>animate*AsState 函数是最简单的 API，可将即时值变化呈现为动画值。它由 Animatable 提供支持，后者是一种基于协程的 API，用于为单个值添加动画效果。updateTransition 可创建过渡对象，用于管理多个动画值，并且根据状态变化运行这些值。rememberInfiniteTransition 与其类似，不过，它会创建一个无限过渡对象，以管理多个无限期运行的动画。所有这些 API 都是可组合项（Animatable 除外），这意味着这些动画可以在非组合期间创建。</p>
<p>所有这些 API 都基于更基础的 Animation API。虽然大多数应用不会直接与 Animation 互动，但 Animation 的某些自定义功能可以通过更高级别的 API 获得。<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/f13713a4a9ffc78309e88ac2710c3c95.png" alt="在这里插入图片描述"></p>
<h3 id="Animatable"><a href="#Animatable" class="headerlink" title="Animatable"></a>Animatable</h3><p><strong>Animatable</strong> 是一个值容器，它的 <strong>animateTo</strong> 方法可以根据数值的变化设置动画效果。 <strong>animate*AsState</strong> 背后就是基于<strong>Animatable</strong>的实现。它可确保一致的连续性和互斥性，这意味着值变化始终是连续的，并且会取消任何当前正在播放的动画。</p>
<p><strong>Animatable</strong> 的许多功能（包括 <strong>animateTo</strong>）以<strong>挂起函数</strong>的形式提供。这意味着，它们需要在一个<strong>协程作用域</strong>内执行。</p>
<p>例如，可以搭配 <strong>LaunchedEffect</strong> 使用：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Start out gray and animate to green/red based on `ok`</span></span><br><span class="line"><span class="keyword">val</span> color = remember &#123; Animatable(Color.Gray) &#125;</span><br><span class="line">LaunchedEffect(ok) &#123;</span><br><span class="line">    color.animateTo(<span class="keyword">if</span> (ok) Color.Green <span class="keyword">else</span> Color.Red)</span><br><span class="line">&#125;</span><br><span class="line">Box(Modifier.fillMaxSize().background(color.value))</span><br></pre></td></tr></table></figure>

<p>这段代码创建了初始值为 <code>Color.Gray</code> 的 <strong>Animatable</strong> 实例。根据布尔标记 <code>ok</code> 的值，颜色将以动画形式呈现 <code>Color.Green</code> 或 <code>Color.Red</code>。对该布尔值的任何后续更改都会使动画开始使用另一种颜色。</p>
<p>如果正在播放动画的中途修改了<code>ok</code>值，系统会立即中断取消该动画，并且从当前快照值开始新的动画。</p>
<p>与 <strong>animate*AsState</strong> 相比，使用 <strong>Animatable</strong> 可以直接对以下几个方面进行更精细的控制：</p>
<ul>
<li>1）<strong>Animatable</strong> <strong>的初始值可以与第一个目标值不同</strong>。例如，上面的代码示例首先显示一个灰色，然后目标值为绿色或红色。</li>
<li>2）<strong>Animatable 对内容值提供更多操作（即 snapTo 和 animateDecay）</strong>。<strong>snapTo</strong> 可立即将当前值设为目标值，跳过中间过渡值。如果动画本身不是唯一的可信来源，且必须与其他状态（如触摸事件）同步，该函数就非常有用。<strong>animateDecay</strong> 用于衰减动画（从给定速度变慢），在fling等场景中非常有用。</li>
</ul>
<p>使用<strong>Animatable</strong>实现前面通过<strong>animatexxxAsState</strong>方式实现的红心按钮的例子：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatableExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> changeSize <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">false</span>) &#125;</span><br><span class="line">    <span class="keyword">var</span> changeColor <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">false</span>) &#125;</span><br><span class="line">    <span class="keyword">val</span> buttonSize = remember &#123; Animatable(<span class="number">24.</span>dp, Dp.VectorConverter) &#125;</span><br><span class="line">    <span class="keyword">val</span> buttonColor = remember &#123; Animatable(Color.Gray) &#125;</span><br><span class="line">    LaunchedEffect(changeSize, changeColor) &#123;</span><br><span class="line">        <span class="comment">// 注意，因为animateTo是挂起函数，会阻塞当前协程，</span></span><br><span class="line">        <span class="comment">// 所以这里必须分别放在launch中启动子协程执行，否则动画效果是顺序执行的</span></span><br><span class="line">        <span class="comment">// 或者，也可以分开放在两个LaunchedEffect里执行</span></span><br><span class="line">        launch &#123; buttonSize.animateTo(<span class="keyword">if</span>(changeSize) <span class="number">32.</span>dp <span class="keyword">else</span> <span class="number">24.</span>dp) &#125;</span><br><span class="line">        launch &#123; buttonColor.animateTo(<span class="keyword">if</span>(changeColor) Color.Red <span class="keyword">else</span> Color.Gray) &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (buttonSize.value == <span class="number">32.</span>dp) &#123;</span><br><span class="line">        changeSize = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    Box(</span><br><span class="line">        Modifier.fillMaxSize(),</span><br><span class="line">        contentAlignment = Alignment.Center</span><br><span class="line">    ) &#123;</span><br><span class="line">        IconButton(</span><br><span class="line">            onClick = &#123;</span><br><span class="line">                changeSize = <span class="literal">true</span></span><br><span class="line">                changeColor = !changeColor</span><br><span class="line">            &#125;</span><br><span class="line">        ) &#123;</span><br><span class="line">            Icon(Icons.Rounded.Favorite, <span class="literal">null</span>,</span><br><span class="line">                Modifier.size(buttonSize.value), tint = buttonColor.value)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行效果：<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/c20d41aa8bbf3833ebf86484469fdf06.gif"></p>
<p>这里需要注意的一点是：由于<strong>animateTo</strong>是<strong>挂起函数</strong>，会阻塞当前协程作用域范围的执行流程，所以这里必须分别放在<strong>launch</strong>中启动子协程执行，这样才能使得二者并行同时执行，否则如果直接将两个animateTo先后调用，那么最终动画效果将是顺序执行的，可以将上面代码中的launch都去掉，然后运行效果如下，可以对比一下有什么不同：<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/19d7586be3281bd406aafe10ec00b04d.gif"></p>
<p>上面代码中创建<code>buttonSize</code>时，传入了内置的<code>TwoWayConverter</code>转换器<code>Dp.VectorConverter</code>， <code>Animatable</code>可直接传入<strong>Float</strong>或<strong>Color</strong>类型的值，当传入其他类型时需要指定对应的<strong>TwoWayConverter</strong>转换器。</p>
<p>另外，需要注意的是，<strong>LaunchedEffect</strong>会在<strong>onActive</strong>时被执行，最好确保<strong>LaunchedEffect</strong>中<strong>animateTo</strong>的默认值与创建<strong>Animatable</strong>时的默认值相同，不然在首次渲染页面时就会呈现过渡动画（当然如果这就是你预期的需求，那就这样做）</p>
<h4 id="监听动画状态变化值"><a href="#监听动画状态变化值" class="headerlink" title="监听动画状态变化值"></a>监听动画状态变化值</h4><p><strong>animateTo</strong>可以传一个 <strong>lambda</strong>回调函数来获得动画状态值的变化：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">buttonColor.animateTo(<span class="keyword">if</span>(changeColor) Color.Red <span class="keyword">else</span> Color.Gray) &#123;</span><br><span class="line">   println(value) <span class="comment">// 监听动画状态值的变化</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="停止动画"><a href="#停止动画" class="headerlink" title="停止动画"></a>停止动画</h4><p>调用 <strong>animation.stop()</strong> 可以主动停止动画，但这是一个<strong>挂起函数</strong>，因此同样需要在一个协程作用域中执行它。</p>
<p><strong>animation.updateBounds()<strong>可以指定边界范围上下界（是指动画状态值的区间范围）当达到设置的</strong>upperBound</strong>或<strong>lowerBound</strong>时也会会停止动画，但这是属于正常符合预期的停止。</p>
<p>设置updateBounds()之后，还可以根据动画结果返回值执行后续逻辑：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> result = buttonSize.animateTo(..)</span><br><span class="line"><span class="keyword">if</span> (result.endReason == AnimationEndReason.BoundReached) &#123;</span><br><span class="line">    buttonSize.animateTo(...) <span class="comment">// 例如可以反向执行动画</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还有一种情况是，当使用 <strong>Animatable.animateTo()</strong> 在执行动画过程中，有人更新了其依赖的状态值，则动画会被立即中断而取消掉。</p>
<h3 id="Animation"><a href="#Animation" class="headerlink" title="Animation"></a>Animation</h3><p><strong>Animation</strong> 是可用的最低级别的 Animation API。到目前为止，我们看到的许多动画都是基于Animation 构建的。</p>
<p><strong>Animation</strong> 子类型有两种：<strong>TargetBasedAnimation</strong> 和 <strong>DecayAnimation</strong>。</p>
<p><strong>Animation 只能用于手动控制动画的时间</strong>。<strong>Animation</strong> 是<strong>无状态</strong>的，它没有任何生命周期概念。它充当更高级别 API 使用的动画计算引擎。</p>
<blockquote>
<p>注意：除非需要手动控制时间，否则通常建议使用基于这些类构建的更高级别动画 API。</p>
</blockquote>
<h4 id="TargetBasedAnimation"><a href="#TargetBasedAnimation" class="headerlink" title="TargetBasedAnimation"></a>TargetBasedAnimation</h4><p><strong>TargetBasedAnimation</strong> 可以直接让您自己<strong>控制动画的播放时间</strong>。<br>在下面的示例中，<strong>TargetAnimation</strong> 的播放时间将根据 <strong>withFrameNanos</strong> 提供的帧时间手动控制。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> anim = remember &#123;</span><br><span class="line">    TargetBasedAnimation(</span><br><span class="line">        animationSpec = tween(<span class="number">200</span>),</span><br><span class="line">        typeConverter = <span class="built_in">Float</span>.VectorConverter,</span><br><span class="line">        initialValue = <span class="number">200f</span>,</span><br><span class="line">        targetValue = <span class="number">1000f</span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> playTime <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">0L</span>) &#125;</span><br><span class="line"></span><br><span class="line">LaunchedEffect(anim) &#123;</span><br><span class="line">    <span class="keyword">val</span> startTime = withFrameNanos &#123; it &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        playTime = withFrameNanos &#123; it &#125; - startTime</span><br><span class="line">        <span class="keyword">val</span> animationValue = anim.getValueFromNanos(playTime)</span><br><span class="line">    &#125; <span class="keyword">while</span> (someCustomCondition())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="DecayAnimation"><a href="#DecayAnimation" class="headerlink" title="DecayAnimation"></a>DecayAnimation</h4><p>与 <strong>TargetBasedAnimation</strong> 不同，<strong>DecayAnimation</strong> 不需要提供 <strong>targetValue</strong>，而是根据起始条件（由 <strong>initialVelocity</strong> 和 <strong>initialValue</strong> 设置）以及所提供的 <strong>DecayAnimationSpec</strong> 计算其 <strong>targetValue</strong>。</p>
<p>衰减动画通常在快滑手势之后使用，用于使元素减速并停止。动画速度从 <strong>initialVelocityVector</strong> 设置的值开始，然后逐渐变慢。</p>
<h2 id="手势和动画"><a href="#手势和动画" class="headerlink" title="手势和动画"></a>手势和动画</h2><p>与单独处理动画相比，当我们处理触摸事件和动画时，必须考虑几个事项。<br>首先，当触摸事件开始时，我们可能需要中断正在播放的动画，因为用户互动应当具有最高优先级。</p>
<p>在下面的示例中，我们使用 <strong>Animatable</strong> 表示圆形组件的偏移位置。触摸事件由 <strong>pointerInput</strong> 修饰符处理。</p>
<p>当检测到新的点按事件时，我们将调用 <strong>animateTo</strong> 以将偏移值通过动画过渡到点按位置。在动画播放期间也可能发生点按事件。</p>
<p>在这种情况下，<strong>animateTo</strong> 会中断正在播放的动画，启动动画以过渡到新的目标位置，同时保持被中断的动画的速度。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressLint(<span class="string">&quot;ReturnFromAwaitPointerEventScope&quot;</span>)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">GestureWithAnimation</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> offset = remember &#123; Animatable(Offset(<span class="number">0f</span>, <span class="number">0f</span>), Offset.VectorConverter) &#125;</span><br><span class="line">    Box(Modifier</span><br><span class="line">            .fillMaxSize()</span><br><span class="line">            .pointerInput(<span class="built_in">Unit</span>) &#123;</span><br><span class="line">                coroutineScope &#123;</span><br><span class="line">                    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                        <span class="comment">// Detect a tap event and obtain its position.</span></span><br><span class="line">                        <span class="keyword">val</span> position = awaitPointerEventScope &#123; awaitFirstDown().position &#125;</span><br><span class="line">                        <span class="comment">// Animate to the tap position.</span></span><br><span class="line">                        launch &#123; offset.animateTo(position) &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    ) &#123;</span><br><span class="line">        Circle(Modifier.offset &#123; offset.value.toIntOffset() &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">Circle</span><span class="params">(modifier: <span class="type">Modifier</span> = Modifier)</span></span> &#123;</span><br><span class="line">    Box(modifier.size(<span class="number">100.</span>dp).clip(CircleShape).background(Color.Red))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> Offset.<span class="title">toIntOffset</span><span class="params">()</span></span> = IntOffset(x.roundToInt(), y.roundToInt())</span><br></pre></td></tr></table></figure>

<p>运行效果：<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/2bff1b4082cb0bb3005c7d82fb8bef74.gif"></p>
<p>另一种常见模式是需要将动画值与来自触摸事件（例如拖动）的值同步。在下面的示例中，我们会看到以 <strong>Modifier</strong> 的形式（而不是使用 <strong>SwipeToDismiss</strong> 可组合项）实现的“<strong>滑动关闭</strong>”。该元素的水平偏移量表示为 <strong>Animatable</strong>。此 API 具有可用于手势动画的特征。其值可由触摸事件和动画更改。收到触摸事件时，我们通过 <strong>stop</strong> 方法停止 <strong>Animatable</strong>，以便拦截任何正在播放的动画。</p>
<p>在拖动事件期间，我们使用 <strong>snapTo</strong> 将 <strong>Animatable</strong> 值更新为从触摸事件计算得出的值。对于快速滑动，<strong>Compose</strong> 可提供 <strong>VelocityTracker</strong> 来记录拖动事件并计算速度。速度可直接馈送至投掷动画的 <strong>animateDecay</strong>。如需将偏移值滑回原始位置，可使用 <strong>animateTo</strong> 方法指定 <strong>0f</strong> 的目标偏移值。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressLint(<span class="string">&quot;MultipleAwaitPointerEventScopes&quot;</span>, <span class="string">&quot;ReturnFromAwaitPointerEventScope&quot;</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Modifier.<span class="title">swipeToDismiss</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    onDismissed: () -&gt; <span class="type">Unit</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: Modifier = composed &#123;</span><br><span class="line">    <span class="keyword">val</span> offsetX = remember &#123; Animatable(<span class="number">0f</span>) &#125;</span><br><span class="line">    pointerInput(<span class="built_in">Unit</span>) &#123;</span><br><span class="line">        <span class="comment">// Used to calculate fling decay.</span></span><br><span class="line">        <span class="keyword">val</span> decay = splineBasedDecay&lt;<span class="built_in">Float</span>&gt;(<span class="keyword">this</span>)</span><br><span class="line">        <span class="comment">// Use suspend functions for touch events and the Animatable.</span></span><br><span class="line">        coroutineScope &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="comment">// Detect a touch down event.</span></span><br><span class="line">                <span class="keyword">val</span> pointerId = awaitPointerEventScope &#123; awaitFirstDown().id &#125;</span><br><span class="line">                <span class="keyword">val</span> velocityTracker = VelocityTracker()</span><br><span class="line">                <span class="comment">// Stop any ongoing animation.</span></span><br><span class="line">                offsetX.stop()</span><br><span class="line">                awaitPointerEventScope &#123;</span><br><span class="line">                    horizontalDrag(pointerId) &#123; change -&gt;</span><br><span class="line">                        <span class="comment">// Update the animation value with touch events.</span></span><br><span class="line">                        launch &#123; offsetX.snapTo(offsetX.value + change.positionChange().x) &#125;</span><br><span class="line">                        velocityTracker.addPosition(</span><br><span class="line">                            change.uptimeMillis,</span><br><span class="line">                            change.position</span><br><span class="line">                        )</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// No longer receiving touch events. Prepare the animation.</span></span><br><span class="line">                <span class="keyword">val</span> velocity = velocityTracker.calculateVelocity().x</span><br><span class="line">                <span class="keyword">val</span> targetOffsetX = decay.calculateTargetValue(offsetX.value, velocity)</span><br><span class="line">                <span class="comment">// The animation stops when it reaches the bounds.</span></span><br><span class="line">                offsetX.updateBounds(</span><br><span class="line">                    lowerBound = -size.width.toFloat(),</span><br><span class="line">                    upperBound = size.width.toFloat()</span><br><span class="line">                )</span><br><span class="line">                launch &#123;</span><br><span class="line">                    <span class="keyword">if</span> (targetOffsetX.absoluteValue &lt;= size.width) &#123;</span><br><span class="line">                        <span class="comment">// Not enough velocity; Slide back.</span></span><br><span class="line">                        offsetX.animateTo(argetValue = <span class="number">0f</span>,initialVelocity = velocity)</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// The element was swiped away.</span></span><br><span class="line">                        offsetX.animateDecay(velocity, decay)</span><br><span class="line">                        onDismissed()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.offset &#123; IntOffset(offsetX.value.roundToInt(), <span class="number">0</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">SwipeToDismissItem</span><span class="params">(color: <span class="type">Color</span> = Color.Red)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> isDismissed <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">false</span>) &#125;</span><br><span class="line">    <span class="keyword">if</span> (!isDismissed) &#123;</span><br><span class="line">        Box(</span><br><span class="line">            Modifier</span><br><span class="line">                .swipeToDismiss &#123; isDismissed = <span class="literal">true</span> &#125;</span><br><span class="line">                .fillMaxWidth()</span><br><span class="line">                .height(<span class="number">100.</span>dp)</span><br><span class="line">                .background(color)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">SwipeToDismissAnimationExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column &#123;</span><br><span class="line">        repeat(<span class="number">7</span>) &#123;</span><br><span class="line">            SwipeToDismissItem(color = colors[it % colors.size])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行效果：<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/30c5b27114b753fe96c6a004bac93773.gif"></p>
<h2 id="列表动画"><a href="#列表动画" class="headerlink" title="列表动画"></a>列表动画</h2><p>目前官方仅支持对LazyColumn&#x2F;LazyRow等延时列表重排序的时候做动画效果，可以使用<code>Modifier.animateItemPlacement()</code>来实现：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalFoundationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LazyColumnListAnimation</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> list <span class="keyword">by</span> remember &#123; mutableStateOf((<span class="string">&#x27;A&#x27;</span>..<span class="string">&#x27;Z&#x27;</span>).toList()) &#125;</span><br><span class="line">    LazyColumn(</span><br><span class="line">        Modifier.fillMaxWidth(),</span><br><span class="line">        contentPadding = PaddingValues(<span class="number">35.</span>dp),</span><br><span class="line">        verticalArrangement = Arrangement.spacedBy(<span class="number">10.</span>dp)</span><br><span class="line">    ) &#123;</span><br><span class="line">        item &#123;</span><br><span class="line">            Button(onClick = &#123; list = list.shuffled() &#125;) &#123;</span><br><span class="line">                Text(<span class="string">&quot;Shuffle&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        items(list, key = &#123; it &#125;) &#123;</span><br><span class="line">            CardContent(</span><br><span class="line">                <span class="string">&quot;Item <span class="variable">$it</span>&quot;</span>,</span><br><span class="line">                modifier = Modifier.animateItemPlacement(),</span><br><span class="line">                Color.Blue,</span><br><span class="line">                Color.White</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行效果：<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/27d5ff6ca32377f45583a9ca508d8eaf.gif"></p>
<p>虽然官方目前对LazyList列表添加和删除Item项时，没有可支持的动画Api，但是如果你有需求，也可以使用前面提供的Api来实现，如可以使用<strong>AnimatedVisibility</strong>：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ListItemAnimationComponent</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> personList = getPersonList()</span><br><span class="line">    <span class="keyword">val</span> deletedPersonList = remember &#123; mutableStateListOf&lt;Person&gt;() &#125;</span><br><span class="line">    LazyColumn(</span><br><span class="line">        modifier = Modifier.fillMaxWidth()</span><br><span class="line">    ) &#123;</span><br><span class="line">        itemsIndexed(items = personList) &#123; index, person -&gt;</span><br><span class="line">            AnimatedVisibility(</span><br><span class="line">                visible = !deletedPersonList.contains(person),</span><br><span class="line">                enter = expandVertically(),</span><br><span class="line">                exit = shrinkVertically(animationSpec = tween(<span class="number">1000</span>))</span><br><span class="line">            ) &#123;</span><br><span class="line">                Card(</span><br><span class="line">                    shape = RoundedCornerShape(<span class="number">4.</span>dp),</span><br><span class="line">                    backgroundColor = colors[index % colors.size],</span><br><span class="line">                    modifier = Modifier.fillParentMaxWidth()</span><br><span class="line">                ) &#123;</span><br><span class="line">                    Row(</span><br><span class="line">                        modifier = Modifier.fillParentMaxWidth(),</span><br><span class="line">                        horizontalArrangement = Arrangement.SpaceBetween</span><br><span class="line">                    ) &#123;</span><br><span class="line">                        Text(</span><br><span class="line">                            person.name,</span><br><span class="line">                            style = TextStyle(</span><br><span class="line">                                color = Color.Black,</span><br><span class="line">                                fontSize = <span class="number">20.</span>sp,</span><br><span class="line">                                textAlign = TextAlign.Center</span><br><span class="line">                            ),</span><br><span class="line">                            modifier = Modifier.padding(<span class="number">16.</span>dp)</span><br><span class="line">                        )</span><br><span class="line">                        IconButton(onClick = &#123; deletedPersonList.add(person) &#125;) &#123;</span><br><span class="line">                            Icon(</span><br><span class="line">                                imageVector = Icons.Filled.Delete,</span><br><span class="line">                                contentDescription = <span class="string">&quot;Delete&quot;</span></span><br><span class="line">                            )</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行效果：<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/d768744796ce6219af2e96168d09bbbd.gif"></p>
<h2 id="MotionLayout动画"><a href="#MotionLayout动画" class="headerlink" title="MotionLayout动画"></a>MotionLayout动画</h2><p>我们可以通过<strong>Compose</strong>版本的<strong>Constraintlayout</strong>依赖库实现一种<strong>MotionLayout</strong>联动效果的动画，效果如下：</p>
<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/9cba961b034e068e4b9dcd4ba4bda580.gif"></p>
<p>集成步骤：</p>
<ul>
<li>1.确保<code>app/build.gradle</code>中添加了<code>constraintlayout-compose</code>依赖库</li>
<li><code>implementation &quot;androidx.constraintlayout:constraintlayout-compose:1.0.1&quot;</code></li>
<li>2.在<code>res/raw/motion_scene.json5</code>中进行配置</li>
<li>3.在<code>MotionLayout Composable</code>函数中解析并使用配置</li>
</ul>
<p><strong>motion_scene.json5</strong>中的内容如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  ConstraintSets<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    start<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      profile_pic<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        width<span class="punctuation">:</span> <span class="number">48</span><span class="punctuation">,</span></span><br><span class="line">        height<span class="punctuation">:</span> <span class="number">48</span><span class="punctuation">,</span></span><br><span class="line">        start<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;start&#x27;<span class="punctuation">,</span> <span class="number">16</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        top<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;top&#x27;<span class="punctuation">,</span> <span class="number">16</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        custom<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          background<span class="punctuation">:</span> &#x27;#<span class="number">08</span>ff04&#x27;</span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      username<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        top<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;profile_pic&#x27;<span class="punctuation">,</span> &#x27;top&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        bottom<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;profile_pic&#x27;<span class="punctuation">,</span> &#x27;bottom&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        start<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;profile_pic&#x27;<span class="punctuation">,</span> &#x27;end&#x27;<span class="punctuation">,</span> <span class="number">16</span><span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      box<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        width<span class="punctuation">:</span> &#x27;spread&#x27;<span class="punctuation">,</span></span><br><span class="line">        height<span class="punctuation">:</span> &#x27;spread&#x27;<span class="punctuation">,</span></span><br><span class="line">        start<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;start&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        end<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;end&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        top<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;top&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        bottom<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;bottom&#x27;<span class="punctuation">,</span> <span class="number">-16</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    end<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      profile_pic<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        width<span class="punctuation">:</span> <span class="number">150</span><span class="punctuation">,</span></span><br><span class="line">        height<span class="punctuation">:</span> <span class="number">150</span><span class="punctuation">,</span></span><br><span class="line">        start<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;start&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        end<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;end&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        top<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;top&#x27;<span class="punctuation">,</span> <span class="number">16</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        custom<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          background<span class="punctuation">:</span> &#x27;#FFFFFF&#x27;</span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      username<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        top<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;profile_pic&#x27;<span class="punctuation">,</span> &#x27;bottom&#x27;<span class="punctuation">,</span> <span class="number">16</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        end<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;end&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        start<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;start&#x27;<span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      box<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        width<span class="punctuation">:</span> &#x27;spread&#x27;<span class="punctuation">,</span></span><br><span class="line">        height<span class="punctuation">:</span> &#x27;spread&#x27;<span class="punctuation">,</span></span><br><span class="line">        start<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;start&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        end<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;end&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        top<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;top&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        bottom<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;bottom&#x27;<span class="punctuation">,</span> <span class="number">-16</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  Transitions<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    default<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      from<span class="punctuation">:</span> &#x27;start&#x27;<span class="punctuation">,</span></span><br><span class="line">      to<span class="punctuation">:</span> &#x27;end&#x27;<span class="punctuation">,</span></span><br><span class="line">      pathMotionArc<span class="punctuation">:</span> &#x27;startHorizontal&#x27;<span class="punctuation">,</span></span><br><span class="line">      KeyFrames<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        KeyAttributes<span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            target<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;profile_pic&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            frames<span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">100</span><span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            target<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;username&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            frames<span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">50</span><span class="punctuation">,</span> <span class="number">100</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            translationX<span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">90</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>这个文件中主要配置了从start到end状态的各种属性值，以及各个组件相对于其他组件的依赖关系，同时可以在Transitions标签中指定KeyFrames的相关属性。</p>
<p>然后可以在Composable中调用设置代码如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MotionLayoutAnimationDemo</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column &#123;</span><br><span class="line">        <span class="keyword">var</span> progress <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">0f</span>) &#125;</span><br><span class="line">        ProfileHeader(progress = progress)</span><br><span class="line">        Spacer(modifier = Modifier.height(<span class="number">32.</span>dp))</span><br><span class="line">        Slider(</span><br><span class="line">            value = progress,</span><br><span class="line">            onValueChange = &#123; progress = it &#125;,</span><br><span class="line">            modifier = Modifier.padding(horizontal = <span class="number">32.</span>dp)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@OptIn(ExperimentalMotionApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ProfileHeader</span><span class="params">(progress: <span class="type">Float</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> context = LocalContext.current</span><br><span class="line">    <span class="keyword">val</span> motionScene = remember &#123;</span><br><span class="line">        context.resources</span><br><span class="line">            .openRawResource(R.raw.motion_scene)</span><br><span class="line">            .readBytes()</span><br><span class="line">            .decodeToString()</span><br><span class="line">    &#125;</span><br><span class="line">    MotionLayout(</span><br><span class="line">        motionScene = MotionScene(content = motionScene),</span><br><span class="line">        progress = progress,</span><br><span class="line">        modifier = Modifier.fillMaxWidth()</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">val</span> properties = motionProperties(id = <span class="string">&quot;profile_pic&quot;</span>)</span><br><span class="line">        Box(</span><br><span class="line">            modifier = Modifier</span><br><span class="line">                .fillMaxWidth()</span><br><span class="line">                .background(Color.DarkGray)</span><br><span class="line">                .layoutId(<span class="string">&quot;box&quot;</span>)</span><br><span class="line">        )</span><br><span class="line">        Image(</span><br><span class="line">            painter = painterResource(id = R.drawable.ic_head3),</span><br><span class="line">            contentDescription = <span class="literal">null</span>,</span><br><span class="line">            modifier = Modifier</span><br><span class="line">                .clip(CircleShape)</span><br><span class="line">                .border(</span><br><span class="line">                    width = <span class="number">2.</span>dp,</span><br><span class="line">                    color = properties.value.color(<span class="string">&quot;background&quot;</span>),</span><br><span class="line">                    shape = CircleShape</span><br><span class="line">                )</span><br><span class="line">                .layoutId(<span class="string">&quot;profile_pic&quot;</span>)</span><br><span class="line">        )</span><br><span class="line">        Text(</span><br><span class="line">            text = <span class="string">&quot;MotionLayout&quot;</span>,</span><br><span class="line">            fontSize = <span class="number">24.</span>sp,</span><br><span class="line">            modifier = Modifier.layoutId(<span class="string">&quot;username&quot;</span>),</span><br><span class="line">            color = properties.value.color(<span class="string">&quot;background&quot;</span>)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>虽然看起来有点麻烦，但是却不失为一种可以用来解决复杂动画效果的解决方案。</p>
<h2 id="其他一些动画效果Demo"><a href="#其他一些动画效果Demo" class="headerlink" title="其他一些动画效果Demo"></a>其他一些动画效果Demo</h2><h3 id="骨架屏加载动画效果"><a href="#骨架屏加载动画效果" class="headerlink" title="骨架屏加载动画效果"></a>骨架屏加载动画效果</h3><p>动画效果如下：</p>
<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/aaeba6c21f4da8d60f7f8879b3ded2a3.gif"></p>
<p>骨架屏加载动画实现要点：</p>
<ul>
<li>整个骨架图有多个具有动画渐变色效果的AnimatedShimmerItem组成，</li>
<li>ShimmerItem是单个Item布局，由多个闪烁的线条与矩形图形构成。</li>
<li>参数brush用作每个组件的背景色，使用linearGradient创建一个具有线性渐变色效果的brush，通过动画控制brush的渐变色的位移属性，放大到整个骨架图，便会呈现微光的渐变色效果了。</li>
</ul>
<p>源码如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> androidx.compose.animation.core.*</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.background</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.layout.*</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.rememberScrollState</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.shape.RoundedCornerShape</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.verticalScroll</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.Composable</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.Alignment</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.Modifier</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.draw.clip</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.geometry.Offset</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.graphics.Brush</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.graphics.Color</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.tooling.preview.Preview</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.unit.dp</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> barHeight = <span class="number">10.</span>dp</span><br><span class="line"><span class="keyword">val</span> spacerPadding = <span class="number">3.</span>dp</span><br><span class="line"><span class="keyword">val</span> roundedCornerShape = RoundedCornerShape(<span class="number">3.</span>dp)</span><br><span class="line"><span class="keyword">val</span> shimmerColors = listOf(</span><br><span class="line">    Color.LightGray.copy(alpha = <span class="number">0.6f</span>),</span><br><span class="line">    Color.LightGray.copy(alpha = <span class="number">0.2f</span>),</span><br><span class="line">    Color.LightGray.copy(alpha = <span class="number">0.6f</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="meta">@Preview(showBackground = true)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatedShimmerItem</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> transition = rememberInfiniteTransition()</span><br><span class="line">    <span class="keyword">val</span> translateAnim = transition.animateFloat(</span><br><span class="line">        initialValue = <span class="number">0f</span>,</span><br><span class="line">        targetValue = <span class="number">1000f</span>,</span><br><span class="line">        animationSpec = infiniteRepeatable(</span><br><span class="line">            animation = tween(<span class="number">1500</span>, easing = FastOutSlowInEasing),</span><br><span class="line">            repeatMode = RepeatMode.Restart</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">    <span class="comment">// 微光渐变效果</span></span><br><span class="line">    <span class="keyword">val</span> brush = Brush.linearGradient(</span><br><span class="line">        colors = shimmerColors,</span><br><span class="line">        start = Offset.Zero,</span><br><span class="line">        end = Offset(x = translateAnim.value, y = translateAnim.value) <span class="comment">// 动画改变end坐标位置产生渐变色位移效果</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    ShimmerItem(brush)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Preview(showBackground = true)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ShimmerItem</span><span class="params">(brush: <span class="type">Brush</span> = Brush.linearGradient(shimmerColors)</span></span>) &#123;</span><br><span class="line">    Column(Modifier.fillMaxWidth().padding(<span class="number">10.</span>dp)) &#123;</span><br><span class="line">        Row(verticalAlignment = Alignment.CenterVertically) &#123;</span><br><span class="line">            Spacer(</span><br><span class="line">                modifier = Modifier</span><br><span class="line">                    .size(<span class="number">100.</span>dp)</span><br><span class="line">                    .clip(roundedCornerShape)</span><br><span class="line">                    .background(brush)</span><br><span class="line">            )</span><br><span class="line">            Spacer(modifier = Modifier.width(<span class="number">10.</span>dp))</span><br><span class="line">            Column(verticalArrangement = Arrangement.Center) &#123;</span><br><span class="line">                repeat(<span class="number">5</span>) &#123;</span><br><span class="line">                    Spacer(modifier = Modifier.padding(spacerPadding))</span><br><span class="line">                    Spacer(</span><br><span class="line">                        modifier = Modifier</span><br><span class="line">                            .height(barHeight)</span><br><span class="line">                            .clip(roundedCornerShape)</span><br><span class="line">                            .fillMaxWidth()</span><br><span class="line">                            .background(brush)</span><br><span class="line">                    )</span><br><span class="line">                    Spacer(modifier = Modifier.padding(spacerPadding))</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        repeat(<span class="number">3</span>) &#123;</span><br><span class="line">            Spacer(modifier = Modifier.padding(spacerPadding))</span><br><span class="line">            Spacer(</span><br><span class="line">                modifier = Modifier</span><br><span class="line">                    .height(barHeight)</span><br><span class="line">                    .clip(roundedCornerShape)</span><br><span class="line">                    .fillMaxWidth()</span><br><span class="line">                    .background(brush)</span><br><span class="line">            )</span><br><span class="line">            Spacer(modifier = Modifier.padding(spacerPadding))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Preview(showBackground = true)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ShimmerListPreview</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column(Modifier.padding(<span class="number">5.</span>dp).verticalScroll(rememberScrollState())) &#123;</span><br><span class="line">        repeat(<span class="number">5</span>) &#123;</span><br><span class="line">            AnimatedShimmerItem()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="收藏按钮动画效果"><a href="#收藏按钮动画效果" class="headerlink" title="收藏按钮动画效果"></a>收藏按钮动画效果</h3><p>动画效果如下：</p>
<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/680ed083195c4a2aaeeb74a20fcaa2bd.gif"></p>
<p>实现要点：</p>
<ul>
<li>使用<strong>updateTransition</strong>精细控制状态变化时多个维度的属性值同时变化，效果上会比单纯的使用<strong>AnimatedContent</strong>实现方式更加的细腻丝滑。</li>
</ul>
<p>源码如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> androidx.compose.animation.*</span><br><span class="line"><span class="keyword">import</span> androidx.compose.animation.core.*</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.BorderStroke</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.layout.Box</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.layout.Column</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.layout.Row</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.layout.Spacer</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.layout.fillMaxWidth</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.layout.height</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.layout.size</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.layout.width</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.shape.RoundedCornerShape</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material.Button</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material.ButtonDefaults</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material.Icon</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material.Text</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material.icons.Icons</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material.icons.filled.Favorite</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material.icons.filled.FavoriteBorder</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.Composable</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.getValue</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.mutableStateOf</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.remember</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.setValue</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.Alignment</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.Modifier</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.graphics.Color</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.tooling.preview.Preview</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.unit.Dp</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.unit.dp</span><br><span class="line"><span class="keyword">import</span> com.fly.mycompose.application.ui.theme.MyComposeApplicationTheme</span><br><span class="line"><span class="keyword">import</span> com.fly.mycompose.application.ui.theme.Purple500</span><br><span class="line"></span><br><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">UiState</span>(</span><br><span class="line">    <span class="keyword">val</span> backgroundColor: Color,</span><br><span class="line">    <span class="keyword">val</span> textColor: Color,</span><br><span class="line">    <span class="keyword">val</span> roundedCorner: <span class="built_in">Int</span>,</span><br><span class="line">    <span class="keyword">val</span> buttonWidth: Dp</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="keyword">class</span> <span class="title class_">ButtonState</span>(<span class="keyword">val</span> ui: UiState) &#123;</span><br><span class="line">    Idle(UiState(Color.White, Purple500, <span class="number">6</span>, <span class="number">300.</span>dp)),</span><br><span class="line">    Pressed(UiState(Purple500, Color.White, <span class="number">50</span>, <span class="number">60.</span>dp))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">val</span> animateDuration = <span class="number">500</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">changeButtonState</span><span class="params">(buttonState: <span class="type">ButtonState</span>)</span></span> : ButtonState &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">when</span>(buttonState) &#123;</span><br><span class="line">        ButtonState.Idle -&gt; ButtonState.Pressed</span><br><span class="line">        ButtonState.Pressed -&gt; ButtonState.Idle</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@OptIn(ExperimentalAnimationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatedFavButton</span><span class="params">(modifier: <span class="type">Modifier</span> = Modifier)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> buttonState <span class="keyword">by</span> remember &#123; mutableStateOf(ButtonState.Idle) &#125;</span><br><span class="line">    Box(modifier) &#123;</span><br><span class="line">        AnimatedContent(</span><br><span class="line">            targetState = buttonState,</span><br><span class="line">            transitionSpec = &#123;</span><br><span class="line">                fadeIn(tween(animateDuration)) with</span><br><span class="line">                   fadeOut(tween(animateDuration))</span><br><span class="line">            &#125;</span><br><span class="line">        ) &#123; state -&gt;</span><br><span class="line">            FavButton(buttonState = state) &#123;</span><br><span class="line">                buttonState = changeButtonState(buttonState)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatedFavButton2</span><span class="params">(modifier: <span class="type">Modifier</span> = Modifier)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> buttonState <span class="keyword">by</span> remember &#123; mutableStateOf(ButtonState.Idle) &#125;</span><br><span class="line">    <span class="keyword">val</span> transition = updateTransition(targetState = buttonState, label = <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> backgroundColor <span class="keyword">by</span> transition.animateColor(</span><br><span class="line">        transitionSpec = &#123; spring() &#125;, label = <span class="string">&quot;&quot;</span></span><br><span class="line">    ) &#123; it.ui.backgroundColor &#125;</span><br><span class="line">    <span class="keyword">val</span> textColor <span class="keyword">by</span> transition.animateColor(</span><br><span class="line">        transitionSpec = &#123; spring() &#125;, label = <span class="string">&quot;&quot;</span></span><br><span class="line">    ) &#123; it.ui.textColor &#125;</span><br><span class="line">    <span class="keyword">val</span> roundedCorner <span class="keyword">by</span> transition.animateInt(</span><br><span class="line">        transitionSpec = &#123; spring() &#125;, label = <span class="string">&quot;&quot;</span></span><br><span class="line">    ) &#123; it.ui.roundedCorner &#125;</span><br><span class="line">    <span class="keyword">val</span> buttonWidth <span class="keyword">by</span> transition.animateDp(</span><br><span class="line">        transitionSpec = &#123; spring() &#125;, label = <span class="string">&quot;&quot;</span></span><br><span class="line">    ) &#123; it.ui.buttonWidth &#125;</span><br><span class="line"></span><br><span class="line">    FavButton(</span><br><span class="line">        modifier, buttonState, textColor, backgroundColor, roundedCorner, buttonWidth,</span><br><span class="line">    ) &#123;</span><br><span class="line">        buttonState = changeButtonState(buttonState)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">FavButton</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    modifier: <span class="type">Modifier</span> = Modifier,</span></span></span><br><span class="line"><span class="params"><span class="function">    buttonState: <span class="type">ButtonState</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    textColor: <span class="type">Color</span> = buttonState.ui.textColor,</span></span></span><br><span class="line"><span class="params"><span class="function">    backgroundColor: <span class="type">Color</span> = buttonState.ui.backgroundColor,</span></span></span><br><span class="line"><span class="params"><span class="function">    roundedCorner: <span class="type">Int</span> = buttonState.ui.roundedCorner,</span></span></span><br><span class="line"><span class="params"><span class="function">    buttonWidth: <span class="type">Dp</span> = buttonState.ui.buttonWidth,</span></span></span><br><span class="line"><span class="params"><span class="function">    onClick: () -&gt; <span class="type">Unit</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    Button(</span><br><span class="line">        border = BorderStroke(<span class="number">1.</span>dp, Purple500),</span><br><span class="line">        modifier = modifier.size(buttonWidth, height = <span class="number">60.</span>dp),</span><br><span class="line">        shape = RoundedCornerShape(roundedCorner.coerceIn(<span class="number">0.</span><span class="number">.100</span>)),</span><br><span class="line">        colors = ButtonDefaults.buttonColors(backgroundColor),</span><br><span class="line">        onClick = onClick,</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">if</span> (buttonState == ButtonState.Idle) &#123;</span><br><span class="line">            Row &#123;</span><br><span class="line">                Icon(</span><br><span class="line">                    tint = textColor,</span><br><span class="line">                    imageVector = Icons.Default.FavoriteBorder,</span><br><span class="line">                    modifier = Modifier.size(<span class="number">24.</span>dp).align(Alignment.CenterVertically),</span><br><span class="line">                    contentDescription = <span class="literal">null</span></span><br><span class="line">                )</span><br><span class="line">                Spacer(Modifier.width(<span class="number">16.</span>dp))</span><br><span class="line">                Text(</span><br><span class="line">                    <span class="string">&quot;ADD TO FAVORITES!&quot;</span>,</span><br><span class="line">                    softWrap = <span class="literal">false</span>,</span><br><span class="line">                    modifier = Modifier.align(Alignment.CenterVertically),</span><br><span class="line">                    color = textColor</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Icon(</span><br><span class="line">                tint = textColor,</span><br><span class="line">                imageVector = Icons.Default.Favorite,</span><br><span class="line">                modifier = Modifier.size(<span class="number">24.</span>dp),</span><br><span class="line">                contentDescription = <span class="literal">null</span></span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Preview(showBackground = true)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">PreviewFavButton</span><span class="params">()</span></span> &#123;</span><br><span class="line">    MyComposeApplicationTheme &#123;</span><br><span class="line">        Box(Modifier.fillMaxWidth(), contentAlignment = Alignment.Center) &#123;</span><br><span class="line">            Column(horizontalAlignment = Alignment.CenterHorizontally) &#123;</span><br><span class="line">                Text(<span class="string">&quot;High Level API（AnimatedContent)&quot;</span>)</span><br><span class="line">                Spacer(Modifier.height(<span class="number">10.</span>dp))</span><br><span class="line">                AnimatedFavButton()</span><br><span class="line"></span><br><span class="line">                Spacer(Modifier.height(<span class="number">50.</span>dp))</span><br><span class="line"></span><br><span class="line">                Text(<span class="string">&quot;Low Level API（updateTransition)&quot;</span>)</span><br><span class="line">                Spacer(Modifier.height(<span class="number">10.</span>dp))</span><br><span class="line">                AnimatedFavButton2()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="滑动列表时顶部TopBar折叠隐藏动画效果"><a href="#滑动列表时顶部TopBar折叠隐藏动画效果" class="headerlink" title="滑动列表时顶部TopBar折叠隐藏动画效果"></a>滑动列表时顶部TopBar折叠隐藏动画效果</h3><p>动画效果如下：</p>
<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/e04a763aeea96406b1cca2c9f7afe22d.gif"></p>
<p>实现要点：</p>
<ul>
<li>使用Box布局组件叠加TopBar组件和LayColumn列表组件，TopBar固定高度，LayColumn顶部预留出对应TopBar高度的padding距离</li>
<li>如果LayColumn列表向上滑动时，就修改opBar高度为0，同时修改LayColumn顶部的padding为0，反之则都修改为默认的固定高度值</li>
<li>TopBar组件上可以应用<code>Modifier.animateContentSize()</code>, 当高度被修改变化时，会执行动画效果，LayColumn组件可以使用<code>animateDpAsState</code>估值padding自动执行属性动画效果</li>
<li>判断LayColumn列表向上滑动的条件：先<code>rememberLazyListState()</code>，然后判断其<code>firstVisibleItemIndex &gt; 0 || firstVisibleItemScrollOffset &gt; 0</code>就是向上滚动了，TopBar组件和LayColumn组件都要依赖观察该状态值来修改高度和padding</li>
</ul>
<p>源码如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> androidx.compose.ui.Modifier</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.Composable</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material.Text</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.layout.*</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.Alignment</span><br><span class="line"><span class="keyword">import</span> androidx.compose.animation.animateContentSize</span><br><span class="line"><span class="keyword">import</span> androidx.compose.animation.core.animateDpAsState</span><br><span class="line"><span class="keyword">import</span> androidx.compose.animation.core.tween</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.background</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.lazy.LazyColumn</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.lazy.LazyListState</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.lazy.items</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.lazy.rememberLazyListState</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material.MaterialTheme</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material.Scaffold</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material.TopAppBar</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.getValue</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.remember</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.text.TextStyle</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.text.font.FontWeight</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.unit.dp</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> TOP_BAR_HEIGHT = <span class="number">56.</span>dp</span><br><span class="line"><span class="keyword">val</span> LazyListState.isScrolled: <span class="built_in">Boolean</span></span><br><span class="line">    <span class="keyword">get</span>() = firstVisibleItemIndex &gt; <span class="number">0</span> || firstVisibleItemScrollOffset &gt; <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimationTopBarDemo</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> lazyListState = rememberLazyListState()</span><br><span class="line">    Scaffold(</span><br><span class="line">        content = &#123;</span><br><span class="line">            Box(modifier = Modifier.padding(it).fillMaxSize()) &#123;</span><br><span class="line">                MainContent(lazyListState = lazyListState)</span><br><span class="line">                TopBar(lazyListState = lazyListState)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">TopBar</span><span class="params">(lazyListState: <span class="type">LazyListState</span>)</span></span> &#123;</span><br><span class="line">    TopAppBar(</span><br><span class="line">        modifier = Modifier</span><br><span class="line">            .fillMaxWidth()</span><br><span class="line">            .background(color = MaterialTheme.colors.primary)</span><br><span class="line">            .animateContentSize(animationSpec = tween(durationMillis = <span class="number">300</span>))</span><br><span class="line">            .height(height = <span class="keyword">if</span> (lazyListState.isScrolled) <span class="number">0.</span>dp <span class="keyword">else</span> TOP_BAR_HEIGHT),</span><br><span class="line">        contentPadding = PaddingValues(start = <span class="number">16.</span>dp)</span><br><span class="line">    ) &#123;</span><br><span class="line">        Text(</span><br><span class="line">            text = <span class="string">&quot;Title&quot;</span>,</span><br><span class="line">            style = TextStyle(</span><br><span class="line">                fontSize = MaterialTheme.typography.h6.fontSize,</span><br><span class="line">                color = MaterialTheme.colors.surface</span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MainContent</span><span class="params">(lazyListState: <span class="type">LazyListState</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> numbers = remember &#123; List(size = <span class="number">25</span>) &#123; it &#125; &#125;</span><br><span class="line">    <span class="keyword">val</span> padding <span class="keyword">by</span> animateDpAsState(</span><br><span class="line">        targetValue = <span class="keyword">if</span> (lazyListState.isScrolled) <span class="number">0.</span>dp <span class="keyword">else</span> TOP_BAR_HEIGHT,</span><br><span class="line">        animationSpec = tween(durationMillis = <span class="number">300</span>)</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    LazyColumn(</span><br><span class="line">        modifier = Modifier.padding(top = padding),</span><br><span class="line">        state = lazyListState</span><br><span class="line">    ) &#123;</span><br><span class="line">        items(items = numbers, key = &#123; it &#125;) &#123;</span><br><span class="line">            NumberHolder(number = it)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">NumberHolder</span><span class="params">(number: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">    Row(</span><br><span class="line">        modifier = Modifier.fillMaxWidth(),</span><br><span class="line">        verticalAlignment = Alignment.CenterVertically</span><br><span class="line">    ) &#123;</span><br><span class="line">        Text(</span><br><span class="line">            text = number.toString(),</span><br><span class="line">            style = TextStyle(</span><br><span class="line">                fontSize = MaterialTheme.typography.h3.fontSize,</span><br><span class="line">                fontWeight = FontWeight.Bold</span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>参考：</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://developer.android.com/jetpack/compose/animation#animation">Jetpack Compose animation</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=1g3SPJxk4wc&list=PLQkwcJG4YTCSpJ2NLhDTHhi6XBNfk9WiC&index=28">Build Complex Animations With MotionLayout in Jetpack Compose</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=4NDGqqAoD-8&list=PLSrm9z4zp4mEWwyiuYgVMWcDFdsebhM-r&index=61">Collapsing Top Bar Animation with Jetpack Compose</a></p>
</li>
<li><p>《Jetpack Compose从入门到实战》- 机械工业出版社 - 2022年9月</p>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://bravestsnail.github.io">BravestSnail</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://bravestsnail.github.io/2025/05/29/note/Android/compose/Compose%E7%9A%84%E5%8A%A8%E7%94%BB/">https://bravestsnail.github.io/2025/05/29/note/Android/compose/Compose%E7%9A%84%E5%8A%A8%E7%94%BB/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://bravestsnail.github.io" target="_blank">BravestSnail's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Android/">Android</a><a class="post-meta__tags" href="/tags/Compose/">Compose</a><a class="post-meta__tags" href="/tags/%E5%8A%A8%E7%94%BB/">动画</a></div><div class="post-share"><div class="social-share" data-image="/images/avatar.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/05/29/note/Android/compose/Compose%E4%B8%AD%E7%9A%84%E7%BB%98%E5%88%B6%E6%B5%81%E7%A8%8B%E5%92%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B8%83%E5%B1%80/" title="Compose中的绘制流程和自定义布局"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Compose中的绘制流程和自定义布局</div></div><div class="info-2"><div class="info-item-1">  与大多数其他界面工具包一样，Compose 会通过几个不同的“阶段”来渲染帧。如果我们观察一下 Android View 系统，就会发现它有 3 个主要阶段：测量、布局和绘制。Compose 和它非常相似，但开头多了一个叫做“组合”的重要阶段。 Compose 有 3 个主要的阶段：  组合：要显示什么样的界面。Compose 运行Composable可组合函数并创建LayoutNode视图树。 布局：要放置界面的位置。该阶段包含两个步骤：测量和放置。对于视图树中的每个LayoutNode节点进行宽高尺寸测量并完成位置摆放，布局元素都会根据 2D 坐标来测量并放置自己及其所有子元素。 绘制：渲染的方式。将所有LayoutNode界面元素会绘制到画布（通常是设备屏幕）之上。   这些阶段的顺序通常是相同的，从而让数据能够沿一个方向（从组合到布局，再到绘制）生成帧（也称为单向数据流）。 您可以放心地假设每个帧都会以虚拟方式经历这 3 个阶段，但为了保障性能，Compose...</div></div></div></a><a class="pagination-related" href="/2025/05/29/note/Android/compose/Compose%E7%9A%84%E6%89%8B%E5%8A%BF%E6%93%8D%E4%BD%9C%E5%92%8C%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86/" title="Compose的手势操作和事件处理"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Compose的手势操作和事件处理</div></div><div class="info-2"><div class="info-item-1">  Compose 中的手势操作或事件处理全部都是以 Modifier 修饰符的形式提供的，事件处理按照层次可以划分为高级事件处理API和低级事件处理API。 其中高级事件处理API是位于更上层的API，它们都是基于更底层的低级事件处理API实现的，也是开发中比较常用的。高级事件处理API的分类大概如下图所示：  点击事件监听点击事件非常简单，使用 clickable 和 combinedClickable 修饰符即可满足需求： 123456789101112131415161718@OptIn(ExperimentalFoundationApi::class)@Composablefun ClickableExample() &#123;    Column&#123;        Box(Modifier            .clickable &#123; println(&quot;clickable&quot;) &#125;            .size(30.dp)            .background(Color.Red))       ...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/05/29/note/Android/compose/Compose%E4%B8%AD%E7%9A%84Accompanist/" title="Compose中的Accompanist"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-30</div><div class="info-item-2">Compose中的Accompanist</div></div><div class="info-2"><div class="info-item-1">  权限依赖配置： 1234567repositories &#123;    mavenCentral()&#125;dependencies &#123;    implementation &quot;com.google.accompanist:accompanist-permissions:0.28.0&quot;&#125;  单个权限申请例如，我们需要获取相机权限，可以通过rememberPermissionState(Manifest.permission.CAMERA)创建一个 PermissionState对象，然后通过PermissionState.status.isGranted判断权限是否已获取，并通过调用permissionState.launchPermissionRequest()来申请权限。 12345&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;    &lt;!-- 别忘了在清单文件中添加权限声明 --&gt;   ...</div></div></div></a><a class="pagination-related" href="/2025/05/29/note/Android/compose/Compose%E4%B8%AD%E7%9A%84startActivityForResult%E7%9A%84%E6%AD%A3%E7%A1%AE%E5%A7%BF%E5%8A%BF/" title="Compose中的startActivityForResult的正确姿势"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-30</div><div class="info-item-2">Compose中的startActivityForResult的正确姿势</div></div><div class="info-2"><div class="info-item-1">  后来研究了一下，在Compose 中startActivityForResult也有了新的姿势，要理解Compose 中startActivityForResult的姿势，这还得从androidx的startActivityForResult的姿势说起，因为Compose 就是在androidx的基础上利用其API简单封装了一下而已。 倒也不是说以前的不能用了，毕竟有系统自带的，谁还去用第三方的呀，用第三方的还得导入一个依赖库不是，能少依赖三方的就尽量少依赖吧。 androidx之后如何正确的startActivityForResult如何使用如果是在Activity或Fragment内部使用的话，直接调用registerForActivityResult方法即可。 例如，选择文件： 12345val launcher = registerForActivityResult(ActivityResultContracts.GetContent()) &#123; uri -&gt;    uri?.apply &#123; showToast(uri.toString())...</div></div></div></a><a class="pagination-related" href="/2025/05/29/note/Android/compose/Compose%E4%B8%AD%E7%9A%84%E5%AF%BC%E8%88%AA%E8%B7%AF%E7%94%B1/" title="Compose中的导航路由"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-30</div><div class="info-item-2">Compose中的导航路由</div></div><div class="info-2"><div class="info-item-1">  1implementation &quot;androidx.navigation:navigation-compose:$nav_version&quot;   Jetpack库中的Navigation使用起来还是比较麻烦的，首先需要在xml中进行导航图的配置，然后在代码中使用NavController.navigate(id)进行跳转到指定的id的fragment页面，个人感觉这种方式还是不够灵活，需要预先定义，假如某个fragment没有在xml中定义就无法使用NavController进行跳转，另外还需要在xml和java&#x2F;kotlin文件来回折腾修改。 Jetpack...</div></div></div></a><a class="pagination-related" href="/2025/05/29/note/Android/compose/Compose%E4%B8%AD%E7%9A%84%E7%BB%98%E5%88%B6%E6%B5%81%E7%A8%8B%E5%92%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B8%83%E5%B1%80/" title="Compose中的绘制流程和自定义布局"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-30</div><div class="info-item-2">Compose中的绘制流程和自定义布局</div></div><div class="info-2"><div class="info-item-1">  与大多数其他界面工具包一样，Compose 会通过几个不同的“阶段”来渲染帧。如果我们观察一下 Android View 系统，就会发现它有 3 个主要阶段：测量、布局和绘制。Compose 和它非常相似，但开头多了一个叫做“组合”的重要阶段。 Compose 有 3 个主要的阶段：  组合：要显示什么样的界面。Compose 运行Composable可组合函数并创建LayoutNode视图树。 布局：要放置界面的位置。该阶段包含两个步骤：测量和放置。对于视图树中的每个LayoutNode节点进行宽高尺寸测量并完成位置摆放，布局元素都会根据 2D 坐标来测量并放置自己及其所有子元素。 绘制：渲染的方式。将所有LayoutNode界面元素会绘制到画布（通常是设备屏幕）之上。   这些阶段的顺序通常是相同的，从而让数据能够沿一个方向（从组合到布局，再到绘制）生成帧（也称为单向数据流）。 您可以放心地假设每个帧都会以虚拟方式经历这 3 个阶段，但为了保障性能，Compose...</div></div></div></a><a class="pagination-related" href="/2025/05/29/note/Android/compose/Compose%E7%9A%84%E6%89%8B%E5%8A%BF%E6%93%8D%E4%BD%9C%E5%92%8C%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86/" title="Compose的手势操作和事件处理"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-30</div><div class="info-item-2">Compose的手势操作和事件处理</div></div><div class="info-2"><div class="info-item-1">  Compose 中的手势操作或事件处理全部都是以 Modifier 修饰符的形式提供的，事件处理按照层次可以划分为高级事件处理API和低级事件处理API。 其中高级事件处理API是位于更上层的API，它们都是基于更底层的低级事件处理API实现的，也是开发中比较常用的。高级事件处理API的分类大概如下图所示：  点击事件监听点击事件非常简单，使用 clickable 和 combinedClickable 修饰符即可满足需求： 123456789101112131415161718@OptIn(ExperimentalFoundationApi::class)@Composablefun ClickableExample() &#123;    Column&#123;        Box(Modifier            .clickable &#123; println(&quot;clickable&quot;) &#125;            .size(30.dp)            .background(Color.Red))       ...</div></div></div></a><a class="pagination-related" href="/2022/08/22/posts/Activity%E7%9A%84%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/" title="Activity的启动流程"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-22</div><div class="info-item-2">Activity的启动流程</div></div><div class="info-2"><div class="info-item-1">Application的初始化从应用进程到系统进程ActivityThread在创建的时候，会将自己的ApplicationThread绑定到AMS中。  ActivityThread.main() ActivityThread.attach() IActivityManager.attachApplication(mAppThread) Binder.transact()        应用程序通过IActivityManager接口发起系统调用，调用attachApplication并传递IApplicationThread，执行流程从应用进程到了系统进程。  ActivityManagerService.onTransact() ActivityManagerService.attachApplication(IApplicationThread thread)AMS作为IActivityService的接口的服务端实现，会响应客户端的请求，最终attachApplication(IApplicationThread...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/images/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">BravestSnail</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">78</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E5%8A%A8%E7%94%BBAPI"><span class="toc-number">1.</span> <span class="toc-text">高级动画API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AnimatedVisibility"><span class="toc-number">1.1.</span> <span class="toc-text">AnimatedVisibility</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E5%AD%90%E9%A1%B9%E6%B7%BB%E5%8A%A0%E8%BF%9B%E5%85%A5%E5%92%8C%E9%80%80%E5%87%BA%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C"><span class="toc-number">1.1.1.</span> <span class="toc-text">为子项添加进入和退出动画效果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89Enter-Exit%E5%8A%A8%E7%94%BB"><span class="toc-number">1.1.2.</span> <span class="toc-text">自定义Enter&#x2F;Exit动画</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AnimatedContent"><span class="toc-number">1.2.</span> <span class="toc-text">AnimatedContent</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ContentTransform"><span class="toc-number">1.2.1.</span> <span class="toc-text">ContentTransform</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#slideIntoContainer-%E5%92%8C-slideOutOfContainer"><span class="toc-number">1.2.2.</span> <span class="toc-text">slideIntoContainer 和 slideOutOfContainer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SizeTransform"><span class="toc-number">1.2.3.</span> <span class="toc-text">SizeTransform</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Modifier-animateContentSize"><span class="toc-number">1.2.4.</span> <span class="toc-text">Modifier.animateContentSize</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Crossfade"><span class="toc-number">1.3.</span> <span class="toc-text">Crossfade</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#animateXXXAsState"><span class="toc-number">1.4.</span> <span class="toc-text">animateXXXAsState</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AnimationVector-TwoWayConverter"><span class="toc-number">1.4.1.</span> <span class="toc-text">AnimationVector &amp; TwoWayConverter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89TwoWayConverter"><span class="toc-number">1.4.2.</span> <span class="toc-text">自定义TwoWayConverter</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Transition"><span class="toc-number">1.5.</span> <span class="toc-text">Transition</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#updateTransition"><span class="toc-number">1.5.1.</span> <span class="toc-text">updateTransition</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MutableTransitionState"><span class="toc-number">1.5.2.</span> <span class="toc-text">MutableTransitionState</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#MutableTransitionState%EF%BC%9A%E4%B8%BA%E5%85%B6%E8%AE%BE%E7%BD%AE%E4%B8%8D%E5%90%8C%E7%9A%84%E7%9B%AE%E6%A0%87%E5%80%BC%E5%8F%AF%E7%AB%8B%E5%8D%B3%E8%A7%A6%E5%8F%91%E5%8A%A8%E7%94%BB"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">MutableTransitionState：为其设置不同的目标值可立即触发动画</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#MutableTransitionState-%E5%8F%AF%E4%BB%A5%E7%94%A8%E6%9D%A5%E7%9B%91%E5%90%AC%E5%8A%A8%E7%94%BB%E7%8A%B6%E6%80%81"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">MutableTransitionState 可以用来监听动画状态</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#createChildTransition"><span class="toc-number">1.5.3.</span> <span class="toc-text">createChildTransition</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86-Transition-%E4%B8%8E-AnimatedVisibility-%E5%92%8C-AnimatedContent-%E9%85%8D%E5%90%88%E4%BD%BF%E7%94%A8"><span class="toc-number">1.5.4.</span> <span class="toc-text">将 Transition 与 AnimatedVisibility 和 AnimatedContent 配合使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E5%92%8C%E5%A4%8D%E7%94%A8-Transition"><span class="toc-number">1.5.5.</span> <span class="toc-text">封装和复用 Transition</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rememberInfiniteTransition"><span class="toc-number">1.5.6.</span> <span class="toc-text">rememberInfiniteTransition</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AnimationSpec"><span class="toc-number">1.6.</span> <span class="toc-text">AnimationSpec</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#spring%E5%BC%B9%E7%B0%A7%E5%8A%A8%E7%94%BB"><span class="toc-number">1.6.1.</span> <span class="toc-text">spring弹簧动画</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tween%E8%A1%A5%E9%97%B4%E5%8A%A8%E7%94%BB"><span class="toc-number">1.6.2.</span> <span class="toc-text">tween补间动画</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#keyframes%E5%85%B3%E9%94%AE%E5%B8%A7%E5%8A%A8%E7%94%BB"><span class="toc-number">1.6.3.</span> <span class="toc-text">keyframes关键帧动画</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#repeatable%E5%BE%AA%E7%8E%AF%E5%8A%A8%E7%94%BB"><span class="toc-number">1.6.4.</span> <span class="toc-text">repeatable循环动画</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#infiniteRepeatable%E6%97%A0%E9%99%90%E5%BE%AA%E7%8E%AF%E5%8A%A8%E7%94%BB"><span class="toc-number">1.6.5.</span> <span class="toc-text">infiniteRepeatable无限循环动画</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#snap%E5%BF%AB%E9%97%AA%E5%8A%A8%E7%94%BB"><span class="toc-number">1.6.6.</span> <span class="toc-text">snap快闪动画</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E7%94%BB%E5%BD%A2%E5%BC%8F%E7%9A%84%E7%9F%A2%E9%87%8F%E8%B5%84%E6%BA%90"><span class="toc-number">1.7.</span> <span class="toc-text">动画形式的矢量资源</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%8E%E7%BA%A7%E5%8A%A8%E7%94%BBAPI"><span class="toc-number">2.</span> <span class="toc-text">低级动画API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Animatable"><span class="toc-number">2.1.</span> <span class="toc-text">Animatable</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%91%E5%90%AC%E5%8A%A8%E7%94%BB%E7%8A%B6%E6%80%81%E5%8F%98%E5%8C%96%E5%80%BC"><span class="toc-number">2.1.1.</span> <span class="toc-text">监听动画状态变化值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%81%9C%E6%AD%A2%E5%8A%A8%E7%94%BB"><span class="toc-number">2.1.2.</span> <span class="toc-text">停止动画</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Animation"><span class="toc-number">2.2.</span> <span class="toc-text">Animation</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#TargetBasedAnimation"><span class="toc-number">2.2.1.</span> <span class="toc-text">TargetBasedAnimation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DecayAnimation"><span class="toc-number">2.2.2.</span> <span class="toc-text">DecayAnimation</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%8B%E5%8A%BF%E5%92%8C%E5%8A%A8%E7%94%BB"><span class="toc-number">3.</span> <span class="toc-text">手势和动画</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%97%E8%A1%A8%E5%8A%A8%E7%94%BB"><span class="toc-number">4.</span> <span class="toc-text">列表动画</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MotionLayout%E5%8A%A8%E7%94%BB"><span class="toc-number">5.</span> <span class="toc-text">MotionLayout动画</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E4%B8%80%E4%BA%9B%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9CDemo"><span class="toc-number">6.</span> <span class="toc-text">其他一些动画效果Demo</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%A8%E6%9E%B6%E5%B1%8F%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C"><span class="toc-number">6.1.</span> <span class="toc-text">骨架屏加载动画效果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B6%E8%97%8F%E6%8C%89%E9%92%AE%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C"><span class="toc-number">6.2.</span> <span class="toc-text">收藏按钮动画效果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BB%91%E5%8A%A8%E5%88%97%E8%A1%A8%E6%97%B6%E9%A1%B6%E9%83%A8TopBar%E6%8A%98%E5%8F%A0%E9%9A%90%E8%97%8F%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C"><span class="toc-number">6.3.</span> <span class="toc-text">滑动列表时顶部TopBar折叠隐藏动画效果</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/04/note/%E4%B8%8A%E4%B8%8B%E6%96%87Context/" title="上下文Context">上下文Context</a><time datetime="2025-06-04T12:46:35.127Z" title="发表于 2025-06-04 20:46:35">2025-06-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/04/note/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" title="正则表达式">正则表达式</a><time datetime="2025-06-04T12:46:35.127Z" title="发表于 2025-06-04 20:46:35">2025-06-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/04/note/%E6%B3%A8%E8%A7%A3%E5%92%8C%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8/" title="注解和注解处理器">注解和注解处理器</a><time datetime="2025-06-04T12:46:35.127Z" title="发表于 2025-06-04 20:46:35">2025-06-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/04/note/%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E3%80%81%E5%8D%8F%E7%A8%8B%E7%9A%84%E5%8C%BA%E5%88%AB/" title="进程、线程、协程的区别">进程、线程、协程的区别</a><time datetime="2025-06-04T12:46:35.127Z" title="发表于 2025-06-04 20:46:35">2025-06-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/04/note/kotlin/Kotlin%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/" title="Kotlin踩坑记录">Kotlin踩坑记录</a><time datetime="2025-06-04T12:46:35.127Z" title="发表于 2025-06-04 20:46:35">2025-06-04</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By BravestSnail</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>