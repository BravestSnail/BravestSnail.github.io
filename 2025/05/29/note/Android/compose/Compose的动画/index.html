<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Composeçš„åŠ¨ç”» | BravestSnail's Blog</title><meta name="author" content="BravestSnail"><meta name="copyright" content="BravestSnail"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ä¹ä¸€çœ‹Jetpack Composeä¸­çš„åŠ¨ç”»Apiï¼Œå°¼ç›æ˜¯çœŸçš„å¤šå‘€ï¼Œæˆ‘Cäº†ï¼Œç®€ç›´ä»¤äººçœ¼èŠ±ç¼­ä¹±ã€äº‘é‡Œé›¾é‡Œã€å¤©é©¬è¡Œç©ºã€å°å…”ä¹±æ’ã€æ‰‹è„šæ…Œä¹±ã€å¤´å†’è™šæ±—ã€å››è‚¢æŠ“ç‹‚ã€ä¸çŸ¥æ‰€æªå‘€ ã€‚ã€‚ã€‚ğŸ˜­ ä½†æ˜¯æˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œåˆ†ä¸€ä¸‹ç±»ï¼Œå¦‚æœæŒ‰ç…§ä½¿ç”¨çš„æ–¹ä¾¿ç¨‹åº¦åˆ’åˆ†ï¼Œå¤§æ¦‚å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼šé«˜çº§åŠ¨ç”»APIå’Œä½çº§åŠ¨ç”»APIï¼ˆè¿™é‡Œç±»æ¯”é«˜çº§å¼€å‘è¯­è¨€çš„åˆ†ç±»ï¼Œå¹¶ä¸æ˜¯æŒ‡æ•ˆæœå¤šé«˜çº§ï¼‰ã€‚ å…¶ä¸­é«˜çº§åŠ¨ç”»APIä½¿ç”¨æ¯”è¾ƒç®€å•æ–¹ä¾¿ï¼Œå°è£…åº¦é«˜ï¼Œæ›´åŠ é€‚ç”¨äºæ—¥">
<meta property="og:type" content="article">
<meta property="og:title" content="Composeçš„åŠ¨ç”»">
<meta property="og:url" content="https://bravestsnail.github.io/2025/05/29/note/Android/compose/Compose%E7%9A%84%E5%8A%A8%E7%94%BB/index.html">
<meta property="og:site_name" content="BravestSnail&#39;s Blog">
<meta property="og:description" content="ä¹ä¸€çœ‹Jetpack Composeä¸­çš„åŠ¨ç”»Apiï¼Œå°¼ç›æ˜¯çœŸçš„å¤šå‘€ï¼Œæˆ‘Cäº†ï¼Œç®€ç›´ä»¤äººçœ¼èŠ±ç¼­ä¹±ã€äº‘é‡Œé›¾é‡Œã€å¤©é©¬è¡Œç©ºã€å°å…”ä¹±æ’ã€æ‰‹è„šæ…Œä¹±ã€å¤´å†’è™šæ±—ã€å››è‚¢æŠ“ç‹‚ã€ä¸çŸ¥æ‰€æªå‘€ ã€‚ã€‚ã€‚ğŸ˜­ ä½†æ˜¯æˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œåˆ†ä¸€ä¸‹ç±»ï¼Œå¦‚æœæŒ‰ç…§ä½¿ç”¨çš„æ–¹ä¾¿ç¨‹åº¦åˆ’åˆ†ï¼Œå¤§æ¦‚å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼šé«˜çº§åŠ¨ç”»APIå’Œä½çº§åŠ¨ç”»APIï¼ˆè¿™é‡Œç±»æ¯”é«˜çº§å¼€å‘è¯­è¨€çš„åˆ†ç±»ï¼Œå¹¶ä¸æ˜¯æŒ‡æ•ˆæœå¤šé«˜çº§ï¼‰ã€‚ å…¶ä¸­é«˜çº§åŠ¨ç”»APIä½¿ç”¨æ¯”è¾ƒç®€å•æ–¹ä¾¿ï¼Œå°è£…åº¦é«˜ï¼Œæ›´åŠ é€‚ç”¨äºæ—¥">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://bravestsnail.github.io/images/avatar.png">
<meta property="article:published_time" content="2025-05-29T16:00:00.000Z">
<meta property="article:modified_time" content="2025-06-04T12:46:35.125Z">
<meta property="article:author" content="BravestSnail">
<meta property="article:tag" content="Android">
<meta property="article:tag" content="Compose">
<meta property="article:tag" content="åŠ¨ç”»">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://bravestsnail.github.io/images/avatar.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Composeçš„åŠ¨ç”»",
  "url": "https://bravestsnail.github.io/2025/05/29/note/Android/compose/Compose%E7%9A%84%E5%8A%A8%E7%94%BB/",
  "image": "https://bravestsnail.github.io/images/avatar.png",
  "datePublished": "2025-05-29T16:00:00.000Z",
  "dateModified": "2025-06-04T12:46:35.125Z",
  "author": [
    {
      "@type": "Person",
      "name": "BravestSnail",
      "url": "https://bravestsnail.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/images/favicon.ico"><link rel="canonical" href="https://bravestsnail.github.io/2025/05/29/note/Android/compose/Compose%E7%9A%84%E5%8A%A8%E7%94%BB/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Composeçš„åŠ¨ç”»',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>if(window.mermaid){mermaid.initialize({startOnLoad:true});}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/images/favicon.ico" alt="Logo"><span class="site-name">BravestSnail's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">Composeçš„åŠ¨ç”»</span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">Composeçš„åŠ¨ç”»</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2025-05-29T16:00:00.000Z" title="å‘è¡¨äº 2025-05-30 00:00:00">2025-05-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-06-04T12:46:35.125Z" title="æ›´æ–°äº 2025-06-04 20:46:35">2025-06-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/note/">note</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><!-- filepath: /Users/lijiapei/Project/Blog/source/_posts/note/compose/Composeçš„åŠ¨ç”».md -->
<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/8b6babf1ad8edf0de8acca471ee37105.png%23pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¹ä¸€çœ‹Jetpack Composeä¸­çš„åŠ¨ç”»Apiï¼Œå°¼ç›æ˜¯çœŸçš„å¤šå‘€ï¼Œæˆ‘Cäº†ï¼Œç®€ç›´ä»¤äººçœ¼èŠ±ç¼­ä¹±ã€äº‘é‡Œé›¾é‡Œã€å¤©é©¬è¡Œç©ºã€å°å…”ä¹±æ’ã€æ‰‹è„šæ…Œä¹±ã€å¤´å†’è™šæ±—ã€å››è‚¢æŠ“ç‹‚ã€ä¸çŸ¥æ‰€æªå‘€ ã€‚ã€‚ã€‚ğŸ˜­</p>
<p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œåˆ†ä¸€ä¸‹ç±»ï¼Œå¦‚æœæŒ‰ç…§ä½¿ç”¨çš„æ–¹ä¾¿ç¨‹åº¦åˆ’åˆ†ï¼Œå¤§æ¦‚å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼šé«˜çº§åŠ¨ç”»APIå’Œä½çº§åŠ¨ç”»APIï¼ˆè¿™é‡Œç±»æ¯”é«˜çº§å¼€å‘è¯­è¨€çš„åˆ†ç±»ï¼Œå¹¶ä¸æ˜¯æŒ‡æ•ˆæœå¤šé«˜çº§ï¼‰ã€‚</p>
<p>å…¶ä¸­é«˜çº§åŠ¨ç”»APIä½¿ç”¨æ¯”è¾ƒç®€å•æ–¹ä¾¿ï¼Œå°è£…åº¦é«˜ï¼Œæ›´åŠ é€‚ç”¨äºæ—¥å¸¸ä¸šåŠ¡å¼€å‘ï¼Œè€Œä½çº§åŠ¨ç”»APIåˆ™ä½¿ç”¨èµ·æ¥è¾ƒä¸ºéº»çƒ¦ï¼Œå› ä¸ºå…¶é…ç½®é¡¹æˆ–æµç¨‹è¾ƒå¤šï¼Œä½†æ˜¯å´æ›´åŠ çµæ´»ï¼Œèƒ½å¯¹åŠ¨ç”»æ•ˆæœåšå‡ºæ›´åŠ ç²¾ç»†çš„æ§åˆ¶ï¼Œé€‚åˆè‡ªå®šä¹‰è¦æ±‚åº¦è¾ƒé«˜çš„ä¸šåŠ¡åœºæ™¯ã€‚</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥æŒ‰ç…§åŠŸèƒ½ç±»å‹è¿›è¡Œä¸€ä¸ªå¤§æ¦‚çš„åˆ†ç±»ï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­çš„åˆ’åˆ†ï¼Œè¿™é‡Œå†ç”¨è¡¨æ ¼å½’ç±»ä¸€ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>åŠŸèƒ½éœ€æ±‚ç‚¹</th>
<th>å¯èƒ½ç¬¦åˆçš„APIç±»å‹</th>
</tr>
</thead>
<tbody><tr>
<td>å•ä¸ªç»„ä»¶çš„æ˜¾ç¤ºéšè—è½¬åœºåŠ¨ç”»  <br>æ¯ä¸ªå­ç»„ä»¶éœ€è¦ä¸åŒçš„å…¥åœº&#x2F;å‡ºåœºæ•ˆæœ</td>
<td>AnimatedVisibility</td>
</tr>
<tr>
<td>æ ¹æ®ç»„ä»¶å†…å®¹çŠ¶æ€å˜åŒ–çš„åŠ¨ç”»(æ•°æ®ã€å°ºå¯¸ç­‰)  <br>ä¸åŒç»„ä»¶é—´çš„åˆ‡æ¢åŠ¨ç”»</td>
<td>AnimatedContent  <br>Modifier.animateContentSize</td>
</tr>
<tr>
<td>å•çº¯çš„æ·¡å…¥æ·¡å‡ºåŠ¨ç”»</td>
<td>Crossfade</td>
</tr>
<tr>
<td>æ ¹æ®æ•°æ®ä¼°å€¼çŠ¶æ€è‡ªåŠ¨æ‰§è¡Œè¿ç»­åŠ¨ç”»  <br>åŸºäºå•ä¸ªæ•°æ®å€¼çš„çŠ¶æ€å˜åŒ–æ‰§è¡ŒåŠ¨ç”»  <br>åŸºäºè‡ªå®šä¹‰æ•°æ®ç±»å‹è¿›è¡Œä¼°å€¼åŠ¨ç”»  <br>æŒ‡å®šæ¯ä¸€å¸§&#x2F;æ¯ä¸€æ—¶åˆ»çš„åŠ¨ç”»çŠ¶æ€  <br>æ›¿ä»£ä¼ ç»Ÿå±æ€§åŠ¨ç”»çš„æ–¹æ¡ˆ</td>
<td>animateXXXAsState</td>
</tr>
<tr>
<td>æ ¹æ®ä¸åŒçŠ¶æ€åŒæ—¶ç®¡ç†å’Œè¿è¡Œå¤šä¸ªåŠ¨ç”»  <br>è¿›å…¥ç•Œé¢æ—¶è‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡åŠ¨ç”»  <br>ç›‘å¬åŠ¨ç”»çŠ¶æ€  <br>æ›¿ä»£ä¼ ç»ŸViewåŠ¨ç”»ä¸­çš„AnimationSetçš„æ–¹æ¡ˆã€‚</td>
<td>updateTransition  <br>MutableTransitionState</td>
</tr>
<tr>
<td>æ°¸ä¸åœæ­¢ã€æ— é™å¾ªç¯çš„åŠ¨ç”»</td>
<td>rememberInfiniteTransition</td>
</tr>
<tr>
<td>æ›´åŠ åº•å±‚çš„ä½çº§åŠ¨ç”»API  <br>å¯é«˜åº¦è‡ªç”±å®šåˆ¶çš„ä¼°å€¼å±æ€§åŠ¨ç”»  <br>éœ€è¦åœ¨åç¨‹ä¸­æ‰§è¡Œçš„åŠ¨ç”»  <br>éœ€è¦æ§åˆ¶ä¸€äº›åŠ¨ç”»å¹¶è¡Œæ‰§è¡Œ</td>
<td>Animatable</td>
</tr>
<tr>
<td>æ›´åŠ åº•å±‚çš„ä½çº§åŠ¨ç”»API  <br>éœ€è¦æ‰‹åŠ¨ç²¾ç¡®æ§åˆ¶åŠ¨ç”»çš„æ—¶é—´  <br>æ‰‹åŠ¿åŠ¨ç”»ï¼Œflingè¡°å‡åŠ¨ç”»</td>
<td>TargetBasedAnimation  <br>DecayAnimation</td>
</tr>
</tbody></table>
<h2 id="é«˜çº§åŠ¨ç”»API"><a href="#é«˜çº§åŠ¨ç”»API" class="headerlink" title="é«˜çº§åŠ¨ç”»API"></a>é«˜çº§åŠ¨ç”»API</h2><h3 id="AnimatedVisibility"><a href="#AnimatedVisibility" class="headerlink" title="AnimatedVisibility"></a>AnimatedVisibility</h3><p><strong>AnimatedVisibility</strong>ä¸»è¦ç”¨äºé¡µé¢æ˜¾ç¤ºçŠ¶æ€çš„åŠ¨ç”»ï¼Œå³æ˜¾ç¤º&#x2F;éšè—çš„è¿‡æ¸¡åŠ¨ç”»ï¼Œæˆ–è€…å…¥åœº&#x2F;ç¦»åœºåŠ¨ç”»ã€‚<br>å¯ä»¥ä½¿ç”¨Â <strong>+</strong>Â è¿ç®—ç¬¦ç»„åˆå¤šä¸ªÂ <strong>EnterTransition</strong>Â æˆ–Â <strong>ExitTransition</strong>Â å¯¹è±¡ï¼Œå¹¶ä¸”æ¯ä¸ªå¯¹è±¡éƒ½æ¥å—å¯é€‰å‚æ•°ä»¥è‡ªå®šä¹‰å…¶è¡Œä¸ºã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatedVisibilityExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> visible <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">true</span>) &#125;</span><br><span class="line">    <span class="keyword">val</span> density = LocalDensity.current</span><br><span class="line">    Box(Modifier.fillMaxWidth(), contentAlignment = Alignment.TopCenter) &#123;</span><br><span class="line">        AnimatedVisibility(</span><br><span class="line">            visible = visible,</span><br><span class="line">            enter = slideInVertically &#123; with(density) &#123; -<span class="number">40.</span>dp.roundToPx() &#125; &#125; <span class="comment">// ä»é¡¶éƒ¨ 40dp çš„åœ°æ–¹å¼€å§‹æ»‘å…¥</span></span><br><span class="line">                    + expandVertically(expandFrom = Alignment.Top)  <span class="comment">// ä»é¡¶éƒ¨å¼€å§‹å±•å¼€</span></span><br><span class="line">                    + fadeIn(initialAlpha = <span class="number">0.3f</span>), <span class="comment">// ä»åˆå§‹é€æ˜åº¦ 0.3f å¼€å§‹æ·¡å…¥</span></span><br><span class="line">            exit = slideOutVertically() + shrinkVertically() + fadeOut()</span><br><span class="line">        ) &#123;</span><br><span class="line">            Text(<span class="string">&quot;Hello&quot;</span>,</span><br><span class="line">                Modifier.background(Color.Green).fillMaxWidth().height(<span class="number">200.</span>dp)</span><br><span class="line">                    .wrapContentWidth(Alignment.CenterHorizontally),</span><br><span class="line">                fontSize = <span class="number">20.</span>sp</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">        Button(</span><br><span class="line">            onClick = &#123; visible = !visible &#125;,</span><br><span class="line">            modifier = Modifier.padding(top = <span class="number">200.</span>dp)</span><br><span class="line">        ) &#123;</span><br><span class="line">            Text(text = <span class="keyword">if</span>(visible) <span class="string">&quot;éšè—&quot;</span> <span class="keyword">else</span> <span class="string">&quot;æ˜¾ç¤º&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼š<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/3e22b4715acd83d62846ddb060aa4a79.gif"></p>
<p>é»˜è®¤æƒ…å†µä¸‹Â <strong>EnterTransition</strong>Â æ˜¯Â <strong>fadeIn() + expandIn()</strong>Â çš„æ•ˆæœï¼Œè€ŒÂ <strong>ExitTransition</strong>Â æ˜¯Â <strong>shrinkOut() + fadeOut()</strong>Â çš„æ•ˆæœï¼Œ Composeé¢å¤–æä¾›äº†<strong>RowScope.AnimatedVisibility</strong>å’Œ<strong>ColumnScope.AnimatedVisibility</strong>ä¸¤ä¸ªæ‰©å±•æ–¹æ³•ï¼Œ å½“æˆ‘ä»¬åœ¨<strong>Row</strong>æˆ–<strong>Column</strong>ä¸­è°ƒç”¨æ—¶ï¼Œè¯¥ç»„ä»¶çš„é»˜è®¤åŠ¨ç”»æ•ˆæœä¼šæ ¹æ®çˆ¶å®¹å™¨çš„å¸ƒå±€ç‰¹å¾è¿›è¡Œè°ƒæ•´ï¼Œæ¯”å¦‚åœ¨<strong>Row</strong>ä¸­<strong>EnterTransition</strong>é»˜è®¤æ˜¯<strong>fadeIn + expandHorizontally</strong>ç»„åˆï¼Œè€Œåœ¨<strong>Column</strong>ä¸­<strong>EnterTransition</strong>é»˜è®¤æ˜¯<strong>fadeIn + expandVertically</strong>ç»„åˆæ–¹æ¡ˆã€‚</p>
<p><strong>EnterTransition</strong>Â å’ŒÂ <strong>ExitTransition</strong>Â åŠ¨ç”»åˆ†ç±»æ•ˆæœç¤ºä¾‹ï¼š</p>
<table>
<thead>
<tr>
<th>EnterTransition</th>
<th>ExitTransition</th>
</tr>
</thead>
<tbody><tr>
<td>FadeIn<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/67d0860deeec8a99ea7f2cce7d6098f9.gif%23pic_center"></td>
<td>FadeOut<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/ef1ca6d769ae298e376e713c798f3bf8.gif%23pic_center"></td>
</tr>
<tr>
<td>slideIn<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/1dff32012ca8f26ba7c7f08a42d6c833.gif%23pic_center"></td>
<td>slideOut<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/6133f5399ec5c1f4fdede031a168bdbe.gif%23pic_center"></td>
</tr>
<tr>
<td>slideInHorizontally<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/cbfd3accac9e76aafd7e25f17eb8a57d.gif%23pic_center"></td>
<td>slideOutHorizontally<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/313364af392b206d901220e8779adb46.gif%23pic_center"></td>
</tr>
<tr>
<td>slideInVertically<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/f66fad6f439ecee50d8577521ded3e74.gif%23pic_center"></td>
<td>slideOutVertically<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/56adb93b11b0b1968253c8d7b604de01.gif%23pic_center"></td>
</tr>
<tr>
<td>scaleIn<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/05dcc7896ee6f719437b2d233d639286.gif%23pic_center"></td>
<td>scaleOut<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/201109df2aadf656953a12d8889cdb40.gif%23pic_center"></td>
</tr>
<tr>
<td>expandIn<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/8a6b470f6789653b6b5b3e309b4b41f3.gif%23pic_center"></td>
<td>shrinkOut<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/a0a5c0892fb90b84f6f8dcfc13bae429.gif%23pic_center"></td>
</tr>
<tr>
<td>expandHorizontally<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/66e0e708d3f676467b4236bbb8fd3625.gif%23pic_center"></td>
<td>shrinkHorizontally<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/d46b61381d6ff493359596f5ad4af9f7.gif%23pic_center"></td>
</tr>
<tr>
<td>expandVertically<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/4ff8c840f478b2ddcdd6a5badc598b0d.gif%23pic_center"></td>
<td>shrinkVertically<img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/93bd8b421695eaedd09f6fa503b19c1e.gif%23pic_center"></td>
</tr>
</tbody></table>
<h4 id="ä¸ºå­é¡¹æ·»åŠ è¿›å…¥å’Œé€€å‡ºåŠ¨ç”»æ•ˆæœ"><a href="#ä¸ºå­é¡¹æ·»åŠ è¿›å…¥å’Œé€€å‡ºåŠ¨ç”»æ•ˆæœ" class="headerlink" title="ä¸ºå­é¡¹æ·»åŠ è¿›å…¥å’Œé€€å‡ºåŠ¨ç”»æ•ˆæœ"></a>ä¸ºå­é¡¹æ·»åŠ è¿›å…¥å’Œé€€å‡ºåŠ¨ç”»æ•ˆæœ</h4><p><strong>AnimatedVisibility</strong>Â ä¸­çš„å†…å®¹ï¼ˆç›´æ¥æˆ–é—´æ¥å­é¡¹ï¼‰å¯ä»¥ä½¿ç”¨Â <strong>Modifier.animateEnterExit</strong>Â ä¿®é¥°ç¬¦ä¸ºæ¯ä¸ªå­é¡¹æŒ‡å®šä¸åŒçš„åŠ¨ç”»è¡Œä¸ºã€‚</p>
<p>å…¶ä¸­æ¯ä¸ªå­é¡¹çš„è§†è§‰æ•ˆæœå‡ç”± AnimatedVisibility å¯ç»„åˆé¡¹ä¸­æŒ‡å®šçš„åŠ¨ç”»ä¸å­é¡¹è‡ªå·±çš„è¿›å…¥å’Œé€€å‡ºåŠ¨ç”»æ„æˆã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalAnimationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatedVisibilityExample3</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> visible <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">true</span>) &#125;</span><br><span class="line">    Box(Modifier.fillMaxWidth(), contentAlignment = Alignment.TopCenter) &#123;</span><br><span class="line">        AnimatedVisibility(visible = visible, enter = fadeIn(), exit = fadeOut()) &#123;</span><br><span class="line">            <span class="comment">// å¤–å±‚Boxç»„ä»¶æ·¡å…¥æ·¡å‡ºè¿›å‡ºå±å¹•</span></span><br><span class="line">            Box(Modifier.fillMaxSize().background(Color.DarkGray)) &#123;</span><br><span class="line">                Box(Modifier.align(Alignment.Center)</span><br><span class="line">                    .sizeIn(minWidth = <span class="number">256.</span>dp, minHeight = <span class="number">64.</span>dp).background(Color.Green)</span><br><span class="line">                    .animateEnterExit(enter = slideInVertically(), exit = slideOutVertically())</span><br><span class="line">                ) &#123;</span><br><span class="line">                    Text(text = <span class="string">&quot;å†…å±‚Boxç»„ä»¶æ»‘åŠ¨è¿›å‡ºå±å¹•&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">                &#125;</span><br><span class="line">                Box(Modifier.padding(top = <span class="number">150.</span>dp).align(Alignment.Center)</span><br><span class="line">                    .sizeIn(minWidth = <span class="number">256.</span>dp, minHeight = <span class="number">64.</span>dp).background(Color.Cyan)</span><br><span class="line">                    .animateEnterExit(enter = scaleIn(), exit = scaleOut())</span><br><span class="line">                ) &#123;</span><br><span class="line">                    Text(text = <span class="string">&quot;å†…å±‚å±‚Boxç»„ä»¶ç¼©æ”¾è¿›å‡ºå±å¹•&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Button(</span><br><span class="line">            onClick = &#123; visible = !visible &#125;,</span><br><span class="line">            modifier = Modifier.padding(top = <span class="number">50.</span>dp)</span><br><span class="line">        ) &#123;</span><br><span class="line">            Text(text = <span class="keyword">if</span>(visible) <span class="string">&quot;éšè—&quot;</span> <span class="keyword">else</span> <span class="string">&quot;æ˜¾ç¤º&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼š<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/655aa60d412587d6854b90d14bf041cc.gif"></p>
<p>æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›Â <strong>AnimatedVisibility</strong>Â å†…çš„<strong>æ¯ä¸ªå­ç»„ä»¶æœ‰ä¸åŒçš„è¿‡æ¸¡åŠ¨ç”»</strong>ï¼Œæ­¤æ—¶è¯·åœ¨Â <strong>AnimatedVisibility</strong>Â å¯ç»„åˆé¡¹ä¸­æŒ‡å®šÂ <strong>EnterTransition.None</strong>Â å’ŒÂ <strong>ExitTransition.None</strong>ï¼Œå³å®Œå…¨ä¸åº”ç”¨ä»»ä½•åŠ¨ç”»ï¼Œè¿™æ ·å­é¡¹å°±å¯ä»¥é€šè¿‡Â <strong>Modifier.animateEnterExit</strong>Â æ‹¥æœ‰å„è‡ªçš„ä¸åŒåŠ¨ç”»äº†ã€‚</p>
<h4 id="è‡ªå®šä¹‰Enter-ExitåŠ¨ç”»"><a href="#è‡ªå®šä¹‰Enter-ExitåŠ¨ç”»" class="headerlink" title="è‡ªå®šä¹‰Enter&#x2F;ExitåŠ¨ç”»"></a>è‡ªå®šä¹‰Enter&#x2F;ExitåŠ¨ç”»</h4><p>å¦‚æœæƒ³åœ¨å†…ç½®è¿›å…¥å’Œé€€å‡ºåŠ¨ç”»ä¹‹å¤–æ·»åŠ è‡ªå®šä¹‰åŠ¨ç”»æ•ˆæœï¼Œè¯·åœ¨Â <strong>AnimatedVisibilityScope</strong>Â å†…è®¾ç½®Â <strong>transition</strong>ï¼Œ æ·»åŠ åˆ°Â <strong>Transition</strong>Â å®ä¾‹çš„æ‰€æœ‰åŠ¨ç”»çŠ¶æ€éƒ½å°†ä¸Â <strong>AnimatedVisibility</strong>Â çš„è¿›å…¥å’Œé€€å‡ºåŠ¨ç”»åŒæ—¶è¿è¡Œã€‚</p>
<p><strong>AnimatedVisibility</strong>Â ä¼šç­‰åˆ°Â <strong>Transition</strong>Â ä¸­çš„æ‰€æœ‰åŠ¨ç”»éƒ½å®Œæˆåå†ç§»é™¤å…¶å†…å®¹ã€‚å¯¹äºç‹¬ç«‹äºÂ <strong>Transition</strong>ï¼ˆä¾‹å¦‚ä½¿ç”¨Â <strong>animate*AsState</strong>ï¼‰åˆ›å»ºçš„é€€å‡ºåŠ¨ç”»ï¼Œ<strong>AnimatedVisibility</strong>Â å°†æ— æ³•è§£é‡Šè¿™äº›åŠ¨ç”»ï¼Œå› æ­¤å¯èƒ½ä¼šåœ¨å®Œæˆä¹‹å‰ç§»é™¤å†…å®¹å¯ç»„åˆé¡¹ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalAnimationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatedVisibilityExample4</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> visible <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">true</span>) &#125;</span><br><span class="line">    Box(Modifier.fillMaxWidth(), contentAlignment = Alignment.TopCenter) &#123;</span><br><span class="line">        AnimatedVisibility(visible = visible, enter = scaleIn(), exit = scaleOut()) &#123;</span><br><span class="line">            <span class="comment">// ä½¿ç”¨ AnimatedVisibilityScope#transition æ·»åŠ è‡ªå®šä¹‰çš„åŠ¨ç”»ä¸AnimatedVisibilityåŒæ—¶æ‰§è¡Œ</span></span><br><span class="line">            <span class="keyword">val</span> background <span class="keyword">by</span> transition.animateColor(label = <span class="string">&quot;backgroundTransition&quot;</span>) &#123; state -&gt;</span><br><span class="line">                <span class="keyword">if</span> (state == EnterExitState.Visible) Color.Blue <span class="keyword">else</span> Color.Green</span><br><span class="line">            &#125;</span><br><span class="line">            Box(modifier = Modifier.size(<span class="number">100.</span>dp).background(background))</span><br><span class="line">        &#125;</span><br><span class="line">        Button(</span><br><span class="line">            onClick = &#123; visible = !visible &#125;,</span><br><span class="line">            modifier = Modifier.padding(top = <span class="number">120.</span>dp)</span><br><span class="line">        ) &#123;</span><br><span class="line">            Text(text = <span class="keyword">if</span>(visible) <span class="string">&quot;éšè—&quot;</span> <span class="keyword">else</span> <span class="string">&quot;æ˜¾ç¤º&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼š<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/0c9632dc2cede9bb46eb7cff055c3220.gif"></p>
<h3 id="AnimatedContent"><a href="#AnimatedContent" class="headerlink" title="AnimatedContent"></a>AnimatedContent</h3><p><strong>AnimatedContent</strong>Â å¯ç»„åˆé¡¹ä¼šåœ¨å†…å®¹æ ¹æ®ç›®æ ‡çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¸ºå†…å®¹æ·»åŠ åŠ¨ç”»æ•ˆæœã€‚<br>ä¸ AnimatedVisibility çš„åŒºåˆ«æ˜¯:Â <strong>AnimatedVisibilityç”¨æ¥æ·»åŠ ç»„ä»¶è‡ªèº«çš„å…¥åœº&#x2F;ç¦»åœºåŠ¨ç”»ï¼Œè€ŒAnimatedContentæ˜¯å®ç°ä¸åŒç»„ä»¶é—´çš„åˆ‡æ¢åŠ¨ç”»</strong></p>
<p>AnimatedContentæ¥æ”¶ä¸€ä¸ª<strong>targetState</strong>å’Œä¸€ä¸ª<strong>content</strong>ï¼Œ<strong>content</strong>Â æ˜¯åŸºäºÂ <strong>targetState</strong>Â åˆ›å»ºçš„<strong>Composable</strong>ï¼Œå½“<strong>targetState</strong>å˜åŒ–æ—¶ï¼Œ<strong>content</strong>çš„å†…å®¹ä¹Ÿä¼šéšä¹‹å˜åŒ–ã€‚<strong>AnimatedContent</strong>å†…éƒ¨ç»´æŠ¤ç€<strong>targetState</strong>åˆ°<strong>content</strong>çš„æ˜ å°„è¡¨ï¼ŒæŸ¥æ‰¾Â <strong>targetState</strong>æ–°æ—§å€¼å¯¹åº”çš„<strong>content</strong>åï¼Œåœ¨<strong>content</strong>å‘ç”Ÿé‡ç»„æ—¶é™„åŠ åŠ¨ç”»æ•ˆæœã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalAnimationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatedContentExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column &#123;</span><br><span class="line">        <span class="keyword">var</span> count <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">0</span>) &#125;</span><br><span class="line">        Button(onClick = &#123; count++ &#125;) &#123; Text(<span class="string">&quot;Add&quot;</span>) &#125;</span><br><span class="line">        AnimatedContent(targetState = count) &#123; targetCount -&gt;</span><br><span class="line">            <span class="comment">// è¿™é‡Œè¦ä½¿ç”¨lambdaçš„å‚æ•° `targetCount`, è€Œä¸æ˜¯ `count`ï¼Œå¦åˆ™å°†æ²¡æœ‰æ„ä¹‰ï¼ˆAPI ä¼šå°†æ­¤å€¼ç”¨ä½œé”®ï¼Œä»¥æ ‡è¯†å½“å‰æ˜¾ç¤ºçš„å†…å®¹ï¼‰</span></span><br><span class="line">            Text(text = <span class="string">&quot;Count: <span class="variable">$targetCount</span>&quot;</span>, Modifier.background(Color.Green), fontSize = <span class="number">25.</span>sp)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼š<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/5147c0b86727d15fab581f2057883976.gif"></p>
<h4 id="ContentTransform"><a href="#ContentTransform" class="headerlink" title="ContentTransform"></a>ContentTransform</h4><p><strong>AnimatedContent</strong>é»˜è®¤æ˜¯æ·¡å…¥æ·¡å‡ºæ•ˆæœï¼Œå¯ä»¥ä¸ºÂ <strong>transitionSpec</strong>Â å‚æ•°æŒ‡å®šÂ <strong>ContentTransform</strong>Â å¯¹è±¡ï¼Œä»¥è‡ªå®šä¹‰æ­¤åŠ¨ç”»è¡Œä¸ºã€‚</p>
<p>å¯ä»¥ä½¿ç”¨Â <strong>with infix</strong>Â å‡½æ•°æ¥ç»„åˆÂ <strong>EnterTransition</strong>Â ä¸Â <strong>ExitTransition</strong>ï¼Œä»¥åˆ›å»ºÂ <strong>ContentTransform</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExperimentalAnimationApi</span></span><br><span class="line"><span class="keyword">infix</span> <span class="function"><span class="keyword">fun</span> EnterTransition.<span class="title">with</span><span class="params">(exit: <span class="type">ExitTransition</span>)</span></span> = ContentTransform(<span class="keyword">this</span>, exit)</span><br></pre></td></tr></table></figure>

<p><strong>ContentTransform</strong>æœ¬è´¨ä¸Šå°±æ˜¯<strong>currentContent(initial)</strong>Â çš„Â <strong>ExitTransition</strong>ä¸<strong>targetContent</strong>çš„<strong>EnterTransition</strong>ç»„åˆï¼ŒÂ <strong>EnterTransition</strong>Â å®šä¹‰äº†ç›®æ ‡å†…å®¹åº”å¦‚ä½•æ˜¾ç¤ºï¼Œ<strong>ExitTransition</strong>Â åˆ™å®šä¹‰äº†åˆå§‹å†…å®¹åº”å¦‚ä½•æ¶ˆå¤±ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalAnimationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatedContentExample2</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column &#123;</span><br><span class="line">        <span class="keyword">var</span> count <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">0</span>) &#125;</span><br><span class="line">        Button(onClick = &#123; count++ &#125;) &#123; Text(<span class="string">&quot;Add&quot;</span>) &#125;</span><br><span class="line">        AnimatedContent(</span><br><span class="line">            targetState = count,</span><br><span class="line">            transitionSpec = &#123;</span><br><span class="line">                <span class="comment">// ä»å³å¾€å·¦åˆ‡æ¢ï¼Œå¹¶ä¼´éšæ·¡å…¥æ·¡å‡ºæ•ˆæœï¼ˆinitialOffsetX = width, targetOffsetX = -widthï¼‰</span></span><br><span class="line">                slideInHorizontally&#123;width -&gt; width&#125; + fadeIn() with</span><br><span class="line">                        slideOutHorizontally&#123;width -&gt; -width&#125; + fadeOut()</span><br><span class="line">            &#125;</span><br><span class="line">        ) &#123; targetCount -&gt;</span><br><span class="line">            Text(text = <span class="string">&quot;Count: <span class="variable">$targetCount</span>&quot;</span>, Modifier.background(Color.Green), fontSize = <span class="number">25.</span>sp)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼š<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/aba6dc7663519fa182818bf7180edd4a.gif"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalAnimationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatedContentExample3</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column(horizontalAlignment = Alignment.CenterHorizontally) &#123;</span><br><span class="line">        <span class="keyword">var</span> count <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">0</span>) &#125;</span><br><span class="line">        Button(onClick = &#123; count++ &#125;) &#123; Text(<span class="string">&quot;Add&quot;</span>) &#125;</span><br><span class="line">        <span class="keyword">val</span> animationSpec = tween&lt;IntOffset&gt;(<span class="number">200</span>)</span><br><span class="line">        <span class="keyword">val</span> animationSpec2 = tween&lt;<span class="built_in">Float</span>&gt;(<span class="number">200</span>)</span><br><span class="line">        AnimatedContent(</span><br><span class="line">            targetState = count,</span><br><span class="line">            transitionSpec = &#123;</span><br><span class="line">                slideInVertically(animationSpec)&#123; height -&gt; height&#125; + fadeIn(animationSpec2) with</span><br><span class="line">                    slideOutVertically(animationSpec) &#123;height -&gt; height&#125; + fadeOut(animationSpec2)</span><br><span class="line">            &#125;</span><br><span class="line">        ) &#123; targetCount -&gt;</span><br><span class="line">            Text(text = <span class="string">&quot;<span class="variable">$targetCount</span>&quot;</span>, fontSize = <span class="number">40.</span>sp)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼š<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/32ad157d2be46e78cb9ac4e4a2d44769.gif"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalAnimationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatedContentExample4</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column &#123;</span><br><span class="line">        <span class="keyword">var</span> count <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">0</span>) &#125;</span><br><span class="line">        Row(horizontalArrangement = Arrangement.SpaceAround) &#123;</span><br><span class="line">            Button(onClick = &#123; count-- &#125;) &#123; Text(<span class="string">&quot;Minus&quot;</span>) &#125;</span><br><span class="line">            Spacer(Modifier.size(<span class="number">60.</span>dp))</span><br><span class="line">            Button(onClick = &#123; count++ &#125;) &#123; Text(<span class="string">&quot;Plus &quot;</span>) &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Spacer(Modifier.size(<span class="number">20.</span>dp))</span><br><span class="line">        AnimatedContent(</span><br><span class="line">            targetState = count,</span><br><span class="line">            transitionSpec = &#123;</span><br><span class="line">                <span class="keyword">if</span> (targetState &gt; initialState) &#123;</span><br><span class="line">                    <span class="comment">// å¦‚æœtargetStateæ›´å¤§ï¼Œåˆ™ä»ä¸‹å¾€ä¸Šåˆ‡æ¢å¹¶ä¼´éšæ·¡å…¥æ·¡å‡ºæ•ˆæœ</span></span><br><span class="line">                    slideInVertically &#123; height -&gt; height &#125; + fadeIn() with</span><br><span class="line">                            slideOutVertically &#123; height -&gt; -height &#125; + fadeOut()</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// å¦‚æœtargetStateæ›´å°ï¼Œåˆ™ä»ä¸Šå¾€ä¸‹åˆ‡æ¢å¹¶ä¼´éšæ·¡å…¥æ·¡å‡ºæ•ˆæœ</span></span><br><span class="line">                    slideInVertically &#123; height -&gt; -height &#125; + fadeIn() with</span><br><span class="line">                            slideOutVertically &#123; height -&gt; height &#125; + fadeOut()</span><br><span class="line">                &#125;.using(</span><br><span class="line">                    <span class="comment">// Disable clipping since the faded slide-in/out should be displayed out of bounds.</span></span><br><span class="line">                    SizeTransform(clip = <span class="literal">false</span>)</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        ) &#123; targetCount -&gt;</span><br><span class="line">            Text(text = <span class="string">&quot;Count: <span class="variable">$targetCount</span>&quot;</span>, Modifier.background(Color.Green), fontSize = <span class="number">25.</span>sp)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼š<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/683d7ad96c09b4aaeca92185386e0760.gif"></p>
<h4 id="slideIntoContainer-å’Œ-slideOutOfContainer"><a href="#slideIntoContainer-å’Œ-slideOutOfContainer" class="headerlink" title="slideIntoContainerÂ å’ŒÂ slideOutOfContainer"></a><strong>slideIntoContainer</strong>Â å’ŒÂ <strong>slideOutOfContainer</strong></h4><p>é™¤äº†å¯ç”¨äº AnimatedVisibility çš„æ‰€æœ‰ EnterTransition å’Œ ExitTransition å‡½æ•°ä¹‹å¤–ï¼ŒAnimatedContent è¿˜æä¾›äº†Â <strong>slideIntoContainer</strong>Â å’ŒÂ <strong>slideOutOfContainer</strong>ã€‚è¿™äº›æ˜¯Â <strong>slideInHorizontally&#x2F;Vertically</strong>Â å’ŒÂ <strong>slideOutHorizontally&#x2F;Vertically</strong>Â çš„ä¾¿æ·æ›¿ä»£æ–¹æ¡ˆï¼Œå®ƒä»¬å¯æ ¹æ®åˆå§‹å†…å®¹çš„å¤§å°å’ŒÂ <strong>AnimatedContent</strong>Â å†…å®¹çš„ç›®æ ‡å†…å®¹æ¥è®¡ç®—æ»‘åŠ¨è·ç¦»ã€‚(å®˜æ–¹ä¾‹å­å¯è§ï¼š<a target="_blank" rel="noopener" href="https://developer.android.com/reference/kotlin/androidx/compose/animation/AnimatedContentScope#slideIntoContainer%28androidx.compose.animation.AnimatedContentScope.SlideDirection,androidx.compose.animation.core.FiniteAnimationSpec,kotlin.Function1">slideIntoContainer</a>)</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalAnimationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">SlideIntoContainerSample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> transitionSpec: AnimatedContentScope&lt;<span class="built_in">Int</span>&gt;.() -&gt; ContentTransform = &#123;</span><br><span class="line">        <span class="keyword">if</span> (initialState &lt; targetState) &#123;</span><br><span class="line">            slideIntoContainer(towards = AnimatedContentScope.SlideDirection.Up) + fadeIn() with</span><br><span class="line">                    slideOutOfContainer(towards = AnimatedContentScope.SlideDirection.Up) + fadeOut()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            slideIntoContainer(towards = AnimatedContentScope.SlideDirection.Down) + fadeIn()  with</span><br><span class="line">                    slideOutOfContainer(towards = AnimatedContentScope.SlideDirection.Down) + fadeOut()</span><br><span class="line">        &#125;.apply &#123;</span><br><span class="line">            <span class="comment">// è¿™é‡Œå¯æŒ‡å®šç›®æ ‡å†…å®¹çš„ zIndex ï¼Œå€¼è¶Šå¤§è¶Šä¸Šå±‚ï¼Œå€¼è¶Šå°è¶Šä¸‹å±‚</span></span><br><span class="line"><span class="comment">//            targetContentZIndex = when (targetState) &#123;</span></span><br><span class="line"><span class="comment">//                NestedMenuState.Level1 -&gt; 1f</span></span><br><span class="line"><span class="comment">//                NestedMenuState.Level2 -&gt; 2f</span></span><br><span class="line"><span class="comment">//                NestedMenuState.Level3 -&gt; 3f</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line">        &#125;.using(SizeTransform(clip = <span class="literal">false</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    Column &#123;</span><br><span class="line">        <span class="keyword">var</span> count <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">0</span>) &#125;</span><br><span class="line">        Row(horizontalArrangement = Arrangement.SpaceAround) &#123;</span><br><span class="line">            Button(onClick = &#123; count-- &#125;) &#123; Text(<span class="string">&quot;Minus&quot;</span>) &#125;</span><br><span class="line">            Spacer(Modifier.size(<span class="number">60.</span>dp))</span><br><span class="line">            Button(onClick = &#123; count++ &#125;) &#123; Text(<span class="string">&quot;Plus &quot;</span>) &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Spacer(Modifier.size(<span class="number">20.</span>dp))</span><br><span class="line">        AnimatedContent(</span><br><span class="line">            targetState = count,</span><br><span class="line">            transitionSpec = transitionSpec,</span><br><span class="line">        ) &#123; targetCount -&gt;</span><br><span class="line">            Text(text = <span class="string">&quot;Count: <span class="variable">$targetCount</span>&quot;</span>, Modifier.background(Color.Green), fontSize = <span class="number">25.</span>sp)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼šåŒä¸Šä¸€ä¸ªä¾‹å­ä¸€æ ·</p>
<h4 id="SizeTransform"><a href="#SizeTransform" class="headerlink" title="SizeTransform"></a>SizeTransform</h4><p><strong>SizeTransform</strong>Â å®šä¹‰äº†å¤§å°åº”å¦‚ä½•åœ¨åˆå§‹å†…å®¹ä¸ç›®æ ‡å†…å®¹ä¹‹é—´æ·»åŠ åŠ¨ç”»æ•ˆæœã€‚åœ¨åˆ›å»ºåŠ¨ç”»æ—¶ï¼Œæ‚¨å¯ä»¥è®¿é—®åˆå§‹å¤§å°å’Œç›®æ ‡å¤§å°ã€‚ SizeTransform è¿˜å¯æ§åˆ¶åœ¨åŠ¨ç”»æ’­æ”¾æœŸé—´æ˜¯å¦åº”å°†å†…å®¹è£å‰ªä¸ºç»„ä»¶å¤§å°ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalAnimationApi::class, ExperimentalMaterialApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">SizeTransformAnimatedContentSample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> expanded <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">false</span>) &#125;</span><br><span class="line">    Surface(</span><br><span class="line">        color = MaterialTheme.colors.primary,</span><br><span class="line">        onClick = &#123; expanded = !expanded &#125;,</span><br><span class="line">        modifier = Modifier.padding(<span class="number">10.</span>dp).onSizeChanged &#123;  &#125;</span><br><span class="line">    ) &#123;</span><br><span class="line">        AnimatedContent(</span><br><span class="line">            targetState = expanded,</span><br><span class="line">            transitionSpec = &#123;</span><br><span class="line">                fadeIn(animationSpec = tween(<span class="number">150</span>, <span class="number">150</span>)) with</span><br><span class="line">                    fadeOut(animationSpec = tween(<span class="number">150</span>)) using</span><br><span class="line">                        SizeTransform &#123; initialSize, targetSize -&gt;</span><br><span class="line">                            <span class="keyword">if</span> (targetState) &#123;</span><br><span class="line">                                keyframes &#123;</span><br><span class="line">                                    <span class="comment">// å±•å¼€æ—¶ï¼Œå…ˆæ°´å¹³æ–¹å‘å±•å¼€</span></span><br><span class="line">                                    <span class="comment">// 150msä¹‹å‰ï¼šå®½åº¦ä»initialSize.widthå¢å¤§åˆ°targetSize.widthï¼Œé«˜åº¦ä¿æŒinitialSize.heightä¸å˜</span></span><br><span class="line">                                    <span class="comment">// 150msä¹‹åï¼šå®½åº¦ä¿æŒtargetSize.widthä¸å˜ï¼Œé«˜åº¦ä»initialSize.heightå¼€å§‹å¢å¤§åˆ°targetSize.height</span></span><br><span class="line">                                    IntSize(targetSize.width, initialSize.height) at <span class="number">150</span></span><br><span class="line">                                    durationMillis = <span class="number">300</span></span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                keyframes &#123;</span><br><span class="line">                                    <span class="comment">// æ”¶ç¼©æ—¶ï¼Œå…ˆå‚ç›´æ–¹å‘æ”¶èµ·</span></span><br><span class="line">                                    <span class="comment">// 150msä¹‹å‰ï¼šå®½åº¦ä¿æŒinitialSize.widthä¸å˜ï¼Œé«˜åº¦ä»initialSize.heightå‡å°åˆ°targetSize.height</span></span><br><span class="line">                                    <span class="comment">// 150msä¹‹åï¼šå®½åº¦ä»initialSize.widthå‡å°åˆ°targetSize.widthï¼Œé«˜åº¦ä¿æŒtargetSize.heightä¸å˜</span></span><br><span class="line">                                    IntSize(initialSize.width, targetSize.height) at <span class="number">150</span></span><br><span class="line">                                    durationMillis = <span class="number">300</span></span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ) &#123; targetExpanded -&gt;</span><br><span class="line">            <span class="keyword">if</span> (targetExpanded) Expanded() <span class="keyword">else</span> ContentIcon()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ContentIcon</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Icon(Icons.Default.ArrowDropDown, <span class="string">&quot;&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">Expanded</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Text(text = <span class="string">&quot;SizeTransform å®šä¹‰äº†å¤§å°åº”å¦‚ä½•åœ¨åˆå§‹å†…å®¹ä¸ç›®æ ‡å†…å®¹ä¹‹é—´æ·»åŠ åŠ¨ç”»æ•ˆæœã€‚åœ¨åˆ›å»ºåŠ¨ç”»æ—¶ï¼Œæ‚¨å¯ä»¥è®¿é—®åˆå§‹å¤§å°å’Œç›®æ ‡å¤§å°ã€‚SizeTransform è¿˜å¯æ§åˆ¶åœ¨åŠ¨ç”»æ’­æ”¾æœŸé—´æ˜¯å¦åº”å°†å†…å®¹è£å‰ªä¸ºç»„ä»¶å¤§å°ã€‚SizeTransform å®šä¹‰äº†å¤§å°åº”å¦‚ä½•åœ¨åˆå§‹å†…å®¹ä¸ç›®æ ‡å†…å®¹ä¹‹é—´æ·»åŠ åŠ¨ç”»æ•ˆæœã€‚åœ¨åˆ›å»ºåŠ¨ç”»æ—¶ï¼Œæ‚¨å¯ä»¥è®¿é—®åˆå§‹å¤§å°å’Œç›®æ ‡å¤§å°ã€‚SizeTransform è¿˜å¯æ§åˆ¶åœ¨åŠ¨ç”»æ’­æ”¾æœŸé—´æ˜¯å¦åº”å°†å†…å®¹è£å‰ªä¸ºç»„ä»¶å¤§å°ã€‚&quot;</span>,</span><br><span class="line">        modifier = Modifier.padding(<span class="number">10.</span>dp))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼š<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/dc1d2e7764174d0693093f1f3a000544.gif"></p>
<p>ä¸<strong>AnimatedVisibility</strong>ä¸€æ ·ï¼Œ<strong>AnimatedContent</strong>Â å†…çš„å­ç»„ä»¶ä¹Ÿå¯ä»¥é€šè¿‡Â <strong>Modifier.animateEnterExit()</strong>Â å•ç‹¬æŒ‡å®šåŠ¨ç”»ã€‚</p>
<h4 id="Modifier-animateContentSize"><a href="#Modifier-animateContentSize" class="headerlink" title="Modifier.animateContentSize"></a>Modifier.animateContentSize</h4><p><strong>Modifier.animateContentSizeï¼š</strong>Â å½“å®¹å™¨å°ºå¯¸å¤§å°å‘ç”Ÿå˜åŒ–æ—¶æ·»åŠ åŠ¨ç”»æ•ˆæœ</p>
<blockquote>
<p>æ³¨æ„ï¼š<strong>animateContentSize</strong>Â åœ¨ä¿®é¥°ç¬¦é“¾ä¸­çš„ä½ç½®é¡ºåºå¾ˆé‡è¦ã€‚ä¸ºäº†ç¡®ä¿æµç•…çš„åŠ¨ç”»ï¼Œ<strong>è¯·åŠ¡å¿…å°†å…¶æ”¾ç½®åœ¨ä»»ä½•å¤§å°ä¿®é¥°ç¬¦ï¼ˆå¦‚ size æˆ– defaultMinSizeï¼‰å‰é¢</strong>ï¼Œä»¥ç¡®ä¿Â <strong>animateContentSize</strong>Â ä¼šå°†å¸¦åŠ¨ç”»æ•ˆæœçš„å€¼çš„å˜åŒ–æŠ¥å‘Šç»™å¸ƒå±€ã€‚</p>
</blockquote>
<p>ä¸‹é¢ä»£ç ä½¿ç”¨<strong>expand</strong>æ¥æ§åˆ¶<strong>Text</strong>çš„<strong>maxLines</strong>å±æ€§ï¼Œå½“æœ€å¤§è¡Œæ•°å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ<strong>animateContentSize()</strong>Â ä¼šä½¿ç”¨è¿‡æ¸¡åŠ¨ç”»ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimateContentSizeExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> expand <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">true</span>) &#125;</span><br><span class="line">    Column(Modifier.padding(<span class="number">16.</span>dp)) &#123;</span><br><span class="line">        Button(onClick = &#123; expand = !expand &#125;) &#123;</span><br><span class="line">            Text(text = <span class="keyword">if</span> (expand) <span class="string">&quot;æ”¶èµ·&quot;</span> <span class="keyword">else</span> <span class="string">&quot;å±•å¼€&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        Spacer(Modifier.height(<span class="number">16.</span>dp))</span><br><span class="line">        Box(</span><br><span class="line">            modifier = Modifier.background(Color.Green, RoundedCornerShape(<span class="number">15.</span>dp))</span><br><span class="line">                .padding(<span class="number">16.</span>dp).wrapContentSize()</span><br><span class="line">                .animateContentSize()</span><br><span class="line">        ) &#123;</span><br><span class="line">            Text(</span><br><span class="line">                text = <span class="string">&quot;Modifier.animateContentSize() animates its own size when its child modifier (or the child composable if it is already at the tail of the chain) changes size. This allows the parent modifier to observe a smooth size change, resulting in an overall continuous visual change.\n\n&quot;</span></span><br><span class="line">                        +<span class="string">&quot;A FiniteAnimationSpec can be optionally specified for the size change animation. By default, spring will be used.\n\n&quot;</span></span><br><span class="line">                        +<span class="string">&quot;An optional finishedListener can be supplied to get notified when the size change animation is finished. Since the content size change can be dynamic in many cases, both initial value and target value (i.e. final size) will be passed to the finishedListener. Note: if the animation is interrupted, the initial value will be the size at the point of interruption. This is intended to help determine the direction of the size change (i.e. expand or collapse in x and y dimensions).&quot;</span>,</span><br><span class="line">                fontSize = <span class="number">16.</span>sp,</span><br><span class="line">                textAlign = TextAlign.Justify,</span><br><span class="line">                maxLines = <span class="keyword">if</span> (expand) <span class="built_in">Int</span>.MAX_VALUE <span class="keyword">else</span> <span class="number">2</span></span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼š<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/9107199e4f2e019b3e599e92afa42214.gif"></p>
<h3 id="Crossfade"><a href="#Crossfade" class="headerlink" title="Crossfade"></a>Crossfade</h3><p><strong>Crossfade</strong>Â å¯ä½¿ç”¨æ·¡å…¥æ·¡å‡ºåŠ¨ç”»åœ¨ä¸¤ä¸ªå¸ƒå±€ä¹‹é—´æ·»åŠ åŠ¨ç”»æ•ˆæœã€‚ é€šè¿‡åˆ‡æ¢ä¼ é€’ç»™Â <strong>current</strong>Â å‚æ•°çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨æ·¡å…¥æ·¡å‡ºåŠ¨ç”»æ¥åˆ‡æ¢å†…å®¹ã€‚å¦‚æœåªæ˜¯æ·¡å…¥æ·¡å‡ºçš„éœ€æ±‚ï¼Œå¯ä»¥ä½¿ç”¨<strong>Crossfade</strong>æ›¿ä»£<strong>AnimatedContent</strong>ã€‚</p>
<p><strong>AnimatedContent</strong>æ˜¯<strong>Crossfade</strong>çš„ä¸€ç§<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%B3%9B%E5%8C%96&spm=1001.2101.3001.7020">æ³›åŒ–</a>ï¼Œ<strong>AnimatedContent</strong>æ˜¯åæ¥ä¸ºäº†å¢å¼º<strong>Crossfade</strong>è€Œå¢åŠ çš„ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šCrossfadeæ— æ³•å®ç° SizeTransform é‚£æ ·å°ºå¯¸å¤§å°å˜åŒ–çš„åŠ¨ç”»æ•ˆæœï¼ˆå¦‚æœæœ‰è¿™ç§éœ€æ±‚ï¼Œè¯·ä½¿ç”¨<strong>AnimatedContent + SizeTransform</strong>Â æˆ–è€…ä½¿ç”¨Â <strong>Crossfade + Modifier.animateContentSize</strong>ï¼‰</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">CrossfadeExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column &#123;</span><br><span class="line">        <span class="keyword">var</span> currentPage <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="string">&quot;A&quot;</span>) &#125;</span><br><span class="line">        Button(onClick = &#123; currentPage = <span class="keyword">if</span>(currentPage == <span class="string">&quot;A&quot;</span>) <span class="string">&quot;B&quot;</span> <span class="keyword">else</span> <span class="string">&quot;A&quot;</span> &#125;) &#123;</span><br><span class="line">            Text(<span class="string">&quot;Change&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        Spacer(Modifier.size(<span class="number">20.</span>dp))</span><br><span class="line">        Crossfade(targetState = currentPage) &#123; screen -&gt;</span><br><span class="line">            <span class="keyword">when</span> (screen) &#123;</span><br><span class="line">                <span class="string">&quot;A&quot;</span> -&gt; Text(<span class="string">&quot;Page A&quot;</span>, Modifier.background(Color.Green), fontSize = <span class="number">25.</span>sp)</span><br><span class="line">                <span class="string">&quot;B&quot;</span> -&gt; Text(<span class="string">&quot;Page B&quot;</span>, Modifier.background(Color.Red), fontSize = <span class="number">25.</span>sp)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼š<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/7df0d654fbbf2d72f825972e6af82322.gif"></p>
<h3 id="animateXXXAsState"><a href="#animateXXXAsState" class="headerlink" title="animateXXXAsState"></a>animateXXXAsState</h3><p><strong>animate*AsState</strong>Â å‡½æ•°æ˜¯ Compose ä¸­æœ€ç®€å•çš„åŠ¨ç”» APIï¼Œç”¨äºä¸ºå•ä¸ªå€¼æ·»åŠ åŠ¨ç”»æ•ˆæœã€‚ç±»ä¼¼äºä¼ ç»ŸåŠ¨ç”»ä¸­çš„å±æ€§åŠ¨ç”»ã€‚</p>
<p>æ‚¨åªéœ€æä¾›ç»“æŸå€¼ï¼ˆæˆ–ç›®æ ‡å€¼ï¼‰ï¼Œè¯¥ API å°±ä¼šè‡ªåŠ¨å®Œæˆä»å½“å‰å€¼åˆ°ç›®æ ‡å€¼è¿‡æ¸¡çš„ä¼°å€¼è®¡ç®—ã€‚<br>ä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼šé€æ˜åº¦åœ¨1å’Œ0.2ä¹‹å‰åˆ‡æ¢</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimateXXXAsStateExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> enabled <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">true</span>) &#125;</span><br><span class="line">    <span class="keyword">val</span> alpha: <span class="built_in">Float</span> <span class="keyword">by</span> animateFloatAsState(<span class="keyword">if</span> (enabled) <span class="number">1f</span> <span class="keyword">else</span> <span class="number">0.2f</span>)</span><br><span class="line">    Box(</span><br><span class="line">        Modifier</span><br><span class="line">            .size(<span class="number">200.</span>dp)</span><br><span class="line">            .graphicsLayer(alpha = alpha)</span><br><span class="line">            .background(Color.Red)</span><br><span class="line">            .clickable &#123; enabled = !enabled &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼š<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/137db17457e2aa2591f58d1858d3c135.gif"></p>
<p>ä»¥ä¸‹ä»£ç å®ç°çº¢å¿ƒæŒ‰é’®åŠ¨ç”»æ•ˆæœï¼š</p>
<ul>
<li>ç‚¹å‡»æŒ‰é’®æ—¶ï¼ŒbuttonSizeä»24dpå¼€å§‹å‘32dpè¿‡æ¸¡ï¼Œ</li>
<li>å½“buttonSizeè¾¾åˆ°32dpæ—¶ï¼ŒchangeSizeè¢«ç½®ä¸ºfalseï¼ŒbuttonSizeåˆä¼šä»32dpå¼€å§‹å‘24dpè¿‡æ¸¡ï¼Œ</li>
<li>åŒæ—¶æ¯ç‚¹å‡»ä¸€æ¬¡æŒ‰é’®ï¼ŒæŒ‰é’®é¢œè‰²åœ¨çº¢è‰²å’Œç°è‰²ä¹‹é—´è¿‡æ¸¡åˆ‡æ¢</li>
<li>size: å° -&gt; å¤§ -&gt; å° color: ç°è‰² -&gt; çº¢è‰²</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimateXXXAsStateExample2</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> changeSize <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">false</span>) &#125;</span><br><span class="line">    <span class="keyword">var</span> changeColor <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">false</span>) &#125;</span><br><span class="line">    <span class="keyword">val</span> buttonSize <span class="keyword">by</span> animateDpAsState(<span class="keyword">if</span>(changeSize) <span class="number">32.</span>dp <span class="keyword">else</span> <span class="number">24.</span>dp)</span><br><span class="line">    <span class="keyword">val</span> buttonColor <span class="keyword">by</span> animateColorAsState(</span><br><span class="line">        targetValue = <span class="keyword">if</span>(changeColor) Color.Red <span class="keyword">else</span> Color.Gray,</span><br><span class="line">        animationSpec = spring(Spring.DampingRatioNoBouncy)</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">if</span> (buttonSize == <span class="number">32.</span>dp) &#123;</span><br><span class="line">        changeSize = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    Box(Modifier.fillMaxSize(),contentAlignment = Alignment.Center) &#123;</span><br><span class="line">        IconButton(</span><br><span class="line">            onClick = &#123;</span><br><span class="line">                changeSize = <span class="literal">true</span></span><br><span class="line">                changeColor = !changeColor</span><br><span class="line">            &#125;</span><br><span class="line">        ) &#123;</span><br><span class="line">            Icon(Icons.Rounded.Favorite, <span class="literal">null</span>, Modifier.size(buttonSize), tint = buttonColor)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼š<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/c1e29b2a2f3f0e700a40d653949a0bff.gif"></p>
<p>è¯·æ³¨æ„ï¼Œæ‚¨æ— éœ€åˆ›å»ºä»»ä½•åŠ¨ç”»ç±»çš„å®ä¾‹ï¼Œä¹Ÿä¸å¿…å¤„ç†ä¸­æ–­ã€‚åœ¨åå°ï¼Œç³»ç»Ÿä¼šåœ¨è°ƒç”¨ç‚¹åˆ›å»ºå¹¶è®°å½•ä¸€ä¸ªåŠ¨ç”»å¯¹è±¡ï¼ˆå³Â <strong>Animatable</strong>Â å®ä¾‹ï¼‰ï¼Œå¹¶å°†ç¬¬ä¸€ä¸ªç›®æ ‡å€¼è®¾ä¸ºåˆå§‹å€¼ã€‚æ­¤åï¼Œåªè¦æ‚¨ä¸ºæ­¤å¯ç»„åˆé¡¹æä¾›ä¸åŒçš„ç›®æ ‡å€¼ï¼Œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨å‘è¯¥å€¼æ’­æ”¾åŠ¨ç”»ã€‚</p>
<p>å¦‚æœå·²æœ‰åŠ¨ç”»åœ¨æ’­æ”¾ï¼Œç³»ç»Ÿå°†ä»å…¶å½“å‰å€¼ï¼ˆå’Œé€Ÿåº¦ï¼‰å¼€å§‹å‘ç›®æ ‡å€¼æ’­æ”¾åŠ¨ç”»ã€‚ åœ¨æ’­æ”¾åŠ¨ç”»æœŸé—´ï¼Œè¿™ä¸ªå¯ç»„åˆé¡¹ä¼šé‡ç»„ï¼Œå¹¶ä¸”æ¯å¸§éƒ½ä¼šè¿”å›ä¸€ä¸ªå·²æ›´æ–°çš„åŠ¨ç”»å€¼ã€‚</p>
<p>Compose ä¸ºÂ <strong>Floatã€Colorã€Dpã€Sizeã€Offsetã€Rectã€Intã€IntOffset</strong>Â å’ŒÂ <strong>IntSize</strong>Â æä¾›å¼€ç®±å³ç”¨çš„Â <strong>animate*AsState</strong>Â å‡½æ•°ã€‚ å¯¹äºæ— æ³•ç›´æ¥ä¼°å€¼è®¡ç®—çš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨é€šç”¨ç±»å‹çš„Â <strong>animateValueAsState</strong>ï¼Œå¹¶å®ç°Â <strong>TwoWayConverter</strong>Â ä¼°å€¼è®¡ç®—å™¨ã€‚</p>
<h4 id="AnimationVector-TwoWayConverter"><a href="#AnimationVector-TwoWayConverter" class="headerlink" title="AnimationVector &amp; TwoWayConverter"></a>AnimationVector &amp; TwoWayConverter</h4><p><strong>Floatã€Colorã€Dp</strong>ç­‰éƒ½æ˜¯é€šè¿‡<strong>Animatable</strong>è½¬æ¢æˆå¯åŠ¨ç”»ç±»å‹ï¼Œè€Œ<strong>Animatable</strong>æ˜¯å€ŸåŠ©Â <strong>TwoWayConverter</strong>Â å®ç°çš„ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animatable</span>&lt;<span class="type">T, V : AnimationVector</span>&gt;(</span><br><span class="line">    initialValue: T, <span class="comment">// Tç±»å‹çš„åŠ¨ç”»åˆå§‹å€¼</span></span><br><span class="line">    <span class="keyword">val</span> typeConverter: TwoWayConverter&lt;T, V&gt;, <span class="comment">// å°†Tç±»å‹çš„æ•°å€¼ä¸Vç±»å‹çš„æ•°ç»„è¿›è¡Œè½¬æ¢</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> visibilityThreshold: T? = <span class="literal">null</span>, <span class="comment">// åŠ¨ç”»æ¶ˆå¤±æ—¶çš„é˜ˆå€¼ï¼Œé»˜è®¤ä¸ºnull</span></span><br><span class="line">    <span class="keyword">val</span> label: String = <span class="string">&quot;Animatable&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TwoWayConverter</span>&lt;<span class="type">T, V : AnimationVector</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> convertToVector: (T) -&gt; V   <span class="comment">// å°†Tç±»å‹çš„æ•°å€¼è½¬æ¢ä¸ºVç±»å‹</span></span><br><span class="line">    <span class="keyword">val</span> convertFromVector: (V) -&gt; T <span class="comment">// å°†Vç±»å‹çš„æ•°å€¼è½¬æ¢ä¸ºTç±»å‹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸åŒç±»å‹çš„æ•°å€¼å¯ä»¥æ ¹æ®éœ€æ±‚ä¸ä¸åŒçš„<strong>AnimationVectorXD</strong>è¿›è¡Œè½¬æ¢ï¼Œè¿™é‡Œ<strong>X</strong>ä»£è¡¨äº†ä¿¡æ¯çš„ç»´åº¦ï¼Œä¾‹å¦‚ä¸€ä¸ª<strong>Int</strong>å¯ä»¥ä¸<strong>AnimationVector1D</strong>è¿›è¡Œè½¬æ¢ï¼Œ<strong>AnimationVector1D</strong>åªåŒ…å«ä¸€ä¸ªæµ®ç‚¹å‹æ•°å€¼ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> IntToVector: TwoWayConverter&lt;<span class="built_in">Int</span>, AnimationVector1D&gt; =</span><br><span class="line">       TwoWayConverter( &#123; AnimationVector1D(it.toFloat()) &#125;, &#123; it.value.toInt() &#125;)</span><br></pre></td></tr></table></figure>

<p>åŒæ ·åœ°ï¼Œ<strong>Size</strong>åŒ…å«<strong>width</strong>å’Œ<strong>height</strong>ä¸¤ä¸ªç»´åº¦ï¼Œå¯ä»¥ä¸<strong>AnimationVector2D</strong>è¿›è¡Œè½¬æ¢ï¼Œ<br><strong>Color</strong>Â åŒ…å«Â <strong>redã€greenã€blue</strong>Â å’ŒÂ <strong>alpha</strong>Â è¿™Â <strong>4</strong>Â ä¸ªç»´åº¦ï¼Œå¯ä»¥ä¸Â <strong>AnimationVector4D</strong>Â è¿›è¡Œè½¬æ¢ã€‚</p>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒåŠ¨ç”»ä¸­ä½¿ç”¨çš„æ¯ç§æ•°æ®ç±»å‹éƒ½å¯ä»¥æ ¹æ®å…¶ç»´åº¦è½¬æ¢ä¸ºÂ <strong>AnimationVector1Dã€AnimationVector2Dã€AnimationVector3D</strong>Â æˆ–Â <strong>AnimationVector4D</strong>ã€‚</p>
<p>è¿™æ ·å¯ä¸ºå¯¹è±¡çš„ä¸åŒç»„ä»¶å•ç‹¬æ·»åŠ åŠ¨ç”»æ•ˆæœï¼Œä¸”æ¯ä¸ªç»„ä»¶éƒ½æœ‰è‡ªå·±çš„é€Ÿåº¦è·Ÿè¸ªã€‚å¯¹äºå¸¸è§çš„æ•°æ®ç±»å‹ï¼ŒComposeéƒ½æä¾›äº†<strong>å†…ç½®è½¬æ¢å™¨</strong>ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å¦‚<strong>Color.VectorConverterã€Dp.VectorConverterã€Float.VectorConverterã€Rect.VectorConverter</strong>Â ç­‰ç­‰ã€‚å¯ä»¥åœ¨å¯¹åº”ç±»å‹çš„<strong>ä¼´ç”Ÿå¯¹è±¡</strong>ä¸­æ‰¾åˆ°å…¶å®ç°ã€‚</p>
<h4 id="è‡ªå®šä¹‰TwoWayConverter"><a href="#è‡ªå®šä¹‰TwoWayConverter" class="headerlink" title="è‡ªå®šä¹‰TwoWayConverter"></a>è‡ªå®šä¹‰TwoWayConverter</h4><p>é¦–å…ˆè¦æ˜ç¡®ä¸€ç‚¹çš„æ˜¯ï¼Œåªæœ‰æ²¡æœ‰æ‰¾åˆ°Composeæä¾›çš„å†…ç½®è½¬æ¢å™¨çš„æ•°æ®ç±»å‹æ—¶æ‰éœ€è¦è¿›è¡Œè‡ªå®šä¹‰ï¼Œé€šå¸¸æˆ‘ä»¬ä¸éœ€è¦è¿™æ ·åšã€‚</p>
<p>ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ç»“åˆä½¿ç”¨Â <strong>animateValueAsState</strong>Â ä¸ºè‡ªå®šä¹‰æ•°æ®ç±»å‹æ·»åŠ åŠ¨ç”»æ•ˆæœï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimateValueExample</span><span class="params">(targetSize: <span class="type">MySize</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> animSize: MySize <span class="keyword">by</span> animateValueAsState(</span><br><span class="line">        targetValue = targetSize,</span><br><span class="line">        typeConverter = TwoWayConverter(</span><br><span class="line">            convertToVector = &#123; size: MySize -&gt;</span><br><span class="line">                <span class="comment">// Extract a float value from each of the `Dp` fields.</span></span><br><span class="line">                AnimationVector2D(size.width.value, size.height.value)</span><br><span class="line">            &#125;,</span><br><span class="line">            convertFromVector = &#123; vector: AnimationVector2D -&gt;</span><br><span class="line">                MySize(vector.v1.dp, vector.v2.dp)</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">MySize</span>(<span class="keyword">val</span> width: Dp, <span class="keyword">val</span> height: Dp)</span><br></pre></td></tr></table></figure>

<h3 id="Transition"><a href="#Transition" class="headerlink" title="Transition"></a>Transition</h3><p><strong>Transition</strong>Â å¯ç®¡ç†ä¸€ä¸ªæˆ–å¤šä¸ªåŠ¨ç”»ä½œä¸ºå…¶å­é¡¹ï¼Œå¹¶åœ¨å¤šä¸ªçŠ¶æ€ä¹‹é—´åŒæ—¶è¿è¡Œè¿™äº›åŠ¨ç”»ã€‚ç±»ä¼¼ä¼ ç»ŸåŠ¨ç”»ä¸­çš„<strong>AnimationSet</strong>ã€‚</p>
<p>è¿™é‡Œçš„çŠ¶æ€å¯ä»¥æ˜¯ä»»ä½•æ•°æ®ç±»å‹ã€‚åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰Â <strong>enum</strong>Â ç±»å‹æ¥ç¡®ä¿ç±»å‹å®‰å…¨ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="keyword">class</span> <span class="title class_">BoxState</span> &#123;</span><br><span class="line">    Collapsed,</span><br><span class="line">    Expanded</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="updateTransition"><a href="#updateTransition" class="headerlink" title="updateTransition"></a>updateTransition</h4><p><strong>updateTransition</strong>Â å¯åˆ›å»ºå¹¶è®°ä½Â <strong>Transition</strong>Â çš„å®ä¾‹ï¼Œå½“å…¶è§‚å¯Ÿçš„çŠ¶æ€æ”¹å˜æ—¶ï¼ŒTransitionä¼šè‡ªåŠ¨æ›´æ–°å…¶çŠ¶æ€ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> currentState <span class="keyword">by</span> remember &#123; mutableStateOf(BoxState.Collapsed) &#125;</span><br><span class="line"><span class="keyword">val</span> transition = updateTransition(currentState, label = <span class="string">&quot;BoxTransition&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æŸä¸€ä¸ªÂ <strong>transition.animatexxx æ‰©å±•å‡½æ•°</strong>Â æ¥å®šä¹‰æ­¤è¿‡æ¸¡æ•ˆæœä¸­çš„å­åŠ¨ç”»ã€‚ä¸ºæ¯ä¸ªçŠ¶æ€æŒ‡å®šç›®æ ‡å€¼ã€‚</p>
<p>è¿™äº›Â <strong>transition.animatexxx æ‰©å±•å‡½æ•°</strong>Â ä¼šè¿”å›ä¸€ä¸ªåŠ¨ç”»å€¼ï¼Œåœ¨åŠ¨ç”»æ’­æ”¾è¿‡ç¨‹ä¸­ï¼Œå½“ä½¿ç”¨Â <strong>updateTransition</strong>Â æ›´æ–°è¿‡æ¸¡çŠ¶æ€æ—¶ï¼Œè¯¥å€¼å°†é€å¸§æ›´æ–°ã€‚</p>
<p>æ‚¨ä¹Ÿå¯ä»¥ä¼ é€’Â <strong>transitionSpec</strong>Â å‚æ•°ï¼Œä¸ºè¿‡æ¸¡çŠ¶æ€å˜åŒ–çš„æ¯ä¸ªç»„åˆæŒ‡å®šä¸åŒçš„Â <strong>AnimationSpec</strong>ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">TransitionAnimationExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> boxState <span class="keyword">by</span> remember &#123; mutableStateOf(BoxState.Collapsed) &#125;</span><br><span class="line">    <span class="keyword">val</span> transition = updateTransition(boxState, label = <span class="string">&quot;BoxTransition&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> size <span class="keyword">by</span> transition.animateFloat(</span><br><span class="line">        transitionSpec = &#123; tween(<span class="number">500</span>) &#125;, label = <span class="string">&quot;size&quot;</span></span><br><span class="line">    ) &#123; state -&gt;</span><br><span class="line">        state.valueOf(collapsed = <span class="number">100f</span>, expanded = <span class="number">200f</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> borderWidth <span class="keyword">by</span> transition.animateDp(</span><br><span class="line">        transitionSpec = &#123; tween(<span class="number">500</span>) &#125;, label = <span class="string">&quot;borderWidth&quot;</span></span><br><span class="line">    ) &#123; state -&gt;</span><br><span class="line">        state.valueOf(collapsed = <span class="number">1.</span>dp, expanded = <span class="number">2.</span>dp)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> bgColor <span class="keyword">by</span> transition.animateColor(</span><br><span class="line">        transitionSpec = &#123;</span><br><span class="line">            <span class="keyword">when</span> &#123;</span><br><span class="line">                BoxState.Expanded isTransitioningTo BoxState.Collapsed -&gt; spring(stiffness = <span class="number">50f</span>)</span><br><span class="line">                <span class="keyword">else</span> -&gt; tween(<span class="number">500</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, label = <span class="string">&quot;bgColor&quot;</span></span><br><span class="line">    ) &#123; state -&gt;</span><br><span class="line">        state.valueOf(collapsed = Color.Green, expanded = Color.Cyan)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> borderColor <span class="keyword">by</span> transition.animateColor(label = <span class="string">&quot;borderColor&quot;</span>) &#123; state -&gt;</span><br><span class="line">        state.valueOf(collapsed = Color.Red, expanded = Color.Blue)</span><br><span class="line">    &#125;</span><br><span class="line">    Box(</span><br><span class="line">        modifier = Modifier</span><br><span class="line">            .clickable &#123;</span><br><span class="line">                boxState = boxState.swapState()</span><br><span class="line">            &#125;</span><br><span class="line">            .padding(<span class="number">5.</span>dp)</span><br><span class="line">            .size(size.dp)</span><br><span class="line">            .background(bgColor)</span><br><span class="line">            .border(BorderStroke(borderWidth, borderColor)),</span><br><span class="line">        contentAlignment = Alignment.Center</span><br><span class="line">    ) &#123;</span><br><span class="line">        Text(text = boxState.valueOf(<span class="string">&quot;Collapsed&quot;</span>, <span class="string">&quot;Expanded&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> BoxState.<span class="title">valueOf</span><span class="params">(collapsed: <span class="type">T</span>, expanded: <span class="type">T</span>)</span></span> : T &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">when</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        BoxState.Collapsed -&gt; collapsed</span><br><span class="line">        BoxState.Expanded -&gt; expanded</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> BoxState.<span class="title">swapState</span><span class="params">()</span></span> : BoxState = valueOf(BoxState.Expanded, BoxState.Collapsed)</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼š<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/78d97855f77e9304ab8e01adc7ae5b78.gif"></p>
<p>å½“è¿‡æ¸¡åŠ¨ç”»åˆ°ç›®æ ‡çŠ¶æ€åï¼Œ<strong>Transition.currentState</strong>Â å°†ä¸Â <strong>Transition.targetState</strong>Â ç›¸åŒï¼Œè¿™ä¸€ç‚¹å¯ä»¥ç”¨ä½œåˆ¤æ–­æ˜¯å¦å·²å®Œæˆè¿‡æ¸¡åŠ¨ç”»çš„æ¡ä»¶ã€‚</p>
<h4 id="MutableTransitionState"><a href="#MutableTransitionState" class="headerlink" title="MutableTransitionState"></a>MutableTransitionState</h4><h5 id="MutableTransitionStateï¼šä¸ºå…¶è®¾ç½®ä¸åŒçš„ç›®æ ‡å€¼å¯ç«‹å³è§¦å‘åŠ¨ç”»"><a href="#MutableTransitionStateï¼šä¸ºå…¶è®¾ç½®ä¸åŒçš„ç›®æ ‡å€¼å¯ç«‹å³è§¦å‘åŠ¨ç”»" class="headerlink" title="MutableTransitionStateï¼šä¸ºå…¶è®¾ç½®ä¸åŒçš„ç›®æ ‡å€¼å¯ç«‹å³è§¦å‘åŠ¨ç”»"></a>MutableTransitionStateï¼šä¸ºå…¶è®¾ç½®ä¸åŒçš„ç›®æ ‡å€¼å¯ç«‹å³è§¦å‘åŠ¨ç”»</h5><p>æœ‰æ—¶ï¼Œæˆ‘ä»¬ä¼šå¸Œæœ›<strong>åˆå§‹çŠ¶æ€ä¸ç¬¬ä¸€ä¸ªç›®æ ‡çŠ¶æ€ä¸åŒ</strong>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»“åˆä½¿ç”¨Â <strong>updateTransition</strong>Â å’ŒÂ <strong>MutableTransitionState</strong>Â æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p>
<p><strong>MutableTransitionState</strong>çš„æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ª<strong>initialState</strong>å‚æ•°ï¼Œåªéœ€è¦ä¿®æ”¹å®ƒçš„<strong>targetState</strong>å€¼ä¸<strong>initialState</strong>ä¸åŒçš„å€¼ï¼Œå°±ä¼šç«‹å³è§¦å‘åŠ¨ç”»ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨ä»£ç è¿›å…¥ç»„åˆé˜¶æ®µåç«‹å³å¼€å§‹æ’­æ”¾åŠ¨ç”»ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MutableTransitionStateExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> boxState = remember &#123;</span><br><span class="line">        MutableTransitionState(BoxState.Collapsed).apply &#123;</span><br><span class="line">            targetState = BoxState.Expanded <span class="comment">// ä¿®æ”¹targetStateä¸initialStateä¸åŒç«‹å³æ‰§è¡ŒåŠ¨ç”»</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> transition = updateTransition(boxState, label = <span class="string">&quot;BoxTransition&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> size <span class="keyword">by</span> transition.animateFloat(</span><br><span class="line">        transitionSpec = &#123; tween(<span class="number">500</span>) &#125;, label = <span class="string">&quot;sizeTransition&quot;</span></span><br><span class="line">    ) &#123; state -&gt;</span><br><span class="line">        state.valueOf(collapsed = <span class="number">100f</span>, expanded = <span class="number">200f</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> bgColor <span class="keyword">by</span> transition.animateColor(</span><br><span class="line">        transitionSpec = &#123; tween(<span class="number">500</span>) &#125;, label = <span class="string">&quot;bgColorTransition&quot;</span></span><br><span class="line">    ) &#123; state -&gt;</span><br><span class="line">        state.valueOf(collapsed = Color.Green, expanded = Color.Cyan)</span><br><span class="line">    &#125;</span><br><span class="line">    Box(</span><br><span class="line">        modifier = Modifier</span><br><span class="line">            .clickable &#123;</span><br><span class="line">                boxState.targetState = boxState.targetState.swapState() <span class="comment">// ä¿®æ”¹çŠ¶æ€æ—¶è¦ä¿®æ”¹çŠ¶æ€çš„targetState </span></span><br><span class="line">            &#125;</span><br><span class="line">            .padding(<span class="number">5.</span>dp)</span><br><span class="line">            .size(size.dp)</span><br><span class="line">            .background(bgColor) ,</span><br><span class="line">        contentAlignment = Alignment.Center</span><br><span class="line">    ) &#123;</span><br><span class="line">        Text(text = boxState.valueOf(<span class="string">&quot;Collapsed&quot;</span>, <span class="string">&quot;Expanded&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> MutableTransitionState<span class="type">&lt;BoxState&gt;</span>.<span class="title">valueOf</span><span class="params">(collapsed: <span class="type">T</span>, expanded: <span class="type">T</span>)</span></span> : T &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.targetState.valueOf(collapsed, expanded)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼š ä¸å‰é¢çš„æ•ˆæœä¸€æ ·ï¼Œä½†æ˜¯è¿›å…¥ç•Œé¢å°±å¼€å§‹è‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡åŠ¨ç”»ã€‚</p>
<h5 id="MutableTransitionState-å¯ä»¥ç”¨æ¥ç›‘å¬åŠ¨ç”»çŠ¶æ€"><a href="#MutableTransitionState-å¯ä»¥ç”¨æ¥ç›‘å¬åŠ¨ç”»çŠ¶æ€" class="headerlink" title="MutableTransitionState å¯ä»¥ç”¨æ¥ç›‘å¬åŠ¨ç”»çŠ¶æ€"></a>MutableTransitionState å¯ä»¥ç”¨æ¥ç›‘å¬åŠ¨ç”»çŠ¶æ€</h5><p>ä¾‹å¦‚ï¼Œä½¿ç”¨Â <strong>AnimatedVisibility</strong>Â æ­é…Â <strong>MutableTransitionState</strong>Â å¯ä»¥å®ç°è§‚å¯ŸåŠ¨ç”»çš„å¯è§çŠ¶æ€ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatedVisibilityExample2</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// Create a MutableTransitionState&lt;Boolean&gt; for the AnimatedVisibility.</span></span><br><span class="line">    <span class="keyword">val</span> state = remember &#123;</span><br><span class="line">        <span class="comment">// initialStateä¸ºfalse, targetStateè®¾ç½®ä¸ºtrue, </span></span><br><span class="line">        <span class="comment">// å½“AnimatedVisibilityä¸Šå±æ—¶ï¼Œç”±äºä¸¤ä¸ªçŠ¶æ€ä¸åŒï¼Œä¼šç«‹å³æ‰§è¡ŒåŠ¨ç”»</span></span><br><span class="line">        MutableTransitionState(<span class="literal">false</span>).apply &#123; </span><br><span class="line">            targetState = <span class="literal">true</span> <span class="comment">// Start the animation immediately.</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Box(Modifier.fillMaxWidth(), contentAlignment = Alignment.TopCenter) &#123;</span><br><span class="line">        AnimatedVisibility(visibleState = state) &#123;</span><br><span class="line">            Text(text = <span class="string">&quot;Hello, world!&quot;</span>,</span><br><span class="line">                Modifier.background(Color.Green).height(<span class="number">100.</span>dp).fillMaxWidth()</span><br><span class="line">                    .wrapContentWidth(Alignment.CenterHorizontally),</span><br><span class="line">                fontSize = <span class="number">20.</span>sp)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è·å–AnimatedVisibilityå½“å‰æ‰€å¤„çš„åŠ¨ç”»çŠ¶æ€å¹¶æ˜¾ç¤º</span></span><br><span class="line">        Text(text = <span class="string">&quot;current Animate State: <span class="subst">$&#123;state.getAnimationState()&#125;</span>&quot;</span>,</span><br><span class="line">            Modifier.padding(top = <span class="number">100.</span>dp).background(Color.Red).fillMaxWidth().padding(<span class="number">15.</span>dp),</span><br><span class="line">            color = Color.White,</span><br><span class="line">            fontSize = <span class="number">20.</span>sp)</span><br><span class="line">        Button(</span><br><span class="line">            onClick = &#123; state.targetState = !state.targetState &#125;,</span><br><span class="line">            Modifier.padding(top = <span class="number">160.</span>dp)</span><br><span class="line">        ) &#123;</span><br><span class="line">            Text(text = <span class="keyword">if</span>(state.targetState) <span class="string">&quot;éšè—&quot;</span> <span class="keyword">else</span> <span class="string">&quot;æ˜¾ç¤º&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">enum</span> <span class="keyword">class</span> <span class="title class_">Animate</span> &#123; VISIBLE, INVISIBLE, APPEARING, DISAPPEARING &#125;</span><br><span class="line"><span class="comment">// ä¸ºMutableTransitionStateå®šä¹‰ä¸€ä¸ªæ‰©å±•å‡½æ•°æ¥æ–¹ä¾¿çš„è·å–åŠ¨ç”»çŠ¶æ€</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> MutableTransitionState<span class="type">&lt;Boolean&gt;</span>.<span class="title">getAnimationState</span><span class="params">()</span></span>: Animate &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">when</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.isIdle &amp;&amp; <span class="keyword">this</span>.currentState -&gt; Animate.VISIBLE <span class="comment">// åŠ¨ç”»å·²ç»“æŸï¼Œå½“å‰å¤„äºå¯è§çŠ¶æ€</span></span><br><span class="line">        !<span class="keyword">this</span>.isIdle &amp;&amp; <span class="keyword">this</span>.currentState -&gt; Animate.DISAPPEARING <span class="comment">// åŠ¨ç”»æ‰§è¡Œä¸­ï¼Œä¸”é€æ¸ä¸å¯è§</span></span><br><span class="line">        <span class="keyword">this</span>.isIdle &amp;&amp; !<span class="keyword">this</span>.currentState -&gt; Animate.INVISIBLE <span class="comment">// åŠ¨ç”»å·²ç»“æŸï¼Œå½“å‰å¤„äºä¸å¯è§çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">else</span> -&gt; Animate.APPEARING <span class="comment">// åŠ¨ç”»æ‰§è¡Œä¸­ï¼Œä¸”é€æ¸å¯è§</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼š<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/134bb62428d509ca25cde05c64c98b79.gif"></p>
<h4 id="createChildTransition"><a href="#createChildTransition" class="headerlink" title="createChildTransition"></a>createChildTransition</h4><p>å¯¹äºæ¶‰åŠå¤šä¸ªå¯ç»„åˆå‡½æ•°çš„æ›´å¤æ‚çš„è¿‡æ¸¡ï¼Œå¯ä½¿ç”¨ createChildTransition æ¥åˆ›å»ºå­è¿‡æ¸¡ã€‚</p>
<p>æ­¤æ–¹æ³•å¯¹äºåœ¨å¤æ‚çš„å¯ç»„åˆé¡¹ä¸­åˆ†ç¦»å¤šä¸ªå­ç»„ä»¶ä¹‹é—´çš„å…³æ³¨ç‚¹éå¸¸æœ‰ç”¨ã€‚çˆ¶è¿‡æ¸¡å°†ä¼šçŸ¥é“å­è¿‡æ¸¡ä¸­çš„æ‰€æœ‰åŠ¨ç”»å€¼ã€‚createChildTransitionæ›´åƒæ˜¯ä¸€ç§mapã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="keyword">class</span> <span class="title class_">DialerState</span> &#123; DialerMinimized, NumberPad &#125;</span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">DialerButton</span><span class="params">(isVisibleTransition: <span class="type">Transition</span>&lt;<span class="type">Boolean</span>&gt;)</span></span> &#123;</span><br><span class="line">    <span class="comment">// ä¸éœ€è¦çŸ¥é“å…¶ä»–çŠ¶æ€ï¼Œåªéœ€å…³æ³¨å½“å‰isVisibleTransitionæ˜¯ visible è¿˜æ˜¯ not visible.</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">NumberPad</span><span class="params">(isVisibleTransition: <span class="type">Transition</span>&lt;<span class="type">Boolean</span>&gt;)</span></span> &#123;</span><br><span class="line">    <span class="comment">// ä¸éœ€è¦çŸ¥é“å…¶ä»–çŠ¶æ€ï¼Œåªéœ€å…³æ³¨å½“å‰isVisibleTransitionæ˜¯ visible è¿˜æ˜¯ not visible.</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@OptIn(ExperimentalTransitionApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">Dialer</span><span class="params">(dialerState: <span class="type">DialerState</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> transition = updateTransition(dialerState, label = <span class="string">&quot;&quot;</span>)</span><br><span class="line">    Box &#123;</span><br><span class="line">        NumberPad(</span><br><span class="line">            transition.createChildTransition &#123;</span><br><span class="line">                it == DialerState.NumberPad</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">        DialerButton(</span><br><span class="line">            transition.createChildTransition &#123;</span><br><span class="line">                it == DialerState.DialerMinimized</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å°†-Transition-ä¸-AnimatedVisibility-å’Œ-AnimatedContent-é…åˆä½¿ç”¨"><a href="#å°†-Transition-ä¸-AnimatedVisibility-å’Œ-AnimatedContent-é…åˆä½¿ç”¨" class="headerlink" title="å°† Transition ä¸ AnimatedVisibility å’Œ AnimatedContent é…åˆä½¿ç”¨"></a>å°† Transition ä¸ AnimatedVisibility å’Œ AnimatedContent é…åˆä½¿ç”¨</h4><p><strong>Transition</strong>ä¸­æœ‰åˆ†åˆ«é’ˆå¯¹<strong>AnimatedVisibility</strong>Â å’ŒÂ <strong>AnimatedContent</strong>Â çš„æ‰©å±•å‡½æ•°ã€‚<br><strong>Transition.AnimatedVisibility</strong>Â å’ŒÂ <strong>Transition.AnimatedContent</strong>Â çš„Â <strong>targetState</strong>Â æºè‡ªÂ <strong>Transition</strong>ï¼Œ ä¼šåœ¨Â <strong>Transition</strong>Â çš„Â <strong>targetState</strong>Â å‘ç”Ÿå˜åŒ–æ—¶è§†éœ€è¦è§¦å‘è¿›å…¥&#x2F;é€€å‡ºè¿‡æ¸¡ã€‚</p>
<p>è¿™äº›æ‰©å±•å‡½æ•°å…è®¸å°†åŸæœ¬ä½äºÂ <strong>AnimatedVisibility</strong>Â æˆ–Â <strong>AnimatedContent</strong>Â å†…çš„æ‰€æœ‰Â <strong>enter&#x2F;exit&#x2F;sizeTransform</strong>Â åŠ¨ç”»æå‡åˆ°Â <strong>Transition</strong>Â ä¸­ã€‚ å€ŸåŠ©è¿™äº›æ‰©å±•å‡½æ•°ï¼Œå¯ä»¥ä»å¤–éƒ¨è§‚å¯ŸÂ <strong>AnimatedVisibility&#x2F;AnimatedContent</strong>Â çš„çŠ¶æ€å˜åŒ–ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalAnimationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">TransitionWithAnimatedVisibilityAndAnimatedContent</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> selected <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">false</span>) &#125;</span><br><span class="line">    <span class="comment">// å½“ `selected` å˜åŒ–æ—¶è§¦å‘transitionåŠ¨ç”»</span></span><br><span class="line">    <span class="keyword">val</span> transition = updateTransition(selected, label = <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> borderColor <span class="keyword">by</span> transition.animateColor(label = <span class="string">&quot;&quot;</span>) &#123; isSelected -&gt;</span><br><span class="line">        <span class="keyword">if</span> (isSelected) Color.Magenta <span class="keyword">else</span> Color.White</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> elevation <span class="keyword">by</span> transition.animateDp(label = <span class="string">&quot;&quot;</span>) &#123; isSelected -&gt;</span><br><span class="line">        <span class="keyword">if</span> (isSelected) <span class="number">10.</span>dp <span class="keyword">else</span> <span class="number">2.</span>dp</span><br><span class="line">    &#125;</span><br><span class="line">    Surface(</span><br><span class="line">        modifier = Modifier.clickable &#123; selected = !selected &#125;</span><br><span class="line">            .padding(<span class="number">10.</span>dp),</span><br><span class="line">        shape = RoundedCornerShape(<span class="number">8.</span>dp),</span><br><span class="line">        border = BorderStroke(<span class="number">2.</span>dp, borderColor),</span><br><span class="line">        elevation = elevation</span><br><span class="line">    ) &#123;</span><br><span class="line">        Column(modifier = Modifier</span><br><span class="line">            .fillMaxWidth()</span><br><span class="line">            .padding(<span class="number">16.</span>dp)) &#123;</span><br><span class="line">            Text(text = <span class="string">&quot;Hello, world!&quot;</span>)</span><br><span class="line">            <span class="comment">// AnimatedVisibility ä½œä¸ºè¿‡æ¸¡åŠ¨ç”»çš„ä¸€éƒ¨åˆ†</span></span><br><span class="line">            transition.AnimatedVisibility(</span><br><span class="line">                visible = &#123; targetSelected -&gt; targetSelected &#125;,</span><br><span class="line">                enter = expandVertically(),</span><br><span class="line">                exit = shrinkVertically()</span><br><span class="line">            ) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;It is fine today.&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// AnimatedContent ä½œä¸ºè¿‡æ¸¡åŠ¨ç”»çš„ä¸€éƒ¨åˆ†</span></span><br><span class="line">            transition.AnimatedContent &#123; targetState -&gt;</span><br><span class="line">                <span class="keyword">if</span> (targetState) &#123;</span><br><span class="line">                    Text(text = <span class="string">&quot;Selected&quot;</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Icon(Icons.Default.Favorite, <span class="string">&quot;&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼š<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/f61c1ccbc35e1d1c0e4018685731fb09.gif"></p>
<p>å¯¹äº<strong>transition.AnimatedContent</strong>,Â <strong>transition</strong>æ‰€åŒ…å«çš„çŠ¶æ€å€¼ä¼šè¢«è½¬æ¢æˆ<strong>targetState</strong>å‚æ•°ä¼ å…¥ã€‚<br>å¯¹äº<strong>transition.AnimatedVisibility</strong>ï¼Œåˆ™éœ€è¦é€šè¿‡ä¸€ä¸ªÂ <strong>lambdaè½¬æ¢å™¨</strong>Â å°†çŠ¶æ€å€¼è½¬æ¢æˆå…¶æ‰€éœ€çš„Â <strong>Boolean</strong>Â ç±»å‹çš„Â <strong>visible</strong>Â å‚æ•°ã€‚</p>
<h4 id="å°è£…å’Œå¤ç”¨-Transition"><a href="#å°è£…å’Œå¤ç”¨-Transition" class="headerlink" title="å°è£…å’Œå¤ç”¨ Transition"></a>å°è£…å’Œå¤ç”¨ Transition</h4><p>åœ¨å¤„ç†å…·æœ‰å¤§é‡åŠ¨ç”»å€¼çš„å¤æ‚ç»„ä»¶æ—¶ï¼Œå¯èƒ½ä¼šå¸Œæœ›å°†åŠ¨ç”»å®ç°ä¸å¯ç»„åˆç•Œé¢åˆ†å¼€ã€‚<br>ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªç±»æ¥ä¿å­˜æ‰€æœ‰åŠ¨ç”»å€¼ï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªâ€œupdateâ€å‡½æ•°æ¥è¿”å›è¯¥ç±»çš„å®ä¾‹ã€‚è¿‡æ¸¡å®ç°å¯æå–åˆ°æ–°çš„ç‹¬ç«‹å‡½æ•°ä¸­ã€‚</p>
<p>å½“æ‚¨éœ€è¦é›†ä¸­å¤„ç†åŠ¨ç”»é€»è¾‘æˆ–ä½¿å¤æ‚åŠ¨ç”»å¯é‡å¤ä½¿ç”¨æ—¶ï¼Œè¿™ç§æ¨¡å¼å¾ˆæœ‰ç”¨ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatingBoxExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> currentState <span class="keyword">by</span> remember &#123; mutableStateOf(BoxState.Collapsed) &#125;</span><br><span class="line">    AnimatingBox(</span><br><span class="line">        boxState = currentState,</span><br><span class="line">        Modifier.clickable &#123; currentState = currentState.swapState() &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatingBox</span><span class="params">(boxState: <span class="type">BoxState</span>, modifier: <span class="type">Modifier</span> = Modifier)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> transitionData = updateTransitionData(boxState)</span><br><span class="line">    Box(modifier.background(transitionData.color).size(transitionData.size))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿å­˜åŠ¨ç”»å€¼</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">TransitionData</span>(color: State&lt;Color&gt;, size: State&lt;Dp&gt;) &#123;</span><br><span class="line">    <span class="keyword">val</span> color <span class="keyword">by</span> color</span><br><span class="line">    <span class="keyword">val</span> size <span class="keyword">by</span> size</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ª Transition å¹¶è¿”å›å…¶åŠ¨ç”»å€¼</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">updateTransitionData</span><span class="params">(boxState: <span class="type">BoxState</span>)</span></span>: TransitionData &#123;</span><br><span class="line">    <span class="keyword">val</span> transition = updateTransition(boxState, label = <span class="string">&quot;boxState&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> color = transition.animateColor(label = <span class="string">&quot;color&quot;</span>) &#123; state -&gt;</span><br><span class="line">        state.valueOf(collapsed = Color.Gray, expanded =  Color.Red)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> size = transition.animateDp(label = <span class="string">&quot;size&quot;</span>) &#123; state -&gt;</span><br><span class="line">        state.valueOf(collapsed = <span class="number">64.</span>dp, expanded = <span class="number">128.</span>dp)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> remember(transition) &#123; TransitionData(color, size) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> BoxState.<span class="title">valueOf</span><span class="params">(collapsed: <span class="type">T</span>, expanded: <span class="type">T</span>)</span></span> : T &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">when</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        BoxState.Collapsed -&gt; collapsed</span><br><span class="line">        BoxState.Expanded -&gt; expanded</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> BoxState.<span class="title">swapState</span><span class="params">()</span></span> : BoxState = valueOf(BoxState.Expanded, BoxState.Collapsed)</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼š<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/92eb70215e3f49ef32b531d0a4e3fc8d.gif"></p>
<h4 id="rememberInfiniteTransition"><a href="#rememberInfiniteTransition" class="headerlink" title="rememberInfiniteTransition"></a>rememberInfiniteTransition</h4><p><strong>InfiniteTransition</strong>Â å¯ä»¥åƒÂ <strong>Transition</strong>Â ä¸€æ ·ä¿å­˜ä¸€ä¸ªæˆ–å¤šä¸ªå­åŠ¨ç”»ï¼Œ ä½†æ˜¯ï¼Œè¿™äº›åŠ¨ç”»ä¸€è¿›å…¥ç»„åˆé˜¶æ®µå°±å¼€å§‹è¿è¡Œï¼Œé™¤éè¢«ç§»é™¤ï¼Œå¦åˆ™ä¸ä¼šåœæ­¢ã€‚å³ä¸€ä¸ª<strong>æ— é™å¾ªç¯çš„TransitionåŠ¨ç”»</strong>ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨Â <strong>rememberInfiniteTransition</strong>Â åˆ›å»ºÂ <strong>InfiniteTransition</strong>Â å®ä¾‹ã€‚<br>å¯ä»¥ä½¿ç”¨Â <strong>animateColor</strong>ã€<strong>animatedFloat</strong>Â æˆ–Â <strong>animatedValue</strong>Â æ·»åŠ å­åŠ¨ç”»ã€‚<br>è¿˜éœ€è¦æŒ‡å®šÂ <strong>infiniteRepeatable</strong>Â ä»¥æŒ‡å®šåŠ¨ç”»çš„é‡å¤æ¨¡å¼ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">RememberInfiniteTransitionExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> infiniteTransition = rememberInfiniteTransition()</span><br><span class="line">    <span class="keyword">val</span> color <span class="keyword">by</span> infiniteTransition.animateColor(</span><br><span class="line">        initialValue = Color.Red,</span><br><span class="line">        targetValue = Color.Blue,</span><br><span class="line">        animationSpec = infiniteRepeatable(</span><br><span class="line">            animation = tween(<span class="number">1000</span>, easing = LinearEasing),</span><br><span class="line">            repeatMode = RepeatMode.Reverse</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">val</span> roundPercent <span class="keyword">by</span> infiniteTransition.animateFloat(</span><br><span class="line">        initialValue = <span class="number">0f</span>,</span><br><span class="line">        targetValue = <span class="number">100f</span>,</span><br><span class="line">        animationSpec = infiniteRepeatable(</span><br><span class="line">            animation = tween(<span class="number">1000</span>, easing = FastOutLinearInEasing),</span><br><span class="line">            repeatMode = RepeatMode.Reverse</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">val</span> offset <span class="keyword">by</span> infiniteTransition.animateFloat(</span><br><span class="line">        initialValue = <span class="number">0f</span>,</span><br><span class="line">        targetValue = <span class="number">100f</span>,</span><br><span class="line">        animationSpec = infiniteRepeatable(</span><br><span class="line">            animation = tween(<span class="number">1000</span>, easing = FastOutSlowInEasing),</span><br><span class="line">            repeatMode = RepeatMode.Reverse</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">    Box(modifier = Modifier.size(<span class="number">300.</span>dp)) &#123;</span><br><span class="line">        Box(</span><br><span class="line">            Modifier</span><br><span class="line">                .padding(<span class="number">10.</span>dp)</span><br><span class="line">                .size(<span class="number">100.</span>dp)</span><br><span class="line">                .offset(offset.dp, offset.dp)</span><br><span class="line">                .clip(RoundedCornerShape(roundPercent.toInt()))</span><br><span class="line">                .background(color)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼š<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/da7af596a0ba19955854d85b9b808826.gif"></p>
<p>åœ¨Â <strong>infiniteRepeatable</strong>Â ä¸­çš„Â <strong>repeatMode</strong>Â æœ‰ä¸¤ç§åŠ¨ç”»çš„é‡å¤æ¨¡å¼ï¼š</p>
<ul>
<li><strong>Reverse</strong>Â ï¼š æ‰§è¡Œåˆ°ç›®æ ‡çŠ¶æ€åå†åŸè·¯è¿”å›åˆå§‹çŠ¶æ€ï¼Œé€†å‘æ‰§è¡ŒåŠ¨ç”»æ•ˆæœ</li>
<li><strong>Restart</strong>ï¼š æ‰§è¡Œåˆ°ç›®æ ‡çŠ¶æ€åå†é‡æ–°ä»åˆå§‹çŠ¶æ€å¼€å§‹æ‰§è¡Œ</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">InfiniteRepeatableDemo</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> infiniteTransition = rememberInfiniteTransition()</span><br><span class="line">    <span class="keyword">val</span> degrees <span class="keyword">by</span> infiniteTransition.animateFloat(</span><br><span class="line">        initialValue = <span class="number">0f</span>,</span><br><span class="line">        targetValue = <span class="number">360f</span>,</span><br><span class="line">        animationSpec = infiniteRepeatable(</span><br><span class="line">            animation = keyframes &#123;</span><br><span class="line">                durationMillis = <span class="number">3000</span></span><br><span class="line">                <span class="number">0F</span> at <span class="number">0</span></span><br><span class="line">                <span class="number">360f</span> at <span class="number">3000</span></span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    Box(</span><br><span class="line">        modifier = Modifier.fillMaxSize(),</span><br><span class="line">        contentAlignment = Alignment.Center</span><br><span class="line">    ) &#123;</span><br><span class="line">        Text(</span><br><span class="line">            text = <span class="string">&quot;infiniteRepeatable&quot;</span>,</span><br><span class="line">            modifier = Modifier.rotate(degrees = degrees),</span><br><span class="line">            color = Color.Red,</span><br><span class="line">            fontSize = <span class="number">22.</span>sp</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼š<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/88875c39f6ac2d057593e343327c9acb.gif"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ImageBorderAnimation</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> infiniteTransition = rememberInfiniteTransition()</span><br><span class="line">    <span class="keyword">val</span> degrees <span class="keyword">by</span> infiniteTransition.animateFloat(</span><br><span class="line">        initialValue = <span class="number">0f</span>,</span><br><span class="line">        targetValue = <span class="number">360f</span>,</span><br><span class="line">        animationSpec = infiniteRepeatable(tween(<span class="number">1000</span>, easing = LinearEasing))</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">val</span> strokeWidth = <span class="number">8.</span>dp</span><br><span class="line">    Box(</span><br><span class="line">        modifier = Modifier.fillMaxSize(),</span><br><span class="line">        contentAlignment = Alignment.Center</span><br><span class="line">    ) &#123;</span><br><span class="line">        Image(</span><br><span class="line">            painter = painterResource(id = R.drawable.ic_head3),</span><br><span class="line">            contentDescription = <span class="string">&quot;head&quot;</span>,</span><br><span class="line">            contentScale = ContentScale.Crop,</span><br><span class="line">            modifier = Modifier</span><br><span class="line">                .size(<span class="number">150.</span>dp)</span><br><span class="line">                .drawBehind &#123;</span><br><span class="line">                    rotate(degrees) &#123;</span><br><span class="line">                        drawCircle(</span><br><span class="line">                            brush = Brush.sweepGradient(colors = colors),</span><br><span class="line">                            style = Stroke(strokeWidth.toPx())</span><br><span class="line">                        )</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                .padding(strokeWidth / <span class="number">2</span>)</span><br><span class="line">                .clip(CircleShape)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼š<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/e014b20695c7a6cb8d5cdfd070086214.gif"></p>
<h3 id="AnimationSpec"><a href="#AnimationSpec" class="headerlink" title="AnimationSpec"></a>AnimationSpec</h3><p><strong>AnimationSpec</strong>ä¸»è¦æ˜¯ç”¨æ¥å¯¹åŠ¨ç”»è¿›è¡Œé…ç½®çš„ï¼Œå‰é¢è®¸å¤šä¾‹å­ä¸­éƒ½ä½¿ç”¨äº†ï¼Œç›®å‰Composeä¸­å¤§å¤šæ•°åŠ¨ç”»Apiéƒ½æ”¯æŒ<strong>AnimationSpec</strong>å‚æ•°æ¥å®šä¹‰åŠ¨ç”»æ•ˆæœ</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> alpha: <span class="built_in">Float</span> <span class="keyword">by</span> animateFloatAsState(</span><br><span class="line">   targetValue = <span class="keyword">if</span> (enabled) <span class="number">1f</span> <span class="keyword">else</span> <span class="number">0.5f</span>,</span><br><span class="line">   <span class="comment">// Configure the animation duration and easing.</span></span><br><span class="line">   animationSpec = tween(durationMillis = <span class="number">300</span>, easing = FastOutSlowInEasing)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>Composeæä¾›äº†å¤šç§AnimationSpecçš„å­ç±»</p>
<h4 id="springå¼¹ç°§åŠ¨ç”»"><a href="#springå¼¹ç°§åŠ¨ç”»" class="headerlink" title="springå¼¹ç°§åŠ¨ç”»"></a><strong>springå¼¹ç°§åŠ¨ç”»</strong></h4><p>ä½¿ç”¨<strong>spring</strong>ä¼šåˆ›å»ºä¸€ä¸ª<strong>SpringSpec</strong>å®ä¾‹ï¼Œå¯ä»¥ç”¨æ¥åˆ›å»ºä¸€ä¸ªåŸºäºç‰©ç†ç‰¹æ€§çš„å¼¹è·³åŠ¨ç”»ï¼Œå®ƒçš„åŠ¨ç”»ä¼°å€¼å°†åœ¨å½“å‰å€¼å’Œç›®æ ‡å€¼ä¹‹é—´æŒ‰ç…§å¼¹ç°§ç‰©ç†è¿åŠ¨è½¨è¿¹è¿›è¡Œå˜åŒ–ã€‚<strong>spring</strong>Â ç”¨ä½œå¾ˆå¤šåŠ¨ç”» APIï¼ˆå¦‚Â <strong>animate*AsState</strong>Â å’ŒÂ <strong>updateTransition</strong>ï¼‰çš„é»˜è®¤Â <strong>AnimationSpec</strong>ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> value <span class="keyword">by</span> animateFloatAsState(</span><br><span class="line">   targetValue = <span class="number">1f</span>,</span><br><span class="line">   animationSpec = spring(</span><br><span class="line">       dampingRatio = Spring.DampingRatioHighBouncy,</span><br><span class="line">       stiffness = Spring.StiffnessMedium</span><br><span class="line">   )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>spring</strong>æœ‰ä¸‰ä¸ªå‚æ•°<strong>dampingRatio</strong>ã€<strong>stiffness</strong>ã€<strong>visibilityThreshold</strong>Â å…¶ä¸­å‰ä¸¤ä¸ªå‚æ•°ä¸»è¦ç”¨æ¥æ§åˆ¶åŠ¨ç”»è·³åŠ¨æ•ˆæœçš„ï¼š</p>
<ul>
<li><strong>dampingRatio</strong>Â è¡¨ç¤ºå¼¹ç°§çš„<strong>é˜»å°¼æ¯”</strong>ï¼Œå³å¼¹ç°§çš„<strong>å¼¹æ€§</strong>ï¼Œ<strong>dampingRatioå€¼è¶Šå°å¼¹æ€§è¶Šå¤§ï¼ˆéœ‡åŠ¨å¹…åº¦è¶Šå¤§ï¼‰ï¼Œåä¹‹å¼¹æ€§è¶Šå°ï¼ˆdampingRatio&gt;&#x3D;0ï¼‰</strong><br>  <strong>dampingRatio</strong>é»˜è®¤å€¼æ˜¯<strong>Spring.DampingRatioNoBouncy</strong>, å³é»˜è®¤æ²¡æœ‰å¼¹æ€§ï¼Œç³»ç»Ÿé¢„å®šä¹‰çš„<strong>dampingRatio</strong>çš„å„ä¸ªå–å€¼åŠæ•ˆæœå¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> Spring &#123;</span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">val</span> DampingRatioHighBouncy = <span class="number">0.2f</span></span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">val</span> DampingRatioMediumBouncy = <span class="number">0.5f</span></span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">val</span> DampingRatioLowBouncy = <span class="number">0.75f</span></span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">val</span> DampingRatioNoBouncy = <span class="number">1f</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/8f83c91db4e303c1689a4ddf40d7c611.gif%23pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<ul>
<li><strong>stiffness</strong>è¡¨ç¤ºå¼¹ç°§çš„<strong>åˆšåº¦</strong>ï¼Œ<strong>å€¼è¶Šå¤§è¡¨ç¤ºåˆ°é™æ­¢çŠ¶æ€çš„é€Ÿåº¦è¶Šå¿«ï¼Œåä¹‹è¶Šæ…¢</strong>ã€‚é»˜è®¤å€¼ä¸ºÂ <strong>Spring.StiffnessMedium</strong>ã€‚<strong>ï¼ˆstiffness&gt;0ï¼‰</strong><br>  ç³»ç»Ÿé¢„å®šä¹‰çš„<strong>stiffness</strong>å¸¸é‡å€¼å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> Spring &#123;</span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">val</span> StiffnessHigh = <span class="number">10_000f</span></span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">val</span> StiffnessMedium = <span class="number">1500f</span></span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">val</span> StiffnessMediumLow = <span class="number">400f</span></span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">val</span> StiffnessLow = <span class="number">200f</span></span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">val</span> StiffnessVeryLow = <span class="number">50f</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>visibilityThreshold</strong>æ˜¯ç”±å¼€å‘è€…æŒ‡å®šä¸€ä¸ªé˜ˆå€¼ï¼Œå½“åŠ¨ç”»åˆ°è¾¾è¿™ä¸ªé˜ˆå€¼æ—¶ï¼ŒåŠ¨ç”»ç«‹å³åœæ­¢ã€‚å…¶ç±»å‹å’Œ<strong>targetValue</strong>ä¸€è‡´ã€‚</li>
</ul>
<h4 id="tweenè¡¥é—´åŠ¨ç”»"><a href="#tweenè¡¥é—´åŠ¨ç”»" class="headerlink" title="tweenè¡¥é—´åŠ¨ç”»"></a>tweenè¡¥é—´åŠ¨ç”»</h4><p>ä½¿ç”¨<strong>tween</strong>å¯ä»¥åˆ›å»ºä¸€ä¸ª<strong>TweenSpec</strong>å®ä¾‹ï¼Œ<strong>TweenSpec</strong>æ˜¯<strong>DurationBasedAnimationSpec</strong>çš„å­ç±»ã€‚<br><strong>TweenSpecå¿…é¡»æŒ‡å®šæ—¶é—´å‚æ•°</strong>ï¼Œ å®ƒå¿…é¡»åœ¨è§„å®šæ—¶é—´å†…å®ŒæˆåŠ¨ç”»ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> value <span class="keyword">by</span> animateFloatAsState(</span><br><span class="line">   targetValue = <span class="number">1f</span>,</span><br><span class="line">   animationSpec = tween(</span><br><span class="line">       durationMillis = <span class="number">300</span>,</span><br><span class="line">       delayMillis = <span class="number">50</span>,</span><br><span class="line">       easing = LinearOutSlowInEasing</span><br><span class="line">   )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>tween</strong>å¯ä»¥é€šè¿‡<strong>easing</strong>å‚æ•°æ¥æ§åˆ¶åŠ¨ç”»å˜åŒ–é€Ÿç‡</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…ˆåŠ é€Ÿåå‡é€Ÿ</span></span><br><span class="line"> <span class="keyword">val</span> FastOutSlowInEasing: Easing = CubicBezierEasing(<span class="number">0.4f</span>, <span class="number">0.0f</span>, <span class="number">0.2f</span>, <span class="number">1.0f</span>)</span><br><span class="line"> <span class="comment">// å…ˆåŒ€é€Ÿåå‡é€Ÿ</span></span><br><span class="line"> <span class="keyword">val</span> LinearOutSlowInEasing: Easing = CubicBezierEasing(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.2f</span>, <span class="number">1.0f</span>)</span><br><span class="line"> <span class="comment">// å…ˆåŠ é€ŸååŒ€é€Ÿ</span></span><br><span class="line"> <span class="keyword">val</span> FastOutLinearInEasing: Easing = CubicBezierEasing(<span class="number">0.4f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>)</span><br><span class="line"> <span class="comment">// ä¸€ç›´åŒ€é€Ÿ</span></span><br><span class="line"> <span class="keyword">val</span> LinearEasing: Easing = Easing &#123; fraction -&gt; fraction &#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>Easing</th>
<th>æ•ˆæœ</th>
</tr>
</thead>
<tbody><tr>
<td>FastOutSlowInEasing</td>
<td><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/ee03d83f714e3ab9e0276027a27d8e5f.gif%23pic_center" alt="FastOutSlowInEasing"></td>
</tr>
<tr>
<td>LinearOutSlowInEasing</td>
<td><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/d4dc663bf349864688e9b9799fd14424.gif%23pic_center" alt="LinearOutSlowInEasing"></td>
</tr>
<tr>
<td>FastOutLinearInEasing</td>
<td><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/2ec458b00490e541ff49c687a1a42976.gif%23pic_center" alt="FastOutLinearInEasing"></td>
</tr>
</tbody></table>
<p>ä»¥ä¸Šé¢„å®šä¹‰çš„<strong>Easing</strong>éƒ½æ˜¯é€šè¿‡<strong>CubicBezierEasing</strong>ä¸‰é˜¶è´å¡å°”æ›²çº¿å®ç°çš„ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰<strong>CubicBezierEasing</strong>ã€‚å¦‚éœ€è‡ªå®šä¹‰<strong>CubicBezierEasing</strong>å¯ä»¥å‚è€ƒç½‘ç«™Â <a target="_blank" rel="noopener" href="https://cubic-bezier.com/#.4,0,.2,1">cubic-bezier</a>Â æ¥è°ƒè¯•è‡ªå·±çš„å‚æ•°ï¼Œ å…¶ä¸­ï¼Œèµ·å§‹ç‚¹(0,0), ç»ˆç‚¹(1, 1), æ‰€ä»¥åªéœ€è¦æä¾›ä¸¤ä¸ªæ§åˆ¶ç‚¹çš„åæ ‡å³å¯ï¼Œä¹Ÿå°±æ˜¯<strong>CubicBezierEasing</strong>çš„å››ä¸ªå‚æ•°çš„å«ä¹‰ã€‚</p>
<h4 id="keyframeså…³é”®å¸§åŠ¨ç”»"><a href="#keyframeså…³é”®å¸§åŠ¨ç”»" class="headerlink" title="keyframeså…³é”®å¸§åŠ¨ç”»"></a>keyframeså…³é”®å¸§åŠ¨ç”»</h4><p><strong>keyframes</strong>Â å¯ä»¥æ›´ç²¾ç»†çš„æ§åˆ¶åŠ¨ç”»ï¼Œå®ƒå…è®¸åœ¨å¼€å§‹å’Œç»“æŸä¹‹é—´æ’å…¥å…³é”®å¸§èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ä¸èŠ‚ç‚¹ä¹‹é—´çš„åŠ¨ç”»è¿‡æ¸¡å¯ä»¥åº”ç”¨ä¸åŒæ•ˆæœã€‚</p>
<p>å¯¹äºå…¶ä¸­æ¯ä¸ªå…³é”®å¸§ï¼Œæ‚¨éƒ½å¯ä»¥æŒ‡å®šÂ <strong>Easing</strong>Â æ¥ç¡®å®šæ’å€¼æ›²çº¿ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> value <span class="keyword">by</span> animateFloatAsState(</span><br><span class="line">   targetValue = <span class="number">1f</span>,</span><br><span class="line">   animationSpec = keyframes &#123;</span><br><span class="line">       durationMillis = <span class="number">375</span></span><br><span class="line">       <span class="number">0.0f</span> at <span class="number">0</span> with LinearOutSlowInEasing <span class="comment">// 0msåˆå§‹å€¼ä¸º0f, å¼€å§‹ä½¿ç”¨LinearOutSlowInEasing</span></span><br><span class="line">       <span class="number">0.2f</span> at <span class="number">15</span> with FastOutLinearInEasing <span class="comment">// 15msè¾¾åˆ°0.2f, ä»15mså¼€å§‹ä½¿ç”¨FastOutLinearInEasing</span></span><br><span class="line">       <span class="number">0.4f</span> at <span class="number">75</span> <span class="comment">// 75msè¾¾åˆ°0.4f</span></span><br><span class="line">       <span class="number">0.4f</span> at <span class="number">225</span> <span class="comment">// 225msè¾¾åˆ°0.4f</span></span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>keyframes</strong>è¿”å›ä¸€ä¸ª<strong>KeyFrameSpec</strong>å®ä¾‹ï¼Œå®ƒä¹Ÿæ˜¯<strong>DurationBasedAnimationSpec</strong>çš„å­ç±»ï¼Œéœ€è¦åœ¨è§„å®šæ—¶é—´å†…å®ŒæˆåŠ¨ç”»ã€‚</p>
<p>å…³é”®å¸§èŠ‚ç‚¹çš„å®šä¹‰ç”±æ—¶é—´æˆ³ã€åŠ¨ç”»æ•°å€¼ã€åŠ¨ç”»æ•ˆæœç»„æˆã€‚</p>
<h4 id="repeatableå¾ªç¯åŠ¨ç”»"><a href="#repeatableå¾ªç¯åŠ¨ç”»" class="headerlink" title="repeatableå¾ªç¯åŠ¨ç”»"></a>repeatableå¾ªç¯åŠ¨ç”»</h4><p>ä½¿ç”¨<strong>repeatable</strong>å¯ä»¥åˆ›å»ºä¸€ä¸ª<strong>RepeatableSpec</strong>å®ä¾‹ã€‚<strong>repeatable</strong>Â åå¤è¿è¡ŒåŸºäºæ—¶é•¿çš„åŠ¨ç”»ï¼ˆä¾‹å¦‚Â <strong>tween</strong>Â æˆ–Â <strong>keyframes</strong>ï¼‰ï¼Œç›´è‡³è¾¾åˆ°æŒ‡å®šçš„è¿­ä»£è®¡æ•°ã€‚æ‚¨å¯ä»¥ä¼ é€’Â <strong>repeatMode</strong>Â å‚æ•°æ¥æŒ‡å®šåŠ¨ç”»æ˜¯ä»å¤´å¼€å§‹ (<strong>RepeatMode.Restart</strong>) è¿˜æ˜¯ä»ç»“å°¾å¼€å§‹ (<strong>RepeatMode.Reverse</strong>) é‡å¤æ’­æ”¾ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> value <span class="keyword">by</span> animateFloatAsState(</span><br><span class="line">   targetValue = <span class="number">1f</span>,</span><br><span class="line">   animationSpec = repeatable(</span><br><span class="line">       iterations = <span class="number">3</span>, <span class="comment">// é‡å¤æ’­æ”¾çš„æ¬¡æ•°</span></span><br><span class="line">       animation = tween(durationMillis = <span class="number">300</span>),</span><br><span class="line">       repeatMode = RepeatMode.Reverse</span><br><span class="line">   )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>RepeatMode.Reverse: å¾€è¿”æ‰§è¡Œï¼Œè¾¾åˆ°ç›®æ ‡å€¼åå†åŸè·¯è¿”å›åˆå§‹å€¼</li>
<li>RepeatMode.Restart: ä»å¤´æ‰§è¡Œï¼Œè¾¾åˆ°ç›®æ ‡å€¼åï¼Œå†é‡æ–°ä»åˆå§‹å€¼å¼€å§‹æ‰§è¡Œ</li>
</ul>
<h4 id="infiniteRepeatableæ— é™å¾ªç¯åŠ¨ç”»"><a href="#infiniteRepeatableæ— é™å¾ªç¯åŠ¨ç”»" class="headerlink" title="infiniteRepeatableæ— é™å¾ªç¯åŠ¨ç”»"></a>infiniteRepeatableæ— é™å¾ªç¯åŠ¨ç”»</h4><p><strong>infiniteRepeatable</strong>Â ä¸Â <strong>repeatable</strong>Â ç±»ä¼¼ï¼Œä½†å®ƒä¼šé‡å¤æ— é™æ¬¡çš„è¿­ä»£ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> value <span class="keyword">by</span> animateFloatAsState(</span><br><span class="line">   targetValue = <span class="number">1f</span>,</span><br><span class="line">   animationSpec = infiniteRepeatable(</span><br><span class="line">       animation = tween(durationMillis = <span class="number">300</span>),</span><br><span class="line">       repeatMode = RepeatMode.Reverse</span><br><span class="line">   )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="snapå¿«é—ªåŠ¨ç”»"><a href="#snapå¿«é—ªåŠ¨ç”»" class="headerlink" title="snapå¿«é—ªåŠ¨ç”»"></a>snapå¿«é—ªåŠ¨ç”»</h4><p><strong>snap</strong>åˆ›å»ºä¸€ä¸ª<strong>SnapSpec</strong>å®ä¾‹ï¼Œ<strong>snap</strong>Â æ˜¯ä¸€ç§ç‰¹æ®Šçš„Â <strong>AnimationSpec</strong>ï¼Œå®ƒä¼šç«‹å³å°†å€¼åˆ‡æ¢åˆ°ç›®æ ‡å€¼ã€‚æ²¡æœ‰ä¸­é—´è¿‡æ¸¡ï¼ŒåŠ¨ç”»ç¬é—´å®Œæˆã€‚</p>
<p>å¯ä»¥æŒ‡å®šÂ <strong>delayMillis</strong>Â æ¥è®¾ç½®å»¶è¿ŸåŠ¨ç”»çš„å¼€å§‹æ—¶é—´ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> value <span class="keyword">by</span> animateFloatAsState(</span><br><span class="line">   targetValue = <span class="number">1f</span>,</span><br><span class="line">   animationSpec = snap(delayMillis = <span class="number">50</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="åŠ¨ç”»å½¢å¼çš„çŸ¢é‡èµ„æº"><a href="#åŠ¨ç”»å½¢å¼çš„çŸ¢é‡èµ„æº" class="headerlink" title="åŠ¨ç”»å½¢å¼çš„çŸ¢é‡èµ„æº"></a>åŠ¨ç”»å½¢å¼çš„çŸ¢é‡èµ„æº</h3><p>å¦‚éœ€ä½¿ç”¨Â <strong>AnimatedVectorDrawable</strong>Â èµ„æºï¼Œè¯·ä½¿ç”¨Â <strong>animatedVectorResource</strong>Â åŠ è½½å¯ç»˜åˆ¶å¯¹è±¡æ–‡ä»¶ï¼Œå¹¶ä¼ å…¥Â <strong>boolean</strong>Â ä»¥åœ¨å¯ç»˜åˆ¶å¯¹è±¡çš„å¼€å§‹å’Œç»“æŸçŠ¶æ€ä¹‹é—´åˆ‡æ¢ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatedVectorDrawable</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> image = AnimatedImageVector.animatedVectorResource(R.drawable.ic_hourglass_animated)</span><br><span class="line">    <span class="keyword">var</span> atEnd <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">false</span>) &#125;</span><br><span class="line">    Image(</span><br><span class="line">        painter = rememberAnimatedVectorPainter(image, atEnd),</span><br><span class="line">        contentDescription = <span class="string">&quot;Timer&quot;</span>,</span><br><span class="line">        modifier = Modifier.clickable &#123;</span><br><span class="line">            atEnd = !atEnd</span><br><span class="line">        &#125;,</span><br><span class="line">        contentScale = ContentScale.Crop</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä½çº§åŠ¨ç”»API"><a href="#ä½çº§åŠ¨ç”»API" class="headerlink" title="ä½çº§åŠ¨ç”»API"></a>ä½çº§åŠ¨ç”»API</h2><p>å‰é¢æåŠçš„æ‰€æœ‰é«˜çº§åˆ«åŠ¨ç”» API éƒ½æ˜¯åœ¨ä½çº§åˆ«åŠ¨ç”» API çš„åŸºç¡€ä¸Šæ„å»ºè€Œæˆçš„ã€‚</p>
<p>animate*AsState å‡½æ•°æ˜¯æœ€ç®€å•çš„ APIï¼Œå¯å°†å³æ—¶å€¼å˜åŒ–å‘ˆç°ä¸ºåŠ¨ç”»å€¼ã€‚å®ƒç”± Animatable æä¾›æ”¯æŒï¼Œåè€…æ˜¯ä¸€ç§åŸºäºåç¨‹çš„ APIï¼Œç”¨äºä¸ºå•ä¸ªå€¼æ·»åŠ åŠ¨ç”»æ•ˆæœã€‚updateTransition å¯åˆ›å»ºè¿‡æ¸¡å¯¹è±¡ï¼Œç”¨äºç®¡ç†å¤šä¸ªåŠ¨ç”»å€¼ï¼Œå¹¶ä¸”æ ¹æ®çŠ¶æ€å˜åŒ–è¿è¡Œè¿™äº›å€¼ã€‚rememberInfiniteTransition ä¸å…¶ç±»ä¼¼ï¼Œä¸è¿‡ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªæ— é™è¿‡æ¸¡å¯¹è±¡ï¼Œä»¥ç®¡ç†å¤šä¸ªæ— é™æœŸè¿è¡Œçš„åŠ¨ç”»ã€‚æ‰€æœ‰è¿™äº› API éƒ½æ˜¯å¯ç»„åˆé¡¹ï¼ˆAnimatable é™¤å¤–ï¼‰ï¼Œè¿™æ„å‘³ç€è¿™äº›åŠ¨ç”»å¯ä»¥åœ¨éç»„åˆæœŸé—´åˆ›å»ºã€‚</p>
<p>æ‰€æœ‰è¿™äº› API éƒ½åŸºäºæ›´åŸºç¡€çš„ Animation APIã€‚è™½ç„¶å¤§å¤šæ•°åº”ç”¨ä¸ä¼šç›´æ¥ä¸ Animation äº’åŠ¨ï¼Œä½† Animation çš„æŸäº›è‡ªå®šä¹‰åŠŸèƒ½å¯ä»¥é€šè¿‡æ›´é«˜çº§åˆ«çš„ API è·å¾—ã€‚<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/f13713a4a9ffc78309e88ac2710c3c95.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h3 id="Animatable"><a href="#Animatable" class="headerlink" title="Animatable"></a>Animatable</h3><p><strong>Animatable</strong>Â æ˜¯ä¸€ä¸ªå€¼å®¹å™¨ï¼Œå®ƒçš„Â <strong>animateTo</strong>Â æ–¹æ³•å¯ä»¥æ ¹æ®æ•°å€¼çš„å˜åŒ–è®¾ç½®åŠ¨ç”»æ•ˆæœã€‚Â <strong>animate*AsState</strong>Â èƒŒåå°±æ˜¯åŸºäº<strong>Animatable</strong>çš„å®ç°ã€‚å®ƒå¯ç¡®ä¿ä¸€è‡´çš„è¿ç»­æ€§å’Œäº’æ–¥æ€§ï¼Œè¿™æ„å‘³ç€å€¼å˜åŒ–å§‹ç»ˆæ˜¯è¿ç»­çš„ï¼Œå¹¶ä¸”ä¼šå–æ¶ˆä»»ä½•å½“å‰æ­£åœ¨æ’­æ”¾çš„åŠ¨ç”»ã€‚</p>
<p><strong>Animatable</strong>Â çš„è®¸å¤šåŠŸèƒ½ï¼ˆåŒ…æ‹¬Â <strong>animateTo</strong>ï¼‰ä»¥<strong>æŒ‚èµ·å‡½æ•°</strong>çš„å½¢å¼æä¾›ã€‚è¿™æ„å‘³ç€ï¼Œå®ƒä»¬éœ€è¦åœ¨ä¸€ä¸ª<strong>åç¨‹ä½œç”¨åŸŸ</strong>å†…æ‰§è¡Œã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¯ä»¥æ­é…Â <strong>LaunchedEffect</strong>Â ä½¿ç”¨ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Start out gray and animate to green/red based on `ok`</span></span><br><span class="line"><span class="keyword">val</span> color = remember &#123; Animatable(Color.Gray) &#125;</span><br><span class="line">LaunchedEffect(ok) &#123;</span><br><span class="line">    color.animateTo(<span class="keyword">if</span> (ok) Color.Green <span class="keyword">else</span> Color.Red)</span><br><span class="line">&#125;</span><br><span class="line">Box(Modifier.fillMaxSize().background(color.value))</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç åˆ›å»ºäº†åˆå§‹å€¼ä¸ºÂ <code>Color.Gray</code>Â çš„Â <strong>Animatable</strong>Â å®ä¾‹ã€‚æ ¹æ®å¸ƒå°”æ ‡è®°Â <code>ok</code>Â çš„å€¼ï¼Œé¢œè‰²å°†ä»¥åŠ¨ç”»å½¢å¼å‘ˆç°Â <code>Color.Green</code>Â æˆ–Â <code>Color.Red</code>ã€‚å¯¹è¯¥å¸ƒå°”å€¼çš„ä»»ä½•åç»­æ›´æ”¹éƒ½ä¼šä½¿åŠ¨ç”»å¼€å§‹ä½¿ç”¨å¦ä¸€ç§é¢œè‰²ã€‚</p>
<p>å¦‚æœæ­£åœ¨æ’­æ”¾åŠ¨ç”»çš„ä¸­é€”ä¿®æ”¹äº†<code>ok</code>å€¼ï¼Œç³»ç»Ÿä¼šç«‹å³ä¸­æ–­å–æ¶ˆè¯¥åŠ¨ç”»ï¼Œå¹¶ä¸”ä»å½“å‰å¿«ç…§å€¼å¼€å§‹æ–°çš„åŠ¨ç”»ã€‚</p>
<p>ä¸Â <strong>animate*AsState</strong>Â ç›¸æ¯”ï¼Œä½¿ç”¨Â <strong>Animatable</strong>Â å¯ä»¥ç›´æ¥å¯¹ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œæ›´ç²¾ç»†çš„æ§åˆ¶ï¼š</p>
<ul>
<li>1ï¼‰<strong>Animatable</strong>Â <strong>çš„åˆå§‹å€¼å¯ä»¥ä¸ç¬¬ä¸€ä¸ªç›®æ ‡å€¼ä¸åŒ</strong>ã€‚ä¾‹å¦‚ï¼Œä¸Šé¢çš„ä»£ç ç¤ºä¾‹é¦–å…ˆæ˜¾ç¤ºä¸€ä¸ªç°è‰²ï¼Œç„¶åç›®æ ‡å€¼ä¸ºç»¿è‰²æˆ–çº¢è‰²ã€‚</li>
<li>2ï¼‰<strong>Animatable å¯¹å†…å®¹å€¼æä¾›æ›´å¤šæ“ä½œï¼ˆå³ snapTo å’Œ animateDecayï¼‰</strong>ã€‚<strong>snapTo</strong>Â å¯ç«‹å³å°†å½“å‰å€¼è®¾ä¸ºç›®æ ‡å€¼ï¼Œè·³è¿‡ä¸­é—´è¿‡æ¸¡å€¼ã€‚å¦‚æœåŠ¨ç”»æœ¬èº«ä¸æ˜¯å”¯ä¸€çš„å¯ä¿¡æ¥æºï¼Œä¸”å¿…é¡»ä¸å…¶ä»–çŠ¶æ€ï¼ˆå¦‚è§¦æ‘¸äº‹ä»¶ï¼‰åŒæ­¥ï¼Œè¯¥å‡½æ•°å°±éå¸¸æœ‰ç”¨ã€‚<strong>animateDecay</strong>Â ç”¨äºè¡°å‡åŠ¨ç”»ï¼ˆä»ç»™å®šé€Ÿåº¦å˜æ…¢ï¼‰ï¼Œåœ¨flingç­‰åœºæ™¯ä¸­éå¸¸æœ‰ç”¨ã€‚</li>
</ul>
<p>ä½¿ç”¨<strong>Animatable</strong>å®ç°å‰é¢é€šè¿‡<strong>animatexxxAsState</strong>æ–¹å¼å®ç°çš„çº¢å¿ƒæŒ‰é’®çš„ä¾‹å­ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatableExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> changeSize <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">false</span>) &#125;</span><br><span class="line">    <span class="keyword">var</span> changeColor <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">false</span>) &#125;</span><br><span class="line">    <span class="keyword">val</span> buttonSize = remember &#123; Animatable(<span class="number">24.</span>dp, Dp.VectorConverter) &#125;</span><br><span class="line">    <span class="keyword">val</span> buttonColor = remember &#123; Animatable(Color.Gray) &#125;</span><br><span class="line">    LaunchedEffect(changeSize, changeColor) &#123;</span><br><span class="line">        <span class="comment">// æ³¨æ„ï¼Œå› ä¸ºanimateToæ˜¯æŒ‚èµ·å‡½æ•°ï¼Œä¼šé˜»å¡å½“å‰åç¨‹ï¼Œ</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥è¿™é‡Œå¿…é¡»åˆ†åˆ«æ”¾åœ¨launchä¸­å¯åŠ¨å­åç¨‹æ‰§è¡Œï¼Œå¦åˆ™åŠ¨ç”»æ•ˆæœæ˜¯é¡ºåºæ‰§è¡Œçš„</span></span><br><span class="line">        <span class="comment">// æˆ–è€…ï¼Œä¹Ÿå¯ä»¥åˆ†å¼€æ”¾åœ¨ä¸¤ä¸ªLaunchedEffecté‡Œæ‰§è¡Œ</span></span><br><span class="line">        launch &#123; buttonSize.animateTo(<span class="keyword">if</span>(changeSize) <span class="number">32.</span>dp <span class="keyword">else</span> <span class="number">24.</span>dp) &#125;</span><br><span class="line">        launch &#123; buttonColor.animateTo(<span class="keyword">if</span>(changeColor) Color.Red <span class="keyword">else</span> Color.Gray) &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (buttonSize.value == <span class="number">32.</span>dp) &#123;</span><br><span class="line">        changeSize = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    Box(</span><br><span class="line">        Modifier.fillMaxSize(),</span><br><span class="line">        contentAlignment = Alignment.Center</span><br><span class="line">    ) &#123;</span><br><span class="line">        IconButton(</span><br><span class="line">            onClick = &#123;</span><br><span class="line">                changeSize = <span class="literal">true</span></span><br><span class="line">                changeColor = !changeColor</span><br><span class="line">            &#125;</span><br><span class="line">        ) &#123;</span><br><span class="line">            Icon(Icons.Rounded.Favorite, <span class="literal">null</span>,</span><br><span class="line">                Modifier.size(buttonSize.value), tint = buttonColor.value)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼š<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/c20d41aa8bbf3833ebf86484469fdf06.gif"></p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼šç”±äº<strong>animateTo</strong>æ˜¯<strong>æŒ‚èµ·å‡½æ•°</strong>ï¼Œä¼šé˜»å¡å½“å‰åç¨‹ä½œç”¨åŸŸèŒƒå›´çš„æ‰§è¡Œæµç¨‹ï¼Œæ‰€ä»¥è¿™é‡Œå¿…é¡»åˆ†åˆ«æ”¾åœ¨<strong>launch</strong>ä¸­å¯åŠ¨å­åç¨‹æ‰§è¡Œï¼Œè¿™æ ·æ‰èƒ½ä½¿å¾—äºŒè€…å¹¶è¡ŒåŒæ—¶æ‰§è¡Œï¼Œå¦åˆ™å¦‚æœç›´æ¥å°†ä¸¤ä¸ªanimateToå…ˆåè°ƒç”¨ï¼Œé‚£ä¹ˆæœ€ç»ˆåŠ¨ç”»æ•ˆæœå°†æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œå¯ä»¥å°†ä¸Šé¢ä»£ç ä¸­çš„launchéƒ½å»æ‰ï¼Œç„¶åè¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼Œå¯ä»¥å¯¹æ¯”ä¸€ä¸‹æœ‰ä»€ä¹ˆä¸åŒï¼š<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/19d7586be3281bd406aafe10ec00b04d.gif"></p>
<p>ä¸Šé¢ä»£ç ä¸­åˆ›å»º<code>buttonSize</code>æ—¶ï¼Œä¼ å…¥äº†å†…ç½®çš„<code>TwoWayConverter</code>è½¬æ¢å™¨<code>Dp.VectorConverter</code>ï¼ŒÂ <code>Animatable</code>å¯ç›´æ¥ä¼ å…¥<strong>Float</strong>æˆ–<strong>Color</strong>ç±»å‹çš„å€¼ï¼Œå½“ä¼ å…¥å…¶ä»–ç±»å‹æ—¶éœ€è¦æŒ‡å®šå¯¹åº”çš„<strong>TwoWayConverter</strong>è½¬æ¢å™¨ã€‚</p>
<p>å¦å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>LaunchedEffect</strong>ä¼šåœ¨<strong>onActive</strong>æ—¶è¢«æ‰§è¡Œï¼Œæœ€å¥½ç¡®ä¿<strong>LaunchedEffect</strong>ä¸­<strong>animateTo</strong>çš„é»˜è®¤å€¼ä¸åˆ›å»º<strong>Animatable</strong>æ—¶çš„é»˜è®¤å€¼ç›¸åŒï¼Œä¸ç„¶åœ¨é¦–æ¬¡æ¸²æŸ“é¡µé¢æ—¶å°±ä¼šå‘ˆç°è¿‡æ¸¡åŠ¨ç”»ï¼ˆå½“ç„¶å¦‚æœè¿™å°±æ˜¯ä½ é¢„æœŸçš„éœ€æ±‚ï¼Œé‚£å°±è¿™æ ·åšï¼‰</p>
<h4 id="ç›‘å¬åŠ¨ç”»çŠ¶æ€å˜åŒ–å€¼"><a href="#ç›‘å¬åŠ¨ç”»çŠ¶æ€å˜åŒ–å€¼" class="headerlink" title="ç›‘å¬åŠ¨ç”»çŠ¶æ€å˜åŒ–å€¼"></a>ç›‘å¬åŠ¨ç”»çŠ¶æ€å˜åŒ–å€¼</h4><p><strong>animateTo</strong>å¯ä»¥ä¼ ä¸€ä¸ªÂ <strong>lambda</strong>å›è°ƒå‡½æ•°æ¥è·å¾—åŠ¨ç”»çŠ¶æ€å€¼çš„å˜åŒ–ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">buttonColor.animateTo(<span class="keyword">if</span>(changeColor) Color.Red <span class="keyword">else</span> Color.Gray) &#123;</span><br><span class="line">   println(value) <span class="comment">// ç›‘å¬åŠ¨ç”»çŠ¶æ€å€¼çš„å˜åŒ–</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="åœæ­¢åŠ¨ç”»"><a href="#åœæ­¢åŠ¨ç”»" class="headerlink" title="åœæ­¢åŠ¨ç”»"></a>åœæ­¢åŠ¨ç”»</h4><p>è°ƒç”¨Â <strong>animation.stop()</strong>Â å¯ä»¥ä¸»åŠ¨åœæ­¢åŠ¨ç”»ï¼Œä½†è¿™æ˜¯ä¸€ä¸ª<strong>æŒ‚èµ·å‡½æ•°</strong>ï¼Œå› æ­¤åŒæ ·éœ€è¦åœ¨ä¸€ä¸ªåç¨‹ä½œç”¨åŸŸä¸­æ‰§è¡Œå®ƒã€‚</p>
<p><strong>animation.updateBounds()<strong>å¯ä»¥æŒ‡å®šè¾¹ç•ŒèŒƒå›´ä¸Šä¸‹ç•Œï¼ˆæ˜¯æŒ‡åŠ¨ç”»çŠ¶æ€å€¼çš„åŒºé—´èŒƒå›´ï¼‰å½“è¾¾åˆ°è®¾ç½®çš„</strong>upperBound</strong>æˆ–<strong>lowerBound</strong>æ—¶ä¹Ÿä¼šä¼šåœæ­¢åŠ¨ç”»ï¼Œä½†è¿™æ˜¯å±äºæ­£å¸¸ç¬¦åˆé¢„æœŸçš„åœæ­¢ã€‚</p>
<p>è®¾ç½®updateBounds()ä¹‹åï¼Œè¿˜å¯ä»¥æ ¹æ®åŠ¨ç”»ç»“æœè¿”å›å€¼æ‰§è¡Œåç»­é€»è¾‘ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> result = buttonSize.animateTo(..)</span><br><span class="line"><span class="keyword">if</span> (result.endReason == AnimationEndReason.BoundReached) &#123;</span><br><span class="line">    buttonSize.animateTo(...) <span class="comment">// ä¾‹å¦‚å¯ä»¥åå‘æ‰§è¡ŒåŠ¨ç”»</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯ï¼Œå½“ä½¿ç”¨Â <strong>Animatable.animateTo()</strong>Â åœ¨æ‰§è¡ŒåŠ¨ç”»è¿‡ç¨‹ä¸­ï¼Œæœ‰äººæ›´æ–°äº†å…¶ä¾èµ–çš„çŠ¶æ€å€¼ï¼Œåˆ™åŠ¨ç”»ä¼šè¢«ç«‹å³ä¸­æ–­è€Œå–æ¶ˆæ‰ã€‚</p>
<h3 id="Animation"><a href="#Animation" class="headerlink" title="Animation"></a>Animation</h3><p><strong>Animation</strong>Â æ˜¯å¯ç”¨çš„æœ€ä½çº§åˆ«çš„ Animation APIã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„è®¸å¤šåŠ¨ç”»éƒ½æ˜¯åŸºäºAnimation æ„å»ºçš„ã€‚</p>
<p><strong>Animation</strong>Â å­ç±»å‹æœ‰ä¸¤ç§ï¼š<strong>TargetBasedAnimation</strong>Â å’ŒÂ <strong>DecayAnimation</strong>ã€‚</p>
<p><strong>Animation åªèƒ½ç”¨äºæ‰‹åŠ¨æ§åˆ¶åŠ¨ç”»çš„æ—¶é—´</strong>ã€‚<strong>Animation</strong>Â æ˜¯<strong>æ— çŠ¶æ€</strong>çš„ï¼Œå®ƒæ²¡æœ‰ä»»ä½•ç”Ÿå‘½å‘¨æœŸæ¦‚å¿µã€‚å®ƒå……å½“æ›´é«˜çº§åˆ« API ä½¿ç”¨çš„åŠ¨ç”»è®¡ç®—å¼•æ“ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šé™¤ééœ€è¦æ‰‹åŠ¨æ§åˆ¶æ—¶é—´ï¼Œå¦åˆ™é€šå¸¸å»ºè®®ä½¿ç”¨åŸºäºè¿™äº›ç±»æ„å»ºçš„æ›´é«˜çº§åˆ«åŠ¨ç”» APIã€‚</p>
</blockquote>
<h4 id="TargetBasedAnimation"><a href="#TargetBasedAnimation" class="headerlink" title="TargetBasedAnimation"></a>TargetBasedAnimation</h4><p><strong>TargetBasedAnimation</strong>Â å¯ä»¥ç›´æ¥è®©æ‚¨è‡ªå·±<strong>æ§åˆ¶åŠ¨ç”»çš„æ’­æ”¾æ—¶é—´</strong>ã€‚<br>åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œ<strong>TargetAnimation</strong>Â çš„æ’­æ”¾æ—¶é—´å°†æ ¹æ®Â <strong>withFrameNanos</strong>Â æä¾›çš„å¸§æ—¶é—´æ‰‹åŠ¨æ§åˆ¶ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> anim = remember &#123;</span><br><span class="line">    TargetBasedAnimation(</span><br><span class="line">        animationSpec = tween(<span class="number">200</span>),</span><br><span class="line">        typeConverter = <span class="built_in">Float</span>.VectorConverter,</span><br><span class="line">        initialValue = <span class="number">200f</span>,</span><br><span class="line">        targetValue = <span class="number">1000f</span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> playTime <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">0L</span>) &#125;</span><br><span class="line"></span><br><span class="line">LaunchedEffect(anim) &#123;</span><br><span class="line">    <span class="keyword">val</span> startTime = withFrameNanos &#123; it &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        playTime = withFrameNanos &#123; it &#125; - startTime</span><br><span class="line">        <span class="keyword">val</span> animationValue = anim.getValueFromNanos(playTime)</span><br><span class="line">    &#125; <span class="keyword">while</span> (someCustomCondition())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="DecayAnimation"><a href="#DecayAnimation" class="headerlink" title="DecayAnimation"></a>DecayAnimation</h4><p>ä¸Â <strong>TargetBasedAnimation</strong>Â ä¸åŒï¼Œ<strong>DecayAnimation</strong>Â ä¸éœ€è¦æä¾›Â <strong>targetValue</strong>ï¼Œè€Œæ˜¯æ ¹æ®èµ·å§‹æ¡ä»¶ï¼ˆç”±Â <strong>initialVelocity</strong>Â å’ŒÂ <strong>initialValue</strong>Â è®¾ç½®ï¼‰ä»¥åŠæ‰€æä¾›çš„Â <strong>DecayAnimationSpec</strong>Â è®¡ç®—å…¶Â <strong>targetValue</strong>ã€‚</p>
<p>è¡°å‡åŠ¨ç”»é€šå¸¸åœ¨å¿«æ»‘æ‰‹åŠ¿ä¹‹åä½¿ç”¨ï¼Œç”¨äºä½¿å…ƒç´ å‡é€Ÿå¹¶åœæ­¢ã€‚åŠ¨ç”»é€Ÿåº¦ä»Â <strong>initialVelocityVector</strong>Â è®¾ç½®çš„å€¼å¼€å§‹ï¼Œç„¶åé€æ¸å˜æ…¢ã€‚</p>
<h2 id="æ‰‹åŠ¿å’ŒåŠ¨ç”»"><a href="#æ‰‹åŠ¿å’ŒåŠ¨ç”»" class="headerlink" title="æ‰‹åŠ¿å’ŒåŠ¨ç”»"></a>æ‰‹åŠ¿å’ŒåŠ¨ç”»</h2><p>ä¸å•ç‹¬å¤„ç†åŠ¨ç”»ç›¸æ¯”ï¼Œå½“æˆ‘ä»¬å¤„ç†è§¦æ‘¸äº‹ä»¶å’ŒåŠ¨ç”»æ—¶ï¼Œå¿…é¡»è€ƒè™‘å‡ ä¸ªäº‹é¡¹ã€‚<br>é¦–å…ˆï¼Œå½“è§¦æ‘¸äº‹ä»¶å¼€å§‹æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ä¸­æ–­æ­£åœ¨æ’­æ”¾çš„åŠ¨ç”»ï¼Œå› ä¸ºç”¨æˆ·äº’åŠ¨åº”å½“å…·æœ‰æœ€é«˜ä¼˜å…ˆçº§ã€‚</p>
<p>åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨Â <strong>Animatable</strong>Â è¡¨ç¤ºåœ†å½¢ç»„ä»¶çš„åç§»ä½ç½®ã€‚è§¦æ‘¸äº‹ä»¶ç”±Â <strong>pointerInput</strong>Â ä¿®é¥°ç¬¦å¤„ç†ã€‚</p>
<p>å½“æ£€æµ‹åˆ°æ–°çš„ç‚¹æŒ‰äº‹ä»¶æ—¶ï¼Œæˆ‘ä»¬å°†è°ƒç”¨Â <strong>animateTo</strong>Â ä»¥å°†åç§»å€¼é€šè¿‡åŠ¨ç”»è¿‡æ¸¡åˆ°ç‚¹æŒ‰ä½ç½®ã€‚åœ¨åŠ¨ç”»æ’­æ”¾æœŸé—´ä¹Ÿå¯èƒ½å‘ç”Ÿç‚¹æŒ‰äº‹ä»¶ã€‚</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<strong>animateTo</strong>Â ä¼šä¸­æ–­æ­£åœ¨æ’­æ”¾çš„åŠ¨ç”»ï¼Œå¯åŠ¨åŠ¨ç”»ä»¥è¿‡æ¸¡åˆ°æ–°çš„ç›®æ ‡ä½ç½®ï¼ŒåŒæ—¶ä¿æŒè¢«ä¸­æ–­çš„åŠ¨ç”»çš„é€Ÿåº¦ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressLint(<span class="string">&quot;ReturnFromAwaitPointerEventScope&quot;</span>)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">GestureWithAnimation</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> offset = remember &#123; Animatable(Offset(<span class="number">0f</span>, <span class="number">0f</span>), Offset.VectorConverter) &#125;</span><br><span class="line">    Box(Modifier</span><br><span class="line">            .fillMaxSize()</span><br><span class="line">            .pointerInput(<span class="built_in">Unit</span>) &#123;</span><br><span class="line">                coroutineScope &#123;</span><br><span class="line">                    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                        <span class="comment">// Detect a tap event and obtain its position.</span></span><br><span class="line">                        <span class="keyword">val</span> position = awaitPointerEventScope &#123; awaitFirstDown().position &#125;</span><br><span class="line">                        <span class="comment">// Animate to the tap position.</span></span><br><span class="line">                        launch &#123; offset.animateTo(position) &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    ) &#123;</span><br><span class="line">        Circle(Modifier.offset &#123; offset.value.toIntOffset() &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">Circle</span><span class="params">(modifier: <span class="type">Modifier</span> = Modifier)</span></span> &#123;</span><br><span class="line">    Box(modifier.size(<span class="number">100.</span>dp).clip(CircleShape).background(Color.Red))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> Offset.<span class="title">toIntOffset</span><span class="params">()</span></span> = IntOffset(x.roundToInt(), y.roundToInt())</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼š<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/2bff1b4082cb0bb3005c7d82fb8bef74.gif"></p>
<p>å¦ä¸€ç§å¸¸è§æ¨¡å¼æ˜¯éœ€è¦å°†åŠ¨ç”»å€¼ä¸æ¥è‡ªè§¦æ‘¸äº‹ä»¶ï¼ˆä¾‹å¦‚æ‹–åŠ¨ï¼‰çš„å€¼åŒæ­¥ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä»¥Â <strong>Modifier</strong>Â çš„å½¢å¼ï¼ˆè€Œä¸æ˜¯ä½¿ç”¨Â <strong>SwipeToDismiss</strong>Â å¯ç»„åˆé¡¹ï¼‰å®ç°çš„â€œ<strong>æ»‘åŠ¨å…³é—­</strong>â€ã€‚è¯¥å…ƒç´ çš„æ°´å¹³åç§»é‡è¡¨ç¤ºä¸ºÂ <strong>Animatable</strong>ã€‚æ­¤ API å…·æœ‰å¯ç”¨äºæ‰‹åŠ¿åŠ¨ç”»çš„ç‰¹å¾ã€‚å…¶å€¼å¯ç”±è§¦æ‘¸äº‹ä»¶å’ŒåŠ¨ç”»æ›´æ”¹ã€‚æ”¶åˆ°è§¦æ‘¸äº‹ä»¶æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡Â <strong>stop</strong>Â æ–¹æ³•åœæ­¢Â <strong>Animatable</strong>ï¼Œä»¥ä¾¿æ‹¦æˆªä»»ä½•æ­£åœ¨æ’­æ”¾çš„åŠ¨ç”»ã€‚</p>
<p>åœ¨æ‹–åŠ¨äº‹ä»¶æœŸé—´ï¼Œæˆ‘ä»¬ä½¿ç”¨Â <strong>snapTo</strong>Â å°†Â <strong>Animatable</strong>Â å€¼æ›´æ–°ä¸ºä»è§¦æ‘¸äº‹ä»¶è®¡ç®—å¾—å‡ºçš„å€¼ã€‚å¯¹äºå¿«é€Ÿæ»‘åŠ¨ï¼Œ<strong>Compose</strong>Â å¯æä¾›Â <strong>VelocityTracker</strong>Â æ¥è®°å½•æ‹–åŠ¨äº‹ä»¶å¹¶è®¡ç®—é€Ÿåº¦ã€‚é€Ÿåº¦å¯ç›´æ¥é¦ˆé€è‡³æŠ•æ·åŠ¨ç”»çš„Â <strong>animateDecay</strong>ã€‚å¦‚éœ€å°†åç§»å€¼æ»‘å›åŸå§‹ä½ç½®ï¼Œå¯ä½¿ç”¨Â <strong>animateTo</strong>Â æ–¹æ³•æŒ‡å®šÂ <strong>0f</strong>Â çš„ç›®æ ‡åç§»å€¼ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressLint(<span class="string">&quot;MultipleAwaitPointerEventScopes&quot;</span>, <span class="string">&quot;ReturnFromAwaitPointerEventScope&quot;</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Modifier.<span class="title">swipeToDismiss</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    onDismissed: () -&gt; <span class="type">Unit</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: Modifier = composed &#123;</span><br><span class="line">    <span class="keyword">val</span> offsetX = remember &#123; Animatable(<span class="number">0f</span>) &#125;</span><br><span class="line">    pointerInput(<span class="built_in">Unit</span>) &#123;</span><br><span class="line">        <span class="comment">// Used to calculate fling decay.</span></span><br><span class="line">        <span class="keyword">val</span> decay = splineBasedDecay&lt;<span class="built_in">Float</span>&gt;(<span class="keyword">this</span>)</span><br><span class="line">        <span class="comment">// Use suspend functions for touch events and the Animatable.</span></span><br><span class="line">        coroutineScope &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="comment">// Detect a touch down event.</span></span><br><span class="line">                <span class="keyword">val</span> pointerId = awaitPointerEventScope &#123; awaitFirstDown().id &#125;</span><br><span class="line">                <span class="keyword">val</span> velocityTracker = VelocityTracker()</span><br><span class="line">                <span class="comment">// Stop any ongoing animation.</span></span><br><span class="line">                offsetX.stop()</span><br><span class="line">                awaitPointerEventScope &#123;</span><br><span class="line">                    horizontalDrag(pointerId) &#123; change -&gt;</span><br><span class="line">                        <span class="comment">// Update the animation value with touch events.</span></span><br><span class="line">                        launch &#123; offsetX.snapTo(offsetX.value + change.positionChange().x) &#125;</span><br><span class="line">                        velocityTracker.addPosition(</span><br><span class="line">                            change.uptimeMillis,</span><br><span class="line">                            change.position</span><br><span class="line">                        )</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// No longer receiving touch events. Prepare the animation.</span></span><br><span class="line">                <span class="keyword">val</span> velocity = velocityTracker.calculateVelocity().x</span><br><span class="line">                <span class="keyword">val</span> targetOffsetX = decay.calculateTargetValue(offsetX.value, velocity)</span><br><span class="line">                <span class="comment">// The animation stops when it reaches the bounds.</span></span><br><span class="line">                offsetX.updateBounds(</span><br><span class="line">                    lowerBound = -size.width.toFloat(),</span><br><span class="line">                    upperBound = size.width.toFloat()</span><br><span class="line">                )</span><br><span class="line">                launch &#123;</span><br><span class="line">                    <span class="keyword">if</span> (targetOffsetX.absoluteValue &lt;= size.width) &#123;</span><br><span class="line">                        <span class="comment">// Not enough velocity; Slide back.</span></span><br><span class="line">                        offsetX.animateTo(argetValue = <span class="number">0f</span>,initialVelocity = velocity)</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// The element was swiped away.</span></span><br><span class="line">                        offsetX.animateDecay(velocity, decay)</span><br><span class="line">                        onDismissed()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.offset &#123; IntOffset(offsetX.value.roundToInt(), <span class="number">0</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">SwipeToDismissItem</span><span class="params">(color: <span class="type">Color</span> = Color.Red)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> isDismissed <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">false</span>) &#125;</span><br><span class="line">    <span class="keyword">if</span> (!isDismissed) &#123;</span><br><span class="line">        Box(</span><br><span class="line">            Modifier</span><br><span class="line">                .swipeToDismiss &#123; isDismissed = <span class="literal">true</span> &#125;</span><br><span class="line">                .fillMaxWidth()</span><br><span class="line">                .height(<span class="number">100.</span>dp)</span><br><span class="line">                .background(color)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">SwipeToDismissAnimationExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column &#123;</span><br><span class="line">        repeat(<span class="number">7</span>) &#123;</span><br><span class="line">            SwipeToDismissItem(color = colors[it % colors.size])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼š<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/30c5b27114b753fe96c6a004bac93773.gif"></p>
<h2 id="åˆ—è¡¨åŠ¨ç”»"><a href="#åˆ—è¡¨åŠ¨ç”»" class="headerlink" title="åˆ—è¡¨åŠ¨ç”»"></a>åˆ—è¡¨åŠ¨ç”»</h2><p>ç›®å‰å®˜æ–¹ä»…æ”¯æŒå¯¹LazyColumn&#x2F;LazyRowç­‰å»¶æ—¶åˆ—è¡¨é‡æ’åºçš„æ—¶å€™åšåŠ¨ç”»æ•ˆæœï¼Œå¯ä»¥ä½¿ç”¨<code>Modifier.animateItemPlacement()</code>æ¥å®ç°ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalFoundationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LazyColumnListAnimation</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> list <span class="keyword">by</span> remember &#123; mutableStateOf((<span class="string">&#x27;A&#x27;</span>..<span class="string">&#x27;Z&#x27;</span>).toList()) &#125;</span><br><span class="line">    LazyColumn(</span><br><span class="line">        Modifier.fillMaxWidth(),</span><br><span class="line">        contentPadding = PaddingValues(<span class="number">35.</span>dp),</span><br><span class="line">        verticalArrangement = Arrangement.spacedBy(<span class="number">10.</span>dp)</span><br><span class="line">    ) &#123;</span><br><span class="line">        item &#123;</span><br><span class="line">            Button(onClick = &#123; list = list.shuffled() &#125;) &#123;</span><br><span class="line">                Text(<span class="string">&quot;Shuffle&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        items(list, key = &#123; it &#125;) &#123;</span><br><span class="line">            CardContent(</span><br><span class="line">                <span class="string">&quot;Item <span class="variable">$it</span>&quot;</span>,</span><br><span class="line">                modifier = Modifier.animateItemPlacement(),</span><br><span class="line">                Color.Blue,</span><br><span class="line">                Color.White</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼š<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/27d5ff6ca32377f45583a9ca508d8eaf.gif"></p>
<p>è™½ç„¶å®˜æ–¹ç›®å‰å¯¹LazyListåˆ—è¡¨æ·»åŠ å’Œåˆ é™¤Itemé¡¹æ—¶ï¼Œæ²¡æœ‰å¯æ”¯æŒçš„åŠ¨ç”»Apiï¼Œä½†æ˜¯å¦‚æœä½ æœ‰éœ€æ±‚ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å‰é¢æä¾›çš„Apiæ¥å®ç°ï¼Œå¦‚å¯ä»¥ä½¿ç”¨<strong>AnimatedVisibility</strong>ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ListItemAnimationComponent</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> personList = getPersonList()</span><br><span class="line">    <span class="keyword">val</span> deletedPersonList = remember &#123; mutableStateListOf&lt;Person&gt;() &#125;</span><br><span class="line">    LazyColumn(</span><br><span class="line">        modifier = Modifier.fillMaxWidth()</span><br><span class="line">    ) &#123;</span><br><span class="line">        itemsIndexed(items = personList) &#123; index, person -&gt;</span><br><span class="line">            AnimatedVisibility(</span><br><span class="line">                visible = !deletedPersonList.contains(person),</span><br><span class="line">                enter = expandVertically(),</span><br><span class="line">                exit = shrinkVertically(animationSpec = tween(<span class="number">1000</span>))</span><br><span class="line">            ) &#123;</span><br><span class="line">                Card(</span><br><span class="line">                    shape = RoundedCornerShape(<span class="number">4.</span>dp),</span><br><span class="line">                    backgroundColor = colors[index % colors.size],</span><br><span class="line">                    modifier = Modifier.fillParentMaxWidth()</span><br><span class="line">                ) &#123;</span><br><span class="line">                    Row(</span><br><span class="line">                        modifier = Modifier.fillParentMaxWidth(),</span><br><span class="line">                        horizontalArrangement = Arrangement.SpaceBetween</span><br><span class="line">                    ) &#123;</span><br><span class="line">                        Text(</span><br><span class="line">                            person.name,</span><br><span class="line">                            style = TextStyle(</span><br><span class="line">                                color = Color.Black,</span><br><span class="line">                                fontSize = <span class="number">20.</span>sp,</span><br><span class="line">                                textAlign = TextAlign.Center</span><br><span class="line">                            ),</span><br><span class="line">                            modifier = Modifier.padding(<span class="number">16.</span>dp)</span><br><span class="line">                        )</span><br><span class="line">                        IconButton(onClick = &#123; deletedPersonList.add(person) &#125;) &#123;</span><br><span class="line">                            Icon(</span><br><span class="line">                                imageVector = Icons.Filled.Delete,</span><br><span class="line">                                contentDescription = <span class="string">&quot;Delete&quot;</span></span><br><span class="line">                            )</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ•ˆæœï¼š<br><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/d768744796ce6219af2e96168d09bbbd.gif"></p>
<h2 id="MotionLayoutåŠ¨ç”»"><a href="#MotionLayoutåŠ¨ç”»" class="headerlink" title="MotionLayoutåŠ¨ç”»"></a>MotionLayoutåŠ¨ç”»</h2><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡<strong>Compose</strong>ç‰ˆæœ¬çš„<strong>Constraintlayout</strong>ä¾èµ–åº“å®ç°ä¸€ç§<strong>MotionLayout</strong>è”åŠ¨æ•ˆæœçš„åŠ¨ç”»ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/9cba961b034e068e4b9dcd4ba4bda580.gif"></p>
<p>é›†æˆæ­¥éª¤ï¼š</p>
<ul>
<li>1.ç¡®ä¿<code>app/build.gradle</code>ä¸­æ·»åŠ äº†<code>constraintlayout-compose</code>ä¾èµ–åº“</li>
<li><code>implementation &quot;androidx.constraintlayout:constraintlayout-compose:1.0.1&quot;</code></li>
<li>2.åœ¨<code>res/raw/motion_scene.json5</code>ä¸­è¿›è¡Œé…ç½®</li>
<li>3.åœ¨<code>MotionLayout Composable</code>å‡½æ•°ä¸­è§£æå¹¶ä½¿ç”¨é…ç½®</li>
</ul>
<p><strong>motion_scene.json5</strong>ä¸­çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  ConstraintSets<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    start<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      profile_pic<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        width<span class="punctuation">:</span> <span class="number">48</span><span class="punctuation">,</span></span><br><span class="line">        height<span class="punctuation">:</span> <span class="number">48</span><span class="punctuation">,</span></span><br><span class="line">        start<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;start&#x27;<span class="punctuation">,</span> <span class="number">16</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        top<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;top&#x27;<span class="punctuation">,</span> <span class="number">16</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        custom<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          background<span class="punctuation">:</span> &#x27;#<span class="number">08</span>ff04&#x27;</span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      username<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        top<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;profile_pic&#x27;<span class="punctuation">,</span> &#x27;top&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        bottom<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;profile_pic&#x27;<span class="punctuation">,</span> &#x27;bottom&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        start<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;profile_pic&#x27;<span class="punctuation">,</span> &#x27;end&#x27;<span class="punctuation">,</span> <span class="number">16</span><span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      box<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        width<span class="punctuation">:</span> &#x27;spread&#x27;<span class="punctuation">,</span></span><br><span class="line">        height<span class="punctuation">:</span> &#x27;spread&#x27;<span class="punctuation">,</span></span><br><span class="line">        start<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;start&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        end<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;end&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        top<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;top&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        bottom<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;bottom&#x27;<span class="punctuation">,</span> <span class="number">-16</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    end<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      profile_pic<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        width<span class="punctuation">:</span> <span class="number">150</span><span class="punctuation">,</span></span><br><span class="line">        height<span class="punctuation">:</span> <span class="number">150</span><span class="punctuation">,</span></span><br><span class="line">        start<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;start&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        end<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;end&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        top<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;top&#x27;<span class="punctuation">,</span> <span class="number">16</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        custom<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          background<span class="punctuation">:</span> &#x27;#FFFFFF&#x27;</span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      username<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        top<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;profile_pic&#x27;<span class="punctuation">,</span> &#x27;bottom&#x27;<span class="punctuation">,</span> <span class="number">16</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        end<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;end&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        start<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;start&#x27;<span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      box<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        width<span class="punctuation">:</span> &#x27;spread&#x27;<span class="punctuation">,</span></span><br><span class="line">        height<span class="punctuation">:</span> &#x27;spread&#x27;<span class="punctuation">,</span></span><br><span class="line">        start<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;start&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        end<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;end&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        top<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;top&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        bottom<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;parent&#x27;<span class="punctuation">,</span> &#x27;bottom&#x27;<span class="punctuation">,</span> <span class="number">-16</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  Transitions<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    default<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      from<span class="punctuation">:</span> &#x27;start&#x27;<span class="punctuation">,</span></span><br><span class="line">      to<span class="punctuation">:</span> &#x27;end&#x27;<span class="punctuation">,</span></span><br><span class="line">      pathMotionArc<span class="punctuation">:</span> &#x27;startHorizontal&#x27;<span class="punctuation">,</span></span><br><span class="line">      KeyFrames<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        KeyAttributes<span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            target<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;profile_pic&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            frames<span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">100</span><span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            target<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;username&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            frames<span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">50</span><span class="punctuation">,</span> <span class="number">100</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            translationX<span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">90</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ–‡ä»¶ä¸­ä¸»è¦é…ç½®äº†ä»startåˆ°endçŠ¶æ€çš„å„ç§å±æ€§å€¼ï¼Œä»¥åŠå„ä¸ªç»„ä»¶ç›¸å¯¹äºå…¶ä»–ç»„ä»¶çš„ä¾èµ–å…³ç³»ï¼ŒåŒæ—¶å¯ä»¥åœ¨Transitionsæ ‡ç­¾ä¸­æŒ‡å®šKeyFramesçš„ç›¸å…³å±æ€§ã€‚</p>
<p>ç„¶åå¯ä»¥åœ¨Composableä¸­è°ƒç”¨è®¾ç½®ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MotionLayoutAnimationDemo</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column &#123;</span><br><span class="line">        <span class="keyword">var</span> progress <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">0f</span>) &#125;</span><br><span class="line">        ProfileHeader(progress = progress)</span><br><span class="line">        Spacer(modifier = Modifier.height(<span class="number">32.</span>dp))</span><br><span class="line">        Slider(</span><br><span class="line">            value = progress,</span><br><span class="line">            onValueChange = &#123; progress = it &#125;,</span><br><span class="line">            modifier = Modifier.padding(horizontal = <span class="number">32.</span>dp)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@OptIn(ExperimentalMotionApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ProfileHeader</span><span class="params">(progress: <span class="type">Float</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> context = LocalContext.current</span><br><span class="line">    <span class="keyword">val</span> motionScene = remember &#123;</span><br><span class="line">        context.resources</span><br><span class="line">            .openRawResource(R.raw.motion_scene)</span><br><span class="line">            .readBytes()</span><br><span class="line">            .decodeToString()</span><br><span class="line">    &#125;</span><br><span class="line">    MotionLayout(</span><br><span class="line">        motionScene = MotionScene(content = motionScene),</span><br><span class="line">        progress = progress,</span><br><span class="line">        modifier = Modifier.fillMaxWidth()</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">val</span> properties = motionProperties(id = <span class="string">&quot;profile_pic&quot;</span>)</span><br><span class="line">        Box(</span><br><span class="line">            modifier = Modifier</span><br><span class="line">                .fillMaxWidth()</span><br><span class="line">                .background(Color.DarkGray)</span><br><span class="line">                .layoutId(<span class="string">&quot;box&quot;</span>)</span><br><span class="line">        )</span><br><span class="line">        Image(</span><br><span class="line">            painter = painterResource(id = R.drawable.ic_head3),</span><br><span class="line">            contentDescription = <span class="literal">null</span>,</span><br><span class="line">            modifier = Modifier</span><br><span class="line">                .clip(CircleShape)</span><br><span class="line">                .border(</span><br><span class="line">                    width = <span class="number">2.</span>dp,</span><br><span class="line">                    color = properties.value.color(<span class="string">&quot;background&quot;</span>),</span><br><span class="line">                    shape = CircleShape</span><br><span class="line">                )</span><br><span class="line">                .layoutId(<span class="string">&quot;profile_pic&quot;</span>)</span><br><span class="line">        )</span><br><span class="line">        Text(</span><br><span class="line">            text = <span class="string">&quot;MotionLayout&quot;</span>,</span><br><span class="line">            fontSize = <span class="number">24.</span>sp,</span><br><span class="line">            modifier = Modifier.layoutId(<span class="string">&quot;username&quot;</span>),</span><br><span class="line">            color = properties.value.color(<span class="string">&quot;background&quot;</span>)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶çœ‹èµ·æ¥æœ‰ç‚¹éº»çƒ¦ï¼Œä½†æ˜¯å´ä¸å¤±ä¸ºä¸€ç§å¯ä»¥ç”¨æ¥è§£å†³å¤æ‚åŠ¨ç”»æ•ˆæœçš„è§£å†³æ–¹æ¡ˆã€‚</p>
<h2 id="å…¶ä»–ä¸€äº›åŠ¨ç”»æ•ˆæœDemo"><a href="#å…¶ä»–ä¸€äº›åŠ¨ç”»æ•ˆæœDemo" class="headerlink" title="å…¶ä»–ä¸€äº›åŠ¨ç”»æ•ˆæœDemo"></a>å…¶ä»–ä¸€äº›åŠ¨ç”»æ•ˆæœDemo</h2><h3 id="éª¨æ¶å±åŠ è½½åŠ¨ç”»æ•ˆæœ"><a href="#éª¨æ¶å±åŠ è½½åŠ¨ç”»æ•ˆæœ" class="headerlink" title="éª¨æ¶å±åŠ è½½åŠ¨ç”»æ•ˆæœ"></a>éª¨æ¶å±åŠ è½½åŠ¨ç”»æ•ˆæœ</h3><p>åŠ¨ç”»æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/aaeba6c21f4da8d60f7f8879b3ded2a3.gif"></p>
<p>éª¨æ¶å±åŠ è½½åŠ¨ç”»å®ç°è¦ç‚¹ï¼š</p>
<ul>
<li>æ•´ä¸ªéª¨æ¶å›¾æœ‰å¤šä¸ªå…·æœ‰åŠ¨ç”»æ¸å˜è‰²æ•ˆæœçš„AnimatedShimmerItemç»„æˆï¼Œ</li>
<li>ShimmerItemæ˜¯å•ä¸ªItemå¸ƒå±€ï¼Œç”±å¤šä¸ªé—ªçƒçš„çº¿æ¡ä¸çŸ©å½¢å›¾å½¢æ„æˆã€‚</li>
<li>å‚æ•°brushç”¨ä½œæ¯ä¸ªç»„ä»¶çš„èƒŒæ™¯è‰²ï¼Œä½¿ç”¨linearGradientåˆ›å»ºä¸€ä¸ªå…·æœ‰çº¿æ€§æ¸å˜è‰²æ•ˆæœçš„brushï¼Œé€šè¿‡åŠ¨ç”»æ§åˆ¶brushçš„æ¸å˜è‰²çš„ä½ç§»å±æ€§ï¼Œæ”¾å¤§åˆ°æ•´ä¸ªéª¨æ¶å›¾ï¼Œä¾¿ä¼šå‘ˆç°å¾®å…‰çš„æ¸å˜è‰²æ•ˆæœäº†ã€‚</li>
</ul>
<p>æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> androidx.compose.animation.core.*</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.background</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.layout.*</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.rememberScrollState</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.shape.RoundedCornerShape</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.verticalScroll</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.Composable</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.Alignment</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.Modifier</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.draw.clip</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.geometry.Offset</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.graphics.Brush</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.graphics.Color</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.tooling.preview.Preview</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.unit.dp</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> barHeight = <span class="number">10.</span>dp</span><br><span class="line"><span class="keyword">val</span> spacerPadding = <span class="number">3.</span>dp</span><br><span class="line"><span class="keyword">val</span> roundedCornerShape = RoundedCornerShape(<span class="number">3.</span>dp)</span><br><span class="line"><span class="keyword">val</span> shimmerColors = listOf(</span><br><span class="line">    Color.LightGray.copy(alpha = <span class="number">0.6f</span>),</span><br><span class="line">    Color.LightGray.copy(alpha = <span class="number">0.2f</span>),</span><br><span class="line">    Color.LightGray.copy(alpha = <span class="number">0.6f</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="meta">@Preview(showBackground = true)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatedShimmerItem</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> transition = rememberInfiniteTransition()</span><br><span class="line">    <span class="keyword">val</span> translateAnim = transition.animateFloat(</span><br><span class="line">        initialValue = <span class="number">0f</span>,</span><br><span class="line">        targetValue = <span class="number">1000f</span>,</span><br><span class="line">        animationSpec = infiniteRepeatable(</span><br><span class="line">            animation = tween(<span class="number">1500</span>, easing = FastOutSlowInEasing),</span><br><span class="line">            repeatMode = RepeatMode.Restart</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">    <span class="comment">// å¾®å…‰æ¸å˜æ•ˆæœ</span></span><br><span class="line">    <span class="keyword">val</span> brush = Brush.linearGradient(</span><br><span class="line">        colors = shimmerColors,</span><br><span class="line">        start = Offset.Zero,</span><br><span class="line">        end = Offset(x = translateAnim.value, y = translateAnim.value) <span class="comment">// åŠ¨ç”»æ”¹å˜endåæ ‡ä½ç½®äº§ç”Ÿæ¸å˜è‰²ä½ç§»æ•ˆæœ</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    ShimmerItem(brush)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Preview(showBackground = true)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ShimmerItem</span><span class="params">(brush: <span class="type">Brush</span> = Brush.linearGradient(shimmerColors)</span></span>) &#123;</span><br><span class="line">    Column(Modifier.fillMaxWidth().padding(<span class="number">10.</span>dp)) &#123;</span><br><span class="line">        Row(verticalAlignment = Alignment.CenterVertically) &#123;</span><br><span class="line">            Spacer(</span><br><span class="line">                modifier = Modifier</span><br><span class="line">                    .size(<span class="number">100.</span>dp)</span><br><span class="line">                    .clip(roundedCornerShape)</span><br><span class="line">                    .background(brush)</span><br><span class="line">            )</span><br><span class="line">            Spacer(modifier = Modifier.width(<span class="number">10.</span>dp))</span><br><span class="line">            Column(verticalArrangement = Arrangement.Center) &#123;</span><br><span class="line">                repeat(<span class="number">5</span>) &#123;</span><br><span class="line">                    Spacer(modifier = Modifier.padding(spacerPadding))</span><br><span class="line">                    Spacer(</span><br><span class="line">                        modifier = Modifier</span><br><span class="line">                            .height(barHeight)</span><br><span class="line">                            .clip(roundedCornerShape)</span><br><span class="line">                            .fillMaxWidth()</span><br><span class="line">                            .background(brush)</span><br><span class="line">                    )</span><br><span class="line">                    Spacer(modifier = Modifier.padding(spacerPadding))</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        repeat(<span class="number">3</span>) &#123;</span><br><span class="line">            Spacer(modifier = Modifier.padding(spacerPadding))</span><br><span class="line">            Spacer(</span><br><span class="line">                modifier = Modifier</span><br><span class="line">                    .height(barHeight)</span><br><span class="line">                    .clip(roundedCornerShape)</span><br><span class="line">                    .fillMaxWidth()</span><br><span class="line">                    .background(brush)</span><br><span class="line">            )</span><br><span class="line">            Spacer(modifier = Modifier.padding(spacerPadding))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Preview(showBackground = true)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ShimmerListPreview</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column(Modifier.padding(<span class="number">5.</span>dp).verticalScroll(rememberScrollState())) &#123;</span><br><span class="line">        repeat(<span class="number">5</span>) &#123;</span><br><span class="line">            AnimatedShimmerItem()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ”¶è—æŒ‰é’®åŠ¨ç”»æ•ˆæœ"><a href="#æ”¶è—æŒ‰é’®åŠ¨ç”»æ•ˆæœ" class="headerlink" title="æ”¶è—æŒ‰é’®åŠ¨ç”»æ•ˆæœ"></a>æ”¶è—æŒ‰é’®åŠ¨ç”»æ•ˆæœ</h3><p>åŠ¨ç”»æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/680ed083195c4a2aaeeb74a20fcaa2bd.gif"></p>
<p>å®ç°è¦ç‚¹ï¼š</p>
<ul>
<li>ä½¿ç”¨<strong>updateTransition</strong>ç²¾ç»†æ§åˆ¶çŠ¶æ€å˜åŒ–æ—¶å¤šä¸ªç»´åº¦çš„å±æ€§å€¼åŒæ—¶å˜åŒ–ï¼Œæ•ˆæœä¸Šä¼šæ¯”å•çº¯çš„ä½¿ç”¨<strong>AnimatedContent</strong>å®ç°æ–¹å¼æ›´åŠ çš„ç»†è…»ä¸æ»‘ã€‚</li>
</ul>
<p>æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> androidx.compose.animation.*</span><br><span class="line"><span class="keyword">import</span> androidx.compose.animation.core.*</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.BorderStroke</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.layout.Box</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.layout.Column</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.layout.Row</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.layout.Spacer</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.layout.fillMaxWidth</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.layout.height</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.layout.size</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.layout.width</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.shape.RoundedCornerShape</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material.Button</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material.ButtonDefaults</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material.Icon</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material.Text</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material.icons.Icons</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material.icons.filled.Favorite</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material.icons.filled.FavoriteBorder</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.Composable</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.getValue</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.mutableStateOf</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.remember</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.setValue</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.Alignment</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.Modifier</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.graphics.Color</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.tooling.preview.Preview</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.unit.Dp</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.unit.dp</span><br><span class="line"><span class="keyword">import</span> com.fly.mycompose.application.ui.theme.MyComposeApplicationTheme</span><br><span class="line"><span class="keyword">import</span> com.fly.mycompose.application.ui.theme.Purple500</span><br><span class="line"></span><br><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">UiState</span>(</span><br><span class="line">    <span class="keyword">val</span> backgroundColor: Color,</span><br><span class="line">    <span class="keyword">val</span> textColor: Color,</span><br><span class="line">    <span class="keyword">val</span> roundedCorner: <span class="built_in">Int</span>,</span><br><span class="line">    <span class="keyword">val</span> buttonWidth: Dp</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="keyword">class</span> <span class="title class_">ButtonState</span>(<span class="keyword">val</span> ui: UiState) &#123;</span><br><span class="line">    Idle(UiState(Color.White, Purple500, <span class="number">6</span>, <span class="number">300.</span>dp)),</span><br><span class="line">    Pressed(UiState(Purple500, Color.White, <span class="number">50</span>, <span class="number">60.</span>dp))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">val</span> animateDuration = <span class="number">500</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">changeButtonState</span><span class="params">(buttonState: <span class="type">ButtonState</span>)</span></span> : ButtonState &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">when</span>(buttonState) &#123;</span><br><span class="line">        ButtonState.Idle -&gt; ButtonState.Pressed</span><br><span class="line">        ButtonState.Pressed -&gt; ButtonState.Idle</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@OptIn(ExperimentalAnimationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatedFavButton</span><span class="params">(modifier: <span class="type">Modifier</span> = Modifier)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> buttonState <span class="keyword">by</span> remember &#123; mutableStateOf(ButtonState.Idle) &#125;</span><br><span class="line">    Box(modifier) &#123;</span><br><span class="line">        AnimatedContent(</span><br><span class="line">            targetState = buttonState,</span><br><span class="line">            transitionSpec = &#123;</span><br><span class="line">                fadeIn(tween(animateDuration)) with</span><br><span class="line">                   fadeOut(tween(animateDuration))</span><br><span class="line">            &#125;</span><br><span class="line">        ) &#123; state -&gt;</span><br><span class="line">            FavButton(buttonState = state) &#123;</span><br><span class="line">                buttonState = changeButtonState(buttonState)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimatedFavButton2</span><span class="params">(modifier: <span class="type">Modifier</span> = Modifier)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> buttonState <span class="keyword">by</span> remember &#123; mutableStateOf(ButtonState.Idle) &#125;</span><br><span class="line">    <span class="keyword">val</span> transition = updateTransition(targetState = buttonState, label = <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> backgroundColor <span class="keyword">by</span> transition.animateColor(</span><br><span class="line">        transitionSpec = &#123; spring() &#125;, label = <span class="string">&quot;&quot;</span></span><br><span class="line">    ) &#123; it.ui.backgroundColor &#125;</span><br><span class="line">    <span class="keyword">val</span> textColor <span class="keyword">by</span> transition.animateColor(</span><br><span class="line">        transitionSpec = &#123; spring() &#125;, label = <span class="string">&quot;&quot;</span></span><br><span class="line">    ) &#123; it.ui.textColor &#125;</span><br><span class="line">    <span class="keyword">val</span> roundedCorner <span class="keyword">by</span> transition.animateInt(</span><br><span class="line">        transitionSpec = &#123; spring() &#125;, label = <span class="string">&quot;&quot;</span></span><br><span class="line">    ) &#123; it.ui.roundedCorner &#125;</span><br><span class="line">    <span class="keyword">val</span> buttonWidth <span class="keyword">by</span> transition.animateDp(</span><br><span class="line">        transitionSpec = &#123; spring() &#125;, label = <span class="string">&quot;&quot;</span></span><br><span class="line">    ) &#123; it.ui.buttonWidth &#125;</span><br><span class="line"></span><br><span class="line">    FavButton(</span><br><span class="line">        modifier, buttonState, textColor, backgroundColor, roundedCorner, buttonWidth,</span><br><span class="line">    ) &#123;</span><br><span class="line">        buttonState = changeButtonState(buttonState)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">FavButton</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    modifier: <span class="type">Modifier</span> = Modifier,</span></span></span><br><span class="line"><span class="params"><span class="function">    buttonState: <span class="type">ButtonState</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    textColor: <span class="type">Color</span> = buttonState.ui.textColor,</span></span></span><br><span class="line"><span class="params"><span class="function">    backgroundColor: <span class="type">Color</span> = buttonState.ui.backgroundColor,</span></span></span><br><span class="line"><span class="params"><span class="function">    roundedCorner: <span class="type">Int</span> = buttonState.ui.roundedCorner,</span></span></span><br><span class="line"><span class="params"><span class="function">    buttonWidth: <span class="type">Dp</span> = buttonState.ui.buttonWidth,</span></span></span><br><span class="line"><span class="params"><span class="function">    onClick: () -&gt; <span class="type">Unit</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    Button(</span><br><span class="line">        border = BorderStroke(<span class="number">1.</span>dp, Purple500),</span><br><span class="line">        modifier = modifier.size(buttonWidth, height = <span class="number">60.</span>dp),</span><br><span class="line">        shape = RoundedCornerShape(roundedCorner.coerceIn(<span class="number">0.</span><span class="number">.100</span>)),</span><br><span class="line">        colors = ButtonDefaults.buttonColors(backgroundColor),</span><br><span class="line">        onClick = onClick,</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">if</span> (buttonState == ButtonState.Idle) &#123;</span><br><span class="line">            Row &#123;</span><br><span class="line">                Icon(</span><br><span class="line">                    tint = textColor,</span><br><span class="line">                    imageVector = Icons.Default.FavoriteBorder,</span><br><span class="line">                    modifier = Modifier.size(<span class="number">24.</span>dp).align(Alignment.CenterVertically),</span><br><span class="line">                    contentDescription = <span class="literal">null</span></span><br><span class="line">                )</span><br><span class="line">                Spacer(Modifier.width(<span class="number">16.</span>dp))</span><br><span class="line">                Text(</span><br><span class="line">                    <span class="string">&quot;ADD TO FAVORITES!&quot;</span>,</span><br><span class="line">                    softWrap = <span class="literal">false</span>,</span><br><span class="line">                    modifier = Modifier.align(Alignment.CenterVertically),</span><br><span class="line">                    color = textColor</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Icon(</span><br><span class="line">                tint = textColor,</span><br><span class="line">                imageVector = Icons.Default.Favorite,</span><br><span class="line">                modifier = Modifier.size(<span class="number">24.</span>dp),</span><br><span class="line">                contentDescription = <span class="literal">null</span></span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Preview(showBackground = true)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">PreviewFavButton</span><span class="params">()</span></span> &#123;</span><br><span class="line">    MyComposeApplicationTheme &#123;</span><br><span class="line">        Box(Modifier.fillMaxWidth(), contentAlignment = Alignment.Center) &#123;</span><br><span class="line">            Column(horizontalAlignment = Alignment.CenterHorizontally) &#123;</span><br><span class="line">                Text(<span class="string">&quot;High Level APIï¼ˆAnimatedContent)&quot;</span>)</span><br><span class="line">                Spacer(Modifier.height(<span class="number">10.</span>dp))</span><br><span class="line">                AnimatedFavButton()</span><br><span class="line"></span><br><span class="line">                Spacer(Modifier.height(<span class="number">50.</span>dp))</span><br><span class="line"></span><br><span class="line">                Text(<span class="string">&quot;Low Level APIï¼ˆupdateTransition)&quot;</span>)</span><br><span class="line">                Spacer(Modifier.height(<span class="number">10.</span>dp))</span><br><span class="line">                AnimatedFavButton2()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ»‘åŠ¨åˆ—è¡¨æ—¶é¡¶éƒ¨TopBaræŠ˜å éšè—åŠ¨ç”»æ•ˆæœ"><a href="#æ»‘åŠ¨åˆ—è¡¨æ—¶é¡¶éƒ¨TopBaræŠ˜å éšè—åŠ¨ç”»æ•ˆæœ" class="headerlink" title="æ»‘åŠ¨åˆ—è¡¨æ—¶é¡¶éƒ¨TopBaræŠ˜å éšè—åŠ¨ç”»æ•ˆæœ"></a>æ»‘åŠ¨åˆ—è¡¨æ—¶é¡¶éƒ¨TopBaræŠ˜å éšè—åŠ¨ç”»æ•ˆæœ</h3><p>åŠ¨ç”»æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/e04a763aeea96406b1cca2c9f7afe22d.gif"></p>
<p>å®ç°è¦ç‚¹ï¼š</p>
<ul>
<li>ä½¿ç”¨Boxå¸ƒå±€ç»„ä»¶å åŠ TopBarç»„ä»¶å’ŒLayColumnåˆ—è¡¨ç»„ä»¶ï¼ŒTopBarå›ºå®šé«˜åº¦ï¼ŒLayColumné¡¶éƒ¨é¢„ç•™å‡ºå¯¹åº”TopBaré«˜åº¦çš„paddingè·ç¦»</li>
<li>å¦‚æœLayColumnåˆ—è¡¨å‘ä¸Šæ»‘åŠ¨æ—¶ï¼Œå°±ä¿®æ”¹opBaré«˜åº¦ä¸º0ï¼ŒåŒæ—¶ä¿®æ”¹LayColumné¡¶éƒ¨çš„paddingä¸º0ï¼Œåä¹‹åˆ™éƒ½ä¿®æ”¹ä¸ºé»˜è®¤çš„å›ºå®šé«˜åº¦å€¼</li>
<li>TopBarç»„ä»¶ä¸Šå¯ä»¥åº”ç”¨<code>Modifier.animateContentSize()</code>, å½“é«˜åº¦è¢«ä¿®æ”¹å˜åŒ–æ—¶ï¼Œä¼šæ‰§è¡ŒåŠ¨ç”»æ•ˆæœï¼ŒLayColumnç»„ä»¶å¯ä»¥ä½¿ç”¨<code>animateDpAsState</code>ä¼°å€¼paddingè‡ªåŠ¨æ‰§è¡Œå±æ€§åŠ¨ç”»æ•ˆæœ</li>
<li>åˆ¤æ–­LayColumnåˆ—è¡¨å‘ä¸Šæ»‘åŠ¨çš„æ¡ä»¶ï¼šå…ˆ<code>rememberLazyListState()</code>ï¼Œç„¶ååˆ¤æ–­å…¶<code>firstVisibleItemIndex &gt; 0 || firstVisibleItemScrollOffset &gt; 0</code>å°±æ˜¯å‘ä¸Šæ»šåŠ¨äº†ï¼ŒTopBarç»„ä»¶å’ŒLayColumnç»„ä»¶éƒ½è¦ä¾èµ–è§‚å¯Ÿè¯¥çŠ¶æ€å€¼æ¥ä¿®æ”¹é«˜åº¦å’Œpadding</li>
</ul>
<p>æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> androidx.compose.ui.Modifier</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.Composable</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material.Text</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.layout.*</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.Alignment</span><br><span class="line"><span class="keyword">import</span> androidx.compose.animation.animateContentSize</span><br><span class="line"><span class="keyword">import</span> androidx.compose.animation.core.animateDpAsState</span><br><span class="line"><span class="keyword">import</span> androidx.compose.animation.core.tween</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.background</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.lazy.LazyColumn</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.lazy.LazyListState</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.lazy.items</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.lazy.rememberLazyListState</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material.MaterialTheme</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material.Scaffold</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material.TopAppBar</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.getValue</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.remember</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.text.TextStyle</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.text.font.FontWeight</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.unit.dp</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> TOP_BAR_HEIGHT = <span class="number">56.</span>dp</span><br><span class="line"><span class="keyword">val</span> LazyListState.isScrolled: <span class="built_in">Boolean</span></span><br><span class="line">    <span class="keyword">get</span>() = firstVisibleItemIndex &gt; <span class="number">0</span> || firstVisibleItemScrollOffset &gt; <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AnimationTopBarDemo</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> lazyListState = rememberLazyListState()</span><br><span class="line">    Scaffold(</span><br><span class="line">        content = &#123;</span><br><span class="line">            Box(modifier = Modifier.padding(it).fillMaxSize()) &#123;</span><br><span class="line">                MainContent(lazyListState = lazyListState)</span><br><span class="line">                TopBar(lazyListState = lazyListState)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">TopBar</span><span class="params">(lazyListState: <span class="type">LazyListState</span>)</span></span> &#123;</span><br><span class="line">    TopAppBar(</span><br><span class="line">        modifier = Modifier</span><br><span class="line">            .fillMaxWidth()</span><br><span class="line">            .background(color = MaterialTheme.colors.primary)</span><br><span class="line">            .animateContentSize(animationSpec = tween(durationMillis = <span class="number">300</span>))</span><br><span class="line">            .height(height = <span class="keyword">if</span> (lazyListState.isScrolled) <span class="number">0.</span>dp <span class="keyword">else</span> TOP_BAR_HEIGHT),</span><br><span class="line">        contentPadding = PaddingValues(start = <span class="number">16.</span>dp)</span><br><span class="line">    ) &#123;</span><br><span class="line">        Text(</span><br><span class="line">            text = <span class="string">&quot;Title&quot;</span>,</span><br><span class="line">            style = TextStyle(</span><br><span class="line">                fontSize = MaterialTheme.typography.h6.fontSize,</span><br><span class="line">                color = MaterialTheme.colors.surface</span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MainContent</span><span class="params">(lazyListState: <span class="type">LazyListState</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> numbers = remember &#123; List(size = <span class="number">25</span>) &#123; it &#125; &#125;</span><br><span class="line">    <span class="keyword">val</span> padding <span class="keyword">by</span> animateDpAsState(</span><br><span class="line">        targetValue = <span class="keyword">if</span> (lazyListState.isScrolled) <span class="number">0.</span>dp <span class="keyword">else</span> TOP_BAR_HEIGHT,</span><br><span class="line">        animationSpec = tween(durationMillis = <span class="number">300</span>)</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    LazyColumn(</span><br><span class="line">        modifier = Modifier.padding(top = padding),</span><br><span class="line">        state = lazyListState</span><br><span class="line">    ) &#123;</span><br><span class="line">        items(items = numbers, key = &#123; it &#125;) &#123;</span><br><span class="line">            NumberHolder(number = it)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">NumberHolder</span><span class="params">(number: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">    Row(</span><br><span class="line">        modifier = Modifier.fillMaxWidth(),</span><br><span class="line">        verticalAlignment = Alignment.CenterVertically</span><br><span class="line">    ) &#123;</span><br><span class="line">        Text(</span><br><span class="line">            text = number.toString(),</span><br><span class="line">            style = TextStyle(</span><br><span class="line">                fontSize = MaterialTheme.typography.h3.fontSize,</span><br><span class="line">                fontWeight = FontWeight.Bold</span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>å‚è€ƒï¼š</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://developer.android.com/jetpack/compose/animation#animation">Jetpack Compose animation</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=1g3SPJxk4wc&list=PLQkwcJG4YTCSpJ2NLhDTHhi6XBNfk9WiC&index=28">Build Complex Animations With MotionLayout in Jetpack Compose</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=4NDGqqAoD-8&list=PLSrm9z4zp4mEWwyiuYgVMWcDFdsebhM-r&index=61">Collapsing Top Bar Animation with Jetpack Compose</a></p>
</li>
<li><p>ã€ŠJetpack Composeä»å…¥é—¨åˆ°å®æˆ˜ã€‹- æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾ - 2022å¹´9æœˆ</p>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://bravestsnail.github.io">BravestSnail</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://bravestsnail.github.io/2025/05/29/note/Android/compose/Compose%E7%9A%84%E5%8A%A8%E7%94%BB/">https://bravestsnail.github.io/2025/05/29/note/Android/compose/Compose%E7%9A%84%E5%8A%A8%E7%94%BB/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://bravestsnail.github.io" target="_blank">BravestSnail's Blog</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Android/">Android</a><a class="post-meta__tags" href="/tags/Compose/">Compose</a><a class="post-meta__tags" href="/tags/%E5%8A%A8%E7%94%BB/">åŠ¨ç”»</a></div><div class="post-share"><div class="social-share" data-image="/images/avatar.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/05/29/note/Android/compose/Compose%E4%B8%AD%E7%9A%84%E7%BB%98%E5%88%B6%E6%B5%81%E7%A8%8B%E5%92%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B8%83%E5%B1%80/" title="Composeä¸­çš„ç»˜åˆ¶æµç¨‹å’Œè‡ªå®šä¹‰å¸ƒå±€"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">Composeä¸­çš„ç»˜åˆ¶æµç¨‹å’Œè‡ªå®šä¹‰å¸ƒå±€</div></div><div class="info-2"><div class="info-item-1">  ä¸å¤§å¤šæ•°å…¶ä»–ç•Œé¢å·¥å…·åŒ…ä¸€æ ·ï¼ŒComposeÂ ä¼šé€šè¿‡å‡ ä¸ªä¸åŒçš„â€œé˜¶æ®µâ€æ¥æ¸²æŸ“å¸§ã€‚å¦‚æœæˆ‘ä»¬è§‚å¯Ÿä¸€ä¸‹ AndroidÂ ViewÂ ç³»ç»Ÿï¼Œå°±ä¼šå‘ç°å®ƒæœ‰ 3 ä¸ªä¸»è¦é˜¶æ®µï¼šæµ‹é‡ã€å¸ƒå±€å’Œç»˜åˆ¶ã€‚ComposeÂ å’Œå®ƒéå¸¸ç›¸ä¼¼ï¼Œä½†å¼€å¤´å¤šäº†ä¸€ä¸ªå«åšâ€œç»„åˆâ€çš„é‡è¦é˜¶æ®µã€‚ Compose æœ‰ 3 ä¸ªä¸»è¦çš„é˜¶æ®µï¼š  ç»„åˆï¼šè¦æ˜¾ç¤ºä»€ä¹ˆæ ·çš„ç•Œé¢ã€‚Compose è¿è¡ŒComposableå¯ç»„åˆå‡½æ•°å¹¶åˆ›å»ºLayoutNodeè§†å›¾æ ‘ã€‚ å¸ƒå±€ï¼šè¦æ”¾ç½®ç•Œé¢çš„ä½ç½®ã€‚è¯¥é˜¶æ®µåŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼šæµ‹é‡å’Œæ”¾ç½®ã€‚å¯¹äºè§†å›¾æ ‘ä¸­çš„æ¯ä¸ªLayoutNodeèŠ‚ç‚¹è¿›è¡Œå®½é«˜å°ºå¯¸æµ‹é‡å¹¶å®Œæˆä½ç½®æ‘†æ”¾ï¼Œå¸ƒå±€å…ƒç´ éƒ½ä¼šæ ¹æ® 2D åæ ‡æ¥æµ‹é‡å¹¶æ”¾ç½®è‡ªå·±åŠå…¶æ‰€æœ‰å­å…ƒç´ ã€‚ ç»˜åˆ¶ï¼šæ¸²æŸ“çš„æ–¹å¼ã€‚å°†æ‰€æœ‰LayoutNodeç•Œé¢å…ƒç´ ä¼šç»˜åˆ¶åˆ°ç”»å¸ƒï¼ˆé€šå¸¸æ˜¯è®¾å¤‡å±å¹•ï¼‰ä¹‹ä¸Šã€‚   è¿™äº›é˜¶æ®µçš„é¡ºåºé€šå¸¸æ˜¯ç›¸åŒçš„ï¼Œä»è€Œè®©æ•°æ®èƒ½å¤Ÿæ²¿ä¸€ä¸ªæ–¹å‘ï¼ˆä»ç»„åˆåˆ°å¸ƒå±€ï¼Œå†åˆ°ç»˜åˆ¶ï¼‰ç”Ÿæˆå¸§ï¼ˆä¹Ÿç§°ä¸ºå•å‘æ•°æ®æµï¼‰ã€‚ æ‚¨å¯ä»¥æ”¾å¿ƒåœ°å‡è®¾æ¯ä¸ªå¸§éƒ½ä¼šä»¥è™šæ‹Ÿæ–¹å¼ç»å†è¿™ 3 ä¸ªé˜¶æ®µï¼Œä½†ä¸ºäº†ä¿éšœæ€§èƒ½ï¼ŒCompose...</div></div></div></a><a class="pagination-related" href="/2025/05/29/note/Android/compose/Compose%E7%9A%84%E6%89%8B%E5%8A%BF%E6%93%8D%E4%BD%9C%E5%92%8C%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86/" title="Composeçš„æ‰‹åŠ¿æ“ä½œå’Œäº‹ä»¶å¤„ç†"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">Composeçš„æ‰‹åŠ¿æ“ä½œå’Œäº‹ä»¶å¤„ç†</div></div><div class="info-2"><div class="info-item-1">  Compose ä¸­çš„æ‰‹åŠ¿æ“ä½œæˆ–äº‹ä»¶å¤„ç†å…¨éƒ¨éƒ½æ˜¯ä»¥ Modifier ä¿®é¥°ç¬¦çš„å½¢å¼æä¾›çš„ï¼Œäº‹ä»¶å¤„ç†æŒ‰ç…§å±‚æ¬¡å¯ä»¥åˆ’åˆ†ä¸ºé«˜çº§äº‹ä»¶å¤„ç†APIå’Œä½çº§äº‹ä»¶å¤„ç†APIã€‚ å…¶ä¸­é«˜çº§äº‹ä»¶å¤„ç†APIæ˜¯ä½äºæ›´ä¸Šå±‚çš„APIï¼Œå®ƒä»¬éƒ½æ˜¯åŸºäºæ›´åº•å±‚çš„ä½çº§äº‹ä»¶å¤„ç†APIå®ç°çš„ï¼Œä¹Ÿæ˜¯å¼€å‘ä¸­æ¯”è¾ƒå¸¸ç”¨çš„ã€‚é«˜çº§äº‹ä»¶å¤„ç†APIçš„åˆ†ç±»å¤§æ¦‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š  ç‚¹å‡»äº‹ä»¶ç›‘å¬ç‚¹å‡»äº‹ä»¶éå¸¸ç®€å•ï¼Œä½¿ç”¨Â clickableÂ å’ŒÂ combinedClickableÂ ä¿®é¥°ç¬¦å³å¯æ»¡è¶³éœ€æ±‚ï¼š 123456789101112131415161718@OptIn(ExperimentalFoundationApi::class)@Composablefun ClickableExample() &#123;    Column&#123;        Box(Modifier            .clickable &#123; println(&quot;clickable&quot;) &#125;            .size(30.dp)            .background(Color.Red))       ...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/05/29/note/Android/compose/Compose%E4%B8%AD%E7%9A%84Accompanist/" title="Composeä¸­çš„Accompanist"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-30</div><div class="info-item-2">Composeä¸­çš„Accompanist</div></div><div class="info-2"><div class="info-item-1">  æƒé™ä¾èµ–é…ç½®ï¼š 1234567repositories &#123;    mavenCentral()&#125;dependencies &#123;    implementation &quot;com.google.accompanist:accompanist-permissions:0.28.0&quot;&#125;  å•ä¸ªæƒé™ç”³è¯·ä¾‹å¦‚ï¼Œæˆ‘ä»¬éœ€è¦è·å–ç›¸æœºæƒé™ï¼Œå¯ä»¥é€šè¿‡rememberPermissionState(Manifest.permission.CAMERA)åˆ›å»ºä¸€ä¸ªÂ PermissionStateå¯¹è±¡ï¼Œç„¶åé€šè¿‡PermissionState.status.isGrantedåˆ¤æ–­æƒé™æ˜¯å¦å·²è·å–ï¼Œå¹¶é€šè¿‡è°ƒç”¨permissionState.launchPermissionRequest()æ¥ç”³è¯·æƒé™ã€‚ 12345&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;    &lt;!-- åˆ«å¿˜äº†åœ¨æ¸…å•æ–‡ä»¶ä¸­æ·»åŠ æƒé™å£°æ˜ --&gt;   ...</div></div></div></a><a class="pagination-related" href="/2025/05/29/note/Android/compose/Compose%E4%B8%AD%E7%9A%84startActivityForResult%E7%9A%84%E6%AD%A3%E7%A1%AE%E5%A7%BF%E5%8A%BF/" title="Composeä¸­çš„startActivityForResultçš„æ­£ç¡®å§¿åŠ¿"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-30</div><div class="info-item-2">Composeä¸­çš„startActivityForResultçš„æ­£ç¡®å§¿åŠ¿</div></div><div class="info-2"><div class="info-item-1">  åæ¥ç ”ç©¶äº†ä¸€ä¸‹ï¼Œåœ¨ComposeÂ ä¸­startActivityForResultä¹Ÿæœ‰äº†æ–°çš„å§¿åŠ¿ï¼Œè¦ç†è§£ComposeÂ ä¸­startActivityForResultçš„å§¿åŠ¿ï¼Œè¿™è¿˜å¾—ä»androidxçš„startActivityForResultçš„å§¿åŠ¿è¯´èµ·ï¼Œå› ä¸ºComposeÂ å°±æ˜¯åœ¨androidxçš„åŸºç¡€ä¸Šåˆ©ç”¨å…¶APIç®€å•å°è£…äº†ä¸€ä¸‹è€Œå·²ã€‚ å€’ä¹Ÿä¸æ˜¯è¯´ä»¥å‰çš„ä¸èƒ½ç”¨äº†ï¼Œæ¯•ç«Ÿæœ‰ç³»ç»Ÿè‡ªå¸¦çš„ï¼Œè°è¿˜å»ç”¨ç¬¬ä¸‰æ–¹çš„å‘€ï¼Œç”¨ç¬¬ä¸‰æ–¹çš„è¿˜å¾—å¯¼å…¥ä¸€ä¸ªä¾èµ–åº“ä¸æ˜¯ï¼Œèƒ½å°‘ä¾èµ–ä¸‰æ–¹çš„å°±å°½é‡å°‘ä¾èµ–å§ã€‚ androidxä¹‹åå¦‚ä½•æ­£ç¡®çš„startActivityForResultå¦‚ä½•ä½¿ç”¨å¦‚æœæ˜¯åœ¨Activityæˆ–Fragmentå†…éƒ¨ä½¿ç”¨çš„è¯ï¼Œç›´æ¥è°ƒç”¨registerForActivityResultæ–¹æ³•å³å¯ã€‚ ä¾‹å¦‚ï¼Œé€‰æ‹©æ–‡ä»¶ï¼š 12345val launcher = registerForActivityResult(ActivityResultContracts.GetContent()) &#123; uri -&gt;    uri?.apply &#123; showToast(uri.toString())...</div></div></div></a><a class="pagination-related" href="/2025/05/29/note/Android/compose/Compose%E4%B8%AD%E7%9A%84%E5%AF%BC%E8%88%AA%E8%B7%AF%E7%94%B1/" title="Composeä¸­çš„å¯¼èˆªè·¯ç”±"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-30</div><div class="info-item-2">Composeä¸­çš„å¯¼èˆªè·¯ç”±</div></div><div class="info-2"><div class="info-item-1">  1implementation &quot;androidx.navigation:navigation-compose:$nav_version&quot;   Jetpackåº“ä¸­çš„Navigationä½¿ç”¨èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œé¦–å…ˆéœ€è¦åœ¨xmlä¸­è¿›è¡Œå¯¼èˆªå›¾çš„é…ç½®ï¼Œç„¶ååœ¨ä»£ç ä¸­ä½¿ç”¨NavController.navigate(id)è¿›è¡Œè·³è½¬åˆ°æŒ‡å®šçš„idçš„fragmenté¡µé¢ï¼Œä¸ªäººæ„Ÿè§‰è¿™ç§æ–¹å¼è¿˜æ˜¯ä¸å¤Ÿçµæ´»ï¼Œéœ€è¦é¢„å…ˆå®šä¹‰ï¼Œå‡å¦‚æŸä¸ªfragmentæ²¡æœ‰åœ¨xmlä¸­å®šä¹‰å°±æ— æ³•ä½¿ç”¨NavControllerè¿›è¡Œè·³è½¬ï¼Œå¦å¤–è¿˜éœ€è¦åœ¨xmlå’Œjava&#x2F;kotlinæ–‡ä»¶æ¥å›æŠ˜è…¾ä¿®æ”¹ã€‚ Jetpack...</div></div></div></a><a class="pagination-related" href="/2025/05/29/note/Android/compose/Compose%E4%B8%AD%E7%9A%84%E7%BB%98%E5%88%B6%E6%B5%81%E7%A8%8B%E5%92%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B8%83%E5%B1%80/" title="Composeä¸­çš„ç»˜åˆ¶æµç¨‹å’Œè‡ªå®šä¹‰å¸ƒå±€"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-30</div><div class="info-item-2">Composeä¸­çš„ç»˜åˆ¶æµç¨‹å’Œè‡ªå®šä¹‰å¸ƒå±€</div></div><div class="info-2"><div class="info-item-1">  ä¸å¤§å¤šæ•°å…¶ä»–ç•Œé¢å·¥å…·åŒ…ä¸€æ ·ï¼ŒComposeÂ ä¼šé€šè¿‡å‡ ä¸ªä¸åŒçš„â€œé˜¶æ®µâ€æ¥æ¸²æŸ“å¸§ã€‚å¦‚æœæˆ‘ä»¬è§‚å¯Ÿä¸€ä¸‹ AndroidÂ ViewÂ ç³»ç»Ÿï¼Œå°±ä¼šå‘ç°å®ƒæœ‰ 3 ä¸ªä¸»è¦é˜¶æ®µï¼šæµ‹é‡ã€å¸ƒå±€å’Œç»˜åˆ¶ã€‚ComposeÂ å’Œå®ƒéå¸¸ç›¸ä¼¼ï¼Œä½†å¼€å¤´å¤šäº†ä¸€ä¸ªå«åšâ€œç»„åˆâ€çš„é‡è¦é˜¶æ®µã€‚ Compose æœ‰ 3 ä¸ªä¸»è¦çš„é˜¶æ®µï¼š  ç»„åˆï¼šè¦æ˜¾ç¤ºä»€ä¹ˆæ ·çš„ç•Œé¢ã€‚Compose è¿è¡ŒComposableå¯ç»„åˆå‡½æ•°å¹¶åˆ›å»ºLayoutNodeè§†å›¾æ ‘ã€‚ å¸ƒå±€ï¼šè¦æ”¾ç½®ç•Œé¢çš„ä½ç½®ã€‚è¯¥é˜¶æ®µåŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼šæµ‹é‡å’Œæ”¾ç½®ã€‚å¯¹äºè§†å›¾æ ‘ä¸­çš„æ¯ä¸ªLayoutNodeèŠ‚ç‚¹è¿›è¡Œå®½é«˜å°ºå¯¸æµ‹é‡å¹¶å®Œæˆä½ç½®æ‘†æ”¾ï¼Œå¸ƒå±€å…ƒç´ éƒ½ä¼šæ ¹æ® 2D åæ ‡æ¥æµ‹é‡å¹¶æ”¾ç½®è‡ªå·±åŠå…¶æ‰€æœ‰å­å…ƒç´ ã€‚ ç»˜åˆ¶ï¼šæ¸²æŸ“çš„æ–¹å¼ã€‚å°†æ‰€æœ‰LayoutNodeç•Œé¢å…ƒç´ ä¼šç»˜åˆ¶åˆ°ç”»å¸ƒï¼ˆé€šå¸¸æ˜¯è®¾å¤‡å±å¹•ï¼‰ä¹‹ä¸Šã€‚   è¿™äº›é˜¶æ®µçš„é¡ºåºé€šå¸¸æ˜¯ç›¸åŒçš„ï¼Œä»è€Œè®©æ•°æ®èƒ½å¤Ÿæ²¿ä¸€ä¸ªæ–¹å‘ï¼ˆä»ç»„åˆåˆ°å¸ƒå±€ï¼Œå†åˆ°ç»˜åˆ¶ï¼‰ç”Ÿæˆå¸§ï¼ˆä¹Ÿç§°ä¸ºå•å‘æ•°æ®æµï¼‰ã€‚ æ‚¨å¯ä»¥æ”¾å¿ƒåœ°å‡è®¾æ¯ä¸ªå¸§éƒ½ä¼šä»¥è™šæ‹Ÿæ–¹å¼ç»å†è¿™ 3 ä¸ªé˜¶æ®µï¼Œä½†ä¸ºäº†ä¿éšœæ€§èƒ½ï¼ŒCompose...</div></div></div></a><a class="pagination-related" href="/2025/05/29/note/Android/compose/Compose%E7%9A%84%E6%89%8B%E5%8A%BF%E6%93%8D%E4%BD%9C%E5%92%8C%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86/" title="Composeçš„æ‰‹åŠ¿æ“ä½œå’Œäº‹ä»¶å¤„ç†"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-30</div><div class="info-item-2">Composeçš„æ‰‹åŠ¿æ“ä½œå’Œäº‹ä»¶å¤„ç†</div></div><div class="info-2"><div class="info-item-1">  Compose ä¸­çš„æ‰‹åŠ¿æ“ä½œæˆ–äº‹ä»¶å¤„ç†å…¨éƒ¨éƒ½æ˜¯ä»¥ Modifier ä¿®é¥°ç¬¦çš„å½¢å¼æä¾›çš„ï¼Œäº‹ä»¶å¤„ç†æŒ‰ç…§å±‚æ¬¡å¯ä»¥åˆ’åˆ†ä¸ºé«˜çº§äº‹ä»¶å¤„ç†APIå’Œä½çº§äº‹ä»¶å¤„ç†APIã€‚ å…¶ä¸­é«˜çº§äº‹ä»¶å¤„ç†APIæ˜¯ä½äºæ›´ä¸Šå±‚çš„APIï¼Œå®ƒä»¬éƒ½æ˜¯åŸºäºæ›´åº•å±‚çš„ä½çº§äº‹ä»¶å¤„ç†APIå®ç°çš„ï¼Œä¹Ÿæ˜¯å¼€å‘ä¸­æ¯”è¾ƒå¸¸ç”¨çš„ã€‚é«˜çº§äº‹ä»¶å¤„ç†APIçš„åˆ†ç±»å¤§æ¦‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š  ç‚¹å‡»äº‹ä»¶ç›‘å¬ç‚¹å‡»äº‹ä»¶éå¸¸ç®€å•ï¼Œä½¿ç”¨Â clickableÂ å’ŒÂ combinedClickableÂ ä¿®é¥°ç¬¦å³å¯æ»¡è¶³éœ€æ±‚ï¼š 123456789101112131415161718@OptIn(ExperimentalFoundationApi::class)@Composablefun ClickableExample() &#123;    Column&#123;        Box(Modifier            .clickable &#123; println(&quot;clickable&quot;) &#125;            .size(30.dp)            .background(Color.Red))       ...</div></div></div></a><a class="pagination-related" href="/2022/08/22/posts/Activity%E7%9A%84%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/" title="Activityçš„å¯åŠ¨æµç¨‹"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-22</div><div class="info-item-2">Activityçš„å¯åŠ¨æµç¨‹</div></div><div class="info-2"><div class="info-item-1">Applicationçš„åˆå§‹åŒ–ä»åº”ç”¨è¿›ç¨‹åˆ°ç³»ç»Ÿè¿›ç¨‹ActivityThreadåœ¨åˆ›å»ºçš„æ—¶å€™ï¼Œä¼šå°†è‡ªå·±çš„ApplicationThreadç»‘å®šåˆ°AMSä¸­ã€‚  ActivityThread.main() ActivityThread.attach() IActivityManager.attachApplication(mAppThread) Binder.transact()        åº”ç”¨ç¨‹åºé€šè¿‡IActivityManageræ¥å£å‘èµ·ç³»ç»Ÿè°ƒç”¨ï¼Œè°ƒç”¨attachApplicationå¹¶ä¼ é€’IApplicationThreadï¼Œæ‰§è¡Œæµç¨‹ä»åº”ç”¨è¿›ç¨‹åˆ°äº†ç³»ç»Ÿè¿›ç¨‹ã€‚  ActivityManagerService.onTransact() ActivityManagerService.attachApplication(IApplicationThread thread)AMSä½œä¸ºIActivityServiceçš„æ¥å£çš„æœåŠ¡ç«¯å®ç°ï¼Œä¼šå“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œæœ€ç»ˆattachApplication(IApplicationThread...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/images/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">BravestSnail</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">78</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E5%8A%A8%E7%94%BBAPI"><span class="toc-number">1.</span> <span class="toc-text">é«˜çº§åŠ¨ç”»API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AnimatedVisibility"><span class="toc-number">1.1.</span> <span class="toc-text">AnimatedVisibility</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E5%AD%90%E9%A1%B9%E6%B7%BB%E5%8A%A0%E8%BF%9B%E5%85%A5%E5%92%8C%E9%80%80%E5%87%BA%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C"><span class="toc-number">1.1.1.</span> <span class="toc-text">ä¸ºå­é¡¹æ·»åŠ è¿›å…¥å’Œé€€å‡ºåŠ¨ç”»æ•ˆæœ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89Enter-Exit%E5%8A%A8%E7%94%BB"><span class="toc-number">1.1.2.</span> <span class="toc-text">è‡ªå®šä¹‰Enter&#x2F;ExitåŠ¨ç”»</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AnimatedContent"><span class="toc-number">1.2.</span> <span class="toc-text">AnimatedContent</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ContentTransform"><span class="toc-number">1.2.1.</span> <span class="toc-text">ContentTransform</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#slideIntoContainer-%E5%92%8C-slideOutOfContainer"><span class="toc-number">1.2.2.</span> <span class="toc-text">slideIntoContainerÂ å’ŒÂ slideOutOfContainer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SizeTransform"><span class="toc-number">1.2.3.</span> <span class="toc-text">SizeTransform</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Modifier-animateContentSize"><span class="toc-number">1.2.4.</span> <span class="toc-text">Modifier.animateContentSize</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Crossfade"><span class="toc-number">1.3.</span> <span class="toc-text">Crossfade</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#animateXXXAsState"><span class="toc-number">1.4.</span> <span class="toc-text">animateXXXAsState</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AnimationVector-TwoWayConverter"><span class="toc-number">1.4.1.</span> <span class="toc-text">AnimationVector &amp; TwoWayConverter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89TwoWayConverter"><span class="toc-number">1.4.2.</span> <span class="toc-text">è‡ªå®šä¹‰TwoWayConverter</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Transition"><span class="toc-number">1.5.</span> <span class="toc-text">Transition</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#updateTransition"><span class="toc-number">1.5.1.</span> <span class="toc-text">updateTransition</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MutableTransitionState"><span class="toc-number">1.5.2.</span> <span class="toc-text">MutableTransitionState</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#MutableTransitionState%EF%BC%9A%E4%B8%BA%E5%85%B6%E8%AE%BE%E7%BD%AE%E4%B8%8D%E5%90%8C%E7%9A%84%E7%9B%AE%E6%A0%87%E5%80%BC%E5%8F%AF%E7%AB%8B%E5%8D%B3%E8%A7%A6%E5%8F%91%E5%8A%A8%E7%94%BB"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">MutableTransitionStateï¼šä¸ºå…¶è®¾ç½®ä¸åŒçš„ç›®æ ‡å€¼å¯ç«‹å³è§¦å‘åŠ¨ç”»</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#MutableTransitionState-%E5%8F%AF%E4%BB%A5%E7%94%A8%E6%9D%A5%E7%9B%91%E5%90%AC%E5%8A%A8%E7%94%BB%E7%8A%B6%E6%80%81"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">MutableTransitionState å¯ä»¥ç”¨æ¥ç›‘å¬åŠ¨ç”»çŠ¶æ€</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#createChildTransition"><span class="toc-number">1.5.3.</span> <span class="toc-text">createChildTransition</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86-Transition-%E4%B8%8E-AnimatedVisibility-%E5%92%8C-AnimatedContent-%E9%85%8D%E5%90%88%E4%BD%BF%E7%94%A8"><span class="toc-number">1.5.4.</span> <span class="toc-text">å°† Transition ä¸ AnimatedVisibility å’Œ AnimatedContent é…åˆä½¿ç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E5%92%8C%E5%A4%8D%E7%94%A8-Transition"><span class="toc-number">1.5.5.</span> <span class="toc-text">å°è£…å’Œå¤ç”¨ Transition</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rememberInfiniteTransition"><span class="toc-number">1.5.6.</span> <span class="toc-text">rememberInfiniteTransition</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AnimationSpec"><span class="toc-number">1.6.</span> <span class="toc-text">AnimationSpec</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#spring%E5%BC%B9%E7%B0%A7%E5%8A%A8%E7%94%BB"><span class="toc-number">1.6.1.</span> <span class="toc-text">springå¼¹ç°§åŠ¨ç”»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tween%E8%A1%A5%E9%97%B4%E5%8A%A8%E7%94%BB"><span class="toc-number">1.6.2.</span> <span class="toc-text">tweenè¡¥é—´åŠ¨ç”»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#keyframes%E5%85%B3%E9%94%AE%E5%B8%A7%E5%8A%A8%E7%94%BB"><span class="toc-number">1.6.3.</span> <span class="toc-text">keyframeså…³é”®å¸§åŠ¨ç”»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#repeatable%E5%BE%AA%E7%8E%AF%E5%8A%A8%E7%94%BB"><span class="toc-number">1.6.4.</span> <span class="toc-text">repeatableå¾ªç¯åŠ¨ç”»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#infiniteRepeatable%E6%97%A0%E9%99%90%E5%BE%AA%E7%8E%AF%E5%8A%A8%E7%94%BB"><span class="toc-number">1.6.5.</span> <span class="toc-text">infiniteRepeatableæ— é™å¾ªç¯åŠ¨ç”»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#snap%E5%BF%AB%E9%97%AA%E5%8A%A8%E7%94%BB"><span class="toc-number">1.6.6.</span> <span class="toc-text">snapå¿«é—ªåŠ¨ç”»</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E7%94%BB%E5%BD%A2%E5%BC%8F%E7%9A%84%E7%9F%A2%E9%87%8F%E8%B5%84%E6%BA%90"><span class="toc-number">1.7.</span> <span class="toc-text">åŠ¨ç”»å½¢å¼çš„çŸ¢é‡èµ„æº</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%8E%E7%BA%A7%E5%8A%A8%E7%94%BBAPI"><span class="toc-number">2.</span> <span class="toc-text">ä½çº§åŠ¨ç”»API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Animatable"><span class="toc-number">2.1.</span> <span class="toc-text">Animatable</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%91%E5%90%AC%E5%8A%A8%E7%94%BB%E7%8A%B6%E6%80%81%E5%8F%98%E5%8C%96%E5%80%BC"><span class="toc-number">2.1.1.</span> <span class="toc-text">ç›‘å¬åŠ¨ç”»çŠ¶æ€å˜åŒ–å€¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%81%9C%E6%AD%A2%E5%8A%A8%E7%94%BB"><span class="toc-number">2.1.2.</span> <span class="toc-text">åœæ­¢åŠ¨ç”»</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Animation"><span class="toc-number">2.2.</span> <span class="toc-text">Animation</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#TargetBasedAnimation"><span class="toc-number">2.2.1.</span> <span class="toc-text">TargetBasedAnimation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DecayAnimation"><span class="toc-number">2.2.2.</span> <span class="toc-text">DecayAnimation</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%8B%E5%8A%BF%E5%92%8C%E5%8A%A8%E7%94%BB"><span class="toc-number">3.</span> <span class="toc-text">æ‰‹åŠ¿å’ŒåŠ¨ç”»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%97%E8%A1%A8%E5%8A%A8%E7%94%BB"><span class="toc-number">4.</span> <span class="toc-text">åˆ—è¡¨åŠ¨ç”»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MotionLayout%E5%8A%A8%E7%94%BB"><span class="toc-number">5.</span> <span class="toc-text">MotionLayoutåŠ¨ç”»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E4%B8%80%E4%BA%9B%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9CDemo"><span class="toc-number">6.</span> <span class="toc-text">å…¶ä»–ä¸€äº›åŠ¨ç”»æ•ˆæœDemo</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%A8%E6%9E%B6%E5%B1%8F%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C"><span class="toc-number">6.1.</span> <span class="toc-text">éª¨æ¶å±åŠ è½½åŠ¨ç”»æ•ˆæœ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B6%E8%97%8F%E6%8C%89%E9%92%AE%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C"><span class="toc-number">6.2.</span> <span class="toc-text">æ”¶è—æŒ‰é’®åŠ¨ç”»æ•ˆæœ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BB%91%E5%8A%A8%E5%88%97%E8%A1%A8%E6%97%B6%E9%A1%B6%E9%83%A8TopBar%E6%8A%98%E5%8F%A0%E9%9A%90%E8%97%8F%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C"><span class="toc-number">6.3.</span> <span class="toc-text">æ»‘åŠ¨åˆ—è¡¨æ—¶é¡¶éƒ¨TopBaræŠ˜å éšè—åŠ¨ç”»æ•ˆæœ</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/04/note/%E4%B8%8A%E4%B8%8B%E6%96%87Context/" title="ä¸Šä¸‹æ–‡Context">ä¸Šä¸‹æ–‡Context</a><time datetime="2025-06-04T12:46:35.127Z" title="å‘è¡¨äº 2025-06-04 20:46:35">2025-06-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/04/note/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" title="æ­£åˆ™è¡¨è¾¾å¼">æ­£åˆ™è¡¨è¾¾å¼</a><time datetime="2025-06-04T12:46:35.127Z" title="å‘è¡¨äº 2025-06-04 20:46:35">2025-06-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/04/note/%E6%B3%A8%E8%A7%A3%E5%92%8C%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8/" title="æ³¨è§£å’Œæ³¨è§£å¤„ç†å™¨">æ³¨è§£å’Œæ³¨è§£å¤„ç†å™¨</a><time datetime="2025-06-04T12:46:35.127Z" title="å‘è¡¨äº 2025-06-04 20:46:35">2025-06-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/04/note/%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E3%80%81%E5%8D%8F%E7%A8%8B%E7%9A%84%E5%8C%BA%E5%88%AB/" title="è¿›ç¨‹ã€çº¿ç¨‹ã€åç¨‹çš„åŒºåˆ«">è¿›ç¨‹ã€çº¿ç¨‹ã€åç¨‹çš„åŒºåˆ«</a><time datetime="2025-06-04T12:46:35.127Z" title="å‘è¡¨äº 2025-06-04 20:46:35">2025-06-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/04/note/kotlin/Kotlin%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/" title="Kotlinè¸©å‘è®°å½•">Kotlinè¸©å‘è®°å½•</a><time datetime="2025-06-04T12:46:35.127Z" title="å‘è¡¨äº 2025-06-04 20:46:35">2025-06-04</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By BravestSnail</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>