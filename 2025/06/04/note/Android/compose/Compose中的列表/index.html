<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Compose中的列表 | BravestSnail's Blog</title><meta name="author" content="BravestSnail"><meta name="copyright" content="BravestSnail"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Cloumn 和 Row如果是普通的不是特别长的列表，可以直接使用 Column 和 Row 组件，默认 Column 和 Row 组件是不支持滚动的，如果需要支持滚动可以在 Column 和 Row 组件上使用 Modifier.verticalScroll() 和Modifier.horizontalScroll() 修饰符 1234567891011121314151617181920212">
<meta property="og:type" content="article">
<meta property="og:title" content="Compose中的列表">
<meta property="og:url" content="https://bravestsnail.github.io/2025/06/04/note/Android/compose/Compose%E4%B8%AD%E7%9A%84%E5%88%97%E8%A1%A8/index.html">
<meta property="og:site_name" content="BravestSnail&#39;s Blog">
<meta property="og:description" content="Cloumn 和 Row如果是普通的不是特别长的列表，可以直接使用 Column 和 Row 组件，默认 Column 和 Row 组件是不支持滚动的，如果需要支持滚动可以在 Column 和 Row 组件上使用 Modifier.verticalScroll() 和Modifier.horizontalScroll() 修饰符 1234567891011121314151617181920212">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://bravestsnail.github.io/images/avatar.png">
<meta property="article:published_time" content="2025-06-04T12:46:35.121Z">
<meta property="article:modified_time" content="2025-06-04T12:46:35.122Z">
<meta property="article:author" content="BravestSnail">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://bravestsnail.github.io/images/avatar.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Compose中的列表",
  "url": "https://bravestsnail.github.io/2025/06/04/note/Android/compose/Compose%E4%B8%AD%E7%9A%84%E5%88%97%E8%A1%A8/",
  "image": "https://bravestsnail.github.io/images/avatar.png",
  "datePublished": "2025-06-04T12:46:35.121Z",
  "dateModified": "2025-06-04T12:46:35.122Z",
  "author": [
    {
      "@type": "Person",
      "name": "BravestSnail",
      "url": "https://bravestsnail.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/images/favicon.ico"><link rel="canonical" href="https://bravestsnail.github.io/2025/06/04/note/Android/compose/Compose%E4%B8%AD%E7%9A%84%E5%88%97%E8%A1%A8/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Compose中的列表',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>if(window.mermaid){mermaid.initialize({startOnLoad:true});}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/images/favicon.ico" alt="Logo"><span class="site-name">BravestSnail's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">Compose中的列表</span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">Compose中的列表</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-06-04T12:46:35.121Z" title="发表于 2025-06-04 20:46:35">2025-06-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-06-04T12:46:35.122Z" title="更新于 2025-06-04 20:46:35">2025-06-04</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h3 id="Cloumn-和-Row"><a href="#Cloumn-和-Row" class="headerlink" title="Cloumn 和 Row"></a>Cloumn 和 Row</h3><p>如果是普通的不是特别长的列表，可以直接使用 <code>Column</code> 和 <code>Row</code> 组件，默认 <code>Column</code> 和 <code>Row</code> 组件是不支持滚动的，如果需要支持滚动可以在 <code>Column</code> 和 <code>Row</code> 组件上使用 <code>Modifier.verticalScroll()</code> 和<code>Modifier.horizontalScroll()</code> 修饰符</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ColumnList</span><span class="params">(list: <span class="type">List</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    Box &#123;</span><br><span class="line">        Column(Modifier.verticalScroll(rememberScrollState())) &#123;</span><br><span class="line">            list.forEach &#123;</span><br><span class="line">                Text(it)</span><br><span class="line">                Divider()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">RowList</span><span class="params">(list: <span class="type">List</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    Box &#123;</span><br><span class="line">        Row(Modifier.horizontalScroll(rememberScrollState())) &#123;</span><br><span class="line">            list.forEach &#123;</span><br><span class="line">                Text(it)</span><br><span class="line">                Divider(Modifier.width(<span class="number">1.</span>dp).fillMaxHeight(), thickness = <span class="number">1.</span>dp)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Column 的 <code>verticalArrangement</code> 参数可以指定item在主轴不同的排列方式：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ColumnExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column(</span><br><span class="line">        modifier = Modifier.border(<span class="number">1.</span>dp, Color.Blue),</span><br><span class="line">        <span class="comment">// verticalArrangement = Arrangement.Top // 默认是Top</span></span><br><span class="line">    ) &#123;</span><br><span class="line">        Text(<span class="string">&quot;默认效果&quot;</span>, Modifier.background(Color.Green))</span><br><span class="line">        Text(<span class="string">&quot;默认效果&quot;</span>, Modifier.background(Color.Green))</span><br><span class="line">        Text(<span class="string">&quot;默认效果&quot;</span>, Modifier.background(Color.Green))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ColumnExample2</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column(</span><br><span class="line">        modifier = Modifier.border(<span class="number">1.</span>dp, Color.Blue),</span><br><span class="line">        verticalArrangement = Arrangement.Center</span><br><span class="line">    ) &#123;</span><br><span class="line">        Text(<span class="string">&quot;Arrangement.Center&quot;</span>, Modifier.background(Color.Green))</span><br><span class="line">        Text(<span class="string">&quot;Arrangement.Center&quot;</span>, Modifier.background(Color.Green))</span><br><span class="line">        Text(<span class="string">&quot;Arrangement.Center&quot;</span>, Modifier.background(Color.Green))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ColumnExample201</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column(</span><br><span class="line">        modifier = Modifier.border(<span class="number">1.</span>dp, Color.Blue),</span><br><span class="line">        verticalArrangement = Arrangement.SpaceAround</span><br><span class="line">    ) &#123;</span><br><span class="line">        Text(<span class="string">&quot;Arrangement.SpaceAround&quot;</span>, Modifier.background(Color.Green))</span><br><span class="line">        Text(<span class="string">&quot;Arrangement.SpaceAround&quot;</span>, Modifier.background(Color.Green))</span><br><span class="line">        Text(<span class="string">&quot;Arrangement.SpaceAround&quot;</span>, Modifier.background(Color.Green))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ColumnExample202</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column(</span><br><span class="line">        modifier = Modifier.border(<span class="number">1.</span>dp, Color.Blue),</span><br><span class="line">        verticalArrangement = Arrangement.SpaceBetween</span><br><span class="line">    ) &#123;</span><br><span class="line">        Text(<span class="string">&quot;Arrangement.SpaceBetween&quot;</span>, Modifier.background(Color.Green))</span><br><span class="line">        Text(<span class="string">&quot;Arrangement.SpaceBetween&quot;</span>, Modifier.background(Color.Green))</span><br><span class="line">        Text(<span class="string">&quot;Arrangement.SpaceBetween&quot;</span>, Modifier.background(Color.Green))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ColumnExample203</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column(</span><br><span class="line">        modifier = Modifier.border(<span class="number">1.</span>dp, Color.Blue),</span><br><span class="line">        verticalArrangement = Arrangement.SpaceEvenly</span><br><span class="line">    ) &#123;</span><br><span class="line">        Text(<span class="string">&quot;Arrangement.SpaceEvenly&quot;</span>, Modifier.background(Color.Green))</span><br><span class="line">        Text(<span class="string">&quot;Arrangement.SpaceEvenly&quot;</span>, Modifier.background(Color.Green))</span><br><span class="line">        Text(<span class="string">&quot;Arrangement.SpaceEvenly&quot;</span>, Modifier.background(Color.Green))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ColumnExample204</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column(</span><br><span class="line">        modifier = Modifier.border(<span class="number">1.</span>dp, Color.Blue),</span><br><span class="line">        verticalArrangement = Arrangement.spacedBy(<span class="number">10.</span>dp)</span><br><span class="line">    ) &#123;</span><br><span class="line">        Text(<span class="string">&quot;Arrangement.spacedBy(10.dp)&quot;</span>, Modifier.background(Color.Green))</span><br><span class="line">        Text(<span class="string">&quot;Arrangement.spacedBy(10.dp)&quot;</span>, Modifier.background(Color.Green))</span><br><span class="line">        Text(<span class="string">&quot;Arrangement.spacedBy(10.dp)&quot;</span>, Modifier.background(Color.Green))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ColumnExample205</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column(</span><br><span class="line">        modifier = Modifier.border(<span class="number">1.</span>dp, Color.Blue),</span><br><span class="line">        verticalArrangement = Arrangement.Bottom</span><br><span class="line">    ) &#123;</span><br><span class="line">        Text(<span class="string">&quot;Arrangement.Bottom&quot;</span>, Modifier.background(Color.Green))</span><br><span class="line">        Text(<span class="string">&quot;Arrangement.Bottom&quot;</span>, Modifier.background(Color.Green))</span><br><span class="line">        Text(<span class="string">&quot;Arrangement.Bottom&quot;</span>, Modifier.background(Color.Green))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/8f26c421ebe60e6d47e7183d3587a953.png" alt="在这里插入图片描述"></p>
<p>下面的动图总结了不同垂直排列方式的效果：</p>
<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/374518467aa25c0c48b6e9029fb281b4.gif" alt="在这里插入图片描述"></p>
<p>同样，通过 <code>horizontalAlignment</code> 参数可以指定item在交叉轴（横轴）上的排列方式：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ColumnExample3</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column(</span><br><span class="line">        modifier = Modifier.border(<span class="number">1.</span>dp, Color.Blue),</span><br><span class="line">        horizontalAlignment = Alignment.CenterHorizontally</span><br><span class="line">    ) &#123;</span><br><span class="line">        Text(<span class="string">&quot;ffff&quot;</span>, Modifier.background(Color.Green))</span><br><span class="line">        Text(<span class="string">&quot;Alignment.CenterHorizontally&quot;</span>, Modifier.background(Color.Green))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ColumnExample4</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column(</span><br><span class="line">        modifier = Modifier.border(<span class="number">1.</span>dp, Color.Blue),</span><br><span class="line">        horizontalAlignment = Alignment.End</span><br><span class="line">    ) &#123;</span><br><span class="line">        Text(<span class="string">&quot;kkk&quot;</span>, Modifier.background(Color.Green))</span><br><span class="line">        Text(<span class="string">&quot;Alignment.End&quot;</span>, Modifier.background(Color.Green))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/0ed9f7122ca4ed567619446fc8224820.png" alt="在这里插入图片描述"></p>
<p>Row 组件也可以通过 <code>horizontalArrangement</code> 参数指定item在水平方向的排列方式:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">RowExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> modifier = Modifier</span><br><span class="line">        .padding(<span class="number">5.</span>dp)</span><br><span class="line">        .clip(RoundedCornerShape(<span class="number">35</span>))</span><br><span class="line">        .background(Color.Green)</span><br><span class="line">    <span class="keyword">val</span> modifier2 = modifier</span><br><span class="line">        .width(<span class="number">50.</span>dp)</span><br><span class="line">        .padding(<span class="number">5.</span>dp)</span><br><span class="line">    Column &#123;</span><br><span class="line">        Divider()</span><br><span class="line">        Text(<span class="string">&quot;Equal Weight&quot;</span>)</span><br><span class="line">        Row &#123;</span><br><span class="line">            Box(modifier</span><br><span class="line">                .weight(<span class="number">1f</span>)</span><br><span class="line">                .padding(<span class="number">5.</span>dp)) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;A&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">            &#125;</span><br><span class="line">            Box(modifier</span><br><span class="line">                .weight(<span class="number">1f</span>)</span><br><span class="line">                .padding(<span class="number">5.</span>dp)) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;B&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">            &#125;</span><br><span class="line">            Box(modifier</span><br><span class="line">                .weight(<span class="number">1f</span>)</span><br><span class="line">                .padding(<span class="number">5.</span>dp)) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;C&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Divider()</span><br><span class="line">        Text(<span class="string">&quot;Arrangement.Start&quot;</span>)</span><br><span class="line">        Row(</span><br><span class="line">            modifier = Modifier.fillMaxWidth(),</span><br><span class="line">            horizontalArrangement = Arrangement.Start</span><br><span class="line">        ) &#123;</span><br><span class="line">            Box(modifier2) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;A&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">            &#125;</span><br><span class="line">            Box(modifier2) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;B&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">            &#125;</span><br><span class="line">            Box(modifier2) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;C&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Divider()</span><br><span class="line">        Text(<span class="string">&quot;Arrangement.Center&quot;</span>)</span><br><span class="line">        Row(</span><br><span class="line">            modifier = Modifier.fillMaxWidth(),</span><br><span class="line">            horizontalArrangement = Arrangement.Center</span><br><span class="line">        ) &#123;</span><br><span class="line">            Box(modifier2) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;A&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">            &#125;</span><br><span class="line">            Box(modifier2) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;B&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">            &#125;</span><br><span class="line">            Box(modifier2) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;C&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Divider()</span><br><span class="line">        Text(<span class="string">&quot;Arrangement.End&quot;</span>)</span><br><span class="line">        Row(</span><br><span class="line">            modifier = Modifier.fillMaxWidth(),</span><br><span class="line">            horizontalArrangement = Arrangement.End</span><br><span class="line">        ) &#123;</span><br><span class="line">            Box(modifier2) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;A&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">            &#125;</span><br><span class="line">            Box(modifier2) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;B&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">            &#125;</span><br><span class="line">            Box(modifier2) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;C&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Divider()</span><br><span class="line">        Text(<span class="string">&quot;Arrangement.SpaceBetween&quot;</span>)</span><br><span class="line">        Row(</span><br><span class="line">            modifier = Modifier.fillMaxWidth(),</span><br><span class="line">            horizontalArrangement = Arrangement.SpaceBetween</span><br><span class="line">        ) &#123;</span><br><span class="line">            Box(modifier2) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;A&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">            &#125;</span><br><span class="line">            Box(modifier2) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;B&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">            &#125;</span><br><span class="line">            Box(modifier2) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;C&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Divider()</span><br><span class="line">        Text(<span class="string">&quot;Arrangement.SpaceAround&quot;</span>)</span><br><span class="line">        Row(</span><br><span class="line">            modifier = Modifier.fillMaxWidth(),</span><br><span class="line">            horizontalArrangement = Arrangement.SpaceAround</span><br><span class="line">        ) &#123;</span><br><span class="line">            Box(modifier2) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;A&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">            &#125;</span><br><span class="line">            Box(modifier2) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;B&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">            &#125;</span><br><span class="line">            Box(modifier2) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;C&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Divider()</span><br><span class="line">        Text(<span class="string">&quot;Arrangement.SpaceEvenly&quot;</span>)</span><br><span class="line">        Row(</span><br><span class="line">            modifier = Modifier.fillMaxWidth(),</span><br><span class="line">            horizontalArrangement = Arrangement.SpaceEvenly</span><br><span class="line">        ) &#123;</span><br><span class="line">            Box(modifier2) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;A&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">            &#125;</span><br><span class="line">            Box(modifier2) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;B&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">            &#125;</span><br><span class="line">            Box(modifier2) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;C&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Divider()</span><br><span class="line">        Text(<span class="string">&quot;Arrangement.spacedBy(20.dp)&quot;</span>)</span><br><span class="line">        Row(</span><br><span class="line">            modifier = Modifier.fillMaxWidth(),</span><br><span class="line">            horizontalArrangement = Arrangement.spacedBy(<span class="number">20.</span>dp)</span><br><span class="line">        ) &#123;</span><br><span class="line">            Box(modifier2) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;A&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">            &#125;</span><br><span class="line">            Box(modifier2) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;B&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">            &#125;</span><br><span class="line">            Box(modifier2) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;C&quot;</span>, Modifier.align(Alignment.Center))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Divider()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/2426c8f7879fd4e9088710f860a30669.png" alt="在这里插入图片描述"></p>
<p>下面的动图总结了不同水平排列方式的效果：</p>
<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/8729f2ab63a31e07b00f30649ab78eec.gif" alt="在这里插入图片描述"></p>
<h3 id="LazyColumn-和-LazyRow"><a href="#LazyColumn-和-LazyRow" class="headerlink" title="LazyColumn 和 LazyRow"></a>LazyColumn 和 LazyRow</h3><p>这两个是支持惰性加载的列表组件，只有屏幕显示的部分才会真正被加载，对标传统View中的<code>RecyclerView</code></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LazyColumnList</span><span class="params">()</span></span> &#123;</span><br><span class="line">    LazyColumn(</span><br><span class="line">        Modifier</span><br><span class="line">            .fillMaxSize()</span><br><span class="line">            .background(Color.Gray),</span><br><span class="line">        contentPadding = PaddingValues(<span class="number">35.</span>dp), </span><br><span class="line">        verticalArrangement = Arrangement.spacedBy(<span class="number">10.</span>dp)</span><br><span class="line">    ) &#123;</span><br><span class="line">        items(<span class="number">50</span>) &#123; index -&gt;</span><br><span class="line">            CardContent(<span class="string">&quot;我是序号第 <span class="variable">$index</span> 的卡片&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/4315a062b12fe5cc1bf4215e9476d0e3.gif" alt="在这里插入图片描述"></p>
<p>在LazyList组件中是通过使用<code>items</code>或<code>item</code>这两个<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=DSL&spm=1001.2101.3001.7020">DSL</a>来添加item组件的，通过<code>item</code> DSL可以很方便的指定 header 和 footer</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LazyColumnList2</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> list = listOf(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>)</span><br><span class="line">    LazyColumn(</span><br><span class="line">        Modifier.fillMaxSize(),</span><br><span class="line">        contentPadding = PaddingValues(<span class="number">35.</span>dp),</span><br><span class="line">        verticalArrangement = Arrangement.spacedBy(<span class="number">10.</span>dp)</span><br><span class="line">    ) &#123;</span><br><span class="line">        item &#123;</span><br><span class="line">            Text(<span class="string">&quot;Header 第一项&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        items(<span class="number">5</span>) &#123; index -&gt;</span><br><span class="line">            Text(<span class="string">&quot;第 <span class="subst">$&#123;index + <span class="number">2</span>&#125;</span> 项&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        itemsIndexed(list) &#123; index, s -&gt;</span><br><span class="line">            Text(<span class="string">&quot;第 <span class="subst">$&#123;index + <span class="number">7</span>&#125;</span> 项 <span class="variable">$s</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        item &#123;</span><br><span class="line">            Text(<span class="string">&quot;Footer 最后一项&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/cab2c27ac413b3c8472adc3882b066af.png" alt="在这里插入图片描述"></p>
<h4 id="粘性-header"><a href="#粘性-header" class="headerlink" title="粘性 header"></a>粘性 header</h4><p>粘性header通过 <code>stickyHeader</code> 这个DSL来实现：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalFoundationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LazyColumnList5</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> sections = listOf(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>, <span class="string">&quot;D&quot;</span>, <span class="string">&quot;E&quot;</span>, <span class="string">&quot;F&quot;</span>, <span class="string">&quot;G&quot;</span>)</span><br><span class="line">    LazyColumn(</span><br><span class="line">        <span class="comment">/*reverseLayout = true, */</span></span><br><span class="line">        contentPadding = PaddingValues(<span class="number">15.</span>dp)</span><br><span class="line">    ) &#123;</span><br><span class="line">        sections.forEach &#123; section -&gt;</span><br><span class="line">            stickyHeader &#123;</span><br><span class="line">                Text(</span><br><span class="line">                    <span class="string">&quot;Section <span class="variable">$section</span> 粘性Header&quot;</span>,</span><br><span class="line">                    Modifier</span><br><span class="line">                        .fillMaxWidth()</span><br><span class="line">                        .background(Color.LightGray)</span><br><span class="line">                        .padding(<span class="number">8.</span>dp)</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">            items(<span class="number">10</span>) &#123;</span><br><span class="line">                CardContent(<span class="string">&quot;Item <span class="variable">$it</span> from the section <span class="variable">$section</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/f4643b8069867ebe8d992b21537c0fac.gif" alt="在这里插入图片描述"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalFoundationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LazyRowExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    LazyRow(</span><br><span class="line">        Modifier</span><br><span class="line">            .fillMaxWidth()</span><br><span class="line">            .background(Color.Gray),</span><br><span class="line">        contentPadding = PaddingValues(<span class="number">15.</span>dp),</span><br><span class="line">        horizontalArrangement = Arrangement.spacedBy(<span class="number">10.</span>dp)</span><br><span class="line">    ) &#123;</span><br><span class="line">        stickyHeader &#123;</span><br><span class="line">            Box(Modifier</span><br><span class="line">                .height(<span class="number">150.</span>dp)</span><br><span class="line">                .background(Color.Red)</span><br><span class="line">                .padding(<span class="number">8.</span>dp)) &#123;</span><br><span class="line">                Text(text = <span class="string">&quot;粘性Header&quot;</span>, color = Color.White, fontSize = <span class="number">20.</span>sp)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        items(<span class="number">50</span>) &#123; index -&gt;</span><br><span class="line">            CardContent2(index)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/4f31a49c9ddef0a49fac5730c207258c.gif" alt="在这里插入图片描述"></p>
<p>如需实现具有多个标题的列表（例如“联系人列表”），可以执行以下操作，先通过<code>groupBy</code>进行分组：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> This ideally would be done in the ViewModel</span></span><br><span class="line"><span class="keyword">val</span> grouped = contacts.groupBy &#123; it.firstName[<span class="number">0</span>] &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@OptIn(ExperimentalFoundationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ContactsList</span><span class="params">(grouped: <span class="type">Map</span>&lt;<span class="type">Char</span>, List&lt;Contact&gt;&gt;)</span></span> &#123;</span><br><span class="line">    LazyColumn &#123;</span><br><span class="line">        grouped.forEach &#123; (initial, contactsForInitial) -&gt;</span><br><span class="line">            stickyHeader &#123;</span><br><span class="line">                CharacterHeader(initial)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            items(contactsForInitial) &#123; contact -&gt;</span><br><span class="line">                ContactListItem(contact)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="自定义排列方式"><a href="#自定义排列方式" class="headerlink" title="自定义排列方式"></a>自定义排列方式</h4><p>通常，延迟列表包含许多项，并且这些项所占空间大于滚动容器的大小。不过，如果列表中填充的项很少，那么在设计中，您可以对这些项在视口中的位置做出更具体的要求。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">TopWithFooterExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> list = listOf(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>, <span class="string">&quot;I am the Footer&quot;</span>)</span><br><span class="line">    LazyColumn(</span><br><span class="line">        Modifier.fillMaxHeight(),</span><br><span class="line">        contentPadding = PaddingValues(<span class="number">15.</span>dp),</span><br><span class="line">        verticalArrangement = TopWithFooter <span class="comment">// 使用自定义垂直 Arrangement</span></span><br><span class="line">    ) &#123;</span><br><span class="line">        itemsIndexed(list) &#123; index, item -&gt;</span><br><span class="line">            Box(modifier = Modifier</span><br><span class="line">                .background(Color.Blue)</span><br><span class="line">                .padding(<span class="number">10.</span>dp)) &#123;</span><br><span class="line">                Text(<span class="string">&quot;第 <span class="variable">$index</span> 项 <span class="variable">$item</span>&quot;</span>, fontSize = <span class="number">20.</span>sp, color = Color.White)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">object</span> TopWithFooter : Arrangement.Vertical &#123;</span><br><span class="line">    <span class="comment">// 重写 arrange 方法</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> Density.<span class="title">arrange</span><span class="params">(totalSize: <span class="type">Int</span>, sizes: <span class="type">IntArray</span>, outPositions: <span class="type">IntArray</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">var</span> y = <span class="number">0</span></span><br><span class="line">        <span class="comment">// 首先，它会将列表项逐个放在相应位置。</span></span><br><span class="line">        sizes.forEachIndexed &#123; index, size -&gt;</span><br><span class="line">            outPositions[index] = y</span><br><span class="line">            y += size</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 其次，如果所用总高度低于视口高度，则会将页脚放置在底部：</span></span><br><span class="line">        <span class="keyword">if</span> (y &lt; totalSize) &#123;</span><br><span class="line">            <span class="keyword">val</span> lastIndex = outPositions.lastIndex</span><br><span class="line">            outPositions[lastIndex] = totalSize - sizes.last()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/a57b76852465d79ca0004346bc0ba1fb.png" alt="在这里插入图片描述"></p>
<h4 id="contentPadding-内容边距"><a href="#contentPadding-内容边距" class="headerlink" title="contentPadding 内容边距"></a>contentPadding 内容边距</h4><p>使用<code>LazyList</code>时，如果使用普通的 <code>Modifier.padding()</code> 为其添加<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%86%85%E8%BE%B9%E8%B7%9D&spm=1001.2101.3001.7020">内边距</a>，效果不会像我们期望的那样，而是会在滑动到边界位置时内容出现padding大小的截断：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AlignYourBodyRow</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    modifier: <span class="type">Modifier</span> = Modifier</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    LazyRow(</span><br><span class="line">        horizontalArrangement = Arrangement.spacedBy(<span class="number">8.</span>dp),</span><br><span class="line">        <span class="comment">// 使用修饰符修改左右的padding会导致滑动的时候出现截断</span></span><br><span class="line">        modifier = modifier.padding(horizontal = <span class="number">16.</span>dp), </span><br><span class="line">    ) &#123;</span><br><span class="line">        items(alignYourBodyData) &#123; item -&gt;</span><br><span class="line">            AlignYourBodyElement(item.drawable, item.text)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/e8d0fa4bf6875032ac43cf25ad9fabac.gif" alt="在这里插入图片描述"></p>
<p>此时正确的做法应当使用 <code>LazyList</code> 的 <code>contentPadding</code> 属性来设置内边距：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AlignYourBodyRow</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    modifier: <span class="type">Modifier</span> = Modifier</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    LazyRow(</span><br><span class="line">        horizontalArrangement = Arrangement.spacedBy(<span class="number">8.</span>dp), </span><br><span class="line">        contentPadding = PaddingValues(horizontal = <span class="number">16.</span>dp), <span class="comment">// 为列表设置正确的内边距</span></span><br><span class="line">        modifier = modifier</span><br><span class="line">    ) &#123;</span><br><span class="line">        items(alignYourBodyData) &#123; item -&gt;</span><br><span class="line">            AlignYourBodyElement(item.drawable, item.text)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/2c5a68c227cadbb92060e32826b4597b.gif" alt="在这里插入图片描述"><br>可以仔细观察对比一下二者的不同。</p>
<h4 id="显示返回顶部按钮"><a href="#显示返回顶部按钮" class="headerlink" title="显示返回顶部按钮"></a>显示返回顶部按钮</h4><p>通过 <code>scrollState.firstVisibleItemIndex &gt; 0</code> 判断是否向下滚动了，然后通过 <code>scrollState.scrollToItem(0)</code> 返回顶部</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LazyColumnList3</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> scrollState = rememberLazyListState(<span class="number">15</span>) <span class="comment">// 从index=15的开始显示</span></span><br><span class="line">    Box &#123;</span><br><span class="line">        LazyColumn(</span><br><span class="line">            Modifier</span><br><span class="line">                .fillMaxHeight()</span><br><span class="line">                .background(Color.Gray), </span><br><span class="line">            verticalArrangement = Arrangement.spacedBy(<span class="number">10.</span>dp),</span><br><span class="line">            state = scrollState</span><br><span class="line">        ) &#123;</span><br><span class="line">            items(<span class="number">50</span>) &#123; index -&gt;</span><br><span class="line">                CardContent(<span class="string">&quot;我是序号第 <span class="variable">$index</span> 的卡片&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">val</span> showScrollToTopButton <span class="keyword">by</span> remember &#123;</span><br><span class="line">            derivedStateOf &#123; scrollState.firstVisibleItemIndex &gt; <span class="number">10</span> &#125; <span class="comment">// 这里根据实际业务一页大概展示多少条，可以判断超过一页后再显示</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (showScrollToTopButton) &#123;</span><br><span class="line">            <span class="keyword">val</span> scope = rememberCoroutineScope()</span><br><span class="line">            ExtendedFloatingActionButton(</span><br><span class="line">                text = &#123;</span><br><span class="line">                    Column &#123;</span><br><span class="line">                        Icon(Icons.Default.KeyboardArrowUp, <span class="literal">null</span>)</span><br><span class="line">                        Text(<span class="string">&quot;Top&quot;</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                onClick = &#123;</span><br><span class="line">                    scope.launch &#123; scrollState.scrollToItem(<span class="number">0</span>) &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                shape = CircleShape, <span class="comment">// RoundedCornerShape(15),</span></span><br><span class="line">                modifier = Modifier.size(<span class="number">70.</span>dp).align(Alignment.BottomEnd),</span><br><span class="line">                backgroundColor = Color.Green</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/1344218d8fb6a2ff5936dcb09d8dcff9.gif" alt="在这里插入图片描述"><br>可以使用 <code>AnimatedVisibility</code> 为按钮添加动画：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalAnimationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LazyColumnList3</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> scrollState = rememberLazyListState(<span class="number">15</span>) <span class="comment">// 从index=15的开始显示</span></span><br><span class="line">    Box &#123;</span><br><span class="line">        LazyColumn(</span><br><span class="line">            Modifier</span><br><span class="line">                .fillMaxHeight()</span><br><span class="line">                .background(Color.Gray),</span><br><span class="line">            verticalArrangement = Arrangement.spacedBy(<span class="number">10.</span>dp),</span><br><span class="line">            state = scrollState</span><br><span class="line">        ) &#123;</span><br><span class="line">            items(<span class="number">50</span>) &#123; index -&gt;</span><br><span class="line">                CardContent(<span class="string">&quot;我是序号第 <span class="variable">$index</span> 的卡片&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">val</span> showScrollToTopButton <span class="keyword">by</span> remember &#123;</span><br><span class="line">            derivedStateOf &#123; scrollState.firstVisibleItemIndex &gt; <span class="number">10</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        AnimatedVisibility(</span><br><span class="line">            visible = showScrollToTopButton,</span><br><span class="line">            modifier = Modifier.align(Alignment.BottomEnd),</span><br><span class="line">            enter = fadeIn() + scaleIn(),</span><br><span class="line">            exit = fadeOut() + scaleOut(),</span><br><span class="line">        ) &#123; </span><br><span class="line">            <span class="keyword">val</span> scope = rememberCoroutineScope()</span><br><span class="line">            ExtendedFloatingActionButton(</span><br><span class="line">                text = &#123;</span><br><span class="line">                    Column &#123;</span><br><span class="line">                        Icon(Icons.Default.KeyboardArrowUp, <span class="literal">null</span>)</span><br><span class="line">                        Text(<span class="string">&quot;Top&quot;</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                onClick = &#123;</span><br><span class="line">                    scope.launch &#123; scrollState.scrollToItem(<span class="number">0</span>) &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                shape = CircleShape, <span class="comment">// RoundedCornerShape(15),</span></span><br><span class="line">                modifier = Modifier.size(<span class="number">70.</span>dp),  </span><br><span class="line">                backgroundColor = Color.Green</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用 <code>scrollToItem</code> 或 <code>animateScrollToItem</code> 时发现，有时不一定能够滑动到顶部，可以通过指定滑动的距离解决，如 <code>animateScrollToItem(0， -10000）</code>或者 <code>scrollBy(-10000f)</code></p>
<p><code>LazyListState</code>可以帮助我们分析滑动事件， 一个常见的例子是，系统会在用户滚动经过某个点后发送分析事件。 为了高效地解决此问题，我们可以使用 <code>snapshotFlow()</code>：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> listState = rememberLazyListState()</span><br><span class="line"></span><br><span class="line">LazyColumn(state = listState) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LaunchedEffect(listState) &#123;</span><br><span class="line">    snapshotFlow &#123; listState.firstVisibleItemIndex &#125;</span><br><span class="line">        .map &#123; index -&gt; index &gt; <span class="number">0</span> &#125;</span><br><span class="line">        .distinctUntilChanged()</span><br><span class="line">        .filter &#123; it == <span class="literal">true</span> &#125;</span><br><span class="line">        .collect &#123;</span><br><span class="line">            MyAnalyticsService.sendScrolledPastFirstItemEvent()</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>LazyListState</code> 还可以通过 <code>layoutInfo</code> 属性提供有关当前显示的所有列表项以及这些项在屏幕上的边界的信息。</p>
<h4 id="contentType-多类型列表"><a href="#contentType-多类型列表" class="headerlink" title="contentType 多类型列表"></a>contentType 多类型列表</h4><p>从 <code>Compose 1.2</code> 开始，为了最大限度地提高延迟布局的性能，建议将 <code>contentType</code> 添加到列表或网格中。 当列表或网格由多种不同类型的项组成时，这样可为布局的每一项指定内容类型：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MultiTypeList</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> list <span class="keyword">by</span> remember &#123; mutableStateOf(prepareNewsList()) &#125;</span><br><span class="line">    LazyColumn(</span><br><span class="line">        contentPadding = PaddingValues(<span class="number">15.</span>dp),</span><br><span class="line">        verticalArrangement = Arrangement.spacedBy(<span class="number">10.</span>dp)</span><br><span class="line">    ) &#123;</span><br><span class="line">        items(list, contentType = &#123; it.type &#125;) &#123; item -&gt;</span><br><span class="line">            <span class="keyword">if</span> (item.type == <span class="number">1</span>) &#123;</span><br><span class="line">                Card(elevation = <span class="number">8.</span>dp, modifier = Modifier.fillMaxWidth()) &#123;</span><br><span class="line">                    Row(</span><br><span class="line">                        horizontalArrangement = Arrangement.spacedBy(<span class="number">20.</span>dp),</span><br><span class="line">                        verticalAlignment = Alignment.CenterVertically</span><br><span class="line">                    ) &#123;</span><br><span class="line">                        Image(</span><br><span class="line">                            painter = painterResource(id = R.drawable.ic_sky),</span><br><span class="line">                            contentDescription = <span class="literal">null</span>,</span><br><span class="line">                            modifier = Modifier.size(<span class="number">100.</span>dp),</span><br><span class="line">                            contentScale = ContentScale.Crop</span><br><span class="line">                        )</span><br><span class="line">                        Text(item.name.repeat(<span class="number">2</span>), fontSize = <span class="number">20.</span>sp)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                CardContent(text = item.name.repeat(<span class="number">3</span>))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">prepareNewsList</span><span class="params">()</span></span> : List&lt;NewsItem&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> List(<span class="number">50</span>) &#123;</span><br><span class="line">        NewsItem(<span class="string">&quot;NewsItem <span class="variable">$it</span> &quot;</span>, <span class="keyword">if</span>(it % <span class="number">2</span> == <span class="number">0</span>) <span class="number">1</span> <span class="keyword">else</span> <span class="number">2</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">NewsItem</span>(<span class="keyword">val</span> name : String, <span class="keyword">val</span> type : <span class="built_in">Int</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/bff1e044e66ce11d4f2f8ec2020b0713.png" alt="在这里插入图片描述"></p>
<h4 id="延迟列表的使用注意事项"><a href="#延迟列表的使用注意事项" class="headerlink" title="延迟列表的使用注意事项"></a>延迟列表的使用注意事项</h4><h5 id="为列表项指定-key"><a href="#为列表项指定-key" class="headerlink" title="为列表项指定 key"></a>为列表项指定 key</h5><p>注意：实际业务中使用<code>LazyColumn</code>必须为每个<code>item</code>提供一个稳定的 <strong><code>唯一key</code></strong> (默认是将<code>position</code>作为索引)</p>
<p>键的类型必须受 <code>Bundle</code> 支持，这是 Android 的机制，旨在当重新创建 <code>activity</code> 时保持相应状态。</p>
<p><code>Bundle</code> 支持<strong>基本类型、枚举或 <code>Parcelable</code></strong> 等类型。</p>
<p><code>Bundle</code> 必须支持该键，以便在重新创建 activity 时，甚至在滚动离开此项然后滚动回来时，此项可组合项中的 <code>rememberSaveable</code> 仍可以恢复。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MessageList</span><span class="params">(messages: <span class="type">List</span>&lt;<span class="type">Message</span>&gt;)</span></span> &#123;</span><br><span class="line">    LazyColumn &#123;</span><br><span class="line">        items(</span><br><span class="line">            items = messages,</span><br><span class="line">            key = &#123; message -&gt;</span><br><span class="line">                <span class="comment">// Return a stable + unique key for the item</span></span><br><span class="line">                message.id</span><br><span class="line">            &#125;</span><br><span class="line">        ) &#123; message -&gt;</span><br><span class="line">            MessageRow(message)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="避免使用大小为-0-像素的列表项"><a href="#避免使用大小为-0-像素的列表项" class="headerlink" title="避免使用大小为 0 像素的列表项"></a>避免使用大小为 0 像素的列表项</h5><p>如果使用分页，<strong>尤其是在加载图片列表时，必须为每个列表项预先提供一个固定高度大小的占位符</strong>，因为<code>LazyColumn</code>会在首次测量时认为高度没有限制，会一直进行组合，直到计算的测量高度填满可用的视图窗口，然后停止组合。</p>
<p>如果没有提供占位符(高度是<code>0px</code>)或者提供了高度很小的占位符，则意味着在首次测量时，<code>LazyColumn</code>会组合它的所有项，因为高度为<code>0</code>的项可以很容易容纳到当前窗口中。而在几毫秒之后，图片又加载出来了，<code>LazyColumn</code>开始重组显示图片，但此时只有一部分能被容纳到窗口中，因此<code>LazyColumn</code>会舍弃最开始组合的不必要的其他所有项。为了避免这种性能损耗，应该为每个<code>item</code>提供一个默认的高度大小的占位符，<strong>最好的做法是保证加载前后的item高度大小不变</strong>。</p>
<h5 id="避免嵌套可以同方向滚动的组件"><a href="#避免嵌套可以同方向滚动的组件" class="headerlink" title="避免嵌套可以同方向滚动的组件"></a>避免嵌套可以同方向滚动的组件</h5><p>这仅适用于将没有预定义尺寸的可滚动子级嵌套在可向同一方向滚动的另一个父级中的情况。</p>
<p>例如，尝试在可垂直滚动的 <code>Column</code> 父级中嵌套没有固定高度的子级 <code>LazyColumn</code>：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Throws IllegalStateException</span></span><br><span class="line">Column(</span><br><span class="line">  modifier = Modifier.verticalScroll(state)</span><br><span class="line">) &#123;</span><br><span class="line">   LazyColumn &#123;</span><br><span class="line">       <span class="comment">// ...</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Compose不支持嵌套同方向的滚动列表，比如<code>LazyColumn</code>里嵌套<code>LazyColumn</code>，这种小心思就别想了，Google不让你这么玩~</p>
<p>但是可以在<code>Row</code>中嵌套<code>LazyColumn</code>，如果一定要在<code>Column</code>中嵌套<code>LazyColumn</code>，必须为<code>LazyColumn</code>指定固定的大小：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Column(</span><br><span class="line">   modifier = Modifier.verticalScroll(scrollState)</span><br><span class="line">) &#123;</span><br><span class="line">   LazyColumn(</span><br><span class="line">       modifier = Modifier.height(<span class="number">200.</span>dp)</span><br><span class="line">   ) &#123;</span><br><span class="line">       <span class="comment">// ...</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>总之，官方是不推荐嵌套同方向滚动的组件的，但是如果你硬要这么做，就必须为内层的滚动组件设置一个固定的大小。即不支持两个无界大小的滚动组件嵌套。</p>
<h5 id="尽量避免将多个元素放入一个-item-项中"><a href="#尽量避免将多个元素放入一个-item-项中" class="headerlink" title="尽量避免将多个元素放入一个 item{...} 项中"></a>尽量避免将多个元素放入一个 <code>item&#123;...&#125;</code> 项中</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">LazyVerticalGrid(</span><br><span class="line">   <span class="comment">// ...</span></span><br><span class="line">) &#123;</span><br><span class="line">   item &#123; Item(<span class="number">0</span>) &#125;</span><br><span class="line">   item &#123;</span><br><span class="line">       Item(<span class="number">1</span>)</span><br><span class="line">       Item(<span class="number">2</span>)</span><br><span class="line">   &#125;</span><br><span class="line">   item &#123; Item(<span class="number">3</span>) &#125;</span><br><span class="line">   <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在此示例中，第二个项 lambda 在一个代码块中发出 2 个项，<strong>当多个元素作为一个项的一部分发出时，系统会将其作为一个实体进行处理，这意味着这些元素无法再单独组合</strong>。</p>
<p>也就是说<strong>当其中一个元素需要重组时，系统会将lambda项中的所有元素都进行重组</strong>。如果过度使用，则可能会<strong>降低性能</strong>。</p>
<p>将所有元素放入一个项属于极端情况，完全违背了使用延迟布局的目的。除了潜在的性能问题外，这种情况还会干扰 <code>scrollToItem()</code> 和 <code>animateScrollToItem()</code>。如上面代码如果调用<code>scrollToItem(index = 2)</code> 则实际会滑动到<code>Item(3)</code>的位置，因为<code>Item(1)</code>和<code>Item(2)</code>被视为一个项。</p>
<p>不过，也有一些将多个元素放入一个项的有效用例，例如<strong>在一个列表内添加多条分隔线</strong>。你可能不希望分隔线更改滚动索引，因为分割线不应被视为独立元素。此外，由于分隔线占空间很小，因此性能不会受到影响。<br>分隔线可能需要在其之前的那个项可见时显示，这样分割线就可纳入前一个项中：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">LazyVerticalGrid(</span><br><span class="line">   <span class="comment">// ...</span></span><br><span class="line">) &#123;</span><br><span class="line">   item &#123; Item(<span class="number">0</span>) &#125;</span><br><span class="line">   item &#123;</span><br><span class="line">       Item(<span class="number">1</span>)</span><br><span class="line">       Divider()</span><br><span class="line">   &#125;</span><br><span class="line">   item &#123; Item(<span class="number">2</span>) &#125;</span><br><span class="line">   <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此外，如果要测试延时列表的性能应当在<code>release</code>版本的模式下测试，不应该测试<code>debug</code>版本（并且是在真机而不是模拟器上测试，多次测试结果）</p>
<h3 id="LazyVerticalGrid-和-LazyHorizontalGrid"><a href="#LazyVerticalGrid-和-LazyHorizontalGrid" class="headerlink" title="LazyVerticalGrid 和 LazyHorizontalGrid"></a>LazyVerticalGrid 和 LazyHorizontalGrid</h3><p>可以滑动的表格组件，同时支持Column和Row的<code>verticalArrangement</code> 和 <code>horizontalArrangement</code> 属性效果，可以通过 <code>columns</code> 和 <code>rows</code> 属性指定列数或行数，例如 <code>GridCells.Fixed(3)</code></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LazyVerticalGridExample</span><span class="params">()</span></span> &#123; </span><br><span class="line">    <span class="keyword">val</span> itemsIndexedList = (<span class="string">&#x27;A&#x27;</span>..<span class="string">&#x27;Z&#x27;</span>).toList()</span><br><span class="line">    LazyVerticalGrid(</span><br><span class="line">        columns = GridCells.Fixed(<span class="number">3</span>),</span><br><span class="line">        verticalArrangement = Arrangement.spacedBy(<span class="number">8.</span>dp),</span><br><span class="line">        horizontalArrangement = Arrangement.spacedBy(<span class="number">8.</span>dp),</span><br><span class="line">        contentPadding = PaddingValues(<span class="number">5.</span>dp)</span><br><span class="line">    ) &#123;</span><br><span class="line">        itemsIndexed(itemsIndexedList) &#123; index, item -&gt;</span><br><span class="line">            GridItem(<span class="string">&quot;Item at <span class="variable">$index</span> is <span class="variable">$item</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/4d34a5b7c95cc710a4dc31017d85b83b.gif" alt="在这里插入图片描述"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LazyHorizontalGridExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> itemsIndexedList = (<span class="string">&#x27;A&#x27;</span>..<span class="string">&#x27;Z&#x27;</span>).toList()</span><br><span class="line">    LazyHorizontalGrid(</span><br><span class="line">        rows = GridCells.Fixed(<span class="number">3</span>),</span><br><span class="line">        horizontalArrangement = Arrangement.spacedBy(<span class="number">16.</span>dp),</span><br><span class="line">        verticalArrangement = Arrangement.spacedBy(<span class="number">16.</span>dp),</span><br><span class="line">        contentPadding = PaddingValues(<span class="number">5.</span>dp)</span><br><span class="line">    ) &#123;</span><br><span class="line">        itemsIndexed(itemsIndexedList) &#123; index, item -&gt;</span><br><span class="line">            GridItem(<span class="string">&quot;Item at <span class="variable">$index</span> is <span class="variable">$item</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/aa1c8bea39ab2ce22924749fd787cc30.gif" alt="在这里插入图片描述"></p>
<h4 id="设置单元格的大小占比权重"><a href="#设置单元格的大小占比权重" class="headerlink" title="设置单元格的大小占比权重"></a>设置单元格的大小占比权重</h4><p>可以通过 <code>span</code> 参数设置每个单元格的大小占比权重，<code>span</code> 默认值是 1, 将 <code>span</code> 设置为不同的值可以实现简单的瀑布流效果:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LazyVerticalGridExample2_1</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> list = (<span class="string">&#x27;A&#x27;</span>..<span class="string">&#x27;Z&#x27;</span>).toList()</span><br><span class="line">    <span class="keyword">val</span> spanList = listOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">    LazyVerticalGrid(</span><br><span class="line">        columns = GridCells.Fixed(<span class="number">4</span>),</span><br><span class="line">        horizontalArrangement = Arrangement.spacedBy(<span class="number">8.</span>dp),</span><br><span class="line">        verticalArrangement = Arrangement.spacedBy(<span class="number">8.</span>dp),</span><br><span class="line">        contentPadding = PaddingValues(<span class="number">5.</span>dp)</span><br><span class="line">    ) &#123;</span><br><span class="line">        itemsIndexed(list, span=&#123;index, item -&gt; GridItemSpan( spanList[index])&#125;) &#123; index, item -&gt;</span><br><span class="line">            Text(</span><br><span class="line">                <span class="string">&quot;Item <span class="variable">$item</span>&quot;</span>,</span><br><span class="line">                modifier = Modifier</span><br><span class="line">                    .clip(RoundedCornerShape(<span class="number">5.</span>dp))</span><br><span class="line">                    .background(colors[index % colors.size])</span><br><span class="line">                    .height(<span class="number">80.</span>dp)</span><br><span class="line">                    .wrapContentSize()</span><br><span class="line">                    .padding(<span class="number">5.</span>dp),</span><br><span class="line">                color = Color.White,</span><br><span class="line">                fontSize = <span class="number">16.</span>sp</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/7f61e60d465e2d774f4387522e9d99f1.png" alt="在这里插入图片描述"></p>
<p>如果设置 <code>span = GridItemSpan(maxLineSpan)</code> 则会独占一整行，可以用来实现常见的分组标题的效果：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LazyVerticalGridExample2</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> sections = (<span class="number">0</span> until <span class="number">25</span>).toList().chunked(<span class="number">5</span>)</span><br><span class="line">    LazyVerticalGrid(</span><br><span class="line">        columns = GridCells.Fixed(<span class="number">4</span>),</span><br><span class="line">        horizontalArrangement = Arrangement.spacedBy(<span class="number">16.</span>dp),</span><br><span class="line">        verticalArrangement = Arrangement.spacedBy(<span class="number">16.</span>dp),</span><br><span class="line">        contentPadding = PaddingValues(<span class="number">5.</span>dp)</span><br><span class="line">    ) &#123;</span><br><span class="line">        sections.forEachIndexed &#123; index, items -&gt;</span><br><span class="line">            <span class="comment">// maxLineSpan 是 LazyGridItemSpanScope 的值之一</span></span><br><span class="line">            <span class="comment">// 设置 span = GridItemSpan(maxLineSpan) 即独占一整行</span></span><br><span class="line">            item(span = &#123; GridItemSpan(maxLineSpan) &#125;) &#123;</span><br><span class="line">                Text(</span><br><span class="line">                    <span class="string">&quot;This is section <span class="variable">$index</span>&quot;</span>,</span><br><span class="line">                    Modifier</span><br><span class="line">                        .clip(RoundedCornerShape(<span class="number">5.</span>dp))</span><br><span class="line">                        .background(MaterialTheme.colorScheme.primary)</span><br><span class="line">                        .height(<span class="number">50.</span>dp)</span><br><span class="line">                        .wrapContentSize(),</span><br><span class="line">                    color = Color.White,</span><br><span class="line">                    fontSize = <span class="number">16.</span>sp</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">            items(</span><br><span class="line">                items, </span><br><span class="line">                span = &#123; GridItemSpan( <span class="keyword">if</span>(it % <span class="number">2</span> == <span class="number">0</span>) <span class="number">1</span> <span class="keyword">else</span> <span class="number">2</span>) &#125;</span><br><span class="line">            ) &#123;</span><br><span class="line">                GridItem(<span class="string">&quot;Item <span class="variable">$it</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/a36a27b978c13bac9874cef22b187a62.gif" alt="在这里插入图片描述"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LazyHorizontalGridExample2</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> sections = (<span class="number">0</span> until <span class="number">25</span>).toList().chunked(<span class="number">5</span>)</span><br><span class="line">    LazyHorizontalGrid(</span><br><span class="line">        rows = GridCells.Fixed(<span class="number">3</span>),</span><br><span class="line">        horizontalArrangement = Arrangement.spacedBy(<span class="number">16.</span>dp),</span><br><span class="line">        verticalArrangement = Arrangement.spacedBy(<span class="number">16.</span>dp),</span><br><span class="line">        contentPadding = PaddingValues(<span class="number">5.</span>dp)</span><br><span class="line">    ) &#123;</span><br><span class="line">        sections.forEachIndexed &#123; index, items -&gt;</span><br><span class="line">            item(span = &#123; GridItemSpan(maxLineSpan) &#125;) &#123;</span><br><span class="line">                Text(</span><br><span class="line">                    <span class="string">&quot;section <span class="variable">$index</span>&quot;</span>,</span><br><span class="line">                    Modifier</span><br><span class="line">                        .clip(RoundedCornerShape(<span class="number">5.</span>dp))</span><br><span class="line">                        .background(MaterialTheme.colorScheme.primary)</span><br><span class="line">                        .wrapContentSize()</span><br><span class="line">                        .padding(<span class="number">8.</span>dp),</span><br><span class="line">                    color = Color.White,</span><br><span class="line">                    fontSize = <span class="number">16.</span>sp</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">            items(</span><br><span class="line">                items,</span><br><span class="line">                <span class="comment">// not required as it is the default</span></span><br><span class="line">                span = &#123; GridItemSpan(<span class="number">1</span>) &#125;</span><br><span class="line">            ) &#123;</span><br><span class="line">                GridItem(<span class="string">&quot;Item <span class="variable">$it</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/67c0ab6fd00a57358297b1d60b05f3ee.gif" alt="在这里插入图片描述"></p>
<h4 id="GridCells-Adaptive-自适应屏幕"><a href="#GridCells-Adaptive-自适应屏幕" class="headerlink" title="GridCells.Adaptive() 自适应屏幕"></a>GridCells.Adaptive() 自适应屏幕</h4><p>例如，以下代码设置每个单元格至少<code>100dp</code>, 这在旋转屏幕场景下会自适应：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LazyVerticalGridExample3</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> itemsIndexedList = (<span class="string">&#x27;A&#x27;</span>..<span class="string">&#x27;Z&#x27;</span>).toList()</span><br><span class="line">    LazyVerticalGrid( </span><br><span class="line">        columns = GridCells.Adaptive(<span class="number">100.</span>dp),</span><br><span class="line">        verticalArrangement = Arrangement.spacedBy(<span class="number">8.</span>dp),</span><br><span class="line">        horizontalArrangement = Arrangement.spacedBy(<span class="number">8.</span>dp),</span><br><span class="line">        contentPadding = PaddingValues(<span class="number">5.</span>dp)</span><br><span class="line">    ) &#123;</span><br><span class="line">        itemsIndexed(itemsIndexedList) &#123; index, item -&gt;</span><br><span class="line">            GridItem(<span class="string">&quot;Item at <span class="variable">$index</span> is <span class="variable">$item</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/046967c08027bb750aa8809f6bcdea7e.gif%23pic_center" alt="在这里插入图片描述"></p>
<h4 id="自定义columns的每一列的宽度占比"><a href="#自定义columns的每一列的宽度占比" class="headerlink" title="自定义columns的每一列的宽度占比"></a>自定义columns的每一列的宽度占比</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LazyVerticalGridExample4</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> itemsIndexedList = (<span class="string">&#x27;A&#x27;</span>..<span class="string">&#x27;Z&#x27;</span>).toList()</span><br><span class="line">    LazyVerticalGrid(</span><br><span class="line">        columns = <span class="keyword">object</span>: GridCells &#123;</span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> Density.<span class="title">calculateCrossAxisCellSizes</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">                availableSize: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                spacing: <span class="type">Int</span></span></span></span><br><span class="line"><span class="params"><span class="function">            )</span></span>: List&lt;<span class="built_in">Int</span>&gt; &#123;</span><br><span class="line">                <span class="comment">// 将第一列的宽度调整为可用空间的2/3，第二列的宽度调整为可用空间的1/3</span></span><br><span class="line">                <span class="keyword">val</span> firstColumn = (availableSize - spacing) * <span class="number">2</span> / <span class="number">3</span></span><br><span class="line">                <span class="keyword">val</span> secondColumn = availableSize - spacing - firstColumn</span><br><span class="line">                <span class="keyword">return</span> listOf(firstColumn, secondColumn)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        verticalArrangement = Arrangement.spacedBy(<span class="number">8.</span>dp),</span><br><span class="line">        horizontalArrangement = Arrangement.spacedBy(<span class="number">8.</span>dp),</span><br><span class="line">        contentPadding = PaddingValues(<span class="number">5.</span>dp)</span><br><span class="line">    ) &#123;</span><br><span class="line">        itemsIndexed(itemsIndexedList) &#123; index, item -&gt;</span><br><span class="line">            GridItem(<span class="string">&quot;Item at <span class="variable">$index</span> is <span class="variable">$item</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/444deb9e481501ebed3220ed5ae82bd5.gif" alt="在这里插入图片描述"></p>
<h3 id="LazyHorizontalStaggeredGrid-和-LazyVerticalStaggeredGrid-瀑布流"><a href="#LazyHorizontalStaggeredGrid-和-LazyVerticalStaggeredGrid-瀑布流" class="headerlink" title="LazyHorizontalStaggeredGrid 和 LazyVerticalStaggeredGrid 瀑布流"></a>LazyHorizontalStaggeredGrid 和 LazyVerticalStaggeredGrid 瀑布流</h3><p><code>LazyHorizontalStaggeredGrid</code> 和 <code>LazyVerticalStaggeredGrid</code> 主要为了支持瀑布流效果</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalFoundationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LazyVerticalStaggeredGridExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    LazyVerticalStaggeredGrid(</span><br><span class="line">        columns = StaggeredGridCells.Fixed(<span class="number">3</span>), </span><br><span class="line">        contentPadding = PaddingValues(<span class="number">8.</span>dp),</span><br><span class="line">        verticalArrangement = Arrangement.spacedBy(<span class="number">8.</span>dp),</span><br><span class="line">        horizontalArrangement = Arrangement.spacedBy(<span class="number">8.</span>dp)</span><br><span class="line">    )&#123;</span><br><span class="line">        itemsIndexed(list)&#123; index, item -&gt;</span><br><span class="line">            Card(</span><br><span class="line">                shape = RoundedCornerShape(<span class="number">4.</span>dp),</span><br><span class="line">                backgroundColor = colors[index % colors.size],</span><br><span class="line">            ) &#123;</span><br><span class="line">                Text(</span><br><span class="line">                    text = <span class="string">&quot;<span class="variable">$index</span> <span class="variable">$item</span>&quot;</span>,</span><br><span class="line">                    color = Color.White,</span><br><span class="line">                    modifier = Modifier.padding(<span class="number">10.</span>dp)</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/fa31a7d6e6a4084ba30d89586e618bf5.gif" alt="在这里插入图片描述"></p>
<p><code>LazyVerticalStaggeredGrid</code> 的单元格同样支持<code>Adaptive</code>自适应属性， 例如将上面的代码中 <code>columns</code> 属性改成 <code>StaggeredGridCells.Adaptive(80.dp)</code>，则效果如下：</p>
<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/70fc937609851e6fccefab21676506fb.gif" alt="在这里插入图片描述"></p>
<p><code>LazyHorizontalStaggeredGrid</code>使用是类似的：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalFoundationApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LazyHorizontalStaggeredGridExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    LazyHorizontalStaggeredGrid(</span><br><span class="line">        rows = StaggeredGridCells.Adaptive(<span class="number">80.</span>dp),</span><br><span class="line">        contentPadding = PaddingValues(<span class="number">8.</span>dp),</span><br><span class="line">        verticalArrangement = Arrangement.Center,</span><br><span class="line">        horizontalArrangement = Arrangement.spacedBy(<span class="number">8.</span>dp)</span><br><span class="line">    )&#123;</span><br><span class="line">        itemsIndexed(list)&#123; index, item -&gt;</span><br><span class="line">            Card(</span><br><span class="line">                shape = RoundedCornerShape(<span class="number">4.</span>dp),</span><br><span class="line">                backgroundColor = colors[index % colors.size],</span><br><span class="line">            ) &#123;</span><br><span class="line">                Box &#123;</span><br><span class="line">                    Text(</span><br><span class="line">                        text = <span class="string">&quot;<span class="variable">$index</span> <span class="variable">$item</span>&quot;</span>,</span><br><span class="line">                        color = Color.White,</span><br><span class="line">                        modifier = Modifier.padding(<span class="number">10.</span>dp).align(Alignment.Center)</span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/97af24033942cf4d9535a45edb0646b4.gif" alt="在这里插入图片描述"><br><code>LazyHorizontalStaggeredGrid</code> 和 <code>LazyVerticalStaggeredGrid</code> 中的 <code>items</code> DSL目前不支持设置<code>span</code>参数，这意味着不能在固定列数&#x2F;行数的情况下指定某个item占据多个行或多个列。也就是目前还无法实现如下效果：</p>
<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/33eee72abf0a54ffe23b3433eb151675.png" alt="在这里插入图片描述"><br>如果想要实现此效果，只能使用前面的 <code>LazyVerticalGrid</code> 然后结合 <code>Row</code>或<code>Column</code>甚至是<code>ConstraintLayout</code>来设置每个出现横纵交错的内容块里面的布局，比较麻烦，自适应性肯定不好，还是希望官方能给出支持。</p>
<h3 id="下拉刷新-Modifier-pullRefresh"><a href="#下拉刷新-Modifier-pullRefresh" class="headerlink" title="下拉刷新 Modifier.pullRefresh"></a>下拉刷新 Modifier.pullRefresh</h3><p>从<code>Compose 1.3.0</code>开始，SDK自带了对下拉刷新的支持（在此之前的版本是通过Accompanist库中提供的SwipeRefresh组件），通过在<code>Box</code>组件上应用修饰符<code>Modifier.pullRefresh</code>即可。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalMaterialApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">PullToRefreshModifier</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> refreshScope = rememberCoroutineScope()</span><br><span class="line">    <span class="keyword">var</span> refreshing <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">false</span>) &#125;</span><br><span class="line">    <span class="keyword">var</span> itemCount <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">15</span>) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">refresh</span><span class="params">()</span></span> = refreshScope.launch &#123;</span><br><span class="line">        refreshing = <span class="literal">true</span></span><br><span class="line">        delay(<span class="number">1000</span>)</span><br><span class="line">        itemCount += <span class="number">5</span></span><br><span class="line">        refreshing = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> state = rememberPullRefreshState(refreshing, ::refresh)</span><br><span class="line"></span><br><span class="line">    Box(Modifier.pullRefresh(state)) &#123;</span><br><span class="line">        LazyColumn(Modifier.fillMaxSize()) &#123;</span><br><span class="line">            items(itemCount) &#123;</span><br><span class="line">                ListItem &#123; Text(text = <span class="string">&quot;Item <span class="subst">$&#123;itemCount - it&#125;</span>&quot;</span>) &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        PullRefreshIndicator(refreshing, state, Modifier.align(Alignment.TopCenter))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/d64c773934d1347c6ededf36045acdbe.gif" alt="在这里插入图片描述"><br>其中<code>rememberPullRefreshState</code>需要传递一个<code>refreshing</code>标记状态以及一个<code>refresh</code>方法，<code>refresh</code>是请求刷新数据的业务逻辑，实际项目中，应该放在<code>ViewModel</code>中：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> viewModel: MyViewModel = viewModel()</span><br><span class="line"><span class="keyword">val</span> refreshing <span class="keyword">by</span> viewModel.isRefreshing</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> pullRefreshState = rememberPullRefreshState(refreshing, &#123; viewModel.refresh() &#125;)</span><br><span class="line"></span><br><span class="line">Box(Modifier.pullRefresh(pullRefreshState)) &#123;</span><br><span class="line">    LazyColumn(Modifier.fillMaxSize()) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    PullRefreshIndicator(refreshing, pullRefreshState, Modifier.align(Alignment.TopCenter))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此外，<code>Modifier.pullRefresh</code>还有一个重载函数，可以提供 <code>onPull</code> 和 <code>onRelease</code> 两个动作的回调，方便我们在不同的触发时机进行一些业务操作，如显示自定义的<code>Indicator</code>等。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExperimentalMaterialApi</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Modifier.<span class="title">pullRefresh</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    onPull: (<span class="type">pullDelta</span>: <span class="type">Float</span>) -&gt; <span class="type">Float</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    onRelease: <span class="type">suspend</span> (<span class="type">flingVelocity</span>: <span class="type">Float</span>) -&gt; <span class="type">Unit</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    enabled: <span class="type">Boolean</span> = <span class="literal">true</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: Modifier</span><br></pre></td></tr></table></figure>

<p>以下代码在下拉时根据下拉距离改变顶部的水平进度条的进度，在释放时进行刷新请求数据并执行动画</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalMaterialApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">PullToRefreshModifier2</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> refreshScope = rememberCoroutineScope()</span><br><span class="line">    <span class="keyword">val</span> threshold = <span class="number">160.</span>dp.toPx()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> refreshing <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">false</span>) &#125;</span><br><span class="line">    <span class="keyword">var</span> itemCount <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">15</span>) &#125;</span><br><span class="line">    <span class="keyword">var</span> currentDistance <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">0f</span>) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> progress = currentDistance / threshold</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">refresh</span><span class="params">()</span></span> = refreshScope.launch &#123;</span><br><span class="line">        refreshing = <span class="literal">true</span></span><br><span class="line">        delay(<span class="number">1000</span>)</span><br><span class="line">        itemCount += <span class="number">5</span></span><br><span class="line">        refreshing = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">onPull</span><span class="params">(pullDelta: <span class="type">Float</span>)</span></span>: <span class="built_in">Float</span> = <span class="keyword">when</span> &#123;</span><br><span class="line">        refreshing -&gt; <span class="number">0f</span></span><br><span class="line">        <span class="keyword">else</span> -&gt; &#123;</span><br><span class="line">            <span class="keyword">val</span> newOffset = (currentDistance + pullDelta).coerceAtLeast(<span class="number">0f</span>)</span><br><span class="line">            <span class="keyword">val</span> dragConsumed = newOffset - currentDistance</span><br><span class="line">            currentDistance = newOffset</span><br><span class="line">            dragConsumed</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">onRelease</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (refreshing) <span class="keyword">return</span> <span class="comment">// Already refreshing - don&#x27;t call refresh again.</span></span><br><span class="line">        <span class="keyword">if</span> (currentDistance &gt; threshold) refresh()</span><br><span class="line"></span><br><span class="line">        animate(</span><br><span class="line">            initialValue = currentDistance,</span><br><span class="line">            targetValue = <span class="number">0f</span>,</span><br><span class="line">            animationSpec = tween(<span class="number">1000</span>, easing = LinearOutSlowInEasing)</span><br><span class="line">        ) &#123; value, _ -&gt;</span><br><span class="line">            currentDistance = value</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Box(Modifier.pullRefresh(::onPull, &#123; onRelease() &#125;)) &#123;</span><br><span class="line">        LazyColumn &#123;</span><br><span class="line">            items(itemCount) &#123;</span><br><span class="line">                ListItem &#123; Text(text = <span class="string">&quot;Item <span class="subst">$&#123;itemCount - it&#125;</span>&quot;</span>) &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Custom progress indicator</span></span><br><span class="line">        AnimatedVisibility(visible = (refreshing || progress &gt; <span class="number">0</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (refreshing) &#123;</span><br><span class="line">                LinearProgressIndicator(Modifier.fillMaxWidth())</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                LinearProgressIndicator(progress, Modifier.fillMaxWidth())</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/5daea6ac478d1c89a5391e3068b64345.gif" alt="在这里插入图片描述"><br>将上面代码中的<code>LinearProgressIndicator</code>换成<code>CircularProgressIndicator</code>，还可以根据下拉的距离改变圆形<code>Indicator</code>到顶部的距离</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalMaterialApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">PullToRefreshModifier2</span><span class="params">()</span></span> &#123;</span><br><span class="line">  .......</span><br><span class="line">  Box(Modifier.pullRefresh(::onPull, &#123; onRelease() &#125;)) &#123;</span><br><span class="line">        LazyColumn &#123;</span><br><span class="line">            items(itemCount) &#123;</span><br><span class="line">                ListItem &#123; Text(text = <span class="string">&quot;Item <span class="subst">$&#123;itemCount - it&#125;</span>&quot;</span>) &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (currentDistance &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            CircularProgressIndicator(</span><br><span class="line">                modifier = Modifier</span><br><span class="line">                    .align(Alignment.TopCenter)</span><br><span class="line">                    .size(<span class="number">50.</span>dp)</span><br><span class="line">                    .offset(y = <span class="keyword">if</span> (refreshing) <span class="number">0.</span>dp <span class="keyword">else</span> currentDistance.toDp()),</span><br><span class="line">                color = Color.Red,</span><br><span class="line">                strokeWidth = <span class="number">3.</span>dp</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/236b87ebffcd138dd3fb88e08ee8bf64.gif" alt="在这里插入图片描述"><br>官方还提供了一个很方便的修饰符 <code>Modifier.pullRefreshIndicatorTransform</code> 来根据<code>PullRefreshState</code>自动改变<code>Indicator</code>的平移位置和缩放大小</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalMaterialApi::class)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">PullToRefreshModifier4</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> refreshScope = rememberCoroutineScope()</span><br><span class="line">    <span class="keyword">var</span> refreshing <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="literal">false</span>) &#125;</span><br><span class="line">    <span class="keyword">var</span> itemCount <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">15</span>) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">refresh</span><span class="params">()</span></span> = refreshScope.launch &#123;</span><br><span class="line">        refreshing = <span class="literal">true</span></span><br><span class="line">        delay(<span class="number">1500</span>)</span><br><span class="line">        itemCount += <span class="number">5</span></span><br><span class="line">        refreshing = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> state = rememberPullRefreshState(refreshing, ::refresh)</span><br><span class="line">    <span class="keyword">val</span> rotation = animateFloatAsState(state.progress * <span class="number">120</span>)</span><br><span class="line"></span><br><span class="line">    Box(Modifier.fillMaxSize().pullRefresh(state)) &#123;</span><br><span class="line">        LazyColumn &#123;</span><br><span class="line">            items(itemCount) &#123;</span><br><span class="line">                ListItem &#123; Text(text = <span class="string">&quot;Item <span class="subst">$&#123;itemCount - it&#125;</span>&quot;</span>) &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Surface(</span><br><span class="line">            modifier = Modifier</span><br><span class="line">                .size(<span class="number">50.</span>dp)</span><br><span class="line">                .align(Alignment.TopCenter)</span><br><span class="line">                .pullRefreshIndicatorTransform(state, scale = <span class="literal">true</span>)</span><br><span class="line">                .rotate(rotation.value),</span><br><span class="line">            shape = RoundedCornerShape(<span class="number">10.</span>dp),</span><br><span class="line">            color = Color.DarkGray,</span><br><span class="line">            elevation = <span class="keyword">if</span> (state.progress &gt; <span class="number">0</span> || refreshing) <span class="number">20.</span>dp <span class="keyword">else</span> <span class="number">0.</span>dp,</span><br><span class="line">        ) &#123;</span><br><span class="line">            Box &#123;</span><br><span class="line">                <span class="keyword">if</span> (refreshing) &#123;</span><br><span class="line">                    CircularProgressIndicator(</span><br><span class="line">                        modifier = Modifier</span><br><span class="line">                            .align(Alignment.Center)</span><br><span class="line">                            .size(<span class="number">30.</span>dp),</span><br><span class="line">                        color = Color.White,</span><br><span class="line">                        strokeWidth = <span class="number">3.</span>dp</span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/44f85b2f5dfec64269ed673b6003a779.gif" alt="在这里插入图片描述"></p>
<h3 id="Modifier-verticalScroll-和-Modifier-horizontalScroll-开启滚动特性"><a href="#Modifier-verticalScroll-和-Modifier-horizontalScroll-开启滚动特性" class="headerlink" title="Modifier.verticalScroll() 和 Modifier.horizontalScroll() 开启滚动特性"></a>Modifier.verticalScroll() 和 Modifier.horizontalScroll() 开启滚动特性</h3><p>本文开头提到可以在 <code>Column</code> 和 <code>Row</code> 组件上使用 <code>Modifier.verticalScroll()</code> 和<code>Modifier.horizontalScroll()</code> 修饰符使之成为可滚动列表，后来我发现其实这两个修饰符不止可以在这两个组件上应用，它们几乎可以在任意组件上应用，甚至在 <code>Box</code> 组件上也可以应用这样的修饰符来使内容成为可滚动列表。例如下面的示例代码：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">BoxScrollExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column(</span><br><span class="line">        modifier = Modifier.fillMaxSize(),</span><br><span class="line">        horizontalAlignment = Alignment.CenterHorizontally</span><br><span class="line">    ) &#123;</span><br><span class="line">        BoxNestedScrollExample()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">BoxNestedScrollExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Box(</span><br><span class="line">        modifier = Modifier</span><br><span class="line">            .width(<span class="number">200.</span>dp)</span><br><span class="line">            .background(Color.Magenta)</span><br><span class="line">            .verticalScroll(rememberScrollState())</span><br><span class="line">            .padding(<span class="number">32.</span>dp),</span><br><span class="line">        contentAlignment = Alignment.TopCenter</span><br><span class="line">    ) &#123;</span><br><span class="line">        Column &#123;</span><br><span class="line">            repeat(<span class="number">12</span>) &#123;</span><br><span class="line">                Box(</span><br><span class="line">                    modifier = Modifier</span><br><span class="line">                        .height(<span class="number">128.</span>dp)</span><br><span class="line">                        .verticalScroll(rememberScrollState())</span><br><span class="line">                ) &#123;</span><br><span class="line">                    Text(<span class="string">&quot;<span class="variable">$it</span> Scroll here&quot;</span>, fontSize = <span class="number">16.</span>sp,</span><br><span class="line">                        modifier = Modifier</span><br><span class="line">                            .border(<span class="number">12.</span>dp, Color.Cyan)</span><br><span class="line">                            .background(brush = Brush.verticalGradient(gradientColorsReversed))</span><br><span class="line">                            .padding(<span class="number">24.</span>dp)</span><br><span class="line">                            .height(<span class="number">180.</span>dp)</span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/567f752af30a81586dc25df99ed2b040.gif" alt="在这里插入图片描述"></p>
<p>这里在在 <code>Box</code> 组件上应用了<code>Modifier.verticalScroll()</code> 修饰符使之成为一个可纵向滚动的列表，当然要使组件纵向排列还得借助 <code>Column</code> 组件。但是这里值得注意的一点是，<code>Modifier.verticalScroll()</code> 这个修饰符居然连<strong>嵌套滑动</strong>也为我们处理好了，简直太贴心了，不得不感叹这个修饰符真是太强大了！有了它之后，夫复何求？</p>
<h3 id="Modifier-nestedScroll-开启嵌套滚动"><a href="#Modifier-nestedScroll-开启嵌套滚动" class="headerlink" title="Modifier.nestedScroll() 开启嵌套滚动"></a>Modifier.nestedScroll() 开启嵌套滚动</h3><p><code>Modifier.nestedScroll()</code> 是一个高级的专门用于处理嵌套滚动的修饰符，它可以让开发者参与嵌套滑动的各个部分当中详细定制滑动的偏移量的消费。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> Modifier.<span class="title">nestedScroll</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    connection: <span class="type">NestedScrollConnection</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    dispatcher: <span class="type">NestedScrollDispatcher</span>? = <span class="literal">null</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: Modifier</span><br></pre></td></tr></table></figure>

<p>使用 <code>nestedScroll</code> 参数列表中有一个必选参数 <code>connection</code> 和一个可选参数 <code>dispatcher</code></p>
<ul>
<li><strong><code>connection</code></strong>：嵌套滑动手势处理的核心逻辑，内部回调可以在子布局获得滑动事件前预先消费掉部分或全部手势偏移量，也可以获取子布局消费后剩下的手势偏移量。</li>
<li><strong><code>dispatcher</code></strong>：调度器，内部包含用于父布局的 <code>NestedScrollConnection</code> , 可以调用 <code>dispatch*</code> 系列方法来通知父布局发生滑动。</li>
</ul>
<p>有两种方式来参与嵌套的滚动：作为一个滚动子项，通过 <code>NestedScrollDispatcher</code> 将滚动事件分派到嵌套的滚动链；并通过提供 <code>NestedScrollConnection</code> 作为嵌套滚动链的成员，当下面的另一个嵌套滚动子项分派滚动事件时，将调用该连接。</p>
<p>作为链中的 <code>NestedScrollConnection</code> 参与是强制的，但是另一方面，通过<code>NestedScrollDispatcher</code>进行调度是可选的，因为在某些情况下，元素只是希望参与到嵌套的滚动过程中，但元素本身是不可滚动的。<br>。</p>
<p><strong>NestedScrollConnection</strong> 提供了 4 个回调方法分别对应嵌套滚动系统的 4 个阶段：</p>
<ol>
<li><p><strong><code>onPreScroll</code></strong>：当子项即将执行滚动操作时，将触发此回调，并给父级一个机会在此之前消耗部分子级的增量。此过程应发生在每次可滚动组件接收到增量并通过 <code>NestedScrollDispatcher</code> 分派的时候。子级的分派应考虑到其所有祖先消耗了多少，并相应地调整消耗。</p>
</li>
<li><p><strong><code>onPostScroll</code></strong>：当子项已经消耗了增量（考虑了父级在 1 中预消耗的部分）并希望将未消耗的增量通知祖先时，将触发此回调。此过程应发生在每当可滚动组件接收到增量并通过 <code>NestedScrollDispatcher</code> 分派的时候。任何接收 <code>NestedScrollConnection.onPostScroll</code> 的父级都应消耗不超过 <code>left</code> 的数量，并返回已消耗的数量。</p>
</li>
<li><p><strong><code>onPreFling</code></strong>: 在滚动子项停止拖动并带着某种速度飞动之前发生的阶段。此回调允许祖先消耗速度的一部分。此过程应在 <code>fling</code> 本身发生之前发生。类似于 <code>pre-scroll</code>，父级可以消耗速度的一部分，而下面的节点（包括分派子级）应相应地调整其逻辑以仅适应剩余速度。</p>
</li>
<li><p><strong><code>onPostFling</code></strong>: 这个阶段是指当滚动子项停止 <code>fling</code> 并希望通知祖先时，并提供未消耗的速度。 此过程应在滚动子项上的 <code>fling</code> 本身发生之后发生。分派节点的祖先将有机会使用提供的 <code>velocityLeft</code> 自行飞行。父级必须调用 <code>notifySelfFinish</code> 回调，以便继续传播剩余速度给上方的祖先。</p>
</li>
</ol>
<p>通过下面的例子我们可以观察在滑动过程中各个参数的值：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">TutorialContent</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column(modifier = Modifier.fillMaxSize().padding(<span class="number">8.</span>dp)) &#123;</span><br><span class="line">        NestedScrollExample()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> ColumnScope.<span class="title">NestedScrollExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> text <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="string">&quot;&quot;</span>) &#125;</span><br><span class="line">    <span class="comment">// 连接到嵌套滚动系统的接口</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// 将此 connection 传递给 nestedScroll 修饰符，以参与嵌套滚动过程，</span></span><br><span class="line">    <span class="comment">// 并在滚动子元素通过 NestedScrollDispatcher 分派嵌套滚动事件时接收它们。</span></span><br><span class="line">    <span class="comment">// 其中，滚动子元素是实际接收滚动事件并通过 NestedScrollDispatcher 分派它们的元素。 </span></span><br><span class="line">    <span class="keyword">val</span> nestedScrollConnection = remember &#123;</span><br><span class="line">        <span class="keyword">object</span> : NestedScrollConnection &#123; </span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onPreScroll</span><span class="params">(available: <span class="type">Offset</span>, source: <span class="type">NestedScrollSource</span>)</span></span>: Offset &#123;</span><br><span class="line">                text = <span class="string">&quot;onPreScroll()\navailable: <span class="variable">$available</span>\nsource: <span class="variable">$source</span>\n\n&quot;</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.onPreScroll(available, source)</span><br><span class="line">            &#125; </span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onPostScroll</span><span class="params">(consumed: <span class="type">Offset</span>, available: <span class="type">Offset</span>, source: <span class="type">NestedScrollSource</span>)</span></span>: Offset &#123;</span><br><span class="line">                text += <span class="string">&quot;onPostScroll()\nconsumed: <span class="variable">$consumed</span>\navailable: <span class="variable">$available</span>\nsource: <span class="variable">$source</span>\n\n&quot;</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.onPostScroll(consumed, available, source)</span><br><span class="line">            &#125; </span><br><span class="line">            <span class="keyword">override</span> <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">onPreFling</span><span class="params">(available: <span class="type">Velocity</span>)</span></span>: Velocity &#123;</span><br><span class="line">                text += <span class="string">&quot;onPreFling()\navailable: <span class="variable">$available</span>\n\n&quot;</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.onPreFling(available)</span><br><span class="line">            &#125; </span><br><span class="line">            <span class="keyword">override</span> <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">onPostFling</span><span class="params">(consumed: <span class="type">Velocity</span>, available: <span class="type">Velocity</span>)</span></span>: Velocity &#123;</span><br><span class="line">                text += <span class="string">&quot;onPostFling()\nconsumed: <span class="variable">$consumed</span>\navailable: <span class="variable">$available</span>\n\n&quot;</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.onPostFling(consumed, available)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Box(Modifier.weight(<span class="number">1f</span>).nestedScroll(nestedScrollConnection)) &#123;</span><br><span class="line">        LazyColumn(verticalArrangement = Arrangement.spacedBy(<span class="number">8.</span>dp)) &#123;</span><br><span class="line">            items(<span class="number">100</span>) &#123;</span><br><span class="line">                Text(</span><br><span class="line">                    text = <span class="string">&quot;I&#x27;m item <span class="variable">$it</span>&quot;</span>,</span><br><span class="line">                    modifier = Modifier</span><br><span class="line">                        .shadow(<span class="number">1.</span>dp, RoundedCornerShape(<span class="number">5.</span>dp))</span><br><span class="line">                        .fillMaxWidth()</span><br><span class="line">                        .background(Color.Magenta)</span><br><span class="line">                        .padding(<span class="number">12.</span>dp),</span><br><span class="line">                    fontSize = <span class="number">16.</span>sp,</span><br><span class="line">                    color = Color.White</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Spacer(Modifier.height(<span class="number">10.</span>dp))</span><br><span class="line">    Text(</span><br><span class="line">        text = text,</span><br><span class="line">        modifier = Modifier</span><br><span class="line">            .fillMaxWidth()</span><br><span class="line">            .verticalScroll(rememberScrollState())</span><br><span class="line">            .height(<span class="number">250.</span>dp)</span><br><span class="line">            .padding(<span class="number">10.</span>dp)</span><br><span class="line">            .background(BlueGrey400),</span><br><span class="line">        fontSize = <span class="number">16.</span>sp,</span><br><span class="line">        color = Color.White</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/0218d63795f6c05cda76d93b5e587bad.gif" alt="在这里插入图片描述"></p>
<p>这里可以观察到一件事就是，当手指向下滑动时，<code>available</code> 的 <code>y</code> 值是<strong>正值</strong>，当手指向上滑动时，<code>available</code> 的 <code>y</code> 值是<strong>负值</strong>，因此可以通过 <code>available.y &gt; 0</code> 来判断手指是否是下滑操作。</p>
<p>下面代码是官方API参考文档中提供的使用 <code>NestedScrollConnection</code> 实现的一个滑动列表顶部折叠工具栏的示例：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里我们希望充当这个LazyColumn的父元素，并参与其嵌套滚动。为LazyColumn制作一个折叠工具栏</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">NestedScrollWithCollapseToolBar</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> toolbarHeight = <span class="number">50.</span>dp</span><br><span class="line">    <span class="keyword">val</span> toolbarHeightPx = toolbarHeight.toPx()</span><br><span class="line">    <span class="keyword">var</span> toolbarOffsetHeightPx <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">0f</span>) &#125; <span class="comment">// 折叠工具栏的偏移量</span></span><br><span class="line">    <span class="comment">// 创建到嵌套滚动系统的连接，并倾听子LazyColumn内部发生的滚动</span></span><br><span class="line">    <span class="keyword">val</span> nestedScrollConnection = remember &#123;</span><br><span class="line">        <span class="keyword">object</span> : NestedScrollConnection &#123;</span><br><span class="line">            <span class="comment">// 如果需要的话，尝试在LazyColumn之前消费以折叠工具栏，因此需要预滚动</span></span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onPreScroll</span><span class="params">(available: <span class="type">Offset</span>, source: <span class="type">NestedScrollSource</span>)</span></span>: Offset &#123;</span><br><span class="line">                println(<span class="string">&quot;available.y = <span class="subst">$&#123;available.y&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">val</span> delta = available.y</span><br><span class="line">                <span class="keyword">val</span> newOffset = toolbarOffsetHeightPx + delta</span><br><span class="line">                toolbarOffsetHeightPx = newOffset.coerceIn(-toolbarHeightPx, <span class="number">0f</span>) <span class="comment">// 限制 toolbarOffsetHeightPx 不会越界</span></span><br><span class="line">                <span class="comment">// 这里有一个问题: 让我们假设我们在任何情况下消耗了0，</span></span><br><span class="line">                <span class="comment">// 因为我们希望 LazyColumn 能够滚动以获得良好的用户体验</span></span><br><span class="line">                <span class="keyword">return</span> Offset.Zero</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Box(</span><br><span class="line">        Modifier.fillMaxSize().nestedScroll(nestedScrollConnection) <span class="comment">// 作为父元素附加到嵌套的滚动系统</span></span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="comment">// 我们的列表内置嵌套滚动支持，将通知我们它的滚动</span></span><br><span class="line">        LazyColumn(contentPadding = PaddingValues(top = toolbarHeight)) &#123; <span class="comment">// 顶部预留出显示 TopAppBar 的空间</span></span><br><span class="line">            items(<span class="number">100</span>) &#123; index -&gt;</span><br><span class="line">                Text(<span class="string">&quot;I&#x27;m item <span class="variable">$index</span>&quot;</span>, modifier = Modifier.fillMaxWidth().padding(<span class="number">16.</span>dp))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        TopAppBar(</span><br><span class="line">            modifier = Modifier</span><br><span class="line">                .height(toolbarHeight)</span><br><span class="line">                .offset &#123; IntOffset(x = <span class="number">0</span>, y = toolbarOffsetHeightPx.roundToInt()) &#125;,</span><br><span class="line">            title = &#123; Text(<span class="string">&quot;toolbar offset is <span class="variable">$toolbarOffsetHeightPx</span>&quot;</span>) &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/6297a4367fd339322b5589eed086ce90.gif" alt="在这里插入图片描述"></p>
<p>在上面代码中，注意应用<code>nestedScroll</code>修饰符的Box组件是作为父元素，而它包裹的 <code>LazyColumn</code> 是作为子元素，在滚动过程中 <code>LazyColumn</code> 会通过 <code>nestedScroll</code>提供的 <code>nestedScrollConnection</code> 参数不断的回调其中的方法。</p>
<p>在向上滚动时，<code>available.y</code> 是一个负值，而顶部的 <code>TopAppBar</code> 在向上滚动时需要收起，因此我们需要不断的修改 <code>TopAppBar</code> 的 <code>offsetY</code> 的值让它不断的减小，所以在每次 <code>onPreScroll</code> 回调中 <code>toolbarOffsetHeightPx</code> 不断累加<code>available.y</code> ，它就变成一个不断减小的负值。相反，在向下滚动时，我们需要不断的增大 <code>TopAppBar</code> 的 <code>offsetY</code> 的值，而此时 <code>available.y</code> 是一个正值，因此 <code>toolbarOffsetHeightPx</code> 不断累加它就会不断的变大。</p>
<p>我们只需把这个例子稍加修改，就可以实现一个常见的视差滚动效果，下面是利用上面代码实现的类似<a target="_blank" rel="noopener" href="https://cs.android.com/androidx/platform/frameworks/support/+/androidx-main:compose/material3/material3/samples/src/main/java/androidx/compose/material3/samples/AppBarSamples.kt;l=365?q=ExitUntilCollapsedLargeTopAppBar">Material3的LargeTopAppBa</a>r的效果：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MotionLayoutAnimationByNestedScroll</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> maxHeight = <span class="number">200f</span></span><br><span class="line">    <span class="keyword">val</span> minHeight = <span class="number">60f</span></span><br><span class="line">    <span class="keyword">val</span> toolbarHeightPx = maxHeight.dp.toPx()</span><br><span class="line">    <span class="keyword">val</span> toolbarMinHeightPx = minHeight.dp.toPx()</span><br><span class="line">    <span class="keyword">var</span> toolbarOffsetHeightPx <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">0f</span>) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> nestedScrollConnection = remember &#123;</span><br><span class="line">        <span class="keyword">object</span> : NestedScrollConnection &#123;</span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onPreScroll</span><span class="params">(available: <span class="type">Offset</span>, source: <span class="type">NestedScrollSource</span>)</span></span>: Offset &#123;</span><br><span class="line">                <span class="keyword">val</span> delta = available.y</span><br><span class="line">                <span class="keyword">val</span> newOffset = toolbarOffsetHeightPx + delta</span><br><span class="line">                <span class="comment">// 限制范围在 [-140.dp, 0] 之间</span></span><br><span class="line">                toolbarOffsetHeightPx = newOffset.coerceIn(toolbarMinHeightPx-toolbarHeightPx, <span class="number">0f</span>)</span><br><span class="line">                <span class="keyword">return</span> Offset.Zero</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> progress <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">0f</span>) &#125;</span><br><span class="line">    LaunchedEffect(key1 = toolbarOffsetHeightPx)&#123;</span><br><span class="line">        <span class="comment">// progress的值在topbar的高度从60.dp变化到200.dp过程中，会从0f变化到1f，反之从1f变化到0f</span></span><br><span class="line">        progress = ((toolbarHeightPx + toolbarOffsetHeightPx)/toolbarHeightPx-minHeight/maxHeight)/(<span class="number">1f</span>-minHeight/maxHeight)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Box(Modifier.fillMaxSize().nestedScroll(nestedScrollConnection)) &#123;</span><br><span class="line">        LazyColumn(contentPadding = PaddingValues(top = maxHeight.dp)) &#123;</span><br><span class="line">            items(<span class="number">100</span>) &#123; index -&gt;</span><br><span class="line">                Text(<span class="string">&quot;I&#x27;m item <span class="variable">$index</span>&quot;</span>, modifier = Modifier.fillMaxWidth().padding(<span class="number">16.</span>dp))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 在向下滚动时: TopBar的高度不断增加，progress 不断增大</span></span><br><span class="line">        <span class="comment">// 在向上滚动时: TopBar的高度不断减小，progress 不断减小</span></span><br><span class="line">        MyTopBar(height = (toolbarHeightPx + toolbarOffsetHeightPx).toDp(), progress)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MyTopBar</span><span class="params">(height: <span class="type">Dp</span>, progress: <span class="type">Float</span>)</span></span> &#123;</span><br><span class="line">    Box(</span><br><span class="line">        modifier = Modifier</span><br><span class="line">            .fillMaxWidth()</span><br><span class="line">            .height(height)</span><br><span class="line">            .background(Color.Red)</span><br><span class="line">    )&#123;</span><br><span class="line">        Row(</span><br><span class="line">            modifier = Modifier.fillMaxSize(),</span><br><span class="line">            verticalAlignment = Alignment.CenterVertically</span><br><span class="line">        )&#123;</span><br><span class="line">            Spacer(Modifier.width(<span class="number">24.</span>dp))</span><br><span class="line">            Spacer(Modifier.fillMaxWidth().weight(progress + <span class="number">0.001f</span>))</span><br><span class="line">            Column(horizontalAlignment = Alignment.CenterHorizontally)&#123;</span><br><span class="line">                Box(</span><br><span class="line">                    modifier = Modifier</span><br><span class="line">                        .fillMaxHeight().weight(<span class="number">1f</span>)</span><br><span class="line">                        .padding(vertical = <span class="number">10.</span>dp)</span><br><span class="line">                        .aspectRatio(<span class="number">1f</span>)</span><br><span class="line">                        .clip(CircleShape)</span><br><span class="line">                        .background(Color.White)</span><br><span class="line">                )&#123;</span><br><span class="line">                    Image(</span><br><span class="line">                        painter = painterResource(id = R.drawable.ic_head),</span><br><span class="line">                        contentDescription = <span class="string">&quot;&quot;</span>,</span><br><span class="line">                        modifier = Modifier.fillMaxSize()</span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">                Text(</span><br><span class="line">                    <span class="string">&quot;Hello World&quot;</span>,</span><br><span class="line">                    color = Color.White,</span><br><span class="line">                    modifier = Modifier.alpha(progress)</span><br><span class="line">                        .padding((<span class="number">8</span>*(progress*progress*progress)).dp),</span><br><span class="line">                    fontSize = (<span class="number">24</span>*(progress)).sp,</span><br><span class="line">                    maxLines = <span class="number">1</span>,</span><br><span class="line">                    overflow = TextOverflow.Ellipsis</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">            Text(</span><br><span class="line">                <span class="string">&quot;Hello World&quot;</span>,</span><br><span class="line">                color = Color.White,</span><br><span class="line">                modifier = Modifier.alpha(<span class="number">1f</span>-progress)</span><br><span class="line">                    .weight(<span class="number">1.001f</span>-progress)</span><br><span class="line">                    .padding(start = <span class="number">20.</span>dp),</span><br><span class="line">                fontSize = (<span class="number">24</span>*(<span class="number">1f</span>-progress)).sp,</span><br><span class="line">                maxLines = <span class="number">1</span>,</span><br><span class="line">                overflow = TextOverflow.Ellipsis</span><br><span class="line">            )</span><br><span class="line">            Spacer(Modifier.fillMaxWidth().weight(<span class="number">1f</span>))</span><br><span class="line">            Spacer(Modifier.width(<span class="number">24.</span>dp))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/80641ad26180f363587dccbe04707827.gif" alt="在这里插入图片描述"></p>
<p>这里同样的当向下滚动时，在 <code>onPreScroll</code> 回调中不断累加 <code>available.y</code> 的值到 <code>toolbarOffsetHeightPx</code> 中，因此它是一个不断增大的值， 所以在 <code>MyTopBar</code> 的原本高度值 <code>toolbarHeightPx</code> 的基础上加上这个 <code>toolbarOffsetHeightPx</code> 之后，<code>MyTopBar</code>的高度就会在向下滚动的过程中不断的增大。对应的，在向上滚动时，<code>MyTopBar</code>的高度就会不断的减小，因为其累加的 <code>toolbarOffsetHeightPx</code>值在不断减小。而 <code>MyTopBar</code> 内部的各个组件之间的状态是根据滑动过程中计算的偏移量百分比 <code>progress</code> 的值动态调整的。</p>
<p>上面两个例子中 <code>TopBar</code> 只需要参与到嵌套滑动的系统中，来获得一些增量值以改变自身的偏移量或高度值跟随滑动而变化，但是 <code>TopBar</code> 本身是不需要进行滑动的。</p>
<p>而对于可选的 <strong>NestedScrollDispatcher：</strong> 如果一个组件能够接收和响应拖动&#x2F;抛动事件，并且你希望该组件能够在滚动发生时通知父组件，则需要它，从而实现更好的整体协调。下面同样是官方文档提供的一个例子，其中子组件是可拖拽的，并且它通过分派嵌套的滚动事件来参与嵌套滚动链：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里以 Modifier.draggable 为例，为包含 draggable 的组件添加嵌套滚动的支持。</span></span><br><span class="line"><span class="comment">// (与Modifier.scrollable不同，Modifier.draggable默认是没有提供嵌套滚动支持的)</span></span><br><span class="line"><span class="comment">// 这将是一个通用组件，将在其他嵌套滚动组件中工作。</span></span><br><span class="line"><span class="comment">// 把它放在 LazyColumn 或 Modifier.verticalScroll 中，可以查看它们如何相互作用</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">NestedScrollByDispatcher</span><span class="params">(content: @<span class="type">Composable</span> (<span class="type">Float</span>) -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// first, state and it&#x27;s bounds</span></span><br><span class="line">    <span class="keyword">var</span> basicState <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">0f</span>) &#125;</span><br><span class="line">    <span class="keyword">val</span> minBound = -<span class="number">100f</span></span><br><span class="line">    <span class="keyword">val</span> maxBound = <span class="number">100f</span></span><br><span class="line">    <span class="comment">// Lambda 用来更新状态并返回消耗的量</span></span><br><span class="line">    <span class="keyword">val</span> onNewDelta: (<span class="built_in">Float</span>) -&gt; <span class="built_in">Float</span> = &#123; delta -&gt;</span><br><span class="line">        <span class="keyword">val</span> oldState = basicState</span><br><span class="line">        <span class="keyword">val</span> newState = (basicState + delta).coerceIn(minBound, maxBound)</span><br><span class="line">        basicState = newState</span><br><span class="line">        newState - oldState</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个 dispatcher 来分派嵌套的滚动事件 (作为嵌套的滚动子项参与)</span></span><br><span class="line">    <span class="keyword">val</span> nestedScrollDispatcher = remember &#123; NestedScrollDispatcher() &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建嵌套滚动连接以响应嵌套滚动事件 (作为父元素参与)</span></span><br><span class="line">    <span class="keyword">val</span> nestedScrollConnection = remember &#123;</span><br><span class="line">        <span class="keyword">object</span> : NestedScrollConnection &#123;</span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onPostScroll</span><span class="params">(consumed: <span class="type">Offset</span>, available: <span class="type">Offset</span>, source: <span class="type">NestedScrollSource</span>)</span></span>: Offset &#123;</span><br><span class="line">                <span class="comment">// 我们没有 fling，所以我们对常规的 postScroll 周期感兴趣，让我们尝试消耗剩余的量，并返回消耗的量</span></span><br><span class="line">                <span class="keyword">val</span> vertical = available.y</span><br><span class="line">                <span class="keyword">val</span> weConsumed = onNewDelta(vertical)</span><br><span class="line">                <span class="keyword">return</span> Offset(x = <span class="number">0f</span>, y = weConsumed)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Box(</span><br><span class="line">        Modifier</span><br><span class="line">            .fillMaxWidth()</span><br><span class="line">            .height(<span class="number">100.</span>dp)</span><br><span class="line">            .background(Color.Magenta)</span><br><span class="line">            <span class="comment">// 将自己附加到嵌套的滚动系统</span></span><br><span class="line">            .nestedScroll(connection = nestedScrollConnection, dispatcher = nestedScrollDispatcher)</span><br><span class="line">            .draggable(</span><br><span class="line">                orientation = Orientation.Vertical,</span><br><span class="line">                state = rememberDraggableState &#123; delta -&gt;</span><br><span class="line">                    <span class="comment">// 这是普通的拖拽，先问问父元素是否想要预消费(这是一个嵌套的滚动契约)</span></span><br><span class="line">                    <span class="keyword">val</span> parentsConsumed = nestedScrollDispatcher.dispatchPreScroll(</span><br><span class="line">                        available = Offset(x = <span class="number">0f</span>, y = delta),</span><br><span class="line">                        source = NestedScrollSource.Drag</span><br><span class="line">                    )</span><br><span class="line">                    <span class="comment">// 调整我们可用的量，因为可能父元素已经消耗了一些</span></span><br><span class="line">                    <span class="keyword">val</span> adjustedAvailable = delta - parentsConsumed.y</span><br><span class="line">                    <span class="comment">// 我们的子元素进行消费</span></span><br><span class="line">                    <span class="keyword">val</span> weConsumed = onNewDelta(adjustedAvailable)</span><br><span class="line">                    <span class="comment">// 将 pre-scroll 和我们消费之后剩下的量作为 postScroll 进行调度</span></span><br><span class="line">                    <span class="keyword">val</span> totalConsumed = Offset(x = <span class="number">0f</span>, y = weConsumed) + parentsConsumed</span><br><span class="line">                    <span class="keyword">val</span> left = adjustedAvailable - weConsumed</span><br><span class="line">                    nestedScrollDispatcher.dispatchPostScroll(</span><br><span class="line">                        consumed = totalConsumed,</span><br><span class="line">                        available = Offset(x = <span class="number">0f</span>, y = left),</span><br><span class="line">                        source = NestedScrollSource.Drag</span><br><span class="line">                    )</span><br><span class="line">                    <span class="comment">// 这里我们不会分发 pre/post fling 事件，因为我们这里没有fling操作，但是思想是相似的：</span></span><br><span class="line">                    <span class="comment">// 1. 分发 pre fling, 请求父元素进行预消费</span></span><br><span class="line">                    <span class="comment">// 2. 执行 fling 动作</span></span><br><span class="line">                    <span class="comment">// 3. 分发 post fling, 让父元素响应和处理剩余的速度</span></span><br><span class="line">                &#125;</span><br><span class="line">            )</span><br><span class="line">    ) &#123;</span><br><span class="line">        Box(modifier = Modifier.align(Alignment.Center)) &#123;</span><br><span class="line">            content(basicState)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以把上面的 <code>NestedScrollByDispatcher</code> 组件放在一个 <code>LazyColumn</code> 滚动列表中查看效果：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">NestedScrollByDispatcherUse</span><span class="params">()</span></span> &#123;</span><br><span class="line">    LazyColumn(horizontalAlignment = Alignment.CenterHorizontally) &#123;</span><br><span class="line">        items(<span class="number">100</span>) &#123; index -&gt;</span><br><span class="line">            NestedScrollByDispatcher &#123; delta -&gt;</span><br><span class="line">                Text(<span class="string">&quot;第 <span class="variable">$index</span> 项 draggable State: <span class="subst">$&#123;delta.roundToInt()&#125;</span>&quot;</span>, color = Color.White, fontSize = <span class="number">16.</span>sp)</span><br><span class="line">            &#125;</span><br><span class="line">            Divider()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/09cef5363553be6550a9030ff42d9ba9.gif" alt="在这里插入图片描述"></p>
<p>如果把 <code>NestedScrollByDispatcher</code> 的 <code>content</code> 传入另外一个 <code>LazyColumn</code> 可能效果会更加明显：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">NestedScrollByDispatcherUse</span><span class="params">()</span></span> &#123;</span><br><span class="line">    LazyColumn(horizontalAlignment = Alignment.CenterHorizontally) &#123;</span><br><span class="line">        items(<span class="number">100</span>) &#123; index -&gt;</span><br><span class="line">            NestedScrollByDispatcher &#123; delta -&gt; </span><br><span class="line">                SimpleColumnList()</span><br><span class="line">            &#125;</span><br><span class="line">            Divider()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">SimpleColumnList</span><span class="params">()</span></span> &#123;</span><br><span class="line">    LazyColumn(</span><br><span class="line">        modifier = Modifier.width(<span class="number">200.</span>dp).height(<span class="number">100.</span>dp).background(getRandomColor()),</span><br><span class="line">        contentPadding = PaddingValues(<span class="number">5.</span>dp),</span><br><span class="line">        horizontalAlignment = Alignment.CenterHorizontally</span><br><span class="line">    ) &#123;</span><br><span class="line">        items(<span class="number">10</span>) &#123; index -&gt;</span><br><span class="line">            Text(<span class="string">&quot;子列表的第 <span class="variable">$index</span> 项&quot;</span>, fontSize = <span class="number">16.</span>sp)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/ac7cc1777ce815960fdf5e8639f1d8df.gif" alt="在这里插入图片描述"></p>
<blockquote>
<p>注意：建议在重组之间重用 <code>NestedScrollConnection</code> 和 <code>NestedScrollDispatcher</code> 对象，因为不同的对象会导致嵌套滚动图被不必要地重新计算。</p>
</blockquote>
<p>最后再分享一个通过 <code>nestedScroll</code> 实现的列表视差滚动效果的动画：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ParallaxScrollByNestedScrollDemo</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> moonScrollSpeed = <span class="number">0.3f</span></span><br><span class="line">    <span class="keyword">val</span> midBgScrollSpeed = <span class="number">0.03f</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> imageHeight = (LocalConfiguration.current.screenWidthDp * (<span class="number">2f</span> / <span class="number">3f</span>)).dp</span><br><span class="line">    <span class="keyword">val</span> lazyListState = rememberLazyListState()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> moonOffset <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">0f</span>) &#125;</span><br><span class="line">    <span class="keyword">var</span> midBgOffset <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">0f</span>) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> nestedScrollConnection = <span class="keyword">object</span> : NestedScrollConnection &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onPreScroll</span><span class="params">(available: <span class="type">Offset</span>, source: <span class="type">NestedScrollSource</span>)</span></span>: Offset &#123;</span><br><span class="line">            <span class="keyword">val</span> delta = available.y</span><br><span class="line">            <span class="keyword">val</span> layoutInfo = lazyListState.layoutInfo</span><br><span class="line">            <span class="comment">// 当列表中第一项可见时手指向下滑动不执行动画偏移的修改</span></span><br><span class="line">            <span class="keyword">if</span>(lazyListState.firstVisibleItemIndex == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> Offset.Zero</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 当列表中最后一项可见时手指向上滑动不执行动画偏移的修改</span></span><br><span class="line">            <span class="keyword">if</span>(layoutInfo.visibleItemsInfo.lastOrNull()?.index == layoutInfo.totalItemsCount - <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> Offset.Zero</span><br><span class="line">            &#125;</span><br><span class="line">            moonOffset += delta * moonScrollSpeed</span><br><span class="line">            midBgOffset += delta * midBgScrollSpeed</span><br><span class="line">            <span class="keyword">return</span> Offset.Zero</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    LazyColumn(</span><br><span class="line">        modifier = Modifier</span><br><span class="line">            .fillMaxWidth()</span><br><span class="line">            .nestedScroll(nestedScrollConnection),</span><br><span class="line">        state = lazyListState</span><br><span class="line">    ) &#123;</span><br><span class="line">        items(<span class="number">10</span>) &#123;</span><br><span class="line">            Text(</span><br><span class="line">                text = <span class="string">&quot;Sample item&quot;</span>,</span><br><span class="line">                modifier = Modifier</span><br><span class="line">                    .fillMaxWidth()</span><br><span class="line">                    .padding(<span class="number">16.</span>dp)</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">        item &#123;</span><br><span class="line">            Box(</span><br><span class="line">                modifier = Modifier</span><br><span class="line">                    .clipToBounds()</span><br><span class="line">                    .fillMaxWidth()</span><br><span class="line">                    .height(imageHeight + midBgOffset.toDp())</span><br><span class="line">                    .background(</span><br><span class="line">                        Brush.verticalGradient(</span><br><span class="line">                            listOf(</span><br><span class="line">                                Color(<span class="number">0xFFf36b21</span>),</span><br><span class="line">                                Color(<span class="number">0xFFf9a521</span>)</span><br><span class="line">                            )</span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">            ) &#123;</span><br><span class="line">                Image(</span><br><span class="line">                    painter = painterResource(id = R.drawable.ic_moonbg),</span><br><span class="line">                    contentDescription = <span class="string">&quot;moon&quot;</span>,</span><br><span class="line">                    contentScale = ContentScale.FillWidth,</span><br><span class="line">                    alignment = Alignment.BottomCenter,</span><br><span class="line">                    modifier = Modifier</span><br><span class="line">                        .padding(<span class="number">15.</span>dp)</span><br><span class="line">                        .matchParentSize()</span><br><span class="line">                        .graphicsLayer &#123;</span><br><span class="line">                            translationY = moonOffset</span><br><span class="line">                        &#125;</span><br><span class="line">                )</span><br><span class="line">                Image(</span><br><span class="line">                    painter = painterResource(id = R.drawable.ic_midbg),</span><br><span class="line">                    contentDescription = <span class="string">&quot;mid bg&quot;</span>,</span><br><span class="line">                    contentScale = ContentScale.FillWidth,</span><br><span class="line">                    alignment = Alignment.BottomCenter,</span><br><span class="line">                    modifier = Modifier</span><br><span class="line">                        .matchParentSize()</span><br><span class="line">                        .graphicsLayer &#123;</span><br><span class="line">                            translationY = midBgOffset</span><br><span class="line">                        &#125;</span><br><span class="line">                )</span><br><span class="line">                Image(</span><br><span class="line">                    painter = painterResource(id = R.drawable.ic_outerbg),</span><br><span class="line">                    contentDescription = <span class="string">&quot;outer bg&quot;</span>,</span><br><span class="line">                    contentScale = ContentScale.FillWidth,</span><br><span class="line">                    alignment = Alignment.BottomCenter,</span><br><span class="line">                    modifier = Modifier.matchParentSize()</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        items(<span class="number">20</span>) &#123;</span><br><span class="line">            Text(</span><br><span class="line">                text = <span class="string">&quot;Sample item&quot;</span>,</span><br><span class="line">                modifier = Modifier</span><br><span class="line">                    .fillMaxWidth()</span><br><span class="line">                    .padding(<span class="number">16.</span>dp)</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/b570fece9a938780ecbd9b8a1b0eb35c.gif" alt="在这里插入图片描述"></p>
<p>其中，中间的动画背景图实际上是由三张矢量图的 drawable xml 资源组成的：</p>
<p><img src="https://markdown-1305107759.cos.ap-guangzhou.myqcloud.com/76eac9617d206aecd9ccd13458202bc9.png" alt="在这里插入图片描述"></p>
<p>然后在 <code>onPreScroll</code> 回调中，不断的在月亮和中间背景图上应用经过修改后的偏移量，以达到视差滚动效果。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://bravestsnail.github.io">BravestSnail</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://bravestsnail.github.io/2025/06/04/note/Android/compose/Compose%E4%B8%AD%E7%9A%84%E5%88%97%E8%A1%A8/">https://bravestsnail.github.io/2025/06/04/note/Android/compose/Compose%E4%B8%AD%E7%9A%84%E5%88%97%E8%A1%A8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://bravestsnail.github.io" target="_blank">BravestSnail's Blog</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/images/avatar.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/06/04/note/Android/compose/Compose%E4%B8%AD%E7%9A%84state%E6%A0%B8%E5%BF%83%E6%80%9D%E6%83%B3/" title="Compose中的state核心思想"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Compose中的state核心思想</div></div><div class="info-2"><div class="info-item-1">Compose 中的状态应用的“状态”是指可以随时间变化的任何值。这是一个非常宽泛的定义，从 Room 数据库到类的变量，全部涵盖在内。 所有 Android 应用都会向用户显示状态。下面是 Android 应用中的一些状态示例：  聊天应用中最新收到的消息。 用户的个人资料照片。 在项列表中的滚动位置。   关键提示：状态决定界面在任何特定时间的显示内容。  下面的示例通过构建一个健康App应用来展示如何正确的使用Compose中的状态。 构建的第一项功能是饮水计数器，用于记录您一天饮用了多少杯水。 创建一个名为 WaterCounter 的可组合函数，其中包含一个 Text 可组合项，用于显示饮水杯数。饮水杯数应存储在名为 count 的值中。 创建一个包含 WaterCounter 可组合函数的新文件 WaterCounter.kt，如下所示： 1234567891011121314151617import androidx.compose.foundation.layout.paddingimport...</div></div></div></a><a class="pagination-related" href="/2025/06/04/note/Android/compose/Compose%E4%B8%AD%E7%9A%84%E5%89%AF%E4%BD%9C%E7%94%A8/" title="Compose中的副作用"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Compose中的副作用</div></div><div class="info-2"><div class="info-item-1">什么是副作用从本质上讲，副作用是任何超出函数控制和作用域的东西。副作用会使函数变得不确定，因此它们使开发人员难以推理代码。 想象有一个函数，它被期望对两个数相加：  对于相同的输入值，其结果永远不会变化，也就是说，不会因为运行次数的增加导致输出结果的不同，因为该函数所做的唯一一件事就是将它们相加。因此，我们可以说这个函数是确定的，我们可以很容易地对它进行推理。这样的函数也经常被称为 “纯函数”，因为它只使用它的输入来计算结果。 现在，让我们考虑添加一些附带行为:  我们引入了一个计算缓存来节省计算时间，如果之前已经计算过结果的话，将会直接返回缓存的结果。但是这个缓存逃脱了函数的控制，因此没有任何东西告诉我们从它读取的值是否自上次执行以来没有被修改过。想象一下，这个缓存正在从一个不同的线程并发更新，突然发现两次连续的调用get(a,...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/images/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">BravestSnail</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">78</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Cloumn-%E5%92%8C-Row"><span class="toc-number">1.</span> <span class="toc-text">Cloumn 和 Row</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LazyColumn-%E5%92%8C-LazyRow"><span class="toc-number">2.</span> <span class="toc-text">LazyColumn 和 LazyRow</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B2%98%E6%80%A7-header"><span class="toc-number">2.1.</span> <span class="toc-text">粘性 header</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%92%E5%88%97%E6%96%B9%E5%BC%8F"><span class="toc-number">2.2.</span> <span class="toc-text">自定义排列方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#contentPadding-%E5%86%85%E5%AE%B9%E8%BE%B9%E8%B7%9D"><span class="toc-number">2.3.</span> <span class="toc-text">contentPadding 内容边距</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E8%BF%94%E5%9B%9E%E9%A1%B6%E9%83%A8%E6%8C%89%E9%92%AE"><span class="toc-number">2.4.</span> <span class="toc-text">显示返回顶部按钮</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#contentType-%E5%A4%9A%E7%B1%BB%E5%9E%8B%E5%88%97%E8%A1%A8"><span class="toc-number">2.5.</span> <span class="toc-text">contentType 多类型列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BB%B6%E8%BF%9F%E5%88%97%E8%A1%A8%E7%9A%84%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">2.6.</span> <span class="toc-text">延迟列表的使用注意事项</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BA%E5%88%97%E8%A1%A8%E9%A1%B9%E6%8C%87%E5%AE%9A-key"><span class="toc-number">2.6.1.</span> <span class="toc-text">为列表项指定 key</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%81%BF%E5%85%8D%E4%BD%BF%E7%94%A8%E5%A4%A7%E5%B0%8F%E4%B8%BA-0-%E5%83%8F%E7%B4%A0%E7%9A%84%E5%88%97%E8%A1%A8%E9%A1%B9"><span class="toc-number">2.6.2.</span> <span class="toc-text">避免使用大小为 0 像素的列表项</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%81%BF%E5%85%8D%E5%B5%8C%E5%A5%97%E5%8F%AF%E4%BB%A5%E5%90%8C%E6%96%B9%E5%90%91%E6%BB%9A%E5%8A%A8%E7%9A%84%E7%BB%84%E4%BB%B6"><span class="toc-number">2.6.3.</span> <span class="toc-text">避免嵌套可以同方向滚动的组件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B0%BD%E9%87%8F%E9%81%BF%E5%85%8D%E5%B0%86%E5%A4%9A%E4%B8%AA%E5%85%83%E7%B4%A0%E6%94%BE%E5%85%A5%E4%B8%80%E4%B8%AA-item-%E9%A1%B9%E4%B8%AD"><span class="toc-number">2.6.4.</span> <span class="toc-text">尽量避免将多个元素放入一个 item{...} 项中</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LazyVerticalGrid-%E5%92%8C-LazyHorizontalGrid"><span class="toc-number">3.</span> <span class="toc-text">LazyVerticalGrid 和 LazyHorizontalGrid</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%8D%95%E5%85%83%E6%A0%BC%E7%9A%84%E5%A4%A7%E5%B0%8F%E5%8D%A0%E6%AF%94%E6%9D%83%E9%87%8D"><span class="toc-number">3.1.</span> <span class="toc-text">设置单元格的大小占比权重</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GridCells-Adaptive-%E8%87%AA%E9%80%82%E5%BA%94%E5%B1%8F%E5%B9%95"><span class="toc-number">3.2.</span> <span class="toc-text">GridCells.Adaptive() 自适应屏幕</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89columns%E7%9A%84%E6%AF%8F%E4%B8%80%E5%88%97%E7%9A%84%E5%AE%BD%E5%BA%A6%E5%8D%A0%E6%AF%94"><span class="toc-number">3.3.</span> <span class="toc-text">自定义columns的每一列的宽度占比</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LazyHorizontalStaggeredGrid-%E5%92%8C-LazyVerticalStaggeredGrid-%E7%80%91%E5%B8%83%E6%B5%81"><span class="toc-number">4.</span> <span class="toc-text">LazyHorizontalStaggeredGrid 和 LazyVerticalStaggeredGrid 瀑布流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0-Modifier-pullRefresh"><span class="toc-number">5.</span> <span class="toc-text">下拉刷新 Modifier.pullRefresh</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Modifier-verticalScroll-%E5%92%8C-Modifier-horizontalScroll-%E5%BC%80%E5%90%AF%E6%BB%9A%E5%8A%A8%E7%89%B9%E6%80%A7"><span class="toc-number">6.</span> <span class="toc-text">Modifier.verticalScroll() 和 Modifier.horizontalScroll() 开启滚动特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Modifier-nestedScroll-%E5%BC%80%E5%90%AF%E5%B5%8C%E5%A5%97%E6%BB%9A%E5%8A%A8"><span class="toc-number">7.</span> <span class="toc-text">Modifier.nestedScroll() 开启嵌套滚动</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/04/note/%E4%B8%8A%E4%B8%8B%E6%96%87Context/" title="上下文Context">上下文Context</a><time datetime="2025-06-04T12:46:35.127Z" title="发表于 2025-06-04 20:46:35">2025-06-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/04/note/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" title="正则表达式">正则表达式</a><time datetime="2025-06-04T12:46:35.127Z" title="发表于 2025-06-04 20:46:35">2025-06-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/04/note/%E6%B3%A8%E8%A7%A3%E5%92%8C%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8/" title="注解和注解处理器">注解和注解处理器</a><time datetime="2025-06-04T12:46:35.127Z" title="发表于 2025-06-04 20:46:35">2025-06-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/04/note/%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E3%80%81%E5%8D%8F%E7%A8%8B%E7%9A%84%E5%8C%BA%E5%88%AB/" title="进程、线程、协程的区别">进程、线程、协程的区别</a><time datetime="2025-06-04T12:46:35.127Z" title="发表于 2025-06-04 20:46:35">2025-06-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/04/note/kotlin/Kotlin%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/" title="Kotlin踩坑记录">Kotlin踩坑记录</a><time datetime="2025-06-04T12:46:35.127Z" title="发表于 2025-06-04 20:46:35">2025-06-04</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By BravestSnail</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>